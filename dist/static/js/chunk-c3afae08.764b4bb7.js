(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-c3afae08"],{"0210":function(e,t,i){"use strict";function n(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function r(e){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach((function(t){u(e,t,i[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(i,t))}))}return e}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function s(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,A(n.key),n)}}function l(e,t,i){return t&&o(e.prototype,t),i&&o(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function u(e,t,i){return t=A(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function c(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&d(e,t)}function h(e){return h=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},h(e)}function d(e,t){return d=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},d(e,t)}function f(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function v(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return g(e)}function p(e){var t=f();return function(){var i,n=h(e);if(t){var r=h(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return v(this,i)}}function m(e,t){while(!Object.prototype.hasOwnProperty.call(e,t))if(e=h(e),null===e)break;return e}function y(){return y="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(e,t,i){var n=m(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(arguments.length<3?e:i):r.value}},y.apply(this,arguments)}function b(e){return E(e)||T(e)||k(e)||_()}function E(e){if(Array.isArray(e))return S(e)}function T(e){if("undefined"!==typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function k(e,t){if(e){if("string"===typeof e)return S(e,t);var i=Object.prototype.toString.call(e).slice(8,-1);return"Object"===i&&e.constructor&&(i=e.constructor.name),"Map"===i||"Set"===i?Array.from(e):"Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?S(e,t):void 0}}function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var i=0,n=new Array(t);i<t;i++)n[i]=e[i];return n}function _(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function L(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function A(e){var t=L(e,"string");return"symbol"===typeof t?t:String(t)}i.d(t,"a",(function(){return g})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return l})),i.d(t,"d",(function(){return p})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return y})),i.d(t,"g",(function(){return h})),i.d(t,"h",(function(){return c})),i.d(t,"i",(function(){return r})),i.d(t,"j",(function(){return v})),i.d(t,"k",(function(){return b})),i.d(t,"l",(function(){return a}))},2535:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return h})),i.d(t,"c",(function(){return a})),i.d(t,"d",(function(){return o})),i.d(t,"e",(function(){return u})),i.d(t,"f",(function(){return d})),i.d(t,"g",(function(){return s})),i.d(t,"h",(function(){return l}));var n=i("0210");function r(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];var s=t.call.apply(t,[e].concat(r));i&&"function"===typeof i&&(s&&s.then?s.then((function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];i.call.apply(i,[e].concat(n))})):i.call.apply(i,[e].concat(r)))}function a(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{pre:null,next:null};return this.__hooks||(this.__hooks={}),!this.__hooks[e]&&(this.__hooks[e]=null),function(){var a=arguments,s=this;if(i.pre)try{var o;(o=i.pre).call.apply(o,[this].concat(Array.prototype.slice.call(arguments)))}catch(c){throw c.message="[pluginName: ".concat(this.pluginName,":").concat(e,":pre error] >> ").concat(c.message),c}if(this.__hooks&&this.__hooks[e])try{var l,u=(l=this.__hooks[e]).call.apply(l,[this,this].concat(Array.prototype.slice.call(arguments)));u?u.then?u.then((function(e){!1!==e&&r.apply(void 0,[s,t,i.next].concat(Object(n["k"])(a)))})).catch((function(e){throw e})):r.apply(void 0,[this,t,i.next].concat(Array.prototype.slice.call(arguments))):void 0===u&&r.apply(void 0,[this,t,i.next].concat(Array.prototype.slice.call(arguments)))}catch(c){throw c.message="[pluginName: ".concat(this.pluginName,":").concat(e,"] >> ").concat(c.message),c}else r.apply(void 0,[this,t,i.next].concat(Array.prototype.slice.call(arguments)))}.bind(this)}function s(e,t){var i=this.__hooks;if(i)return!!i.hasOwnProperty(e)&&(i&&(i[e]=t),!0)}function o(e,t){var i=this.__hooks;i&&delete i[e]}function l(e){if(this.plugins&&this.plugins[e.toLowerCase()]){for(var t=this.plugins[e.toLowerCase()],i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.useHooks&&t.useHooks.apply(t,n)}}function u(e){if(this.plugins&&this.plugins[e.toLowerCase()]){var t=this.plugins[e.toLowerCase()];if(t){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];return t.removeHooks&&t.removeHooks.apply(t,n)}}}function c(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];e.__hooks={},t&&t.map((function(t){e.__hooks[t]=null})),Object.defineProperty(e,"hooks",{get:function(){return e.__hooks&&Object.keys(e.__hooks).map((function(t){if(e.__hooks[t])return t}))}})}function h(e){e.__hooks=null}function d(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];if(!e.__hooks||!e.__hooks[t])return i.call.apply(i,[e,e].concat(r));var s,o=(s=e.__hooks[t]).call.apply(s,[e,e].concat(r));if(o&&o.then)o.then((function(t){return!1===t?null:i.call.apply(i,[e,e].concat(r))})).catch((function(e){}));else if(!1!==o)return i.call.apply(i,[e,e].concat(r))}},"2a75":function(e,t,i){"use strict";i.d(t,"a",(function(){return l}));var n=i("0210"),r=i("9a98"),a=i("d2c7"),s=i("2535");function o(e,t){a["b"].logError("[".concat(e,"] event or callback cant be undefined or null when call ").concat(t))}var l=function(){function e(t){Object(n["b"])(this,e),r["b"].checkIsFunction(this.beforeCreate)&&this.beforeCreate(t),Object(s["a"])(this),this.__args=t,this.__events={},this.__onceEvents={},this.config=t.config||{},this.player=null,this.playerConfig={},this.pluginName="",this.__init(t)}return Object(n["c"])(e,[{key:"beforeCreate",value:function(e){}},{key:"afterCreate",value:function(){}},{key:"beforePlayerInit",value:function(){}},{key:"onPluginsReady",value:function(){}},{key:"afterPlayerInit",value:function(){}},{key:"destroy",value:function(){}},{key:"__init",value:function(e){this.player=e.player,this.playerConfig=e.player&&e.player.config,this.pluginName=e.pluginName?e.pluginName.toLowerCase():this.constructor.pluginName.toLowerCase(),this.logger=e.player&&e.player.logger}},{key:"updateLang",value:function(e){e||(e=this.lang)}},{key:"lang",get:function(){return this.player.lang}},{key:"i18n",get:function(){return this.player.i18n}},{key:"i18nKeys",get:function(){return this.player.i18nKeys}},{key:"domEventType",get:function(){var e=r["b"].checkTouchSupport()?"touch":"mouse";return!this.playerConfig||"touch"!==this.playerConfig.domEventType&&"mouse"!==this.playerConfig.domEventType||(e=this.playerConfig.domEventType),e}},{key:"on",value:function(e,t){var i=this;e&&t&&this.player?"string"===typeof e?(this.__events[e]=t,this.player.on(e,t)):Array.isArray(e)&&e.forEach((function(e){i.__events[e]=t,i.player.on(e,t)})):o(this.pluginName,"plugin.on(event, callback)")}},{key:"once",value:function(e,t){var i=this;e&&t&&this.player?"string"===typeof e?(this.__onceEvents[e]=t,this.player.once(e,t)):Array.isArray(e)&&e.forEach((function(n){i.__onceEvents[n]=t,i.player.once(e,t)})):o(this.pluginName,"plugin.once(event, callback)")}},{key:"off",value:function(e,t){var i=this;e&&t&&this.player?"string"===typeof e?(delete this.__events[e],this.player.off(e,t)):Array.isArray(e)&&e.forEach((function(n){delete i.__events[e],i.player.off(n,t)})):o(this.pluginName,"plugin.off(event, callback)")}},{key:"offAll",value:function(){var e=this;["__events","__onceEvents"].forEach((function(t){Object.keys(e[t]).forEach((function(i){e[t][i]&&e.off(i,e[t][i]),i&&delete e[t][i]}))})),this.__events={},this.__onceEvents={}}},{key:"emit",value:function(e){var t;if(this.player){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];(t=this.player).emit.apply(t,[e].concat(n))}}},{key:"emitUserAction",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this.player){var r=Object(n["i"])(Object(n["i"])({},i),{},{pluginName:this.pluginName});this.player.emitUserAction(e,t,r)}}},{key:"hook",value:function(e,t){return s["c"].call.apply(s["c"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return s["g"].call.apply(s["g"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){for(var i=arguments.length,n=new Array(i>2?i-2:0),r=2;r<i;r++)n[r-2]=arguments[r];return s["d"].call.apply(s["d"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";if(this.player)return i&&(t.pluginName=i),this.player.registerPlugin({plugin:e,options:t})}},{key:"getPlugin",value:function(e){return this.player?this.player.getPlugin(e):null}},{key:"__destroy",value:function(){var e=this,t=this.player,i=this.pluginName;this.offAll(),r["b"].clearAllTimers(this),r["b"].checkIsFunction(this.destroy)&&this.destroy(),["player","playerConfig","pluginName","logger","__args","__hooks"].map((function(t){e[t]=null})),t.unRegisterPlugin(i),Object(s["b"])(this)}}],[{key:"defineGetterOrSetter",value:function(e,t){for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&Object.defineProperty(e,i,t[i])}},{key:"defaultConfig",get:function(){return{}}},{key:"pluginName",get:function(){return"pluginName"}}]),e}()},"2bdd":function(e,t,i){"use strict";i.d(t,"a",(function(){return s})),i.d(t,"b",(function(){return l}));var n=i("0210"),r=i("301b"),a=i("9a98"),s={1:"media",2:"media",3:"media",4:"media",5:"media",6:"media"},o={1:5101,2:5102,3:5103,4:5104,5:5105,6:5106},l=Object(n["c"])((function e(t){var i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{errorType:"",errorCode:0,errorMessage:"",originError:"",ext:{},mediaError:null};Object(n["b"])(this,e);var s=t&&t.i18n?t.i18n.ERROR_TYPES:null;if(t.media){var l=i.mediaError?i.mediaError:t.media.error||{},u=t.duration,c=t.currentTime,h=t.ended,d=t.src,f=t.currentSrc,g=t.media,v=g.readyState,p=g.networkState,m=i.errorCode||l.code;o[m]&&(m=o[m]);var y={playerVersion:r["a"],currentTime:c,duration:u,ended:h,readyState:v,networkState:p,src:d||f,errorType:i.errorType,errorCode:m,message:i.errorMessage||l.message,mediaError:l,originError:i.originError?i.originError.stack:"",host:a["b"].getHostFromUrl(d||f)};return i.ext&&Object.keys(i.ext).map((function(e){y[e]=i.ext[e]})),y}if(arguments.length>1){for(var b={playerVersion:r["a"],domain:document.domain},E=["errorType","currentTime","duration","networkState","readyState","src","currentSrc","ended","errd","errorCode","mediaError"],T=0;T<arguments.length;T++)b[E[T]]=arguments[T];return b.ex=s?(s[arguments[0]]||{}).msg:"",b}}))},"2cd3":function(e,t,i){"use strict";var n=i("b28d");i.d(t,"a",(function(){return n}))},"301b":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n="3.0.5"},"3fcb":function(e,t,i){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,g(n.key),n)}}function a(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t){if("function"!==typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&l(e,t)}function o(e){return o=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},o(e)}function l(e,t){return l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},l(e,t)}function u(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function c(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function h(e,t){if(t&&("object"===typeof t||"function"===typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return c(e)}function d(e){var t=u();return function(){var i,n=o(e);if(t){var r=o(this).constructor;i=Reflect.construct(n,arguments,r)}else i=n.apply(this,arguments);return h(this,i)}}function f(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function g(e){var t=f(e,"string");return"symbol"===typeof t?t:String(t)}i.d(t,"a",(function(){return E}));var v=i("2cd3"),p=i("2a75"),m=i("4472"),y=i.n(m),b={getBrowserVersion:function(){var e=navigator.userAgent;if(e.toLowerCase().indexOf("mobile")>-1)return"Unknown";if(e.indexOf("Firefox")>-1){var t=e.match(/firefox\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Firefox "+t}if(e.indexOf("Edge")>-1){var i=e.match(/edge\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Edge "+i}if(e.indexOf("rv:11")>-1)return"IE 11";if(e.indexOf("Opera")>-1||e.indexOf("OPR")>-1){if(e.indexOf("Opera")>-1){var n=e.match(/opera\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+n}if(e.indexOf("OPR")>-1){var r=e.match(/opr\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Opera "+r}}else{if(e.indexOf("Chrome")>-1){var a=e.match(/chrome\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Chrome "+a}if(e.indexOf("Safari")>-1){var s=e.match(/safari\/[\d.]+/gi)[0].match(/[\d]+/)[0];return"Safari "+s}if(!(e.indexOf("MSIE")>-1||e.indexOf("Trident")>-1))return"Unknown";if(e.indexOf("MSIE")>-1){var o=e.match(/msie [\d.]+/gi)[0].match(/[\d]+/)[0];return"IE "+o}if(e.indexOf("Trident")>-1){var l=e.match(/trident\/[\d.]+/gi)[0].match(/[\d]+/)[0],u=parseInt(l)+4;return"IE "+u}}}},E=function(e){s(i,e);var t=d(i);function i(e){var r;return n(this,i),r=t.call(this,e),r.browser=b.getBrowserVersion(),r.hls=null,r.hlsOpts={},r}return a(i,[{key:"afterCreate",value:function(){var e=this,t=this.config.hlsOpts;this.hlsOpts=t,this.on(v["a"].URL_CHANGE,(function(t){/^blob/.test(t)||(e.playerConfig.url=t,e.register(t))}));try{p["a"].defineGetterOrSetter(this.player,{url:{get:function(){try{return e.player.video.src}catch(t){return null}},configurable:!0}})}catch(i){}}},{key:"beforePlayerInit",value:function(){this.register(this.player.config.url)}},{key:"destroy",value:function(){this.hls&&this.hls.destroy();var e=this.player;p["a"].defineGetterOrSetter(e,{url:{get:function(){try{return e.__url}catch(t){return null}},configurable:!0}})}},{key:"register",value:function(e){var t=this,i=this.player;this.hls&&this.hls.destroy(),this.hls=new y.a(this.hlsOpts),this.hls.once(y.a.Events.MEDIA_ATTACHED,(function(){t.hls.loadSource(e)})),this.hls.on(y.a.Events.ERROR,(function(e,n){if(i.emit("HLS_ERROR",{errorType:n.type,errorDetails:n.details,errorFatal:n.fatal}),n.fatal)switch(n.type){case y.a.ErrorTypes.NETWORK_ERROR:t.hls.startLoad();break;case y.a.ErrorTypes.MEDIA_ERROR:t.hls.recoverMediaError();break;default:i.emit("error",n)}})),this.hls.attachMedia(this.player.video),this._statistics()}},{key:"_statistics",value:function(){var e={speed:0,playerType:"HlsPlayer"},t={videoDataRate:0,audioDataRate:0},i=this.player,n=this.hls;n.on(y.a.Events.FRAG_LOAD_PROGRESS,(function(t,i){e.speed=i.stats.loaded/1e3})),n.on(y.a.Events.FRAG_PARSING_DATA,(function(e,i){"video"===i.type&&(t.fps=parseInt(i.nb/(i.endPTS-i.startPTS)))})),n.on(y.a.Events.FRAG_PARSING_INIT_SEGMENT,(function(e,n){if(t.hasAudio=!(!n.tracks||!n.tracks.audio),t.hasVideo=!(!n.tracks||!n.tracks.audio),t.hasAudio){var r=n.tracks.audio;t.audioChannelCount=r.metadata&&r.metadata.channelCount?r.metadata.channelCount:0,t.audioCodec=r.codec}if(t.hasVideo){var a=n.tracks.video;t.videoCodec=a.codec,t.width=a.metadata&&a.metadata.width?a.metadata.width:0,t.height=a.metadata&&a.metadata.height?a.metadata.height:0}t.duration=n.frag&&n.frag.duration?n.frag.duration:0,t.level=n.frag&&n.frag.levels?n.frag.levels:0,(t.videoCodec||t.audioCodec)&&(t.mimeType='video/hls; codecs="'.concat(t.videoCodec,";").concat(t.audioCodec,'"')),i.mediainfo=t,i.emit("media_info",t)})),this._statisticsTimmer=setInterval((function(){i.emit("statistics_info",e),e.speed=0}),1e3)}}],[{key:"pluginName",get:function(){return"HlsJsPlugin"}},{key:"defaultConfig",get:function(){return{hlsOpts:{}}}},{key:"isSupported",get:function(){return y.a.isSupported}}]),i}(p["a"])},4472:function(e,t,i){(function t(i){(function(t,i){e.exports=i()})(0,(function(){"use strict";function e(e,t){var i=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),i.push.apply(i,n)}return i}function n(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function r(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,m(n.key),n)}}function a(e,t,i){return t&&r(e.prototype,t),i&&r(e,i),Object.defineProperty(e,"prototype",{writable:!1}),e}function s(e,t,i){return t=m(t),t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}function o(){return o=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])}return e},o.apply(this,arguments)}function l(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,c(e,t)}function u(e){return u=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},u(e)}function c(e,t){return c=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},c(e,t)}function h(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,i){return d=h()?Reflect.construct.bind():function(e,t,i){var n=[null];n.push.apply(n,t);var r=Function.bind.apply(e,n),a=new r;return i&&c(a,i.prototype),a},d.apply(null,arguments)}function f(e){return-1!==Function.toString.call(e).indexOf("[native code]")}function g(e){var t="function"===typeof Map?new Map:void 0;return g=function(e){if(null===e||!f(e))return e;if("function"!==typeof e)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof t){if(t.has(e))return t.get(e);t.set(e,i)}function i(){return d(e,arguments,u(this).constructor)}return i.prototype=Object.create(e.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),c(i,e)},g(e)}function v(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){if("object"!==typeof e||null===e)return e;var i=e[Symbol.toPrimitive];if(void 0!==i){var n=i.call(e,t||"default");if("object"!==typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function m(e){var t=p(e,"string");return"symbol"===typeof t?t:String(t)}function y(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e["default"]:e}var b={exports:{}};(function(e,t){(function(t){var i=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,n=/^(?=([^\/?#]*))\1([^]*)$/,r=/(?:\/|^)\.(?=\/)/g,a=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,s={buildAbsoluteURL:function(e,t,i){if(i=i||{},e=e.trim(),t=t.trim(),!t){if(!i.alwaysNormalize)return e;var r=s.parseURL(e);if(!r)throw new Error("Error trying to parse base URL.");return r.path=s.normalizePath(r.path),s.buildURLFromParts(r)}var a=s.parseURL(t);if(!a)throw new Error("Error trying to parse relative URL.");if(a.scheme)return i.alwaysNormalize?(a.path=s.normalizePath(a.path),s.buildURLFromParts(a)):t;var o=s.parseURL(e);if(!o)throw new Error("Error trying to parse base URL.");if(!o.netLoc&&o.path&&"/"!==o.path[0]){var l=n.exec(o.path);o.netLoc=l[1],o.path=l[2]}o.netLoc&&!o.path&&(o.path="/");var u={scheme:o.scheme,netLoc:a.netLoc,path:null,params:a.params,query:a.query,fragment:a.fragment};if(!a.netLoc&&(u.netLoc=o.netLoc,"/"!==a.path[0]))if(a.path){var c=o.path,h=c.substring(0,c.lastIndexOf("/")+1)+a.path;u.path=s.normalizePath(h)}else u.path=o.path,a.params||(u.params=o.params,a.query||(u.query=o.query));return null===u.path&&(u.path=i.alwaysNormalize?s.normalizePath(a.path):a.path),s.buildURLFromParts(u)},parseURL:function(e){var t=i.exec(e);return t?{scheme:t[1]||"",netLoc:t[2]||"",path:t[3]||"",params:t[4]||"",query:t[5]||"",fragment:t[6]||""}:null},normalizePath:function(e){e=e.split("").reverse().join("").replace(r,"");while(e.length!==(e=e.replace(a,"")).length);return e.split("").reverse().join("")},buildURLFromParts:function(e){return e.scheme+e.netLoc+e.path+e.params+e.query+e.fragment}};e.exports=s})()})(b);var E=b.exports,T=Number.isFinite||function(e){return"number"===typeof e&&isFinite(e)},k=function(e){return e["MEDIA_ATTACHING"]="hlsMediaAttaching",e["MEDIA_ATTACHED"]="hlsMediaAttached",e["MEDIA_DETACHING"]="hlsMediaDetaching",e["MEDIA_DETACHED"]="hlsMediaDetached",e["BUFFER_RESET"]="hlsBufferReset",e["BUFFER_CODECS"]="hlsBufferCodecs",e["BUFFER_CREATED"]="hlsBufferCreated",e["BUFFER_APPENDING"]="hlsBufferAppending",e["BUFFER_APPENDED"]="hlsBufferAppended",e["BUFFER_EOS"]="hlsBufferEos",e["BUFFER_FLUSHING"]="hlsBufferFlushing",e["BUFFER_FLUSHED"]="hlsBufferFlushed",e["MANIFEST_LOADING"]="hlsManifestLoading",e["MANIFEST_LOADED"]="hlsManifestLoaded",e["MANIFEST_PARSED"]="hlsManifestParsed",e["LEVEL_SWITCHING"]="hlsLevelSwitching",e["LEVEL_SWITCHED"]="hlsLevelSwitched",e["LEVEL_LOADING"]="hlsLevelLoading",e["LEVEL_LOADED"]="hlsLevelLoaded",e["LEVEL_UPDATED"]="hlsLevelUpdated",e["LEVEL_PTS_UPDATED"]="hlsLevelPtsUpdated",e["LEVELS_UPDATED"]="hlsLevelsUpdated",e["AUDIO_TRACKS_UPDATED"]="hlsAudioTracksUpdated",e["AUDIO_TRACK_SWITCHING"]="hlsAudioTrackSwitching",e["AUDIO_TRACK_SWITCHED"]="hlsAudioTrackSwitched",e["AUDIO_TRACK_LOADING"]="hlsAudioTrackLoading",e["AUDIO_TRACK_LOADED"]="hlsAudioTrackLoaded",e["SUBTITLE_TRACKS_UPDATED"]="hlsSubtitleTracksUpdated",e["SUBTITLE_TRACKS_CLEARED"]="hlsSubtitleTracksCleared",e["SUBTITLE_TRACK_SWITCH"]="hlsSubtitleTrackSwitch",e["SUBTITLE_TRACK_LOADING"]="hlsSubtitleTrackLoading",e["SUBTITLE_TRACK_LOADED"]="hlsSubtitleTrackLoaded",e["SUBTITLE_FRAG_PROCESSED"]="hlsSubtitleFragProcessed",e["CUES_PARSED"]="hlsCuesParsed",e["NON_NATIVE_TEXT_TRACKS_FOUND"]="hlsNonNativeTextTracksFound",e["INIT_PTS_FOUND"]="hlsInitPtsFound",e["FRAG_LOADING"]="hlsFragLoading",e["FRAG_LOAD_EMERGENCY_ABORTED"]="hlsFragLoadEmergencyAborted",e["FRAG_LOADED"]="hlsFragLoaded",e["FRAG_DECRYPTED"]="hlsFragDecrypted",e["FRAG_PARSING_INIT_SEGMENT"]="hlsFragParsingInitSegment",e["FRAG_PARSING_USERDATA"]="hlsFragParsingUserdata",e["FRAG_PARSING_METADATA"]="hlsFragParsingMetadata",e["FRAG_PARSED"]="hlsFragParsed",e["FRAG_BUFFERED"]="hlsFragBuffered",e["FRAG_CHANGED"]="hlsFragChanged",e["FPS_DROP"]="hlsFpsDrop",e["FPS_DROP_LEVEL_CAPPING"]="hlsFpsDropLevelCapping",e["ERROR"]="hlsError",e["DESTROYING"]="hlsDestroying",e["KEY_LOADING"]="hlsKeyLoading",e["KEY_LOADED"]="hlsKeyLoaded",e["LIVE_BACK_BUFFER_REACHED"]="hlsLiveBackBufferReached",e["BACK_BUFFER_REACHED"]="hlsBackBufferReached",e}({}),S=function(e){return e["NETWORK_ERROR"]="networkError",e["MEDIA_ERROR"]="mediaError",e["KEY_SYSTEM_ERROR"]="keySystemError",e["MUX_ERROR"]="muxError",e["OTHER_ERROR"]="otherError",e}({}),_=function(e){return e["KEY_SYSTEM_NO_KEYS"]="keySystemNoKeys",e["KEY_SYSTEM_NO_ACCESS"]="keySystemNoAccess",e["KEY_SYSTEM_NO_SESSION"]="keySystemNoSession",e["KEY_SYSTEM_NO_CONFIGURED_LICENSE"]="keySystemNoConfiguredLicense",e["KEY_SYSTEM_LICENSE_REQUEST_FAILED"]="keySystemLicenseRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED"]="keySystemServerCertificateRequestFailed",e["KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED"]="keySystemServerCertificateUpdateFailed",e["KEY_SYSTEM_SESSION_UPDATE_FAILED"]="keySystemSessionUpdateFailed",e["KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED"]="keySystemStatusOutputRestricted",e["KEY_SYSTEM_STATUS_INTERNAL_ERROR"]="keySystemStatusInternalError",e["MANIFEST_LOAD_ERROR"]="manifestLoadError",e["MANIFEST_LOAD_TIMEOUT"]="manifestLoadTimeOut",e["MANIFEST_PARSING_ERROR"]="manifestParsingError",e["MANIFEST_INCOMPATIBLE_CODECS_ERROR"]="manifestIncompatibleCodecsError",e["LEVEL_EMPTY_ERROR"]="levelEmptyError",e["LEVEL_LOAD_ERROR"]="levelLoadError",e["LEVEL_LOAD_TIMEOUT"]="levelLoadTimeOut",e["LEVEL_PARSING_ERROR"]="levelParsingError",e["LEVEL_SWITCH_ERROR"]="levelSwitchError",e["AUDIO_TRACK_LOAD_ERROR"]="audioTrackLoadError",e["AUDIO_TRACK_LOAD_TIMEOUT"]="audioTrackLoadTimeOut",e["SUBTITLE_LOAD_ERROR"]="subtitleTrackLoadError",e["SUBTITLE_TRACK_LOAD_TIMEOUT"]="subtitleTrackLoadTimeOut",e["FRAG_LOAD_ERROR"]="fragLoadError",e["FRAG_LOAD_TIMEOUT"]="fragLoadTimeOut",e["FRAG_DECRYPT_ERROR"]="fragDecryptError",e["FRAG_PARSING_ERROR"]="fragParsingError",e["FRAG_GAP"]="fragGap",e["REMUX_ALLOC_ERROR"]="remuxAllocError",e["KEY_LOAD_ERROR"]="keyLoadError",e["KEY_LOAD_TIMEOUT"]="keyLoadTimeOut",e["BUFFER_ADD_CODEC_ERROR"]="bufferAddCodecError",e["BUFFER_INCOMPATIBLE_CODECS_ERROR"]="bufferIncompatibleCodecsError",e["BUFFER_APPEND_ERROR"]="bufferAppendError",e["BUFFER_APPENDING_ERROR"]="bufferAppendingError",e["BUFFER_STALLED_ERROR"]="bufferStalledError",e["BUFFER_FULL_ERROR"]="bufferFullError",e["BUFFER_SEEK_OVER_HOLE"]="bufferSeekOverHole",e["BUFFER_NUDGE_ON_STALL"]="bufferNudgeOnStall",e["INTERNAL_EXCEPTION"]="internalException",e["INTERNAL_ABORTED"]="aborted",e["UNKNOWN"]="unknown",e}({}),L=function(){},A={trace:L,debug:L,log:L,warn:L,info:L,error:L},C=A;function O(e){var t=self.console[e];return t?t.bind(self.console,"["+e+"] >"):L}function R(e){for(var t=arguments.length,i=new Array(t>1?t-1:0),n=1;n<t;n++)i[n-1]=arguments[n];i.forEach((function(t){C[t]=e[t]?e[t].bind(e):O(t)}))}function w(e,t){if(self.console&&!0===e||"object"===typeof e){R(e,"debug","log","info","warn","error");try{C.log('Debug logs enabled for "'+t+'" in hls.js version 1.4.7')}catch(i){C=A}}else C=A}var x=C,I=/^(\d+)x(\d+)$/,D=/(.+?)=(".*?"|.*?)(?:,|$)/g,P=function(){function e(t){for(var i in"string"===typeof t&&(t=e.parseAttrList(t)),t)t.hasOwnProperty(i)&&("X-"===i.substring(0,2)&&(this.clientAttrs=this.clientAttrs||[],this.clientAttrs.push(i)),this[i]=t[i])}var t=e.prototype;return t.decimalInteger=function(e){var t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.hexadecimalInteger=function(e){if(this[e]){var t=(this[e]||"0x").slice(2);t=(1&t.length?"0":"")+t;for(var i=new Uint8Array(t.length/2),n=0;n<t.length/2;n++)i[n]=parseInt(t.slice(2*n,2*n+2),16);return i}return null},t.hexadecimalIntegerAsNumber=function(e){var t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t},t.decimalFloatingPoint=function(e){return parseFloat(this[e])},t.optionalFloat=function(e,t){var i=this[e];return i?parseFloat(i):t},t.enumeratedString=function(e){return this[e]},t.bool=function(e){return"YES"===this[e]},t.decimalResolution=function(e){var t=I.exec(this[e]);if(null!==t)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}},e.parseAttrList=function(e){var t,i={},n='"';D.lastIndex=0;while(null!==(t=D.exec(e))){var r=t[2];0===r.indexOf(n)&&r.lastIndexOf(n)===r.length-1&&(r=r.slice(1,-1));var a=t[1].trim();i[a]=r}return i},e}();function N(e){return"ID"!==e&&"CLASS"!==e&&"START-DATE"!==e&&"DURATION"!==e&&"END-DATE"!==e&&"END-ON-NEXT"!==e}function M(e){return"SCTE35-OUT"===e||"SCTE35-IN"===e}var F=function(){function e(e,t){if(this.attr=void 0,this._startDate=void 0,this._endDate=void 0,this._badValueForSameId=void 0,t){var i=t.attr;for(var n in i)if(Object.prototype.hasOwnProperty.call(e,n)&&e[n]!==i[n]){x.warn('DATERANGE tag attribute: "'+n+'" does not match for tags with ID: "'+e.ID+'"'),this._badValueForSameId=n;break}e=o(new P({}),i,e)}if(this.attr=e,this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){var r=new Date(this.attr["END-DATE"]);T(r.getTime())&&(this._endDate=r)}}return a(e,[{key:"id",get:function(){return this.attr.ID}},{key:"class",get:function(){return this.attr.CLASS}},{key:"startDate",get:function(){return this._startDate}},{key:"endDate",get:function(){if(this._endDate)return this._endDate;var e=this.duration;return null!==e?new Date(this._startDate.getTime()+1e3*e):null}},{key:"duration",get:function(){if("DURATION"in this.attr){var e=this.attr.decimalFloatingPoint("DURATION");if(T(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}},{key:"plannedDuration",get:function(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}},{key:"endOnNext",get:function(){return this.attr.bool("END-ON-NEXT")}},{key:"isValid",get:function(){return!!this.id&&!this._badValueForSameId&&T(this.startDate.getTime())&&(null===this.duration||this.duration>=0)&&(!this.endOnNext||!!this.class)}}]),e}(),j=function(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}},U={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"},B=function(){function e(e){var t;this._byteRange=null,this._url=null,this.baseurl=void 0,this.relurl=void 0,this.elementaryStreams=(t={},t[U.AUDIO]=null,t[U.VIDEO]=null,t[U.AUDIOVIDEO]=null,t),this.baseurl=e}var t=e.prototype;return t.setByteRange=function(e,t){var i=e.split("@",2),n=[];1===i.length?n[0]=t?t.byteRangeEndOffset:0:n[0]=parseInt(i[1]),n[1]=parseInt(i[0])+n[0],this._byteRange=n},a(e,[{key:"byteRange",get:function(){return this._byteRange?this._byteRange:[]}},{key:"byteRangeStartOffset",get:function(){return this.byteRange[0]}},{key:"byteRangeEndOffset",get:function(){return this.byteRange[1]}},{key:"url",get:function(){return!this._url&&this.baseurl&&this.relurl&&(this._url=E.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""},set:function(e){this._url=e}}]),e}(),G=function(e){function t(t,i){var n;return n=e.call(this,i)||this,n._decryptdata=null,n.rawProgramDateTime=null,n.programDateTime=null,n.tagList=[],n.duration=0,n.sn=0,n.levelkeys=void 0,n.type=void 0,n.loader=null,n.keyLoader=null,n.level=-1,n.cc=0,n.startPTS=void 0,n.endPTS=void 0,n.startDTS=void 0,n.endDTS=void 0,n.start=0,n.deltaPTS=void 0,n.maxStartPTS=void 0,n.minEndPTS=void 0,n.stats=new j,n.urlId=0,n.data=void 0,n.bitrateTest=!1,n.title=null,n.initSegment=null,n.endList=void 0,n.gap=void 0,n.type=t,n}l(t,e);var i=t.prototype;return i.setKeyFormat=function(e){if(this.levelkeys){var t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}},i.abortRequests=function(){var e,t;null==(e=this.loader)||e.abort(),null==(t=this.keyLoader)||t.abort()},i.setElementaryStreamInfo=function(e,t,i,n,r,a){void 0===a&&(a=!1);var s=this.elementaryStreams,o=s[e];o?(o.startPTS=Math.min(o.startPTS,t),o.endPTS=Math.max(o.endPTS,i),o.startDTS=Math.min(o.startDTS,n),o.endDTS=Math.max(o.endDTS,r)):s[e]={startPTS:t,endPTS:i,startDTS:n,endDTS:r,partial:a}},i.clearElementaryStreamInfo=function(){var e=this.elementaryStreams;e[U.AUDIO]=null,e[U.VIDEO]=null,e[U.AUDIOVIDEO]=null},a(t,[{key:"decryptdata",get:function(){var e=this.levelkeys;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){var t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{var i=Object.keys(this.levelkeys);if(1===i.length)return this._decryptdata=this.levelkeys[i[0]].getDecryptData(this.sn)}}return this._decryptdata}},{key:"end",get:function(){return this.start+this.duration}},{key:"endProgramDateTime",get:function(){if(null===this.programDateTime)return null;if(!T(this.programDateTime))return null;var e=T(this.duration)?this.duration:0;return this.programDateTime+1e3*e}},{key:"encrypted",get:function(){var e;if(null!=(e=this._decryptdata)&&e.encrypted)return!0;if(this.levelkeys){var t=Object.keys(this.levelkeys),i=t.length;if(i>1||1===i&&this.levelkeys[t[0]].encrypted)return!0}return!1}}]),t}(B),H=function(e){function t(t,i,n,r,a){var s;s=e.call(this,n)||this,s.fragOffset=0,s.duration=0,s.gap=!1,s.independent=!1,s.relurl=void 0,s.fragment=void 0,s.index=void 0,s.stats=new j,s.duration=t.decimalFloatingPoint("DURATION"),s.gap=t.bool("GAP"),s.independent=t.bool("INDEPENDENT"),s.relurl=t.enumeratedString("URI"),s.fragment=i,s.index=r;var o=t.enumeratedString("BYTERANGE");return o&&s.setByteRange(o,a),a&&(s.fragOffset=a.fragOffset+a.duration),s}return l(t,e),a(t,[{key:"start",get:function(){return this.fragment.start+this.fragOffset}},{key:"end",get:function(){return this.start+this.duration}},{key:"loaded",get:function(){var e=this.elementaryStreams;return!!(e.audio||e.video||e.audiovideo)}}]),t}(B),V=10,K=function(){function e(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.live=!0,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.availabilityDelay=void 0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}var t=e.prototype;return t.reloaded=function(e){if(!e)return this.advanced=!0,void(this.updated=!0);var t=this.lastPartSn-e.lastPartSn,i=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!i||!!t,this.advanced=this.endSN>e.endSN||t>0||0===t&&i>0,this.updated||this.advanced?this.misses=Math.floor(.6*e.misses):this.misses=e.misses+1,this.availabilityDelay=e.availabilityDelay},a(e,[{key:"hasProgramDateTime",get:function(){return!!this.fragments.length&&T(this.fragments[this.fragments.length-1].programDateTime)}},{key:"levelTargetDuration",get:function(){return this.averagetargetduration||this.targetduration||V}},{key:"drift",get:function(){var e=this.driftEndTime-this.driftStartTime;if(e>0){var t=this.driftEnd-this.driftStart;return 1e3*t/e}return 1}},{key:"edge",get:function(){return this.partEnd||this.fragmentEnd}},{key:"partEnd",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}},{key:"fragmentEnd",get:function(){var e;return null!=(e=this.fragments)&&e.length?this.fragments[this.fragments.length-1].end:0}},{key:"age",get:function(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}},{key:"lastPartIndex",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].index:-1}},{key:"lastPartSn",get:function(){var e;return null!=(e=this.partList)&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}}]),e}(),W=void 0,Y=y(W);function z(e,t,i){return Uint8Array.prototype.slice?e.slice(t,i):new Uint8Array(Array.prototype.slice.call(e,t,i))}var X,q=function(e,t){return t+10<=e.length&&73===e[t]&&68===e[t+1]&&51===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},Z=function(e,t){return t+10<=e.length&&51===e[t]&&68===e[t+1]&&73===e[t+2]&&e[t+3]<255&&e[t+4]<255&&e[t+6]<128&&e[t+7]<128&&e[t+8]<128&&e[t+9]<128},Q=function(e,t){var i=t,n=0;while(q(e,t)){n+=10;var r=J(e,t+6);n+=r,Z(e,t+10)&&(n+=10),t+=n}if(n>0)return e.subarray(i,i+n)},J=function(e,t){var i=0;return i=(127&e[t])<<21,i|=(127&e[t+1])<<14,i|=(127&e[t+2])<<7,i|=127&e[t+3],i},$=function(e,t){return q(e,t)&&J(e,t+6)+10<=e.length-t},ee=function(e){for(var t=ne(e),i=0;i<t.length;i++){var n=t[i];if(te(n))return le(n)}},te=function(e){return e&&"PRIV"===e.key&&"com.apple.streaming.transportStreamTimestamp"===e.info},ie=function(e){var t=String.fromCharCode(e[0],e[1],e[2],e[3]),i=J(e,4),n=10;return{type:t,size:i,data:e.subarray(n,n+i)}},ne=function(e){var t=0,i=[];while(q(e,t)){var n=J(e,t+6);t+=10;var r=t+n;while(t+8<r){var a=ie(e.subarray(t)),s=re(a);s&&i.push(s),t+=a.size+10}Z(e,t)&&(t+=10)}return i},re=function(e){return"PRIV"===e.type?ae(e):"W"===e.type[0]?oe(e):se(e)},ae=function(e){if(!(e.size<2)){var t=ue(e.data,!0),i=new Uint8Array(e.data.subarray(t.length+1));return{key:e.type,info:t,data:i.buffer}}},se=function(e){if(!(e.size<2)){if("TXXX"===e.type){var t=1,i=ue(e.data.subarray(t),!0);t+=i.length+1;var n=ue(e.data.subarray(t));return{key:e.type,info:i,data:n}}var r=ue(e.data.subarray(1));return{key:e.type,data:r}}},oe=function(e){if("WXXX"===e.type){if(e.size<2)return;var t=1,i=ue(e.data.subarray(t),!0);t+=i.length+1;var n=ue(e.data.subarray(t));return{key:e.type,info:i,data:n}}var r=ue(e.data);return{key:e.type,data:r}},le=function(e){if(8===e.data.byteLength){var t=new Uint8Array(e.data),i=1&t[3],n=(t[4]<<23)+(t[5]<<15)+(t[6]<<7)+t[7];return n/=45,i&&(n+=47721858.84),Math.round(n)}},ue=function(e,t){void 0===t&&(t=!1);var i=ce();if(i){var n=i.decode(e);if(t){var r=n.indexOf("\0");return-1!==r?n.substring(0,r):n}return n.replace(/\0/g,"")}var a,s,o,l=e.length,u="",c=0;while(c<l){if(a=e[c++],0===a&&t)return u;if(0!==a&&3!==a)switch(a>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:u+=String.fromCharCode(a);break;case 12:case 13:s=e[c++],u+=String.fromCharCode((31&a)<<6|63&s);break;case 14:s=e[c++],o=e[c++],u+=String.fromCharCode((15&a)<<12|(63&s)<<6|(63&o)<<0);break}}return u};function ce(){return X||"undefined"===typeof self.TextDecoder||(X=new self.TextDecoder("utf-8")),X}var he={hexDump:function(e){for(var t="",i=0;i<e.length;i++){var n=e[i].toString(16);n.length<2&&(n="0"+n),t+=n}return t}},de=Math.pow(2,32)-1,fe=[].push,ge={video:1,audio:2,id3:3,text:4};function ve(e){return String.fromCharCode.apply(null,e)}function pe(e,t){var i=e[t]<<8|e[t+1];return i<0?65536+i:i}function me(e,t){var i=ye(e,t);return i<0?4294967296+i:i}function ye(e,t){return e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function be(e,t,i){e[t]=i>>24,e[t+1]=i>>16&255,e[t+2]=i>>8&255,e[t+3]=255&i}function Ee(e,t){var i=[];if(!t.length)return i;for(var n=e.byteLength,r=0;r<n;){var a=me(e,r),s=ve(e.subarray(r+4,r+8)),o=a>1?r+a:n;if(s===t[0])if(1===t.length)i.push(e.subarray(r+8,o));else{var l=Ee(e.subarray(r+8,o),t.slice(1));l.length&&fe.apply(i,l)}r=o}return i}function Te(e){var t=[],i=e[0],n=8,r=me(e,n);n+=4;var a=0,s=0;n+=0===i?8:16,n+=2;var o=e.length+s,l=pe(e,n);n+=2;for(var u=0;u<l;u++){var c=n,h=me(e,c);c+=4;var d=2147483647&h,f=(2147483648&h)>>>31;if(1===f)return x.warn("SIDX has hierarchical references (not supported)"),null;var g=me(e,c);c+=4,t.push({referenceSize:d,subsegmentDuration:g,info:{duration:g/r,start:o,end:o+d-1}}),o+=d,c+=4,n=c}return{earliestPresentationTime:a,timescale:r,version:i,referencesCount:l,references:t}}function ke(e){for(var t=[],i=Ee(e,["moov","trak"]),n=0;n<i.length;n++){var r=i[n],a=Ee(r,["tkhd"])[0];if(a){var s=a[0],o=0===s?12:20,l=me(a,o),u=Ee(r,["mdia","mdhd"])[0];if(u){s=u[0],o=0===s?12:20;var c=me(u,o),h=Ee(r,["mdia","hdlr"])[0];if(h){var d=ve(h.subarray(8,12)),f={soun:U.AUDIO,vide:U.VIDEO}[d];if(f){var g=Ee(r,["mdia","minf","stbl","stsd"])[0],v=void 0;g&&(v=ve(g.subarray(12,16))),t[l]={timescale:c,type:f},t[f]={timescale:c,id:l,codec:v}}}}}}var p=Ee(e,["moov","mvex","trex"]);return p.forEach((function(e){var i=me(e,4),n=t[i];n&&(n.default={duration:me(e,12),flags:me(e,20)})})),t}function Se(e,t){if(!e||!t)return e;var i=t.keyId;if(i&&t.isCommonEncryption){var n=Ee(e,["moov","trak"]);n.forEach((function(e){var t=Ee(e,["mdia","minf","stbl","stsd"])[0],n=t.subarray(8),r=Ee(n,["enca"]),a=r.length>0;a||(r=Ee(n,["encv"])),r.forEach((function(e){var t=a?e.subarray(28):e.subarray(78),n=Ee(t,["sinf"]);n.forEach((function(e){var t=_e(e);if(t){var n=t.subarray(8,24);n.some((function(e){return 0!==e}))||(x.log("[eme] Patching keyId in 'enc"+(a?"a":"v")+">sinf>>tenc' box: "+he.hexDump(n)+" -> "+he.hexDump(i)),t.set(i,8))}}))}))}))}return e}function _e(e){var t=Ee(e,["schm"])[0];if(t){var i=ve(t.subarray(4,8));if("cbcs"===i||"cenc"===i)return Ee(e,["schi","tenc"])[0]}return x.error("[eme] missing 'schm' box"),null}function Le(e,t){return Ee(t,["moof","traf"]).reduce((function(t,i){var n=Ee(i,["tfdt"])[0],r=n[0],a=Ee(i,["tfhd"]).reduce((function(t,i){var a=me(i,4),s=e[a];if(s){var o=me(n,4);if(1===r){if(o===de)return x.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"),t;o*=de+1,o+=me(n,8)}var l=s.timescale||9e4,u=o/l;if(isFinite(u)&&(null===t||u<t))return u}return t}),null);return null!==a&&isFinite(a)&&(null===t||a<t)?a:t}),null)}function Ae(e,t){for(var i=0,n=0,r=0,a=Ee(e,["moof","traf"]),s=0;s<a.length;s++){var o=a[s],l=Ee(o,["tfhd"])[0],u=me(l,4),c=t[u];if(c){var h=c.default,d=me(l,0)|(null==h?void 0:h.flags),f=null==h?void 0:h.duration;8&d&&(f=me(l,2&d?12:8));for(var g=c.timescale||9e4,v=Ee(o,["trun"]),p=0;p<v.length;p++){if(i=Ce(v[p]),!i&&f){var m=me(v[p],4);i=f*m}c.type===U.VIDEO?n+=i/g:c.type===U.AUDIO&&(r+=i/g)}}}if(0===n&&0===r){for(var y=0,b=Ee(e,["sidx"]),E=0;E<b.length;E++){var T=Te(b[E]);null!=T&&T.references&&(y+=T.references.reduce((function(e,t){return e+t.info.duration||0}),0))}return y}return n||r}function Ce(e){var t=me(e,0),i=8;1&t&&(i+=4),4&t&&(i+=4);for(var n=0,r=me(e,4),a=0;a<r;a++){if(256&t){var s=me(e,i);n+=s,i+=4}512&t&&(i+=4),1024&t&&(i+=4),2048&t&&(i+=4)}return n}function Oe(e,t,i){Ee(t,["moof","traf"]).forEach((function(t){Ee(t,["tfhd"]).forEach((function(n){var r=me(n,4),a=e[r];if(a){var s=a.timescale||9e4;Ee(t,["tfdt"]).forEach((function(e){var t=e[0],n=me(e,4);if(0===t)n-=i*s,n=Math.max(n,0),be(e,4,n);else{n*=Math.pow(2,32),n+=me(e,8),n-=i*s,n=Math.max(n,0);var r=Math.floor(n/(de+1)),a=Math.floor(n%(de+1));be(e,4,r),be(e,8,a)}}))}}))}))}function Re(e){var t={valid:null,remainder:null},i=Ee(e,["moof"]);if(!i)return t;if(i.length<2)return t.remainder=e,t;var n=i[i.length-1];return t.valid=z(e,0,n.byteOffset-8),t.remainder=z(e,n.byteOffset-8),t}function we(e,t){var i=new Uint8Array(e.length+t.length);return i.set(e),i.set(t,e.length),i}function xe(e,t){var i=[],n=t.samples,r=t.timescale,a=t.id,s=!1,o=Ee(n,["moof"]);return o.map((function(o){var l=o.byteOffset-8,u=Ee(o,["traf"]);u.map((function(o){var u=Ee(o,["tfdt"]).map((function(e){var t=e[0],i=me(e,4);return 1===t&&(i*=Math.pow(2,32),i+=me(e,8)),i/r}))[0];return void 0!==u&&(e=u),Ee(o,["tfhd"]).map((function(u){var c=me(u,4),h=16777215&me(u,0),d=0!==(1&h),f=0!==(2&h),g=0!==(8&h),v=0,p=0!==(16&h),m=0,y=0!==(32&h),b=8;c===a&&(d&&(b+=8),f&&(b+=4),g&&(v=me(u,b),b+=4),p&&(m=me(u,b),b+=4),y&&(b+=4),"video"===t.type&&(s=Ie(t.codec)),Ee(o,["trun"]).map((function(a){var o=a[0],u=16777215&me(a,0),c=0!==(1&u),h=0,d=0!==(4&u),f=0!==(256&u),g=0,p=0!==(512&u),y=0,b=0!==(1024&u),E=0!==(2048&u),T=0,k=me(a,4),S=8;c&&(h=me(a,S),S+=4),d&&(S+=4);for(var _=h+l,L=0;L<k;L++){if(f?(g=me(a,S),S+=4):g=v,p?(y=me(a,S),S+=4):y=m,b&&(S+=4),E&&(T=0===o?me(a,S):ye(a,S),S+=4),t.type===U.VIDEO){var A=0;while(A<y){var C=me(n,_);if(_+=4,De(s,n[_])){var O=n.subarray(_,_+C);Pe(O,s?2:1,e+T/r,i)}_+=C,A+=C+4}}e+=g/r}})))}))}))})),i}function Ie(e){if(!e)return!1;var t=e.indexOf("."),i=t<0?e:e.substring(0,t);return"hvc1"===i||"hev1"===i||"dvh1"===i||"dvhe"===i}function De(e,t){if(e){var i=t>>1&63;return 39===i||40===i}var n=31&t;return 6===n}function Pe(e,t,i,n){var r=Ne(e),a=0;a+=t;var s=0,o=0,l=!1,u=0;while(a<r.length){s=0;do{if(a>=r.length)break;u=r[a++],s+=u}while(255===u);o=0;do{if(a>=r.length)break;u=r[a++],o+=u}while(255===u);var c=r.length-a;if(!l&&4===s&&a<r.length){l=!0;var h=r[a++];if(181===h){var d=pe(r,a);if(a+=2,49===d){var f=me(r,a);if(a+=4,1195456820===f){var g=r[a++];if(3===g){var v=r[a++],p=31&v,m=64&v,y=m?2+3*p:0,b=new Uint8Array(y);if(m){b[0]=v;for(var E=1;E<y;E++)b[E]=r[a++]}n.push({type:g,payloadType:s,pts:i,bytes:b})}}}}}else if(5===s&&o<c){if(l=!0,o>16){for(var T=[],k=0;k<16;k++){var S=r[a++].toString(16);T.push(1==S.length?"0"+S:S),3!==k&&5!==k&&7!==k&&9!==k||T.push("-")}for(var _=o-16,L=new Uint8Array(_),A=0;A<_;A++)L[A]=r[a++];n.push({payloadType:s,pts:i,uuid:T.join(""),userData:ue(L),userDataBytes:L})}}else if(o<c)a+=o;else if(o>c)break}}function Ne(e){var t=e.byteLength,i=[],n=1;while(n<t-2)0===e[n]&&0===e[n+1]&&3===e[n+2]?(i.push(n+2),n+=2):n++;if(0===i.length)return e;var r=t-i.length,a=new Uint8Array(r),s=0;for(n=0;n<r;s++,n++)s===i[0]&&(s++,i.shift()),a[n]=e[s];return a}function Me(e){var t=e[0],i="",n="",r=0,a=0,s=0,o=0,l=0,u=0;if(0===t){while("\0"!==ve(e.subarray(u,u+1)))i+=ve(e.subarray(u,u+1)),u+=1;i+=ve(e.subarray(u,u+1)),u+=1;while("\0"!==ve(e.subarray(u,u+1)))n+=ve(e.subarray(u,u+1)),u+=1;n+=ve(e.subarray(u,u+1)),u+=1,r=me(e,12),a=me(e,16),o=me(e,20),l=me(e,24),u=28}else if(1===t){u+=4,r=me(e,u),u+=4;var c=me(e,u);u+=4;var h=me(e,u);u+=4,s=Math.pow(2,32)*c+h,Number.isSafeInteger(s)||(s=Number.MAX_SAFE_INTEGER,x.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),o=me(e,u),u+=4,l=me(e,u),u+=4;while("\0"!==ve(e.subarray(u,u+1)))i+=ve(e.subarray(u,u+1)),u+=1;i+=ve(e.subarray(u,u+1)),u+=1;while("\0"!==ve(e.subarray(u,u+1)))n+=ve(e.subarray(u,u+1)),u+=1;n+=ve(e.subarray(u,u+1)),u+=1}var d=e.subarray(u,e.byteLength);return{schemeIdUri:i,value:n,timeScale:r,presentationTime:s,presentationTimeDelta:a,eventDuration:o,id:l,payload:d}}var Fe=function(){function e(e,t,i,n,r){void 0===n&&(n=[1]),void 0===r&&(r=null),this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=i,this.keyFormatVersions=n,this.iv=r,this.encrypted=!!e&&"NONE"!==e,this.isCommonEncryption=this.encrypted&&"AES-128"!==e}e.clearKeyUriToKeyIdMap=function(){};var t=e.prototype;return t.isSupported=function(){if(this.method){if("AES-128"===this.method||"NONE"===this.method)return!0;if("identity"===this.keyFormat)return"SAMPLE-AES"===this.method}return!1},t.getDecryptData=function(t){if(!this.encrypted||!this.uri)return null;if("AES-128"===this.method&&this.uri&&!this.iv){"number"!==typeof t&&("AES-128"!==this.method||this.iv||x.warn('missing IV for initialization segment with method="'+this.method+'" - compliance issue'),t=0);var i=je(t),n=new e(this.method,this.uri,"identity",this.keyFormatVersions,i);return n}return this},e}();function je(e){for(var t=new Uint8Array(16),i=12;i<16;i++)t[i]=e>>8*(15-i)&255;return t}function Ue(){if("undefined"!==typeof self)return self.MediaSource||self.WebKitMediaSource}var Be={audio:{a3ds:!0,"ac-3":!0,"ac-4":!0,alac:!0,alaw:!0,dra1:!0,"dts+":!0,"dts-":!0,dtsc:!0,dtse:!0,dtsh:!0,"ec-3":!0,enca:!0,g719:!0,g726:!0,m4ae:!0,mha1:!0,mha2:!0,mhm1:!0,mhm2:!0,mlpa:!0,mp4a:!0,"raw ":!0,Opus:!0,opus:!0,samr:!0,sawb:!0,sawp:!0,sevc:!0,sqcp:!0,ssmv:!0,twos:!0,ulaw:!0},video:{avc1:!0,avc2:!0,avc3:!0,avc4:!0,avcp:!0,av01:!0,drac:!0,dva1:!0,dvav:!0,dvh1:!0,dvhe:!0,encv:!0,hev1:!0,hvc1:!0,mjp2:!0,mp4v:!0,mvc1:!0,mvc2:!0,mvc3:!0,mvc4:!0,resv:!0,rv60:!0,s263:!0,svc1:!0,svc2:!0,"vc-1":!0,vp08:!0,vp09:!0},text:{stpp:!0,wvtt:!0}},Ge=Ue();function He(e,t){var i=Be[t];return!!i&&!0===i[e.slice(0,4)]}function Ve(e,t){var i;return null!=(i=null==Ge?void 0:Ge.isTypeSupported((t||"video")+'/mp4;codecs="'+e+'"'))&&i}var Ke=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,We=/#EXT-X-MEDIA:(.*)/g,Ye=/^#EXT(?:INF|-X-TARGETDURATION):/m,ze=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[\S ]*)/.source,/#EXT-X-BYTERANGE:*(.+)/.source,/#EXT-X-PROGRAM-DATE-TIME:(.+)/.source,/#.*/.source].join("|"),"g"),Xe=new RegExp([/#(EXTM3U)/.source,/#EXT-X-(DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|")),qe=function(){function e(){}return e.findGroup=function(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.id===t)return n}},e.convertAVC1ToAVCOTI=function(e){var t=e.split(".");if(t.length>2){var i=t.shift()+".";return i+=parseInt(t.shift()).toString(16),i+=("000"+parseInt(t.shift()).toString(16)).slice(-4),i}return e},e.resolve=function(e,t){return E.buildAbsoluteURL(t,e,{alwaysNormalize:!0})},e.isMediaPlaylist=function(e){return Ye.test(e)},e.parseMasterPlaylist=function(t,i){var n,r=!1,a={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:r},s=[];Ke.lastIndex=0;while(null!=(n=Ke.exec(t)))if(n[1]){var o,l=new P(n[1]),u=n[2],c={attrs:l,bitrate:l.decimalInteger("AVERAGE-BANDWIDTH")||l.decimalInteger("BANDWIDTH"),name:l.NAME,url:e.resolve(u,i)},h=l.decimalResolution("RESOLUTION");h&&(c.width=h.width,c.height=h.height),Je((l.CODECS||"").split(/[ ,]+/).filter((function(e){return e})),c),c.videoCodec&&-1!==c.videoCodec.indexOf("avc1")&&(c.videoCodec=e.convertAVC1ToAVCOTI(c.videoCodec)),null!=(o=c.unknownCodecs)&&o.length||s.push(c),a.levels.push(c)}else if(n[3]){var d=n[3],f=n[4];switch(d){case"SESSION-DATA":var g=new P(f),v=g["DATA-ID"];v&&(null===a.sessionData&&(a.sessionData={}),a.sessionData[v]=g);break;case"SESSION-KEY":var p=Ze(f,i);p.encrypted&&p.isSupported()?(null===a.sessionKeys&&(a.sessionKeys=[]),a.sessionKeys.push(p)):x.warn('[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "'+f+'"');break;case"DEFINE":break;case"CONTENT-STEERING":var m=new P(f);a.contentSteering={uri:e.resolve(m["SERVER-URI"],i),pathwayId:m["PATHWAY-ID"]||"."};break;case"START":a.startTimeOffset=Qe(f);break}}var y=s.length>0&&s.length<a.levels.length;return a.levels=y?s:a.levels,0===a.levels.length&&(a.playlistParsingError=new Error("no levels found in manifest")),a},e.parseMasterPlaylistMedia=function(t,i,n){var r,a={},s=n.levels,o={AUDIO:s.map((function(e){return{id:e.attrs.AUDIO,audioCodec:e.audioCodec}})),SUBTITLES:s.map((function(e){return{id:e.attrs.SUBTITLES,textCodec:e.textCodec}})),"CLOSED-CAPTIONS":[]},l=0;We.lastIndex=0;while(null!==(r=We.exec(t))){var u=new P(r[1]),c=u.TYPE;if(c){var h=o[c],d=a[c]||[];a[c]=d;var f={attrs:u,bitrate:0,id:l++,groupId:u["GROUP-ID"]||"",instreamId:u["INSTREAM-ID"],name:u.NAME||u.LANGUAGE||"",type:c,default:u.bool("DEFAULT"),autoselect:u.bool("AUTOSELECT"),forced:u.bool("FORCED"),lang:u.LANGUAGE,url:u.URI?e.resolve(u.URI,i):""};if(null!=h&&h.length){var g=e.findGroup(h,f.groupId)||h[0];$e(f,g,"audioCodec"),$e(f,g,"textCodec")}d.push(f)}}return a},e.parseLevelPlaylist=function(e,t,i,n,r,a){var s,l,u,c=new K(t),h=c.fragments,d=null,f=0,g=0,v=0,p=0,m=null,y=new G(n,t),b=-1,E=!1;ze.lastIndex=0,c.m3u8=e,c.hasVariableRefs=!1;while(null!==(s=ze.exec(e))){E&&(E=!1,y=new G(n,t),y.start=v,y.sn=f,y.cc=p,y.level=i,d&&(y.initSegment=d,y.rawProgramDateTime=d.rawProgramDateTime,d.rawProgramDateTime=null));var k=s[1];if(k){y.duration=parseFloat(k);var S=(" "+s[2]).slice(1);y.title=S||null,y.tagList.push(S?["INF",k,S]:["INF",k])}else if(s[3]){if(T(y.duration)){y.start=v,u&&nt(y,u,c),y.sn=f,y.level=i,y.cc=p,y.urlId=r,h.push(y);var _=(" "+s[3]).slice(1);y.relurl=_,tt(y,m),m=y,v+=y.duration,f++,g=0,E=!0}}else if(s[4]){var L=(" "+s[4]).slice(1);m?y.setByteRange(L,m):y.setByteRange(L)}else if(s[5])y.rawProgramDateTime=(" "+s[5]).slice(1),y.tagList.push(["PROGRAM-DATE-TIME",y.rawProgramDateTime]),-1===b&&(b=h.length);else{if(s=s[0].match(Xe),!s){x.warn("No matches on slow regex match for level playlist!");continue}for(l=1;l<s.length;l++)if("undefined"!==typeof s[l])break;var A=(" "+s[l]).slice(1),C=(" "+s[l+1]).slice(1),O=s[l+2]?(" "+s[l+2]).slice(1):"";switch(A){case"PLAYLIST-TYPE":c.type=C.toUpperCase();break;case"MEDIA-SEQUENCE":f=c.startSN=parseInt(C);break;case"SKIP":var R=new P(C),w=R.decimalInteger("SKIPPED-SEGMENTS");if(T(w)){c.skippedSegments=w;for(var I=w;I--;)h.unshift(null);f+=w}var D=R.enumeratedString("RECENTLY-REMOVED-DATERANGES");D&&(c.recentlyRemovedDateranges=D.split("\t"));break;case"TARGETDURATION":c.targetduration=Math.max(parseInt(C),1);break;case"VERSION":c.version=parseInt(C);break;case"EXTM3U":break;case"ENDLIST":c.live=!1;break;case"#":(C||O)&&y.tagList.push(O?[C,O]:[C]);break;case"DISCONTINUITY":p++,y.tagList.push(["DIS"]);break;case"GAP":y.gap=!0,y.tagList.push([A]);break;case"BITRATE":y.tagList.push([A,C]);break;case"DATERANGE":var N=new P(C),M=new F(N,c.dateRanges[N.ID]);M.isValid||c.skippedSegments?c.dateRanges[M.id]=M:x.warn('Ignoring invalid DATERANGE tag: "'+C+'"'),y.tagList.push(["EXT-X-DATERANGE",C]);break;case"DEFINE":break;case"DISCONTINUITY-SEQUENCE":p=parseInt(C);break;case"KEY":var j=Ze(C,t);if(j.isSupported()){if("NONE"===j.method){u=void 0;break}u||(u={}),u[j.keyFormat]&&(u=o({},u)),u[j.keyFormat]=j}else x.warn('[Keys] Ignoring invalid EXT-X-KEY tag: "'+C+'"');break;case"START":c.startTimeOffset=Qe(C);break;case"MAP":var U=new P(C);if(y.duration){var B=new G(n,t);it(B,U,i,u),d=B,y.initSegment=d,d.rawProgramDateTime&&!y.rawProgramDateTime&&(y.rawProgramDateTime=d.rawProgramDateTime)}else it(y,U,i,u),d=y,E=!0;break;case"SERVER-CONTROL":var V=new P(C);c.canBlockReload=V.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=V.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&V.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=V.optionalFloat("PART-HOLD-BACK",0),c.holdBack=V.optionalFloat("HOLD-BACK",0);break;case"PART-INF":var W=new P(C);c.partTarget=W.decimalFloatingPoint("PART-TARGET");break;case"PART":var Y=c.partList;Y||(Y=c.partList=[]);var z=g>0?Y[Y.length-1]:void 0,X=g++,q=new P(C),Z=new H(q,y,t,X,z);Y.push(Z),y.duration+=Z.duration;break;case"PRELOAD-HINT":var Q=new P(C);c.preloadHint=Q;break;case"RENDITION-REPORT":var J=new P(C);c.renditionReports=c.renditionReports||[],c.renditionReports.push(J);break;default:x.warn("line parsed but not handled: "+s);break}}}m&&!m.relurl?(h.pop(),v-=m.duration,c.partList&&(c.fragmentHint=m)):c.partList&&(tt(y,m),y.cc=p,c.fragmentHint=y,u&&nt(y,u,c));var $=h.length,ee=h[0],te=h[$-1];if(v+=c.skippedSegments*c.targetduration,v>0&&$&&te){c.averagetargetduration=v/$;var ie=te.sn;c.endSN="initSegment"!==ie?ie:0,c.live||(te.endList=!0),ee&&(c.startCC=ee.cc)}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(v+=c.fragmentHint.duration),c.totalduration=v,c.endCC=p,b>0&&et(h,b),c},e}();function Ze(e,t,i){var n,r,a=new P(e),s=null!=(n=a.METHOD)?n:"",o=a.URI,l=a.hexadecimalInteger("IV"),u=a.KEYFORMATVERSIONS,c=null!=(r=a.KEYFORMAT)?r:"identity";o&&a.IV&&!l&&x.error("Invalid IV: "+a.IV);var h=o?qe.resolve(o,t):"",d=(u||"1").split("/").map(Number).filter(Number.isFinite);return new Fe(s,h,c,d,l)}function Qe(e){var t=new P(e),i=t.decimalFloatingPoint("TIME-OFFSET");return T(i)?i:null}function Je(e,t){["video","audio","text"].forEach((function(i){var n=e.filter((function(e){return He(e,i)}));if(n.length){var r=n.filter((function(e){return 0===e.lastIndexOf("avc1",0)||0===e.lastIndexOf("mp4a",0)}));t[i+"Codec"]=r.length>0?r[0]:n[0],e=e.filter((function(e){return-1===n.indexOf(e)}))}})),t.unknownCodecs=e}function $e(e,t,i){var n=t[i];n&&(e[i]=n)}function et(e,t){for(var i=e[t],n=t;n--;){var r=e[n];if(!r)return;r.programDateTime=i.programDateTime-1e3*r.duration,i=r}}function tt(e,t){e.rawProgramDateTime?e.programDateTime=Date.parse(e.rawProgramDateTime):null!=t&&t.programDateTime&&(e.programDateTime=t.endProgramDateTime),T(e.programDateTime)||(e.programDateTime=null,e.rawProgramDateTime=null)}function it(e,t,i,n){e.relurl=t.URI,t.BYTERANGE&&e.setByteRange(t.BYTERANGE),e.level=i,e.sn="initSegment",n&&(e.levelkeys=n),e.initSegment=null}function nt(e,t,i){e.levelkeys=t;var n=i.encryptedFragments;n.length&&n[n.length-1].levelkeys===t||!Object.keys(t).some((function(e){return t[e].isCommonEncryption}))||n.push(e)}var rt={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},at={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};function st(e){var t=e.type;switch(t){case rt.AUDIO_TRACK:return at.AUDIO;case rt.SUBTITLE_TRACK:return at.SUBTITLE;default:return at.MAIN}}function ot(e,t){var i=e.url;return void 0!==i&&0!==i.indexOf("data:")||(i=t.url),i}var lt=function(){function e(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.hls=e,this.registerListeners()}var t=e.prototype;return t.startLoad=function(e){},t.stopLoad=function(){this.destroyInternalLoaders()},t.registerListeners=function(){var e=this.hls;e.on(k.MANIFEST_LOADING,this.onManifestLoading,this),e.on(k.LEVEL_LOADING,this.onLevelLoading,this),e.on(k.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(k.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.unregisterListeners=function(){var e=this.hls;e.off(k.MANIFEST_LOADING,this.onManifestLoading,this),e.off(k.LEVEL_LOADING,this.onLevelLoading,this),e.off(k.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(k.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this)},t.createInternalLoader=function(e){var t=this.hls.config,i=t.pLoader,n=t.loader,r=i||n,a=new r(t);return this.loaders[e.type]=a,a},t.getInternalLoader=function(e){return this.loaders[e.type]},t.resetInternalLoader=function(e){this.loaders[e]&&delete this.loaders[e]},t.destroyInternalLoaders=function(){for(var e in this.loaders){var t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}},t.destroy=function(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()},t.onManifestLoading=function(e,t){var i=t.url;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:rt.MANIFEST,url:i,deliveryDirectives:null})},t.onLevelLoading=function(e,t){var i=t.id,n=t.level,r=t.url,a=t.deliveryDirectives;this.load({id:i,level:n,responseType:"text",type:rt.LEVEL,url:r,deliveryDirectives:a})},t.onAudioTrackLoading=function(e,t){var i=t.id,n=t.groupId,r=t.url,a=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:rt.AUDIO_TRACK,url:r,deliveryDirectives:a})},t.onSubtitleTrackLoading=function(e,t){var i=t.id,n=t.groupId,r=t.url,a=t.deliveryDirectives;this.load({id:i,groupId:n,level:null,responseType:"text",type:rt.SUBTITLE_TRACK,url:r,deliveryDirectives:a})},t.load=function(e){var t,i,n,r=this,a=this.hls.config,s=this.getInternalLoader(e);if(s){var l=s.context;if(l&&l.url===e.url)return void x.trace("[playlist-loader]: playlist request ongoing");x.log("[playlist-loader]: aborting previous loader for type: "+e.type),s.abort()}if((i=e.type===rt.MANIFEST?a.manifestLoadPolicy.default:o({},a.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),s=this.createInternalLoader(e),null!=(t=e.deliveryDirectives)&&t.part)&&(e.type===rt.LEVEL&&null!==e.level?n=this.hls.levels[e.level].details:e.type===rt.AUDIO_TRACK&&null!==e.id?n=this.hls.audioTracks[e.id].details:e.type===rt.SUBTITLE_TRACK&&null!==e.id&&(n=this.hls.subtitleTracks[e.id].details),n)){var u=n.partTarget,c=n.targetduration;if(u&&c){var h=1e3*Math.max(3*u,.8*c);i=o({},i,{maxTimeToFirstByteMs:Math.min(h,i.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(h,i.maxTimeToFirstByteMs)})}}var d=i.errorRetry||i.timeoutRetry||{},f={loadPolicy:i,timeout:i.maxLoadTimeMs,maxRetry:d.maxNumRetry||0,retryDelay:d.retryDelayMs||0,maxRetryDelay:d.maxRetryDelayMs||0},g={onSuccess:function(e,t,i,n){var a=r.getInternalLoader(i);r.resetInternalLoader(i.type);var s=e.data;0===s.indexOf("#EXTM3U")?(t.parsing.start=performance.now(),qe.isMediaPlaylist(s)?r.handleTrackOrLevelPlaylist(e,t,i,n||null,a):r.handleMasterPlaylist(e,t,i,n)):r.handleManifestParsingError(e,i,new Error("no EXTM3U delimiter"),n||null,t)},onError:function(e,t,i,n){r.handleNetworkError(t,i,!1,e,n)},onTimeout:function(e,t,i){r.handleNetworkError(t,i,!0,void 0,e)}};s.load(e,f,g)},t.handleMasterPlaylist=function(e,t,i,n){var r=this.hls,a=e.data,s=ot(e,i),o=qe.parseMasterPlaylist(a,s);if(o.playlistParsingError)this.handleManifestParsingError(e,i,o.playlistParsingError,n,t);else{var l=o.contentSteering,u=o.levels,c=o.sessionData,h=o.sessionKeys,d=o.startTimeOffset,f=o.variableList;this.variableList=f;var g=qe.parseMasterPlaylistMedia(a,s,o),v=g.AUDIO,p=void 0===v?[]:v,m=g.SUBTITLES,y=g["CLOSED-CAPTIONS"];if(p.length){var b=p.some((function(e){return!e.url}));b||!u[0].audioCodec||u[0].attrs.AUDIO||(x.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),p.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new P({}),bitrate:0,url:""}))}r.trigger(k.MANIFEST_LOADED,{levels:u,audioTracks:p,subtitles:m,captions:y,contentSteering:l,url:s,stats:t,networkDetails:n,sessionData:c,sessionKeys:h,startTimeOffset:d,variableList:f})}},t.handleTrackOrLevelPlaylist=function(e,t,i,n,r){var a=this.hls,s=i.id,o=i.level,l=i.type,u=ot(e,i),c=T(s)?s:0,h=T(o)?o:c,d=st(i),f=qe.parseLevelPlaylist(e.data,u,h,d,c,this.variableList);if(l===rt.MANIFEST){var g={attrs:new P({}),bitrate:0,details:f,name:"",url:u};a.trigger(k.MANIFEST_LOADED,{levels:[g],audioTracks:[],url:u,stats:t,networkDetails:n,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),i.levelDetails=f,this.handlePlaylistLoaded(f,e,t,i,n,r)},t.handleManifestParsingError=function(e,t,i,n,r){this.hls.trigger(k.ERROR,{type:S.NETWORK_ERROR,details:_.MANIFEST_PARSING_ERROR,fatal:t.type===rt.MANIFEST,url:e.url,err:i,error:i,reason:i.message,response:e,context:t,networkDetails:n,stats:r})},t.handleNetworkError=function(e,t,i,r,a){void 0===i&&(i=!1);var s="A network "+(i?"timeout":"error"+(r?" (status "+r.code+")":""))+" occurred while loading "+e.type;e.type===rt.LEVEL?s+=": "+e.level+" id: "+e.id:e.type!==rt.AUDIO_TRACK&&e.type!==rt.SUBTITLE_TRACK||(s+=" id: "+e.id+' group-id: "'+e.groupId+'"');var o=new Error(s);x.warn("[playlist-loader]: "+s);var l=_.UNKNOWN,u=!1,c=this.getInternalLoader(e);switch(e.type){case rt.MANIFEST:l=i?_.MANIFEST_LOAD_TIMEOUT:_.MANIFEST_LOAD_ERROR,u=!0;break;case rt.LEVEL:l=i?_.LEVEL_LOAD_TIMEOUT:_.LEVEL_LOAD_ERROR,u=!1;break;case rt.AUDIO_TRACK:l=i?_.AUDIO_TRACK_LOAD_TIMEOUT:_.AUDIO_TRACK_LOAD_ERROR,u=!1;break;case rt.SUBTITLE_TRACK:l=i?_.SUBTITLE_TRACK_LOAD_TIMEOUT:_.SUBTITLE_LOAD_ERROR,u=!1;break}c&&this.resetInternalLoader(e.type);var h={type:S.NETWORK_ERROR,details:l,fatal:u,url:e.url,loader:c,context:e,error:o,networkDetails:t,stats:a};if(r){var d=(null==t?void 0:t.url)||e.url;h.response=n({url:d,data:void 0},r)}this.hls.trigger(k.ERROR,h)},t.handlePlaylistLoaded=function(e,t,i,n,r,a){var s=this.hls,o=n.type,l=n.level,u=n.id,c=n.groupId,h=n.deliveryDirectives,d=ot(t,n),f=st(n),g="number"===typeof n.level&&f===at.MAIN?l:void 0;if(e.fragments.length){e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));var v=e.playlistParsingError;if(v)s.trigger(k.ERROR,{type:S.NETWORK_ERROR,details:_.LEVEL_PARSING_ERROR,fatal:!1,url:d,error:v,reason:v.message,response:t,context:n,level:g,parent:f,networkDetails:r,stats:i});else switch(e.live&&a&&(a.getCacheAge&&(e.ageHeader=a.getCacheAge()||0),a.getCacheAge&&!isNaN(e.ageHeader)||(e.ageHeader=0)),o){case rt.MANIFEST:case rt.LEVEL:s.trigger(k.LEVEL_LOADED,{details:e,level:g||0,id:u||0,stats:i,networkDetails:r,deliveryDirectives:h});break;case rt.AUDIO_TRACK:s.trigger(k.AUDIO_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:i,networkDetails:r,deliveryDirectives:h});break;case rt.SUBTITLE_TRACK:s.trigger(k.SUBTITLE_TRACK_LOADED,{details:e,id:u||0,groupId:c||"",stats:i,networkDetails:r,deliveryDirectives:h});break}}else{var p=new Error("No Segments found in Playlist");s.trigger(k.ERROR,{type:S.NETWORK_ERROR,details:_.LEVEL_EMPTY_ERROR,fatal:!1,url:d,error:p,reason:p.message,response:t,context:n,level:g,parent:f,networkDetails:r,stats:i})}},e}();function ut(e,t){var i;try{i=new Event("addtrack")}catch(n){i=document.createEvent("Event"),i.initEvent("addtrack",!1,!1)}i.track=e,t.dispatchEvent(i)}function ct(e){var t=e.mode;if("disabled"===t&&(e.mode="hidden"),e.cues)for(var i=e.cues.length;i--;)e.removeCue(e.cues[i]);"disabled"===t&&(e.mode=t)}function ht(e,t,i,n){var r=e.mode;if("disabled"===r&&(e.mode="hidden"),e.cues&&e.cues.length>0)for(var a=ft(e.cues,t,i),s=0;s<a.length;s++)n&&!n(a[s])||e.removeCue(a[s]);"disabled"===r&&(e.mode=r)}function dt(e,t){if(t<e[0].startTime)return 0;var i=e.length-1;if(t>e[i].endTime)return-1;var n=0,r=i;while(n<=r){var a=Math.floor((r+n)/2);if(t<e[a].startTime)r=a-1;else{if(!(t>e[a].startTime&&n<i))return a;n=a+1}}return e[n].startTime-t<t-e[r].startTime?n:r}function ft(e,t,i){var n=[],r=dt(e,t);if(r>-1)for(var a=r,s=e.length;a<s;a++){var o=e[a];if(o.startTime>=t&&o.endTime<=i)n.push(o);else if(o.startTime>i)return n}return n}var gt={audioId3:"org.id3",dateRange:"com.apple.quicktime.HLS",emsg:"https://aomedia.org/emsg/ID3"},vt=.25;function pt(){if("undefined"!==typeof self)return self.WebKitDataCue||self.VTTCue||self.TextTrackCue}var mt=function(){var e=pt();try{new e(0,Number.POSITIVE_INFINITY,"")}catch(t){return Number.MAX_VALUE}return Number.POSITIVE_INFINITY}();function yt(e,t){return e.getTime()/1e3-t}function bt(e){return Uint8Array.from(e.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}var Et=function(){function e(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=e,this._registerListeners()}var t=e.prototype;return t.destroy=function(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=null},t._registerListeners=function(){var e=this.hls;e.on(k.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(k.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(k.MANIFEST_LOADING,this.onManifestLoading,this),e.on(k.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(k.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(k.LEVEL_UPDATED,this.onLevelUpdated,this)},t._unregisterListeners=function(){var e=this.hls;e.off(k.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(k.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(k.MANIFEST_LOADING,this.onManifestLoading,this),e.off(k.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(k.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(k.LEVEL_UPDATED,this.onLevelUpdated,this)},t.onMediaAttached=function(e,t){this.media=t.media},t.onMediaDetaching=function(){this.id3Track&&(ct(this.id3Track),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={})},t.onManifestLoading=function(){this.dateRangeCuesAppended={}},t.createTrack=function(e){var t=this.getID3Track(e.textTracks);return t.mode="hidden",t},t.getID3Track=function(e){if(this.media){for(var t=0;t<e.length;t++){var i=e[t];if("metadata"===i.kind&&"id3"===i.label)return ut(i,this.media),i}return this.media.addTextTrack("metadata","id3")}},t.onFragParsingMetadata=function(e,t){if(this.media){var i=this.hls.config,n=i.enableEmsgMetadataCues,r=i.enableID3MetadataCues;if(n||r){var a=t.samples;this.id3Track||(this.id3Track=this.createTrack(this.media));for(var s=pt(),o=0;o<a.length;o++){var l=a[o].type;if((l!==gt.emsg||n)&&r){var u=ne(a[o].data);if(u){var c=a[o].pts,h=c+a[o].duration;h>mt&&(h=mt);var d=h-c;d<=0&&(h=c+vt);for(var f=0;f<u.length;f++){var g=u[f];if(!te(g)){this.updateId3CueEnds(c,l);var v=new s(c,h,"");v.value=g,l&&(v.type=l),this.id3Track.addCue(v)}}}}}}}},t.updateId3CueEnds=function(e,t){var i,n=null==(i=this.id3Track)?void 0:i.cues;if(n)for(var r=n.length;r--;){var a=n[r];a.type===t&&a.startTime<e&&a.endTime===mt&&(a.endTime=e)}},t.onBufferFlushing=function(e,t){var i=t.startOffset,n=t.endOffset,r=t.type,a=this.id3Track,s=this.hls;if(s){var o,l=s.config,u=l.enableEmsgMetadataCues,c=l.enableID3MetadataCues;if(a&&(u||c))o="audio"===r?function(e){return e.type===gt.audioId3&&c}:"video"===r?function(e){return e.type===gt.emsg&&u}:function(e){return e.type===gt.audioId3&&c||e.type===gt.emsg&&u},ht(a,i,n,o)}},t.onLevelUpdated=function(e,t){var i=this,n=t.details;if(this.media&&n.hasProgramDateTime&&this.hls.config.enableDateRangeMetadataCues){var r=this.dateRangeCuesAppended,a=this.id3Track,s=n.dateRanges,o=Object.keys(s);if(a)for(var l=Object.keys(r).filter((function(e){return!o.includes(e)})),u=function(){var e=l[c];Object.keys(r[e].cues).forEach((function(t){a.removeCue(r[e].cues[t])})),delete r[e]},c=l.length;c--;)u();var h=n.fragments[n.fragments.length-1];if(0!==o.length&&T(null==h?void 0:h.programDateTime)){this.id3Track||(this.id3Track=this.createTrack(this.media));for(var d=h.programDateTime/1e3-h.start,f=pt(),g=function(){var e=o[v],t=s[e],n=r[e],a=(null==n?void 0:n.cues)||{},l=(null==n?void 0:n.durationKnown)||!1,u=yt(t.startDate,d),c=mt,h=t.endDate;if(h)c=yt(h,d),l=!0;else if(t.endOnNext&&!l){var g=o.reduce((function(e,i){var n=s[i];return n.class===t.class&&n.id!==i&&n.startDate>t.startDate&&e.push(n),e}),[]).sort((function(e,t){return e.startDate.getTime()-t.startDate.getTime()}))[0];g&&(c=yt(g.startDate,d),l=!0)}for(var p=Object.keys(t.attr),m=0;m<p.length;m++){var y=p[m];if(N(y)){var b=a[y];if(b)l&&!n.durationKnown&&(b.endTime=c);else{var E=t.attr[y];b=new f(u,c,""),M(y)&&(E=bt(E)),b.value={key:y,data:E},b.type=gt.dateRange,b.id=e,i.id3Track.addCue(b),a[y]=b}}}r[e]={cues:a,dateRange:t,durationKnown:l}},v=0;v<o.length;v++)g()}}},e}(),Tt=function(){function e(e){var t=this;this.hls=void 0,this.config=void 0,this.media=null,this.levelDetails=null,this.currentTime=0,this.stallCount=0,this._latency=null,this.timeupdateHandler=function(){return t.timeupdate()},this.hls=e,this.config=e.config,this.registerListeners()}var t=e.prototype;return t.destroy=function(){this.unregisterListeners(),this.onMediaDetaching(),this.levelDetails=null,this.hls=this.timeupdateHandler=null},t.registerListeners=function(){this.hls.on(k.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(k.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.on(k.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(k.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.on(k.ERROR,this.onError,this)},t.unregisterListeners=function(){this.hls.off(k.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(k.MEDIA_DETACHING,this.onMediaDetaching,this),this.hls.off(k.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(k.LEVEL_UPDATED,this.onLevelUpdated,this),this.hls.off(k.ERROR,this.onError,this)},t.onMediaAttached=function(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.timeupdateHandler)},t.onMediaDetaching=function(){this.media&&(this.media.removeEventListener("timeupdate",this.timeupdateHandler),this.media=null)},t.onManifestLoading=function(){this.levelDetails=null,this._latency=null,this.stallCount=0},t.onLevelUpdated=function(e,t){var i=t.details;this.levelDetails=i,i.advanced&&this.timeupdate(),!i.live&&this.media&&this.media.removeEventListener("timeupdate",this.timeupdateHandler)},t.onError=function(e,t){var i;t.details===_.BUFFER_STALLED_ERROR&&(this.stallCount++,null!=(i=this.levelDetails)&&i.live&&x.warn("[playback-rate-controller]: Stall detected, adjusting target latency"))},t.timeupdate=function(){var e=this.media,t=this.levelDetails;if(e&&t){this.currentTime=e.currentTime;var i=this.computeLatency();if(null!==i){this._latency=i;var n=this.config,r=n.lowLatencyMode,a=n.maxLiveSyncPlaybackRate;if(r&&1!==a){var s=this.targetLatency;if(null!==s){var o=i-s,l=Math.min(this.maxLatency,s+t.targetduration),u=o<l;if(t.live&&u&&o>.05&&this.forwardBufferLength>1){var c=Math.min(2,Math.max(1,a)),h=Math.round(2/(1+Math.exp(-.75*o-this.edgeStalled))*20)/20;e.playbackRate=Math.min(c,Math.max(1,h))}else 1!==e.playbackRate&&0!==e.playbackRate&&(e.playbackRate=1)}}}}},t.estimateLiveEdge=function(){var e=this.levelDetails;return null===e?null:e.edge+e.age},t.computeLatency=function(){var e=this.estimateLiveEdge();return null===e?null:e-this.currentTime},a(e,[{key:"latency",get:function(){return this._latency||0}},{key:"maxLatency",get:function(){var e=this.config,t=this.levelDetails;return void 0!==e.liveMaxLatencyDuration?e.liveMaxLatencyDuration:t?e.liveMaxLatencyDurationCount*t.targetduration:0}},{key:"targetLatency",get:function(){var e=this.levelDetails;if(null===e)return null;var t=e.holdBack,i=e.partHoldBack,n=e.targetduration,r=this.config,a=r.liveSyncDuration,s=r.liveSyncDurationCount,o=r.lowLatencyMode,l=this.hls.userConfig,u=o&&i||t;(l.liveSyncDuration||l.liveSyncDurationCount||0===u)&&(u=void 0!==a?a:s*n);var c=n,h=1;return u+Math.min(this.stallCount*h,c)}},{key:"liveSyncPosition",get:function(){var e=this.estimateLiveEdge(),t=this.targetLatency,i=this.levelDetails;if(null===e||null===t||null===i)return null;var n=i.edge,r=e-t-this.edgeStalled,a=n-i.totalduration,s=n-(this.config.lowLatencyMode&&i.partTarget||i.targetduration);return Math.min(Math.max(a,r),s)}},{key:"drift",get:function(){var e=this.levelDetails;return null===e?1:e.drift}},{key:"edgeStalled",get:function(){var e=this.levelDetails;if(null===e)return 0;var t=3*(this.config.lowLatencyMode&&e.partTarget||e.targetduration);return Math.max(e.age-t,0)}},{key:"forwardBufferLength",get:function(){var e=this.media,t=this.levelDetails;if(!e||!t)return 0;var i=e.buffered.length;return(i?e.buffered.end(i-1):t.edge)-this.currentTime}}]),e}(),kt=["NONE","TYPE-0","TYPE-1",null],St={No:"",Yes:"YES",v2:"v2"};function _t(e,t){var i=e.canSkipUntil,n=e.canSkipDateRanges,r=e.endSN,a=void 0!==t?t-r:0;return i&&a<i?n?St.v2:St.Yes:St.No}var Lt=function(){function e(e,t,i){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=i}var t=e.prototype;return t.addDirectives=function(e){var t=new self.URL(e);return void 0!==this.msn&&t.searchParams.set("_HLS_msn",this.msn.toString()),void 0!==this.part&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href},e}(),At=function(){function e(e){this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.videoCodec=void 0,this.width=void 0,this.unknownCodecs=void 0,this.audioGroupIds=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.textGroupIds=void 0,this.url=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.unknownCodecs=e.unknownCodecs,this.codecSet=[e.videoCodec,e.audioCodec].filter((function(e){return e})).join(",").replace(/\.[^.,]+/g,"")}var t=e.prototype;return t.addFallback=function(e){this.url.push(e.url),this._attrs.push(e.attrs)},a(e,[{key:"maxBitrate",get:function(){return Math.max(this.realBitrate,this.bitrate)}},{key:"attrs",get:function(){return this._attrs[this._urlId]}},{key:"pathwayId",get:function(){return this.attrs["PATHWAY-ID"]||"."}},{key:"uri",get:function(){return this.url[this._urlId]||""}},{key:"urlId",get:function(){return this._urlId},set:function(e){var t=e%this.url.length;this._urlId!==t&&(this.fragmentError=0,this.loadError=0,this.details=void 0,this._urlId=t)}},{key:"audioGroupId",get:function(){var e;return null==(e=this.audioGroupIds)?void 0:e[this.urlId]}},{key:"textGroupId",get:function(){var e;return null==(e=this.textGroupIds)?void 0:e[this.urlId]}}]),e}();function Ct(e,t){var i=t.startPTS;if(T(i)){var n,r=0;t.sn>e.sn?(r=i-e.start,n=e):(r=e.start-i,n=t),n.duration!==r&&(n.duration=r)}else if(t.sn>e.sn){var a=e.cc===t.cc;a&&e.minEndPTS?t.start=e.start+(e.minEndPTS-e.start):t.start=e.start+e.duration}else t.start=Math.max(e.start-t.duration,0)}function Ot(e,t,i,n,r,a){var s=n-i;s<=0&&(x.warn("Fragment should have a positive duration",t),n=i+t.duration,a=r+t.duration);var o=i,l=n,u=t.startPTS,c=t.endPTS;if(T(u)){var h=Math.abs(u-i);T(t.deltaPTS)?t.deltaPTS=Math.max(h,t.deltaPTS):t.deltaPTS=h,o=Math.max(i,u),i=Math.min(i,u),r=Math.min(r,t.startDTS),l=Math.min(n,c),n=Math.max(n,c),a=Math.max(a,t.endDTS)}var d=i-t.start;0!==t.start&&(t.start=i),t.duration=n-t.start,t.startPTS=i,t.maxStartPTS=o,t.startDTS=r,t.endPTS=n,t.minEndPTS=l,t.endDTS=a;var f,g=t.sn;if(!e||g<e.startSN||g>e.endSN)return 0;var v=g-e.startSN,p=e.fragments;for(p[v]=t,f=v;f>0;f--)Ct(p[f],p[f-1]);for(f=v;f<p.length-1;f++)Ct(p[f],p[f+1]);return e.fragmentHint&&Ct(p[p.length-1],e.fragmentHint),e.PTSKnown=e.alignedSliding=!0,d}function Rt(e,t){for(var i=null,n=e.fragments,r=n.length-1;r>=0;r--){var a=n[r].initSegment;if(a){i=a;break}}e.fragmentHint&&delete e.fragmentHint.endPTS;var s,o=0;if(It(e,t,(function(e,n){e.relurl&&(o=e.cc-n.cc),T(e.startPTS)&&T(e.endPTS)&&(n.start=n.startPTS=e.startPTS,n.startDTS=e.startDTS,n.maxStartPTS=e.maxStartPTS,n.endPTS=e.endPTS,n.endDTS=e.endDTS,n.minEndPTS=e.minEndPTS,n.duration=e.endPTS-e.startPTS,n.duration&&(s=n),t.PTSKnown=t.alignedSliding=!0),n.elementaryStreams=e.elementaryStreams,n.loader=e.loader,n.stats=e.stats,n.urlId=e.urlId,e.initSegment&&(n.initSegment=e.initSegment,i=e.initSegment)})),i){var l=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments;l.forEach((function(e){var t;e.initSegment&&e.initSegment.relurl!==(null==(t=i)?void 0:t.relurl)||(e.initSegment=i)}))}if(t.skippedSegments)if(t.deltaUpdateFailed=t.fragments.some((function(e){return!e})),t.deltaUpdateFailed){x.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(var u=t.skippedSegments;u--;)t.fragments.shift();t.startSN=t.fragments[0].sn,t.startCC=t.fragments[0].cc}else t.canSkipDateRanges&&(t.dateRanges=wt(e.dateRanges,t.dateRanges,t.recentlyRemovedDateranges));var c=t.fragments;if(o){x.warn("discontinuity sliding from playlist, take drift into account");for(var h=0;h<c.length;h++)c[h].cc+=o}t.skippedSegments&&(t.startCC=t.fragments[0].cc),xt(e.partList,t.partList,(function(e,t){t.elementaryStreams=e.elementaryStreams,t.stats=e.stats})),s?Ot(t,s,s.startPTS,s.endPTS,s.startDTS,s.endDTS):Dt(e,t),c.length&&(t.totalduration=t.edge-c[0].start),t.driftStartTime=e.driftStartTime,t.driftStart=e.driftStart;var d=t.advancedDateTime;if(t.advanced&&d){var f=t.edge;t.driftStart||(t.driftStartTime=d,t.driftStart=f),t.driftEndTime=d,t.driftEnd=f}else t.driftEndTime=e.driftEndTime,t.driftEnd=e.driftEnd,t.advancedDateTime=e.advancedDateTime}function wt(e,t,i){var n=o({},e);return i&&i.forEach((function(e){delete n[e]})),Object.keys(t).forEach((function(e){var i=new F(t[e].attr,n[e]);i.isValid?n[e]=i:x.warn('Ignoring invalid Playlist Delta Update DATERANGE tag: "'+JSON.stringify(t[e].attr)+'"')})),n}function xt(e,t,i){if(e&&t)for(var n=0,r=0,a=e.length;r<=a;r++){var s=e[r],o=t[r+n];s&&o&&s.index===o.index&&s.fragment.sn===o.fragment.sn?i(s,o):n--}}function It(e,t,i){for(var n=t.skippedSegments,r=Math.max(e.startSN,t.startSN)-t.startSN,a=(e.fragmentHint?1:0)+(n?t.endSN:Math.min(e.endSN,t.endSN))-t.startSN,s=t.startSN-e.startSN,o=t.fragmentHint?t.fragments.concat(t.fragmentHint):t.fragments,l=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,u=r;u<=a;u++){var c=l[s+u],h=o[u];n&&!h&&u<n&&(h=t.fragments[u]=c),c&&h&&i(c,h)}}function Dt(e,t){var i=t.startSN+t.skippedSegments-e.startSN,n=e.fragments;i<0||i>=n.length||Pt(t,n[i].start)}function Pt(e,t){if(t){for(var i=e.fragments,n=e.skippedSegments;n<i.length;n++)i[n].start+=t;e.fragmentHint&&(e.fragmentHint.start+=t)}}function Nt(e,t){void 0===t&&(t=1/0);var i=1e3*e.targetduration;if(e.updated){var n=e.fragments,r=4;if(n.length&&i*r>t){var a=1e3*n[n.length-1].duration;a<i&&(i=a)}}else i/=2;return Math.round(i)}function Mt(e,t,i){if(null==e||!e.details)return null;var n=e.details,r=n.fragments[t-n.startSN];return r||(r=n.fragmentHint,r&&r.sn===t?r:t<n.startSN&&i&&i.sn===t?i:null)}function Ft(e,t,i){var n;return null!=e&&e.details?jt(null==(n=e.details)?void 0:n.partList,t,i):null}function jt(e,t,i){if(e)for(var n=e.length;n--;){var r=e[n];if(r.index===i&&r.fragment.sn===t)return r}return null}function Ut(e){switch(e.details){case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_TIMEOUT:case _.LEVEL_LOAD_TIMEOUT:case _.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function Bt(e,t){var i=Ut(t);return e.default[(i?"timeout":"error")+"Retry"]}function Gt(e,t){var i="linear"===e.backoff?1:Math.pow(2,t);return Math.min(i*e.retryDelayMs,e.maxRetryDelayMs)}function Ht(e){return n(n({},e),{errorRetry:null,timeoutRetry:null})}function Vt(e,t,i,n){return!!e&&t<e.maxNumRetry&&(Kt(n)||!!i)}function Kt(e){return 0===e&&!1===navigator.onLine||!!e&&(e<400||e>499)}var Wt={search:function(e,t){var i=0,n=e.length-1,r=null,a=null;while(i<=n){r=(i+n)/2|0,a=e[r];var s=t(a);if(s>0)i=r+1;else{if(!(s<0))return a;n=r-1}}return null}};function Yt(e,t,i){if(null===t||!Array.isArray(e)||!e.length||!T(t))return null;var n=e[0].programDateTime;if(t<(n||0))return null;var r=e[e.length-1].endProgramDateTime;if(t>=(r||0))return null;i=i||0;for(var a=0;a<e.length;++a){var s=e[a];if(qt(t,i,s))return s}return null}function zt(e,t,i,n){void 0===i&&(i=0),void 0===n&&(n=0);var r=null;if(e?r=t[e.sn-t[0].sn+1]||null:0===i&&0===t[0].start&&(r=t[0]),r&&0===Xt(i,n,r))return r;var a=Wt.search(t,Xt.bind(null,i,n));return!a||a===e&&r?r:a}function Xt(e,t,i){if(void 0===e&&(e=0),void 0===t&&(t=0),i.start<=e&&i.start+i.duration>e)return 0;var n=Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0));return i.start+i.duration-n<=e?1:i.start-n>e&&i.start?-1:0}function qt(e,t,i){var n=1e3*Math.min(t,i.duration+(i.deltaPTS?i.deltaPTS:0)),r=i.endProgramDateTime||0;return r-n>e}function Zt(e,t){return Wt.search(e,(function(e){return e.cc<t?1:e.cc>t?-1:0}))}var Qt=3e5,Jt={DoNothing:0,SendEndCallback:1,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,InsertDiscontinuity:4,RetryRequest:5},$t={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2,SwitchToSDR:4},ei=function(){function e(e){this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.log=void 0,this.warn=void 0,this.error=void 0,this.hls=e,this.log=x.log.bind(x,"[info]:"),this.warn=x.warn.bind(x,"[warning]:"),this.error=x.error.bind(x,"[error]:"),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(k.ERROR,this.onError,this),e.on(k.MANIFEST_LOADING,this.onManifestLoading,this),e.on(k.LEVEL_UPDATED,this.onLevelUpdated,this)},t.unregisterListeners=function(){var e=this.hls;e&&(e.off(k.ERROR,this.onError,this),e.off(k.ERROR,this.onErrorOut,this),e.off(k.MANIFEST_LOADING,this.onManifestLoading,this),e.off(k.LEVEL_UPDATED,this.onLevelUpdated,this))},t.destroy=function(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}},t.startLoad=function(e){this.playlistError=0},t.stopLoad=function(){},t.getVariantLevelIndex=function(e){return(null==e?void 0:e.type)===at.MAIN?e.level:this.hls.loadLevel},t.onManifestLoading=function(){this.playlistError=0,this.penalizedRenditions={}},t.onLevelUpdated=function(){this.playlistError=0},t.onError=function(e,t){var i;if(!t.fatal){var n=this.hls,r=t.context;switch(t.details){case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:return void(t.errorAction=this.getFragRetryOrSwitchAction(t));case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:return t.errorAction=this.getFragRetryOrSwitchAction(t),void(t.errorAction.action=Jt.SendAlternateToPenaltyBox);case _.LEVEL_EMPTY_ERROR:case _.LEVEL_PARSING_ERROR:var a,s,o=t.parent===at.MAIN?t.level:n.loadLevel;return void(t.details===_.LEVEL_EMPTY_ERROR&&null!=(a=t.context)&&null!=(s=a.levelDetails)&&s.live?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,o):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,o)));case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:return void("number"===typeof(null==r?void 0:r.level)&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.level)));case _.AUDIO_TRACK_LOAD_ERROR:case _.AUDIO_TRACK_LOAD_TIMEOUT:case _.SUBTITLE_LOAD_ERROR:case _.SUBTITLE_TRACK_LOAD_TIMEOUT:if(r){var l=n.levels[n.loadLevel];if(l&&(r.type===rt.AUDIO_TRACK&&r.groupId===l.audioGroupId||r.type===rt.SUBTITLE_TRACK&&r.groupId===l.textGroupId))return t.errorAction=this.getPlaylistRetryOrSwitchAction(t,n.loadLevel),t.errorAction.action=Jt.SendAlternateToPenaltyBox,void(t.errorAction.flags=$t.MoveAllAlternatesMatchingHost)}return;case _.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:var u=n.levels[n.loadLevel],c=null==u?void 0:u.attrs["HDCP-LEVEL"];return void(c&&(t.errorAction={action:Jt.SendAlternateToPenaltyBox,flags:$t.MoveAllAlternatesMatchingHDCP,hdcpLevel:c}));case _.BUFFER_ADD_CODEC_ERROR:case _.REMUX_ALLOC_ERROR:return void(t.errorAction=this.getLevelSwitchAction(t,null!=(i=t.level)?i:n.loadLevel));case _.INTERNAL_EXCEPTION:case _.BUFFER_APPENDING_ERROR:case _.BUFFER_APPEND_ERROR:case _.BUFFER_FULL_ERROR:case _.LEVEL_SWITCH_ERROR:case _.BUFFER_STALLED_ERROR:case _.BUFFER_SEEK_OVER_HOLE:case _.BUFFER_NUDGE_ON_STALL:return void(t.errorAction={action:Jt.DoNothing,flags:$t.None})}if(t.type===S.KEY_SYSTEM_ERROR){var h=this.getVariantLevelIndex(t.frag);return t.levelRetry=!1,void(t.errorAction=this.getLevelSwitchAction(t,h))}}},t.getPlaylistRetryOrSwitchAction=function(e,t){var i,n=this.hls,r=Bt(n.config.playlistLoadPolicy,e),a=this.playlistError++,s=null==(i=e.response)?void 0:i.code,o=Vt(r,a,Ut(e),s);if(o)return{action:Jt.RetryRequest,flags:$t.None,retryConfig:r,retryCount:a};var l=this.getLevelSwitchAction(e,t);return r&&(l.retryConfig=r,l.retryCount=a),l},t.getFragRetryOrSwitchAction=function(e){var t=this.hls,i=this.getVariantLevelIndex(e.frag),n=t.levels[i],r=t.config,a=r.fragLoadPolicy,s=r.keyLoadPolicy,o=Bt(e.details.startsWith("key")?s:a,e),l=t.levels.reduce((function(e,t){return e+t.fragmentError}),0);if(n){var u;e.details!==_.FRAG_GAP&&n.fragmentError++;var c=null==(u=e.response)?void 0:u.code,h=Vt(o,l,Ut(e),c);if(h)return{action:Jt.RetryRequest,flags:$t.None,retryConfig:o,retryCount:l}}var d=this.getLevelSwitchAction(e,i);return o&&(d.retryConfig=o,d.retryCount=l),d},t.getLevelSwitchAction=function(e,t){var i=this.hls;null!==t&&void 0!==t||(t=i.loadLevel);var n=this.hls.levels[t];if(n&&(n.loadError++,i.autoLevelEnabled)){for(var r,a,s=-1,o=i.levels,l=i.loadLevel,u=i.minAutoLevel,c=i.maxAutoLevel,h=null==(r=e.frag)?void 0:r.type,d=null!=(a=e.context)?a:{},f=d.type,g=d.groupId,v=o.length;v--;){var p=(v+l)%o.length;if(p!==l&&p>=u&&p<=c&&0===o[p].loadError){var m=o[p];if(e.details===_.FRAG_GAP&&e.frag){var y=o[p].details;if(y){var b=zt(e.frag,y.fragments,e.frag.start);if(null!=b&&b.gap)continue}}else{if(f===rt.AUDIO_TRACK&&g===m.audioGroupId||f===rt.SUBTITLE_TRACK&&g===m.textGroupId)continue;if(h===at.AUDIO&&n.audioGroupId===m.audioGroupId||h===at.SUBTITLE&&n.textGroupId===m.textGroupId)continue}s=p;break}}if(s>-1&&i.loadLevel!==s)return e.levelRetry=!0,this.playlistError=0,{action:Jt.SendAlternateToPenaltyBox,flags:$t.None,nextAutoLevel:s}}return{action:Jt.SendAlternateToPenaltyBox,flags:$t.MoveAllAlternatesMatchingHost}},t.onErrorOut=function(e,t){var i;switch(null==(i=t.errorAction)?void 0:i.action){case Jt.DoNothing:break;case Jt.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),t.errorAction.resolved||t.details===_.FRAG_GAP||(t.fatal=!0);break}t.fatal&&this.hls.stopLoad()},t.sendAlternateToPenaltyBox=function(e){var t=this.hls,i=e.errorAction;if(i){var n=i.flags,r=i.hdcpLevel,a=i.nextAutoLevel;switch(n){case $t.None:this.switchLevel(e,a);break;case $t.MoveAllAlternatesMatchingHost:i.resolved||(i.resolved=this.redundantFailover(e));break;case $t.MoveAllAlternatesMatchingHDCP:r&&(t.maxHdcpLevel=kt[kt.indexOf(r)-1],i.resolved=!0),this.warn('Restricting playback to HDCP-LEVEL of "'+t.maxHdcpLevel+'" or lower');break}i.resolved||this.switchLevel(e,a)}},t.switchLevel=function(e,t){void 0!==t&&e.errorAction&&(this.warn("switching to level "+t+" after "+e.details),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel)},t.redundantFailover=function(e){var t=this,i=this.hls,n=this.penalizedRenditions,r=e.parent===at.MAIN?e.level:i.loadLevel,a=i.levels[r],s=a.url.length,o=e.frag?e.frag.urlId:a.urlId;a.urlId!==o||e.frag&&!a.details||this.penalizeRendition(a,e);for(var l=function(){var l=(o+u)%s,c=n[l];if(!c||ti(c,e,n[o]))return t.warn("Switching to Redundant Stream "+(l+1)+"/"+s+': "'+a.url[l]+'" after '+e.details),t.playlistError=0,i.levels.forEach((function(e){e.urlId=l})),i.nextLoadLevel=r,{v:!0}},u=1;u<s;u++){var c=l();if("object"===typeof c)return c.v}return!1},t.penalizeRendition=function(e,t){var i=this.penalizedRenditions,n=i[e.urlId]||{lastErrorPerfMs:0,errors:[],details:void 0};n.lastErrorPerfMs=performance.now(),n.errors.push(t),n.details=e.details,i[e.urlId]=n},e}();function ti(e,t,i){if(performance.now()-e.lastErrorPerfMs>Qt)return!0;var n=e.details;if(t.details===_.FRAG_GAP&&n&&t.frag){var r=t.frag.start,a=zt(null,n.fragments,r);if(a&&!a.gap)return!0}if(i&&e.errors.length<i.errors.length){var s=e.errors[e.errors.length-1];if(n&&s.frag&&t.frag&&Math.abs(s.frag.start-t.frag.start)>3*n.targetduration)return!0}return!1}var ii,ni=function(){function e(e,t){this.hls=void 0,this.timer=-1,this.requestScheduled=-1,this.canLoad=!1,this.log=void 0,this.warn=void 0,this.log=x.log.bind(x,t+":"),this.warn=x.warn.bind(x,t+":"),this.hls=e}var t=e.prototype;return t.destroy=function(){this.clearTimer(),this.hls=this.log=this.warn=null},t.clearTimer=function(){clearTimeout(this.timer),this.timer=-1},t.startLoad=function(){this.canLoad=!0,this.requestScheduled=-1,this.loadPlaylist()},t.stopLoad=function(){this.canLoad=!1,this.clearTimer()},t.switchParams=function(e,t){var i=null==t?void 0:t.renditionReports;if(i){for(var n=-1,r=0;r<i.length;r++){var a=i[r],s=void 0;try{s=new self.URL(a.URI,t.url).href}catch(h){x.warn("Could not construct new URL for Rendition Report: "+h),s=a.URI||""}if(s===e){n=r;break}s===e.substring(0,s.length)&&(n=r)}if(-1!==n){var o=i[n],l=parseInt(o["LAST-MSN"])||(null==t?void 0:t.lastPartSn),u=parseInt(o["LAST-PART"])||(null==t?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){var c=Math.min(t.age-t.partTarget,t.targetduration);u>=0&&c>t.partTarget&&(u+=1)}return new Lt(l,u>=0?u:void 0,St.No)}}},t.loadPlaylist=function(e){-1===this.requestScheduled&&(this.requestScheduled=self.performance.now())},t.shouldLoadPlaylist=function(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)},t.shouldReloadPlaylist=function(e){return-1===this.timer&&-1===this.requestScheduled&&this.shouldLoadPlaylist(e)},t.playlistLoaded=function(e,t,i){var n=this,r=t.details,a=t.stats,s=self.performance.now(),o=a.loading.first?Math.max(0,s-a.loading.first):0;if(r.advancedDateTime=Date.now()-o,r.live||null!=i&&i.live){if(r.reloaded(i),i&&this.log("live playlist "+e+" "+(r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:"MISSED")),i&&r.fragments.length>0&&Rt(i,r),!this.canLoad||!r.live)return;var l,u=void 0,c=void 0;if(r.canBlockReload&&r.endSN&&r.advanced){var h=this.hls.config.lowLatencyMode,d=r.lastPartSn,f=r.endSN,g=r.lastPartIndex,v=-1!==g,p=d===f,m=h?0:g;v?(u=p?f+1:d,c=p?m:g+1):u=f+1;var y=r.age,b=y+r.ageHeader,E=Math.min(b-r.partTarget,1.5*r.targetduration);if(E>0){if(i&&E>i.tuneInGoal)this.warn("CDN Tune-in goal increased from: "+i.tuneInGoal+" to: "+E+" with playlist age: "+r.age),E=0;else{var T=Math.floor(E/r.targetduration);if(u+=T,void 0!==c){var k=Math.round(E%r.targetduration/r.partTarget);c+=k}this.log("CDN Tune-in age: "+r.ageHeader+"s last advanced "+y.toFixed(2)+"s goal: "+E+" skip sn "+T+" to part "+c)}r.tuneInGoal=E}if(l=this.getDeliveryDirectives(r,t.deliveryDirectives,u,c),h||!p)return void this.loadPlaylist(l)}else r.canBlockReload&&(l=this.getDeliveryDirectives(r,t.deliveryDirectives,u,c));var S=this.hls.mainForwardBufferInfo,_=S?S.end-S.len:0,L=1e3*(r.edge-_),A=Nt(r,L);r.updated&&s>this.requestScheduled+A&&(this.requestScheduled=a.loading.start),void 0!==u&&r.canBlockReload?this.requestScheduled=a.loading.first+A-(1e3*r.partTarget||1e3):-1===this.requestScheduled||this.requestScheduled+A<s?this.requestScheduled=s:this.requestScheduled-s<=0&&(this.requestScheduled+=A);var C=this.requestScheduled-s;C=Math.max(0,C),this.log("reload live playlist "+e+" in "+Math.round(C)+" ms"),this.timer=self.setTimeout((function(){return n.loadPlaylist(l)}),C)}else this.clearTimer()},t.getDeliveryDirectives=function(e,t,i,n){var r=_t(e,i);return null!=t&&t.skip&&e.deltaUpdateFailed&&(i=t.msn,n=t.part,r=St.No),new Lt(i,n,r)},t.checkRetry=function(e){var t=this,i=e.details,n=Ut(e),r=e.errorAction,a=r||{},s=a.action,o=a.retryCount,l=void 0===o?0:o,u=a.retryConfig,c=!!r&&!!u&&(s===Jt.RetryRequest||!r.resolved&&s===Jt.SendAlternateToPenaltyBox);if(c){var h;if(this.requestScheduled=-1,l>=u.maxNumRetry)return!1;if(n&&null!=(h=e.context)&&h.deliveryDirectives)this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+' after "'+i+'" without delivery-directives'),this.loadPlaylist();else{var d=Gt(u,l);this.timer=self.setTimeout((function(){return t.loadPlaylist()}),d),this.warn("Retrying playlist loading "+(l+1)+"/"+u.maxNumRetry+' after "'+i+'" in '+d+"ms")}e.levelRetry=!0,r.resolved=!0}return c},e}(),ri=function(e){function t(t,i){var n;return n=e.call(this,t,"[level-controller]")||this,n._levels=[],n._firstLevel=-1,n._startLevel=void 0,n.currentLevel=null,n.currentLevelIndex=-1,n.manualLevelIndex=-1,n.steering=void 0,n.onParsedComplete=void 0,n.steering=i,n._registerListeners(),n}l(t,e);var i=t.prototype;return i._registerListeners=function(){var e=this.hls;e.on(k.MANIFEST_LOADING,this.onManifestLoading,this),e.on(k.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(k.LEVEL_LOADED,this.onLevelLoaded,this),e.on(k.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(k.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(k.FRAG_LOADED,this.onFragLoaded,this),e.on(k.ERROR,this.onError,this)},i._unregisterListeners=function(){var e=this.hls;e.off(k.MANIFEST_LOADING,this.onManifestLoading,this),e.off(k.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(k.LEVEL_LOADED,this.onLevelLoaded,this),e.off(k.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(k.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(k.FRAG_LOADED,this.onFragLoaded,this),e.off(k.ERROR,this.onError,this)},i.destroy=function(){this._unregisterListeners(),this.steering=null,this.resetLevels(),e.prototype.destroy.call(this)},i.startLoad=function(){var t=this._levels;t.forEach((function(e){e.loadError=0,e.fragmentError=0})),e.prototype.startLoad.call(this)},i.resetLevels=function(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[]},i.onManifestLoading=function(e,t){this.resetLevels()},i.onManifestLoaded=function(e,t){var i,n=[],r={};t.levels.forEach((function(e){var t,a=e.attrs;-1!==(null==(t=e.audioCodec)?void 0:t.indexOf("mp4a.40.34"))&&(ii||(ii=/chrome|firefox/i.test(navigator.userAgent)),ii&&(e.audioCodec=void 0));var s=a.AUDIO,o=a.CODECS,l=a["FRAME-RATE"];a["PATHWAY-ID"];var u=a.RESOLUTION,c=a.SUBTITLES,h="",d=""+h+e.bitrate+"-"+u+"-"+l+"-"+o;i=r[d],i?i.addFallback(e):(i=new At(e),r[d]=i,n.push(i)),ai(i,"audio",s),ai(i,"text",c)})),this.filterAndSortMediaOptions(n,t)},i.filterAndSortMediaOptions=function(e,t){var i=this,n=[],r=[],a=!1,s=!1,o=!1,l=e.filter((function(e){var t=e.audioCodec,i=e.videoCodec,n=e.width,r=e.height,l=e.unknownCodecs;return a||(a=!(!n||!r)),s||(s=!!i),o||(o=!!t),!(null!=l&&l.length)&&(!t||Ve(t,"audio"))&&(!i||Ve(i,"video"))}));if((a||s)&&o&&(l=l.filter((function(e){var t=e.videoCodec,i=e.width,n=e.height;return!!t||!(!i||!n)}))),0!==l.length){t.audioTracks&&(n=t.audioTracks.filter((function(e){return!e.audioCodec||Ve(e.audioCodec,"audio")})),si(n)),t.subtitles&&(r=t.subtitles,si(r));var u=l.slice(0);l.sort((function(e,t){return e.attrs["HDCP-LEVEL"]!==t.attrs["HDCP-LEVEL"]?(e.attrs["HDCP-LEVEL"]||"")>(t.attrs["HDCP-LEVEL"]||"")?1:-1:e.bitrate!==t.bitrate?e.bitrate-t.bitrate:e.attrs["FRAME-RATE"]!==t.attrs["FRAME-RATE"]?e.attrs.decimalFloatingPoint("FRAME-RATE")-t.attrs.decimalFloatingPoint("FRAME-RATE"):e.attrs.SCORE!==t.attrs.SCORE?e.attrs.decimalFloatingPoint("SCORE")-t.attrs.decimalFloatingPoint("SCORE"):a&&e.height!==t.height?e.height-t.height:0}));var c=u[0];if(this.steering&&(l=this.steering.filterParsedLevels(l),l.length!==u.length))for(var h=0;h<u.length;h++)if(u[h].pathwayId===l[0].pathwayId){c=u[h];break}this._levels=l;for(var d=0;d<l.length;d++)if(l[d]===c){this._firstLevel=d,this.log("manifest loaded, "+l.length+" level(s) found, first bitrate: "+c.bitrate);break}var f=o&&!s,g={levels:l,audioTracks:n,subtitleTracks:r,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:o,video:s,altAudio:!f&&n.some((function(e){return!!e.url}))};this.hls.trigger(k.MANIFEST_PARSED,g),(this.hls.config.autoStartLoad||this.hls.forceStartLoad)&&this.hls.startLoad(this.hls.config.startPosition)}else Promise.resolve().then((function(){if(i.hls){var e=new Error("no level with compatible codecs found in manifest");i.hls.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:e,reason:e.message})}}))},i.onError=function(e,t){!t.fatal&&t.context&&t.context.type===rt.LEVEL&&t.context.level===this.level&&this.checkRetry(t)},i.onFragLoaded=function(e,t){var i=t.frag;if(void 0!==i&&i.type===at.MAIN){var n=this._levels[i.level];void 0!==n&&(n.loadError=0)}},i.onLevelLoaded=function(e,t){var i,n,r=t.level,a=t.details,s=this._levels[r];if(!s)return this.warn("Invalid level index "+r),void(null!=(n=t.deliveryDirectives)&&n.skip&&(a.deltaUpdateFailed=!0));r===this.currentLevelIndex?(0===s.fragmentError&&(s.loadError=0),this.playlistLoaded(r,t,s.details)):null!=(i=t.deliveryDirectives)&&i.skip&&(a.deltaUpdateFailed=!0)},i.onAudioTrackSwitched=function(e,t){var i=this.currentLevel;if(i){var n=this.hls.audioTracks[t.id].groupId;if(i.audioGroupIds&&i.audioGroupId!==n){for(var r=-1,a=0;a<i.audioGroupIds.length;a++)if(i.audioGroupIds[a]===n){r=a;break}-1!==r&&r!==i.urlId&&(i.urlId=r,this.canLoad&&this.startLoad())}}},i.loadPlaylist=function(t){e.prototype.loadPlaylist.call(this);var i=this.currentLevelIndex,n=this.currentLevel;if(n&&this.shouldLoadPlaylist(n)){var r=n.urlId,a=n.uri;if(t)try{a=t.addDirectives(a)}catch(o){this.warn("Could not construct new URL with HLS Delivery Directives: "+o)}var s=n.attrs["PATHWAY-ID"];this.log("Loading level index "+i+(void 0!==(null==t?void 0:t.msn)?" at sn "+t.msn+" part "+t.part:"")+" with"+(s?" Pathway "+s:"")+" URI "+(r+1)+"/"+n.url.length+" "+a),this.clearTimer(),this.hls.trigger(k.LEVEL_LOADING,{url:a,level:i,id:r,deliveryDirectives:t||null})}},i.removeLevel=function(e,t){var i=this,n=function(e,i){return i!==t},r=this._levels.filter((function(r,a){return a!==e||(r.url.length>1&&void 0!==t?(r.url=r.url.filter(n),r.audioGroupIds&&(r.audioGroupIds=r.audioGroupIds.filter(n)),r.textGroupIds&&(r.textGroupIds=r.textGroupIds.filter(n)),r.urlId=0,!0):(i.steering&&i.steering.removeLevel(r),!1))}));this.hls.trigger(k.LEVELS_UPDATED,{levels:r})},i.onLevelsUpdated=function(e,t){var i=t.levels;i.forEach((function(e,t){var i=e.details;null!=i&&i.fragments&&i.fragments.forEach((function(e){e.level=t}))})),this._levels=i},a(t,[{key:"levels",get:function(){return 0===this._levels.length?null:this._levels}},{key:"level",get:function(){return this.currentLevelIndex},set:function(e){var t=this._levels;if(0!==t.length){if(e<0||e>=t.length){var i=new Error("invalid level idx"),n=e<0;if(this.hls.trigger(k.ERROR,{type:S.OTHER_ERROR,details:_.LEVEL_SWITCH_ERROR,level:e,fatal:n,error:i,reason:i.message}),n)return;e=Math.min(e,t.length-1)}var r=this.currentLevelIndex,a=this.currentLevel,s=a?a.attrs["PATHWAY-ID"]:void 0,l=t[e],u=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,r!==e||!l.details||!a||s!==u){this.log("Switching to level "+e+(u?" with Pathway "+u:"")+" from level "+r+(s?" with Pathway "+s:""));var c=o({},l,{level:e,maxBitrate:l.maxBitrate,attrs:l.attrs,uri:l.uri,urlId:l.urlId});delete c._attrs,delete c._urlId,this.hls.trigger(k.LEVEL_SWITCHING,c);var h=l.details;if(!h||h.live){var d=this.switchParams(l.uri,null==a?void 0:a.details);this.loadPlaylist(d)}}}}},{key:"manualLevel",get:function(){return this.manualLevelIndex},set:function(e){this.manualLevelIndex=e,void 0===this._startLevel&&(this._startLevel=e),-1!==e&&(this.level=e)}},{key:"firstLevel",get:function(){return this._firstLevel},set:function(e){this._firstLevel=e}},{key:"startLevel",get:function(){if(void 0===this._startLevel){var e=this.hls.config.startLevel;return void 0!==e?e:this._firstLevel}return this._startLevel},set:function(e){this._startLevel=e}},{key:"nextLoadLevel",get:function(){return-1!==this.manualLevelIndex?this.manualLevelIndex:this.hls.nextAutoLevel},set:function(e){this.level=e,-1===this.manualLevelIndex&&(this.hls.nextAutoLevel=e)}}]),t}(ni);function ai(e,t,i){i&&("audio"===t?(e.audioGroupIds||(e.audioGroupIds=[]),e.audioGroupIds[e.url.length-1]=i):"text"===t&&(e.textGroupIds||(e.textGroupIds=[]),e.textGroupIds[e.url.length-1]=i))}function si(e){var t={};e.forEach((function(e){var i=e.groupId||"";e.id=t[i]=t[i]||0,t[i]++}))}var oi={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"},li=function(){function e(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}var t=e.prototype;return t._registerListeners=function(){var e=this.hls;e.on(k.BUFFER_APPENDED,this.onBufferAppended,this),e.on(k.FRAG_BUFFERED,this.onFragBuffered,this),e.on(k.FRAG_LOADED,this.onFragLoaded,this)},t._unregisterListeners=function(){var e=this.hls;e.off(k.BUFFER_APPENDED,this.onBufferAppended,this),e.off(k.FRAG_BUFFERED,this.onFragBuffered,this),e.off(k.FRAG_LOADED,this.onFragLoaded,this)},t.destroy=function(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null},t.getAppendedFrag=function(e,t){var i=this.activePartLists[t];if(i)for(var n=i.length;n--;){var r=i[n];if(!r)break;var a=r.end;if(r.start<=e&&null!==a&&e<=a)return r}return this.getBufferedFrag(e,t)},t.getBufferedFrag=function(e,t){for(var i=this.fragments,n=Object.keys(i),r=n.length;r--;){var a=i[n[r]];if((null==a?void 0:a.body.type)===t&&a.buffered){var s=a.body;if(s.start<=e&&e<=s.end)return s}}return null},t.detectEvictedFragments=function(e,t,i,n){var r=this;this.timeRanges&&(this.timeRanges[e]=t);var a=(null==n?void 0:n.fragment.sn)||-1;Object.keys(this.fragments).forEach((function(n){var s=r.fragments[n];if(s&&!(a>=s.body.sn))if(s.buffered||s.loaded){var o=s.range[e];o&&o.time.some((function(e){var i=!r.isTimeBuffered(e.startPTS,e.endPTS,t);return i&&r.removeFragment(s.body),i}))}else s.body.type===i&&r.removeFragment(s.body)}))},t.detectPartialFragments=function(e){var t=this,i=this.timeRanges,n=e.frag,r=e.part;if(i&&"initSegment"!==n.sn){var a=ci(n),s=this.fragments[a];if(s){var o=!n.relurl;Object.keys(i).forEach((function(e){var a=n.elementaryStreams[e];if(a){var l=i[e],u=o||!0===a.partial;s.range[e]=t.getBufferedTimes(n,r,u,l)}})),s.loaded=null,Object.keys(s.range).length?(s.buffered=!0,s.body.endList&&(this.endListFragments[s.body.type]=s),ui(s)||this.removeParts(n.sn-1,n.type)):this.removeFragment(s.body)}}},t.removeParts=function(e,t){var i=this.activePartLists[t];i&&(this.activePartLists[t]=i.filter((function(t){return t.fragment.sn>=e})))},t.fragBuffered=function(e,t){var i=ci(e),n=this.fragments[i];!n&&t&&(n=this.fragments[i]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),n&&(n.loaded=null,n.buffered=!0)},t.getBufferedTimes=function(e,t,i,n){for(var r={time:[],partial:i},a=e.start,s=e.end,o=e.minEndPTS||s,l=e.maxStartPTS||a,u=0;u<n.length;u++){var c=n.start(u)-this.bufferPadding,h=n.end(u)+this.bufferPadding;if(l>=c&&o<=h){r.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(s,n.end(u))});break}if(a<h&&s>c)r.partial=!0,r.time.push({startPTS:Math.max(a,n.start(u)),endPTS:Math.min(s,n.end(u))});else if(s<=c)break}return r},t.getPartialFragment=function(e){var t,i,n,r=null,a=0,s=this.bufferPadding,o=this.fragments;return Object.keys(o).forEach((function(l){var u=o[l];u&&ui(u)&&(i=u.body.start-s,n=u.body.end+s,e>=i&&e<=n&&(t=Math.min(e-i,n-e),a<=t&&(r=u.body,a=t)))})),r},t.isEndListAppended=function(e){var t=this.endListFragments[e];return void 0!==t&&(t.buffered||ui(t))},t.getState=function(e){var t=ci(e),i=this.fragments[t];return i?i.buffered?ui(i)?oi.PARTIAL:oi.OK:oi.APPENDING:oi.NOT_LOADED},t.isTimeBuffered=function(e,t,i){for(var n,r,a=0;a<i.length;a++){if(n=i.start(a)-this.bufferPadding,r=i.end(a)+this.bufferPadding,e>=n&&t<=r)return!0;if(t<=n)return!1}return!1},t.onFragLoaded=function(e,t){var i=t.frag,n=t.part;if("initSegment"!==i.sn&&!i.bitrateTest){var r=n?null:t,a=ci(i);this.fragments[a]={body:i,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}},t.onBufferAppended=function(e,t){var i=this,n=t.frag,r=t.part,a=t.timeRanges;if("initSegment"!==n.sn){var s=n.type;if(r){var o=this.activePartLists[s];o||(this.activePartLists[s]=o=[]),o.push(r)}this.timeRanges=a,Object.keys(a).forEach((function(e){var t=a[e];i.detectEvictedFragments(e,t,s,r)}))}},t.onFragBuffered=function(e,t){this.detectPartialFragments(t)},t.hasFragment=function(e){var t=ci(e);return!!this.fragments[t]},t.hasParts=function(e){var t;return!(null==(t=this.activePartLists[e])||!t.length)},t.removeFragmentsInRange=function(e,t,i,n,r){var a=this;n&&!this.hasGaps||Object.keys(this.fragments).forEach((function(s){var o=a.fragments[s];if(o){var l=o.body;l.type!==i||n&&!l.gap||l.start<t&&l.end>e&&(o.buffered||r)&&a.removeFragment(l)}}))},t.removeFragment=function(e){var t=ci(e);e.stats.loaded=0,e.clearElementaryStreamInfo();var i=this.activePartLists[e.type];if(i){var n=e.sn;this.activePartLists[e.type]=i.filter((function(e){return e.fragment.sn!==n}))}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]},t.removeAllFragments=function(){this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1},e}();function ui(e){var t,i,n;return e.buffered&&(e.body.gap||(null==(t=e.range.video)?void 0:t.partial)||(null==(i=e.range.audio)?void 0:i.partial)||(null==(n=e.range.audiovideo)?void 0:n.partial))}function ci(e){return e.type+"_"+e.level+"_"+e.urlId+"_"+e.sn}var hi=Math.pow(2,17),di=function(){function e(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}var t=e.prototype;return t.destroy=function(){this.loader&&(this.loader.destroy(),this.loader=null)},t.abort=function(){this.loader&&this.loader.abort()},t.load=function(e,t){var i=this,r=e.url;if(!r)return Promise.reject(new vi({type:S.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error("Fragment does not have a "+(r?"part list":"url")),networkDetails:null}));this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(l,u){if(i.loader&&i.loader.destroy(),e.gap)u(gi(e));else{var c=i.loader=e.loader=s?new s(a):new o(a),h=fi(e),d=Ht(a.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:"initSegment"===e.sn?1/0:hi};e.stats=c.stats,c.load(h,f,{onSuccess:function(t,n,r,a){i.resetLoader(e,c);var s=t.data;r.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(s.slice(0,16)),s=s.slice(16)),l({frag:e,part:null,payload:s,networkDetails:a})},onError:function(t,a,s,o){i.resetLoader(e,c),u(new vi({type:S.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:n({url:r,data:void 0},t),error:new Error("HTTP Error "+t.code+" "+t.text),networkDetails:s,stats:o}))},onAbort:function(t,n,r){i.resetLoader(e,c),u(new vi({type:S.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:r,stats:t}))},onTimeout:function(t,n,r){i.resetLoader(e,c),u(new vi({type:S.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error("Timeout after "+f.timeout+"ms"),networkDetails:r,stats:t}))},onProgress:function(i,n,r,a){t&&t({frag:e,part:null,payload:r,networkDetails:a})}})}}))},t.loadPart=function(e,t,i){var r=this;this.abort();var a=this.config,s=a.fLoader,o=a.loader;return new Promise((function(l,u){if(r.loader&&r.loader.destroy(),e.gap||t.gap)u(gi(e,t));else{var c=r.loader=e.loader=s?new s(a):new o(a),h=fi(e,t),d=Ht(a.fragLoadPolicy.default),f={loadPolicy:d,timeout:d.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:hi};t.stats=c.stats,c.load(h,f,{onSuccess:function(n,a,s,o){r.resetLoader(e,c),r.updateStatsFromPart(e,t);var u={frag:e,part:t,payload:n.data,networkDetails:o};i(u),l(u)},onError:function(i,a,s,o){r.resetLoader(e,c),u(new vi({type:S.NETWORK_ERROR,details:_.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:n({url:h.url,data:void 0},i),error:new Error("HTTP Error "+i.code+" "+i.text),networkDetails:s,stats:o}))},onAbort:function(i,n,a){e.stats.aborted=t.stats.aborted,r.resetLoader(e,c),u(new vi({type:S.NETWORK_ERROR,details:_.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:a,stats:i}))},onTimeout:function(i,n,a){r.resetLoader(e,c),u(new vi({type:S.NETWORK_ERROR,details:_.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error("Timeout after "+f.timeout+"ms"),networkDetails:a,stats:i}))}})}}))},t.updateStatsFromPart=function(e,t){var i=e.stats,n=t.stats,r=n.total;if(i.loaded+=n.loaded,r){var a=Math.round(e.duration/t.duration),s=Math.min(Math.round(i.loaded/r),a),o=a-s,l=o*Math.round(i.loaded/s);i.total=i.loaded+l}else i.total=Math.max(i.loaded,i.total);var u=i.loading,c=n.loading;u.start?u.first+=c.first-c.start:(u.start=c.start,u.first=c.first),u.end=c.end},t.resetLoader=function(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()},e}();function fi(e,t){void 0===t&&(t=null);var i=t||e,n={frag:e,part:t,responseType:"arraybuffer",url:i.url,headers:{},rangeStart:0,rangeEnd:0},r=i.byteRangeStartOffset,a=i.byteRangeEndOffset;if(T(r)&&T(a)){var s,o=r,l=a;if("initSegment"===e.sn&&"AES-128"===(null==(s=e.decryptdata)?void 0:s.method)){var u=a-r;u%16&&(l=a+(16-u%16)),0!==r&&(n.resetIV=!0,o=r-16)}n.rangeStart=o,n.rangeEnd=l}return n}function gi(e,t){var i=new Error("GAP "+(e.gap?"tag":"attribute")+" found"),n={type:S.MEDIA_ERROR,details:_.FRAG_GAP,fatal:!1,frag:e,error:i,networkDetails:null};return t&&(n.part=t),(t||e).stats.aborted=!0,new vi(n)}var vi=function(e){function t(t){var i;return i=e.call(this,t.error.message)||this,i.data=void 0,i.data=t,i}return l(t,e),t}(g(Error)),pi=function(){function e(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}var t=e.prototype;return t.abort=function(e){for(var t in this.keyUriToKeyInfo){var i=this.keyUriToKeyInfo[t].loader;if(i){if(e&&e!==i.context.frag.type)return;i.abort()}}},t.detach=function(){for(var e in this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}},t.destroy=function(){for(var e in this.detach(),this.keyUriToKeyInfo){var t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}},t.createKeyLoadError=function(e,t,i,n,r){return void 0===t&&(t=_.KEY_LOAD_ERROR),new vi({type:S.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:r,error:i,networkDetails:n})},t.loadClear=function(e,t){var i=this;if(this.emeController&&this.config.emeEnabled)for(var n=e.sn,r=e.cc,a=function(){var e=t[s];if(r<=e.cc&&("initSegment"===n||"initSegment"===e.sn||n<e.sn))return i.emeController.selectKeySystemFormat(e).then((function(t){e.setKeyFormat(t)})),"break"},s=0;s<t.length;s++){var o=a();if("break"===o)break}},t.load=function(e){var t=this;return!e.decryptdata&&e.encrypted&&this.emeController?this.emeController.selectKeySystemFormat(e).then((function(i){return t.loadInternal(e,i)})):this.loadInternal(e)},t.loadInternal=function(e,t){var i,n;t&&e.setKeyFormat(t);var r=e.decryptdata;if(!r){var a=new Error(t?"Expected frag.decryptdata to be defined after setting format "+t:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,_.KEY_LOAD_ERROR,a))}var s=r.uri;if(!s)return Promise.reject(this.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error('Invalid key URI: "'+s+'"')));var o,l=this.keyUriToKeyInfo[s];if(null!=(i=l)&&i.decryptdata.key)return r.key=l.decryptdata.key,Promise.resolve({frag:e,keyInfo:l});if(null!=(n=l)&&n.keyLoadPromise)switch(null==(o=l.mediaKeySessionContext)?void 0:o.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return l.keyLoadPromise.then((function(t){return r.key=t.keyInfo.decryptdata.key,{frag:e,keyInfo:l}}))}switch(l=this.keyUriToKeyInfo[s]={decryptdata:r,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},r.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return"identity"===r.keyFormat?this.loadKeyHTTP(l,e):this.loadKeyEME(l,e);case"AES-128":return this.loadKeyHTTP(l,e);default:return Promise.reject(this.createKeyLoadError(e,_.KEY_LOAD_ERROR,new Error('Key supplied with unsupported METHOD: "'+r.method+'"')))}},t.loadKeyEME=function(e,t){var i={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){var n=this.emeController.loadKey(i);if(n)return(e.keyLoadPromise=n.then((function(t){return e.mediaKeySessionContext=t,i}))).catch((function(t){throw e.keyLoadPromise=null,t}))}return Promise.resolve(i)},t.loadKeyHTTP=function(e,t){var i=this,r=this.config,a=r.loader,s=new a(r);return t.keyLoader=e.loader=s,e.keyLoadPromise=new Promise((function(a,o){var l={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},u=r.keyLoadPolicy.default,c={loadPolicy:u,timeout:u.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},h={onSuccess:function(e,t,n,r){var s=n.frag,l=n.keyInfo,u=n.url;if(!s.decryptdata||l!==i.keyUriToKeyInfo[u])return o(i.createKeyLoadError(s,_.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),r));l.decryptdata.key=s.decryptdata.key=new Uint8Array(e.data),s.keyLoader=null,l.loader=null,a({frag:s,keyInfo:l})},onError:function(e,r,a,s){i.resetLoader(r),o(i.createKeyLoadError(t,_.KEY_LOAD_ERROR,new Error("HTTP Error "+e.code+" loading key "+e.text),a,n({url:l.url,data:void 0},e)))},onTimeout:function(e,n,r){i.resetLoader(n),o(i.createKeyLoadError(t,_.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),r))},onAbort:function(e,n,r){i.resetLoader(n),o(i.createKeyLoadError(t,_.INTERNAL_ABORTED,new Error("key loading aborted"),r))}};s.load(l,c,h)}))},t.resetLoader=function(e){var t=e.frag,i=e.keyInfo,n=e.url,r=i.loader;t.keyLoader===r&&(t.keyLoader=null,i.loader=null),delete this.keyUriToKeyInfo[n],r&&r.destroy()},e}(),mi=function(){function e(){this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}var t=e.prototype;return t.destroy=function(){this.onHandlerDestroying(),this.onHandlerDestroyed()},t.onHandlerDestroying=function(){this.clearNextTick(),this.clearInterval()},t.onHandlerDestroyed=function(){},t.hasInterval=function(){return!!this._tickInterval},t.hasNextTick=function(){return!!this._tickTimer},t.setInterval=function(e){return!this._tickInterval&&(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)},t.clearInterval=function(){return!!this._tickInterval&&(self.clearInterval(this._tickInterval),this._tickInterval=null,!0)},t.clearNextTick=function(){return!!this._tickTimer&&(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0)},t.tick=function(){this._tickCallCount++,1===this._tickCallCount&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)},t.tickImmediate=function(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)},t.doTick=function(){},e}(),yi={length:0,start:function(){return 0},end:function(){return 0}},bi=function(){function e(){}return e.isBuffered=function(t,i){try{if(t)for(var n=e.getBuffered(t),r=0;r<n.length;r++)if(i>=n.start(r)&&i<=n.end(r))return!0}catch(a){}return!1},e.bufferInfo=function(t,i,n){try{if(t){var r,a=e.getBuffered(t),s=[];for(r=0;r<a.length;r++)s.push({start:a.start(r),end:a.end(r)});return this.bufferedInfo(s,i,n)}}catch(o){}return{len:0,start:i,end:i,nextStart:void 0}},e.bufferedInfo=function(e,t,i){t=Math.max(0,t),e.sort((function(e,t){var i=e.start-t.start;return i||t.end-e.end}));var n=[];if(i)for(var r=0;r<e.length;r++){var a=n.length;if(a){var s=n[a-1].end;e[r].start-s<i?e[r].end>s&&(n[a-1].end=e[r].end):n.push(e[r])}else n.push(e[r])}else n=e;for(var o,l=0,u=t,c=t,h=0;h<n.length;h++){var d=n[h].start,f=n[h].end;if(t+i>=d&&t<f)u=d,c=f,l=c-t;else if(t+i<d){o=d;break}}return{len:l,start:u||0,end:c||0,nextStart:o}},e.getBuffered=function(e){try{return e.buffered}catch(t){return x.log("failed to get media.buffered",t),yi}},e}(),Ei=function(e,t,i,n,r,a){void 0===n&&(n=0),void 0===r&&(r=-1),void 0===a&&(a=!1),this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=Ti(),this.buffering={audio:Ti(),video:Ti(),audiovideo:Ti()},this.level=e,this.sn=t,this.id=i,this.size=n,this.part=r,this.partial=a};function Ti(){return{start:0,executeStart:0,executeEnd:0,end:0}}function ki(e,t){for(var i=null,n=0,r=e.length;n<r;n++){var a=e[n];if(a&&a.cc===t){i=a;break}}return i}function Si(e,t,i){return!(!t.details||!(i.endCC>i.startCC||e&&e.cc<i.startCC))}function _i(e,t,i){var n=e.fragments,r=t.fragments;if(r.length&&n.length){var a=ki(n,r[0].cc);if(a&&(!a||a.startPTS))return a;x.log("No frag in previous level to align on")}else x.log("No fragments to align")}function Li(e,t){if(e){var i=e.start+t;e.start=e.startPTS=i,e.endPTS=i+e.duration}}function Ai(e,t){for(var i=t.fragments,n=0,r=i.length;n<r;n++)Li(i[n],e);t.fragmentHint&&Li(t.fragmentHint,e),t.alignedSliding=!0}function Ci(e,t,i){t&&(Oi(e,i,t),!i.alignedSliding&&t.details&&Ri(i,t.details),i.alignedSliding||!t.details||i.skippedSegments||Dt(t.details,i))}function Oi(e,t,i){if(Si(e,i,t)){var n=_i(i.details,t);n&&T(n.start)&&(x.log("Adjusting PTS using last level due to CC increase within current level "+t.url),Ai(n.start,t))}}function Ri(e,t){if(t.fragments.length&&e.hasProgramDateTime&&t.hasProgramDateTime){var i=t.fragments[0].programDateTime,n=e.fragments[0].programDateTime,r=(n-i)/1e3+t.fragments[0].start;r&&T(r)&&(x.log("Adjusting PTS using programDateTime delta "+(n-i)+"ms, sliding:"+r.toFixed(3)+" "+e.url+" "),Ai(r,e))}}var wi=function(){function e(e,t){this.subtle=void 0,this.aesIV=void 0,this.subtle=e,this.aesIV=t}var t=e.prototype;return t.decrypt=function(e,t){return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e)},e}(),xi=function(){function e(e,t){this.subtle=void 0,this.key=void 0,this.subtle=e,this.key=t}var t=e.prototype;return t.expandKey=function(){return this.subtle.importKey("raw",this.key,{name:"AES-CBC"},!1,["encrypt","decrypt"])},e}();function Ii(e){var t=e.byteLength,i=t&&new DataView(e.buffer).getUint8(t-1);return i?z(e,0,t-i):e}var Di=function(){function e(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}var t=e.prototype;return t.uint8ArrayToUint32Array_=function(e){for(var t=new DataView(e),i=new Uint32Array(4),n=0;n<4;n++)i[n]=t.getUint32(4*n);return i},t.initTable=function(){var e=this.sBox,t=this.invSBox,i=this.subMix,n=i[0],r=i[1],a=i[2],s=i[3],o=this.invSubMix,l=o[0],u=o[1],c=o[2],h=o[3],d=new Uint32Array(256),f=0,g=0,v=0;for(v=0;v<256;v++)d[v]=v<128?v<<1:v<<1^283;for(v=0;v<256;v++){var p=g^g<<1^g<<2^g<<3^g<<4;p=p>>>8^255&p^99,e[f]=p,t[p]=f;var m=d[f],y=d[m],b=d[y],E=257*d[p]^16843008*p;n[f]=E<<24|E>>>8,r[f]=E<<16|E>>>16,a[f]=E<<8|E>>>24,s[f]=E,E=16843009*b^65537*y^257*m^16843008*f,l[p]=E<<24|E>>>8,u[p]=E<<16|E>>>16,c[p]=E<<8|E>>>24,h[p]=E,f?(f=m^d[d[d[b^m]]],g^=d[d[g]]):f=g=1}},t.expandKey=function(e){var t=this.uint8ArrayToUint32Array_(e),i=!0,n=0;while(n<t.length&&i)i=t[n]===this.key[n],n++;if(!i){this.key=t;var r=this.keySize=t.length;if(4!==r&&6!==r&&8!==r)throw new Error("Invalid aes key size="+r);var a,s,o,l,u=this.ksRows=4*(r+6+1),c=this.keySchedule=new Uint32Array(u),h=this.invKeySchedule=new Uint32Array(u),d=this.sBox,f=this.rcon,g=this.invSubMix,v=g[0],p=g[1],m=g[2],y=g[3];for(a=0;a<u;a++)a<r?o=c[a]=t[a]:(l=o,a%r===0?(l=l<<8|l>>>24,l=d[l>>>24]<<24|d[l>>>16&255]<<16|d[l>>>8&255]<<8|d[255&l],l^=f[a/r|0]<<24):r>6&&a%r===4&&(l=d[l>>>24]<<24|d[l>>>16&255]<<16|d[l>>>8&255]<<8|d[255&l]),c[a]=o=(c[a-r]^l)>>>0);for(s=0;s<u;s++)a=u-s,l=3&s?c[a]:c[a-4],h[s]=s<4||a<=4?l:v[d[l>>>24]]^p[d[l>>>16&255]]^m[d[l>>>8&255]]^y[d[255&l]],h[s]=h[s]>>>0}},t.networkToHostOrderSwap=function(e){return e<<24|(65280&e)<<8|(16711680&e)>>8|e>>>24},t.decrypt=function(e,t,i){var n,r,a,s,o,l,u,c,h,d,f,g,v,p,m=this.keySize+6,y=this.invKeySchedule,b=this.invSBox,E=this.invSubMix,T=E[0],k=E[1],S=E[2],_=E[3],L=this.uint8ArrayToUint32Array_(i),A=L[0],C=L[1],O=L[2],R=L[3],w=new Int32Array(e),x=new Int32Array(w.length),I=this.networkToHostOrderSwap;while(t<w.length){for(h=I(w[t]),d=I(w[t+1]),f=I(w[t+2]),g=I(w[t+3]),o=h^y[0],l=g^y[1],u=f^y[2],c=d^y[3],v=4,p=1;p<m;p++)n=T[o>>>24]^k[l>>16&255]^S[u>>8&255]^_[255&c]^y[v],r=T[l>>>24]^k[u>>16&255]^S[c>>8&255]^_[255&o]^y[v+1],a=T[u>>>24]^k[c>>16&255]^S[o>>8&255]^_[255&l]^y[v+2],s=T[c>>>24]^k[o>>16&255]^S[l>>8&255]^_[255&u]^y[v+3],o=n,l=r,u=a,c=s,v+=4;n=b[o>>>24]<<24^b[l>>16&255]<<16^b[u>>8&255]<<8^b[255&c]^y[v],r=b[l>>>24]<<24^b[u>>16&255]<<16^b[c>>8&255]<<8^b[255&o]^y[v+1],a=b[u>>>24]<<24^b[c>>16&255]<<16^b[o>>8&255]<<8^b[255&l]^y[v+2],s=b[c>>>24]<<24^b[o>>16&255]<<16^b[l>>8&255]<<8^b[255&u]^y[v+3],x[t]=I(n^A),x[t+1]=I(s^C),x[t+2]=I(a^O),x[t+3]=I(r^R),A=h,C=d,O=f,R=g,t+=4}return x.buffer},e}(),Pi=16,Ni=function(){function e(e,t){var i=void 0===t?{}:t,n=i.removePKCS7Padding,r=void 0===n||n;if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.useSoftware=e.enableSoftwareAES,this.removePKCS7Padding=r,r)try{var a=self.crypto;a&&(this.subtle=a.subtle||a.webkitSubtle)}catch(s){}null===this.subtle&&(this.useSoftware=!0)}var t=e.prototype;return t.destroy=function(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null},t.isSync=function(){return this.useSoftware},t.flush=function(){var e=this.currentResult,t=this.remainderData;if(!e||t)return this.reset(),null;var i=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?Ii(i):i},t.reset=function(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)},t.decrypt=function(e,t,i){var n=this;return this.useSoftware?new Promise((function(r,a){n.softwareDecrypt(new Uint8Array(e),t,i);var s=n.flush();s?r(s.buffer):a(new Error("[softwareDecrypt] Failed to decrypt data"))})):this.webCryptoDecrypt(new Uint8Array(e),t,i)},t.softwareDecrypt=function(e,t,i){var n=this.currentIV,r=this.currentResult,a=this.remainderData;this.logOnce("JS AES decrypt"),a&&(e=we(a,e),this.remainderData=null);var s=this.getValidChunk(e);if(!s.length)return null;n&&(i=n);var o=this.softwareDecrypter;o||(o=this.softwareDecrypter=new Di),o.expandKey(t);var l=r;return this.currentResult=o.decrypt(s.buffer,0,i),this.currentIV=z(s,-16).buffer,l||null},t.webCryptoDecrypt=function(e,t,i){var n=this,r=this.subtle;return this.key===t&&this.fastAesKey||(this.key=t,this.fastAesKey=new xi(r,t)),this.fastAesKey.expandKey().then((function(t){if(!r)return Promise.reject(new Error("web crypto not initialized"));n.logOnce("WebCrypto AES decrypt");var a=new wi(r,new Uint8Array(i));return a.decrypt(e.buffer,t)})).catch((function(r){return x.warn("[decrypter]: WebCrypto Error, disable WebCrypto API, "+r.name+": "+r.message),n.onWebCryptoError(e,t,i)}))},t.onWebCryptoError=function(e,t,i){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,i);var n=this.flush();if(n)return n.buffer;throw new Error("WebCrypto and softwareDecrypt: failed to decrypt data")},t.getValidChunk=function(e){var t=e,i=e.length-e.length%Pi;return i!==e.length&&(t=z(e,0,i),this.remainderData=z(e,i)),t},t.logOnce=function(e){this.logEnabled&&(x.log("[decrypter]: "+e),this.logEnabled=!1)},e}(),Mi={toString:function(e){for(var t="",i=e.length,n=0;n<i;n++)t+="["+e.start(n).toFixed(3)+"-"+e.end(n).toFixed(3)+"]";return t}},Fi={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"},ji=function(e){function t(t,i,n,r,a){var s;return s=e.call(this)||this,s.hls=void 0,s.fragPrevious=null,s.fragCurrent=null,s.fragmentTracker=void 0,s.transmuxer=null,s._state=Fi.STOPPED,s.playlistType=void 0,s.media=null,s.mediaBuffer=null,s.config=void 0,s.bitrateTest=!1,s.lastCurrentTime=0,s.nextLoadPosition=0,s.startPosition=0,s.startTimeOffset=null,s.loadedmetadata=!1,s.retryDate=0,s.levels=null,s.fragmentLoader=void 0,s.keyLoader=void 0,s.levelLastLoaded=null,s.startFragRequested=!1,s.decrypter=void 0,s.initPTS=[],s.onvseeking=null,s.onvended=null,s.logPrefix="",s.log=void 0,s.warn=void 0,s.playlistType=a,s.logPrefix=r,s.log=x.log.bind(x,r+":"),s.warn=x.warn.bind(x,r+":"),s.hls=t,s.fragmentLoader=new di(t.config),s.keyLoader=n,s.fragmentTracker=i,s.config=t.config,s.decrypter=new Ni(t.config),t.on(k.MANIFEST_LOADED,s.onManifestLoaded,v(s)),s}l(t,e);var i=t.prototype;return i.doTick=function(){this.onTickEnd()},i.onTickEnd=function(){},i.startLoad=function(e){},i.stopLoad=function(){this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);var e=this.fragCurrent;null!=e&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Fi.STOPPED},i._streamEnded=function(e,t){if(t.live||e.nextStart||!e.end||!this.media)return!1;var i=t.partList;if(null!=i&&i.length){var n=i[i.length-1],r=bi.isBuffered(this.media,n.start+n.duration/2);return r}var a=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(a)},i.getLevelDetails=function(){var e;if(this.levels&&null!==this.levelLastLoaded)return null==(e=this.levels[this.levelLastLoaded])?void 0:e.details},i.onMediaAttached=function(e,t){var i=this.media=this.mediaBuffer=t.media;this.onvseeking=this.onMediaSeeking.bind(this),this.onvended=this.onMediaEnded.bind(this),i.addEventListener("seeking",this.onvseeking),i.addEventListener("ended",this.onvended);var n=this.config;this.levels&&n.autoStartLoad&&this.state===Fi.STOPPED&&this.startLoad(n.startPosition)},i.onMediaDetaching=function(){var e=this.media;null!=e&&e.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),e&&this.onvseeking&&this.onvended&&(e.removeEventListener("seeking",this.onvseeking),e.removeEventListener("ended",this.onvended),this.onvseeking=this.onvended=null),this.keyLoader&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loadedmetadata=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()},i.onMediaSeeking=function(){var e=this.config,t=this.fragCurrent,i=this.media,n=this.mediaBuffer,r=this.state,a=i?i.currentTime:0,s=bi.bufferInfo(n||i,a,e.maxBufferHole);if(this.log("media seeking to "+(T(a)?a.toFixed(3):a)+", state: "+r),this.state===Fi.ENDED)this.resetLoadingState();else if(t){var o=e.maxFragLookUpTolerance,l=t.start-o,u=t.start+t.duration+o;if(!s.len||u<s.start||l>s.end){var c=a>u;(a<l||c)&&(c&&t.loader&&(this.log("seeking outside of buffer while fragment load in progress, cancel fragment load"),t.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}i&&(this.fragmentTracker.removeFragmentsInRange(a,1/0,this.playlistType,!0),this.lastCurrentTime=a),this.loadedmetadata||s.len||(this.nextLoadPosition=this.startPosition=a),this.tickImmediate()},i.onMediaEnded=function(){this.startPosition=this.lastCurrentTime=0},i.onManifestLoaded=function(e,t){this.startTimeOffset=t.startTimeOffset,this.initPTS=[]},i.onHandlerDestroying=function(){this.stopLoad(),e.prototype.onHandlerDestroying.call(this)},i.onHandlerDestroyed=function(){this.state=Fi.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,e.prototype.onHandlerDestroyed.call(this)},i.loadFragment=function(e,t,i){this._loadFragForPlayback(e,t,i)},i._loadFragForPlayback=function(e,t,i){var n=this,r=function(t){if(n.fragContextChanged(e))return n.warn("Fragment "+e.sn+(t.part?" p: "+t.part.index:"")+" of level "+e.level+" was dropped during download."),void n.fragmentTracker.removeFragment(e);e.stats.chunkCount++,n._handleFragmentLoadProgress(t)};this._doFragLoad(e,t,i,r).then((function(t){if(t){var i=n.state;n.fragContextChanged(e)?(i===Fi.FRAG_LOADING||!n.fragCurrent&&i===Fi.PARSING)&&(n.fragmentTracker.removeFragment(e),n.state=Fi.IDLE):("payload"in t&&(n.log("Loaded fragment "+e.sn+" of level "+e.level),n.hls.trigger(k.FRAG_LOADED,t)),n._handleFragmentLoadComplete(t))}})).catch((function(t){n.state!==Fi.STOPPED&&n.state!==Fi.ERROR&&(n.warn(t),n.resetFragmentLoading(e))}))},i.clearTrackerIfNeeded=function(e){var t,i=this.fragmentTracker,n=i.getState(e);if(n===oi.APPENDING){var r=e.type,a=this.getFwdBufferInfo(this.mediaBuffer,r),s=Math.max(e.duration,a?a.len:this.config.maxBufferLength);this.reduceMaxBufferLength(s)&&i.removeFragment(e)}else 0===(null==(t=this.mediaBuffer)?void 0:t.buffered.length)?i.removeAllFragments():i.hasParts(e.type)&&(i.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),i.getState(e)===oi.PARTIAL&&i.removeFragment(e))},i.flushMainBuffer=function(e,t,i){if(void 0===i&&(i=null),e-t){var n={startOffset:e,endOffset:t,type:i};this.hls.trigger(k.BUFFER_FLUSHING,n)}},i._loadInitSegment=function(e,t){var i=this;this._doFragLoad(e,t).then((function(t){if(!t||i.fragContextChanged(e)||!i.levels)throw new Error("init load aborted");return t})).then((function(t){var n=i.hls,r=t.payload,a=e.decryptdata;if(r&&r.byteLength>0&&a&&a.key&&a.iv&&"AES-128"===a.method){var s=self.performance.now();return i.decrypter.decrypt(new Uint8Array(r),a.key.buffer,a.iv.buffer).catch((function(t){throw n.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_DECRYPT_ERROR,fatal:!1,error:t,reason:t.message,frag:e}),t})).then((function(i){var r=self.performance.now();return n.trigger(k.FRAG_DECRYPTED,{frag:e,payload:i,stats:{tstart:s,tdecrypt:r}}),t.payload=i,t}))}return t})).then((function(n){var r=i.fragCurrent,a=i.hls,s=i.levels;if(!s)throw new Error("init load aborted, missing levels");var o=e.stats;i.state=Fi.IDLE,t.fragmentError=0,e.data=new Uint8Array(n.payload),o.parsing.start=o.buffering.start=self.performance.now(),o.parsing.end=o.buffering.end=self.performance.now(),n.frag===r&&a.trigger(k.FRAG_BUFFERED,{stats:o,frag:r,part:null,id:e.type}),i.tick()})).catch((function(t){i.state!==Fi.STOPPED&&i.state!==Fi.ERROR&&(i.warn(t),i.resetFragmentLoading(e))}))},i.fragContextChanged=function(e){var t=this.fragCurrent;return!e||!t||e.level!==t.level||e.sn!==t.sn||e.urlId!==t.urlId},i.fragBufferedComplete=function(e,t){var i,n,r,a,s=this.mediaBuffer?this.mediaBuffer:this.media;this.log("Buffered "+e.type+" sn: "+e.sn+(t?" part: "+t.index:"")+" of "+(this.playlistType===at.MAIN?"level":"track")+" "+e.level+" (frag:["+(null!=(i=e.startPTS)?i:NaN).toFixed(3)+"-"+(null!=(n=e.endPTS)?n:NaN).toFixed(3)+"] > buffer:"+(s?Mi.toString(bi.getBuffered(s)):"(detached)")+")"),this.state=Fi.IDLE,s&&(!this.loadedmetadata&&e.type==at.MAIN&&s.buffered.length&&(null==(r=this.fragCurrent)?void 0:r.sn)===(null==(a=this.fragPrevious)?void 0:a.sn)&&(this.loadedmetadata=!0,this.seekToStartPos()),this.tick())},i.seekToStartPos=function(){},i._handleFragmentLoadComplete=function(e){var t=this.transmuxer;if(t){var i=e.frag,n=e.part,r=e.partsLoaded,a=!r||0===r.length||r.some((function(e){return!e})),s=new Ei(i.level,i.sn,i.stats.chunkCount+1,0,n?n.index:-1,!a);t.flush(s)}},i._handleFragmentLoadProgress=function(e){},i._doFragLoad=function(e,t,i,n){var r,a=this;void 0===i&&(i=null);var s=null==t?void 0:t.details;if(!this.levels||!s)throw new Error("frag load aborted, missing level"+(s?"":" detail")+"s");var o=null;if(!e.encrypted||null!=(r=e.decryptdata)&&r.key?!e.encrypted&&s.encryptedFragments.length&&this.keyLoader.loadClear(e,s.encryptedFragments):(this.log("Loading key for "+e.sn+" of ["+s.startSN+"-"+s.endSN+"], "+("[stream-controller]"===this.logPrefix?"level":"track")+" "+e.level),this.state=Fi.KEY_LOADING,this.fragCurrent=e,o=this.keyLoader.load(e).then((function(e){if(!a.fragContextChanged(e.frag))return a.hls.trigger(k.KEY_LOADED,e),a.state===Fi.KEY_LOADING&&(a.state=Fi.IDLE),e})),this.hls.trigger(k.KEY_LOADING,{frag:e}),null===this.fragCurrent&&(o=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))),i=Math.max(e.start,i||0),this.config.lowLatencyMode&&"initSegment"!==e.sn){var l=s.partList;if(l&&n){i>e.end&&s.fragmentHint&&(e=s.fragmentHint);var u=this.getNextPart(l,e,i);if(u>-1){var c,h=l[u];return this.log("Loading part sn: "+e.sn+" p: "+h.index+" cc: "+e.cc+" of playlist ["+s.startSN+"-"+s.endSN+"] parts [0-"+u+"-"+(l.length-1)+"] "+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),this.nextLoadPosition=h.start+h.duration,this.state=Fi.FRAG_LOADING,c=o?o.then((function(i){return!i||a.fragContextChanged(i.frag)?null:a.doFragPartsLoad(e,h,t,n)})).catch((function(e){return a.handleFragLoadError(e)})):this.doFragPartsLoad(e,h,t,n).catch((function(e){return a.handleFragLoadError(e)})),this.hls.trigger(k.FRAG_LOADING,{frag:e,part:h,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):c}if(!e.url||this.loadedEndOfParts(l,i))return Promise.resolve(null)}}this.log("Loading fragment "+e.sn+" cc: "+e.cc+" "+(s?"of ["+s.startSN+"-"+s.endSN+"] ":"")+("[stream-controller]"===this.logPrefix?"level":"track")+": "+e.level+", target: "+parseFloat(i.toFixed(3))),T(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Fi.FRAG_LOADING;var d,f=this.config.progressive;return d=f&&o?o.then((function(t){return!t||a.fragContextChanged(null==t?void 0:t.frag)?null:a.fragmentLoader.load(e,n)})).catch((function(e){return a.handleFragLoadError(e)})):Promise.all([this.fragmentLoader.load(e,f?n:void 0),o]).then((function(e){var t=e[0];return!f&&t&&n&&n(t),t})).catch((function(e){return a.handleFragLoadError(e)})),this.hls.trigger(k.FRAG_LOADING,{frag:e,targetBufferTime:i}),null===this.fragCurrent?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):d},i.doFragPartsLoad=function(e,t,i,n){var r=this;return new Promise((function(a,s){var o,l=[],u=null==(o=i.details)?void 0:o.partList,c=function t(o){r.fragmentLoader.loadPart(e,o,n).then((function(n){l[o.index]=n;var s=n.part;r.hls.trigger(k.FRAG_LOADED,n);var c=Ft(i,e.sn,o.index+1)||jt(u,e.sn,o.index+1);if(!c)return a({frag:e,part:s,partsLoaded:l});t(c)})).catch(s)};c(t)}))},i.handleFragLoadError=function(e){if("data"in e){var t=e.data;e.data&&t.details===_.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(k.ERROR,t)}else this.hls.trigger(k.ERROR,{type:S.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null},i._handleTransmuxerFlush=function(e){var t=this.getCurrentContext(e);if(t&&this.state===Fi.PARSING){var i=t.frag,n=t.part,r=t.level,a=self.performance.now();i.stats.parsing.end=a,n&&(n.stats.parsing.end=a),this.updateLevelTiming(i,n,r,e.partial)}else this.fragCurrent||this.state===Fi.STOPPED||this.state===Fi.ERROR||(this.state=Fi.IDLE)},i.getCurrentContext=function(e){var t=this.levels,i=this.fragCurrent,n=e.level,r=e.sn,a=e.part;if(null==t||!t[n])return this.warn("Levels object was unset while buffering fragment "+r+" of level "+n+". The current chunk will not be buffered."),null;var s=t[n],o=a>-1?Ft(s,r,a):null,l=o?o.fragment:Mt(s,r,i);return l?(i&&i!==l&&(l.stats=i.stats),{frag:l,part:o,level:s}):null},i.bufferFragmentData=function(e,t,i,n){var r;if(e&&this.state===Fi.PARSING){var a=e.data1,s=e.data2,o=a;if(a&&s&&(o=we(a,s)),null!=(r=o)&&r.length){var l={type:e.type,frag:t,part:i,chunkMeta:n,parent:t.type,data:o};this.hls.trigger(k.BUFFER_APPENDING,l),e.dropped&&e.independent&&!i&&this.flushBufferGap(t)}}},i.flushBufferGap=function(e){var t=this.media;if(t)if(bi.isBuffered(t,t.currentTime)){var i=t.currentTime,n=bi.bufferInfo(t,i,0),r=e.duration,a=Math.min(2*this.config.maxFragLookUpTolerance,.25*r),s=Math.max(Math.min(e.start-a,n.end-a),i+a);e.start-s>a&&this.flushMainBuffer(s,e.start)}else this.flushMainBuffer(0,e.start)},i.getFwdBufferInfo=function(e,t){var i=this.getLoadPosition();return T(i)?this.getFwdBufferInfoAtPos(e,i,t):null},i.getFwdBufferInfoAtPos=function(e,t,i){var n=this.config.maxBufferHole,r=bi.bufferInfo(e,t,n);if(0===r.len&&void 0!==r.nextStart){var a=this.fragmentTracker.getBufferedFrag(t,i);if(a&&r.nextStart<a.end)return bi.bufferInfo(e,t,Math.max(r.nextStart,n))}return r},i.getMaxBufferLength=function(e){var t,i=this.config;return t=e?Math.max(8*i.maxBufferSize/e,i.maxBufferLength):i.maxBufferLength,Math.min(t,i.maxMaxBufferLength)},i.reduceMaxBufferLength=function(e){var t=this.config,i=e||t.maxBufferLength;return t.maxMaxBufferLength>=i&&(t.maxMaxBufferLength/=2,this.warn("Reduce max buffer length to "+t.maxMaxBufferLength+"s"),!0)},i.getAppendedFrag=function(e,t){var i=this.fragmentTracker.getAppendedFrag(e,at.MAIN);return i&&"fragment"in i?i.fragment:i},i.getNextFragment=function(e,t){var i=t.fragments,n=i.length;if(!n)return null;var r,a=this.config,s=i[0].start;if(t.live){var o=a.initialLiveManifestSize;if(n<o)return this.warn("Not enough fragments to start playback (have: "+n+", need: "+o+")"),null;t.PTSKnown||this.startFragRequested||-1!==this.startPosition||(r=this.getInitialLiveFragment(t,i),this.startPosition=r?this.hls.liveSyncPosition||r.start:e)}else e<=s&&(r=i[0]);if(!r){var l=a.lowLatencyMode?t.partEnd:t.fragmentEnd;r=this.getFragmentAtPosition(e,l,t)}return this.mapToInitFragWhenRequired(r)},i.isLoopLoading=function(e,t){var i=this.fragmentTracker.getState(e);return(i===oi.OK||i===oi.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t},i.getNextFragmentLoopLoading=function(e,t,i,n,r){var a=e.gap,s=this.getNextFragment(this.nextLoadPosition,t);if(null===s)return s;if(e=s,a&&e&&!e.gap&&i.nextStart){var o=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,i.nextStart,n);if(null!==o&&i.len+o.len>=r)return this.log('buffer full after gaps in "'+n+'" playlist starting at sn: '+e.sn),null}return e},i.mapToInitFragWhenRequired=function(e){return null==e||!e.initSegment||null!=e&&e.initSegment.data||this.bitrateTest?e:e.initSegment},i.getNextPart=function(e,t,i){for(var n=-1,r=!1,a=!0,s=0,o=e.length;s<o;s++){var l=e[s];if(a=a&&!l.independent,n>-1&&i<l.start)break;var u=l.loaded;u?n=-1:(r||l.independent||a)&&l.fragment===t&&(n=s),r=u}return n},i.loadedEndOfParts=function(e,t){var i=e[e.length-1];return i&&t>i.start&&i.loaded},i.getInitialLiveFragment=function(e,t){var i=this.fragPrevious,n=null;if(i){if(e.hasProgramDateTime&&(this.log("Live playlist, switching playlist, load frag with same PDT: "+i.programDateTime),n=Yt(t,i.endProgramDateTime,this.config.maxFragLookUpTolerance)),!n){var r=i.sn+1;if(r>=e.startSN&&r<=e.endSN){var a=t[r-e.startSN];i.cc===a.cc&&(n=a,this.log("Live playlist, switching playlist, load frag with next SN: "+n.sn))}n||(n=Zt(t,i.cc),n&&this.log("Live playlist, switching playlist, load frag with same CC: "+n.sn))}}else{var s=this.hls.liveSyncPosition;null!==s&&(n=this.getFragmentAtPosition(s,this.bitrateTest?e.fragmentEnd:e.edge,e))}return n},i.getFragmentAtPosition=function(e,t,i){var n,r=this.config,a=this.fragPrevious,s=i.fragments,o=i.endSN,l=i.fragmentHint,u=r.maxFragLookUpTolerance,c=i.partList,h=!!(r.lowLatencyMode&&null!=c&&c.length&&l);if(h&&l&&!this.bitrateTest&&(s=s.concat(l),o=l.sn),e<t){var d=e>t-u?0:u;n=zt(a,s,e,d)}else n=s[s.length-1];if(n){var f=n.sn-i.startSN,g=this.fragmentTracker.getState(n);if((g===oi.OK||g===oi.PARTIAL&&n.gap)&&(a=n),a&&n.sn===a.sn&&(!h||c[0].fragment.sn>n.sn)){var v=a&&n.level===a.level;if(v){var p=s[f+1];n=n.sn<o&&this.fragmentTracker.getState(p)!==oi.OK?p:null}}}return n},i.synchronizeToLiveEdge=function(e){var t=this.config,i=this.media;if(i){var n=this.hls.liveSyncPosition,r=i.currentTime,a=e.fragments[0].start,s=e.edge,o=r>=a-t.maxFragLookUpTolerance&&r<=s;if(null!==n&&i.duration>n&&(r<n||!o)){var l=void 0!==t.liveMaxLatencyDuration?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;(!o&&i.readyState<4||r<s-l)&&(this.loadedmetadata||(this.nextLoadPosition=n),i.readyState&&(this.warn("Playback: "+r.toFixed(3)+" is located too far from the end of live sliding playlist: "+s+", reset currentTime to : "+n.toFixed(3)),i.currentTime=n))}}},i.alignPlaylists=function(e,t){var i=this.levels,n=this.levelLastLoaded,r=this.fragPrevious,a=null!==n?i[n]:null,s=e.fragments.length;if(!s)return this.warn("No fragments in live playlist"),0;var o=e.fragments[0].start,l=!t,u=e.alignedSliding&&T(o);if(l||!u&&!o){Ci(r,a,e);var c=e.fragments[0].start;return this.log("Live playlist sliding: "+c.toFixed(2)+" start-sn: "+(t?t.startSN:"na")+"->"+e.startSN+" prev-sn: "+(r?r.sn:"na")+" fragments: "+s),c}return o},i.waitForCdnTuneIn=function(e){var t=3;return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*t)},i.setStartPosition=function(e,t){var i=this.startPosition;if(i<t&&(i=-1),-1===i||-1===this.lastCurrentTime){var n=null!==this.startTimeOffset,r=n?this.startTimeOffset:e.startTimeOffset;null!==r&&T(r)?(i=t+r,r<0&&(i+=e.totalduration),i=Math.min(Math.max(t,i),t+e.totalduration),this.log("Start time offset "+r+" found in "+(n?"multivariant":"media")+" playlist, adjust startPosition to "+i),this.startPosition=i):e.live?i=this.hls.liveSyncPosition||t:this.startPosition=i=0,this.lastCurrentTime=i}this.nextLoadPosition=i},i.getLoadPosition=function(){var e=this.media,t=0;return this.loadedmetadata&&e?t=e.currentTime:this.nextLoadPosition&&(t=this.nextLoadPosition),t},i.handleFragLoadAborted=function(e,t){this.transmuxer&&"initSegment"!==e.sn&&e.stats.aborted&&(this.warn("Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" was aborted"),this.resetFragmentLoading(e))},i.resetFragmentLoading=function(e){this.fragCurrent&&(this.fragContextChanged(e)||this.state===Fi.FRAG_LOADING_WAITING_RETRY)||(this.state=Fi.IDLE)},i.onFragmentOrKeyLoadError=function(e,t){if(t.chunkMeta&&!t.frag){var i=this.getCurrentContext(t.chunkMeta);i&&(t.frag=i.frag)}var n=t.frag;if(n&&n.type===e&&this.levels)if(this.fragContextChanged(n)){var r;this.warn("Frag load error must match current frag to retry "+n.url+" > "+(null==(r=this.fragCurrent)?void 0:r.url))}else{var a=t.details===_.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);var s=t.errorAction,o=s||{},l=o.action,u=o.retryCount,c=void 0===u?0:u,h=o.retryConfig;if(s&&l===Jt.RetryRequest&&h){this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition);var d=Gt(h,c);this.warn("Fragment "+n.sn+" of "+e+" "+n.level+" errored with "+t.details+", retrying loading "+(c+1)+"/"+h.maxNumRetry+" in "+d+"ms"),s.resolved=!0,this.retryDate=self.performance.now()+d,this.state=Fi.FRAG_LOADING_WAITING_RETRY}else h&&s?(this.resetFragmentErrors(e),c<h.maxNumRetry?a||(s.resolved=!0):x.warn(t.details+" reached or exceeded max retry ("+c+")")):(null==s?void 0:s.action)===Jt.SendAlternateToPenaltyBox?this.state=Fi.WAITING_LEVEL:this.state=Fi.ERROR;this.tickImmediate()}},i.reduceLengthAndFlushBuffer=function(e){if(this.state===Fi.PARSING||this.state===Fi.PARSED){var t=e.parent,i=this.getFwdBufferInfo(this.mediaBuffer,t),n=i&&i.len>.5;n&&this.reduceMaxBufferLength(i.len);var r=!n;return r&&this.warn("Buffer full error while media.currentTime is not buffered, flush "+t+" buffer"),e.frag&&(this.fragmentTracker.removeFragment(e.frag),this.nextLoadPosition=e.frag.start),this.resetLoadingState(),r}return!1},i.resetFragmentErrors=function(e){e===at.AUDIO&&(this.fragCurrent=null),this.loadedmetadata||(this.startFragRequested=!1),this.state!==Fi.STOPPED&&(this.state=Fi.IDLE)},i.afterBufferFlushed=function(e,t,i){if(e){var n=bi.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,n,i),this.state===Fi.ENDED&&this.resetLoadingState()}},i.resetLoadingState=function(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state=Fi.IDLE},i.resetStartWhenNotLoaded=function(e){if(!this.loadedmetadata){this.startFragRequested=!1;var t=this.levels?this.levels[e].details:null;null!=t&&t.live?(this.startPosition=-1,this.setStartPosition(t,0),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}},i.resetWhenMissingContext=function(e){this.warn("The loading context changed while buffering fragment "+e.sn+" of level "+e.level+". This chunk will not be buffered."),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(e.level),this.resetLoadingState()},i.removeUnbufferedFrags=function(e){void 0===e&&(e=0),this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)},i.updateLevelTiming=function(e,t,i,n){var r,a=this,s=i.details;if(s){var o=Object.keys(e.elementaryStreams).reduce((function(t,r){var o=e.elementaryStreams[r];if(o){var l=o.endPTS-o.startPTS;if(l<=0)return a.warn("Could not parse fragment "+e.sn+" "+r+" duration reliably ("+l+")"),t||!1;var u=n?0:Ot(s,e,o.startPTS,o.endPTS,o.startDTS,o.endDTS);return a.hls.trigger(k.LEVEL_PTS_UPDATED,{details:s,level:i,drift:u,type:r,frag:e,start:o.startPTS,end:o.endPTS}),!0}return t}),!1);if(o)i.fragmentError=0;else if(null===(null==(r=this.transmuxer)?void 0:r.error)){var l=new Error("Found no media in fragment "+e.sn+" of level "+i.id+" resetting transmuxer to fallback to playlist timing");if(this.warn(l.message),this.hls.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:l,frag:e,reason:"Found no media in msn "+e.sn+' of level "'+i.url+'"'}),!this.hls)return;this.resetTransmuxer()}this.state=Fi.PARSED,this.hls.trigger(k.FRAG_PARSED,{frag:e,part:t})}else this.warn("level.details undefined")},i.resetTransmuxer=function(){this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null)},i.recoverWorkerError=function(e){"demuxerWorker"===e.event&&(this.resetTransmuxer(),this.resetLoadingState())},a(t,[{key:"state",get:function(){return this._state},set:function(e){var t=this._state;t!==e&&(this._state=e,this.log(t+"->"+e))}}]),t}(mi);function Ui(){return self.SourceBuffer||self.WebKitSourceBuffer}function Bi(){var e=Ue();if(!e)return!1;var t=Ui(),i=e&&"function"===typeof e.isTypeSupported&&e.isTypeSupported('video/mp4; codecs="avc1.42E01E,mp4a.40.2"'),n=!t||t.prototype&&"function"===typeof t.prototype.appendBuffer&&"function"===typeof t.prototype.remove;return!!i&&!!n}function Gi(){var e,t=Ui();return"function"===typeof(null==t||null==(e=t.prototype)?void 0:e.changeType)}function Hi(e,t){return void 0===e&&(e=""),void 0===t&&(t=9e4),{type:e,id:-1,pid:-1,inputTimeScale:t,sequenceNumber:-1,samples:[],dropped:0}}var Vi=function(){function e(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}var t=e.prototype;return t.resetInitSegment=function(e,t,i,n){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}},t.resetTimeStamp=function(e){this.initPTS=e,this.resetContiguity()},t.resetContiguity=function(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0},t.canParse=function(e,t){return!1},t.appendFrame=function(e,t,i){},t.demux=function(e,t){this.cachedData&&(e=we(this.cachedData,e),this.cachedData=null);var i,n=Q(e,0),r=n?n.length:0,a=this._audioTrack,s=this._id3Track,o=n?ee(n):void 0,l=e.length;(null===this.basePTS||0===this.frameIndex&&T(o))&&(this.basePTS=Ki(o,t,this.initPTS),this.lastPTS=this.basePTS),null===this.lastPTS&&(this.lastPTS=this.basePTS),n&&n.length>0&&s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:gt.audioId3,duration:Number.POSITIVE_INFINITY});while(r<l){if(this.canParse(e,r)){var u=this.appendFrame(a,e,r);u?(this.frameIndex++,this.lastPTS=u.sample.pts,r+=u.length,i=r):r=l}else $(e,r)?(n=Q(e,r),s.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:gt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,i=r):r++;if(r===l&&i!==l){var c=z(e,i);this.cachedData?this.cachedData=we(this.cachedData,c):this.cachedData=c}}return{audioTrack:a,videoTrack:Hi(),id3Track:s,textTrack:Hi()}},t.demuxSampleAes=function(e,t,i){return Promise.reject(new Error("["+this+"] This demuxer does not support Sample-AES decryption"))},t.flush=function(e){var t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Hi(),id3Track:this._id3Track,textTrack:Hi()}},t.destroy=function(){},e}(),Ki=function(e,t,i){if(T(e))return 90*e;var n=i?9e4*i.baseTime/i.timescale:0;return 9e4*t+n};function Wi(e,t,i,n){var r,a,s,o,l=navigator.userAgent.toLowerCase(),u=n,c=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350];r=1+((192&t[i+2])>>>6);var h=(60&t[i+2])>>>2;if(!(h>c.length-1))return s=(1&t[i+2])<<2,s|=(192&t[i+3])>>>6,x.log("manifest codec:"+n+", ADTS type:"+r+", samplingIndex:"+h),/firefox/i.test(l)?h>=6?(r=5,o=new Array(4),a=h-3):(r=2,o=new Array(2),a=h):-1!==l.indexOf("android")?(r=2,o=new Array(2),a=h):(r=5,o=new Array(4),n&&(-1!==n.indexOf("mp4a.40.29")||-1!==n.indexOf("mp4a.40.5"))||!n&&h>=6?a=h-3:((n&&-1!==n.indexOf("mp4a.40.2")&&(h>=6&&1===s||/vivaldi/i.test(l))||!n&&1===s)&&(r=2,o=new Array(2)),a=h)),o[0]=r<<3,o[0]|=(14&h)>>1,o[1]|=(1&h)<<7,o[1]|=s<<3,5===r&&(o[1]|=(14&a)>>1,o[2]=(1&a)<<7,o[2]|=8,o[3]=0),{config:o,samplerate:c[h],channelCount:s,codec:"mp4a.40."+r,manifestCodec:u};e.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!0,reason:"invalid ADTS sampling index:"+h})}function Yi(e,t){return 255===e[t]&&240===(246&e[t+1])}function zi(e,t){return 1&e[t+1]?7:9}function Xi(e,t){return(3&e[t+3])<<11|e[t+4]<<3|(224&e[t+5])>>>5}function qi(e,t){return t+5<e.length}function Zi(e,t){return t+1<e.length&&Yi(e,t)}function Qi(e,t){return qi(e,t)&&Yi(e,t)&&Xi(e,t)<=e.length-t}function Ji(e,t){if(Zi(e,t)){var i=zi(e,t);if(t+i>=e.length)return!1;var n=Xi(e,t);if(n<=i)return!1;var r=t+n;return r===e.length||Zi(e,r)}return!1}function $i(e,t,i,n,r){if(!e.samplerate){var a=Wi(t,i,n,r);if(!a)return;e.config=a.config,e.samplerate=a.samplerate,e.channelCount=a.channelCount,e.codec=a.codec,e.manifestCodec=a.manifestCodec,x.log("parsed codec:"+e.codec+", rate:"+a.samplerate+", channels:"+a.channelCount)}}function en(e){return 9216e4/e}function tn(e,t){var i=zi(e,t);if(t+i<=e.length){var n=Xi(e,t)-i;if(n>0)return{headerLength:i,frameLength:n}}}function nn(e,t,i,n,r){var a,s=en(e.samplerate),o=n+r*s,l=tn(t,i);if(l){var u=l.frameLength,c=l.headerLength,h=c+u,d=Math.max(0,i+h-t.length);d?(a=new Uint8Array(h-c),a.set(t.subarray(i+c,t.length),0)):a=t.subarray(i+c,i+h);var f={unit:a,pts:o};return d||e.samples.push(f),{sample:f,length:h,missing:d}}var g=t.length-i;a=new Uint8Array(g),a.set(t.subarray(i,t.length),0);var v={unit:a,pts:o};return{sample:v,length:g,missing:-1}}var rn=function(e){function t(t,i){var n;return n=e.call(this)||this,n.observer=void 0,n.config=void 0,n.observer=t,n.config=i,n}l(t,e);var i=t.prototype;return i.resetInitSegment=function(t,i,n,r){e.prototype.resetInitSegment.call(this,t,i,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:i,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=Q(e,0)||[],i=t.length,n=e.length;i<n;i++)if(Ji(e,i))return x.log("ADTS sync word found !"),!0;return!1},i.canParse=function(e,t){return Qi(e,t)},i.appendFrame=function(e,t,i){$i(e,this.observer,t,i,e.manifestCodec);var n=nn(e,t,i,this.basePTS,this.frameIndex);if(n&&0===n.missing)return n},t}(Vi),an=/\/emsg[-/]ID3/i,sn=function(){function e(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}var t=e.prototype;return t.resetTimeStamp=function(){},t.resetInitSegment=function(e,t,i,n){var r=this.videoTrack=Hi("video",1),a=this.audioTrack=Hi("audio",1),s=this.txtTrack=Hi("text",1);if(this.id3Track=Hi("id3",1),this.timeOffset=0,null!=e&&e.byteLength){var o=ke(e);if(o.video){var l=o.video,u=l.id,c=l.timescale,h=l.codec;r.id=u,r.timescale=s.timescale=c,r.codec=h}if(o.audio){var d=o.audio,f=d.id,g=d.timescale,v=d.codec;a.id=f,a.timescale=g,a.codec=v}s.id=ge.text,r.sampleDuration=0,r.duration=a.duration=n}},t.resetContiguity=function(){this.remainderData=null},e.probe=function(e){return e=e.length>16384?e.subarray(0,16384):e,Ee(e,["moof"]).length>0},t.demux=function(e,t){this.timeOffset=t;var i=e,n=this.videoTrack,r=this.txtTrack;if(this.config.progressive){this.remainderData&&(i=we(this.remainderData,e));var a=Re(i);this.remainderData=a.remainder,n.samples=a.valid||new Uint8Array}else n.samples=i;var s=this.extractID3Track(n,t);return r.samples=xe(t,n),{videoTrack:n,audioTrack:this.audioTrack,id3Track:s,textTrack:this.txtTrack}},t.flush=function(){var e=this.timeOffset,t=this.videoTrack,i=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;var n=this.extractID3Track(t,this.timeOffset);return i.samples=xe(e,t),{videoTrack:t,audioTrack:Hi(),id3Track:n,textTrack:Hi()}},t.extractID3Track=function(e,t){var i=this.id3Track;if(e.samples.length){var n=Ee(e.samples,["emsg"]);n&&n.forEach((function(e){var n=Me(e);if(an.test(n.schemeIdUri)){var r=T(n.presentationTime)?n.presentationTime/n.timeScale:t+n.presentationTimeDelta/n.timeScale,a=4294967295===n.eventDuration?Number.POSITIVE_INFINITY:n.eventDuration/n.timeScale;a<=.001&&(a=Number.POSITIVE_INFINITY);var s=n.payload;i.samples.push({data:s,len:s.byteLength,dts:r,pts:r,type:gt.emsg,duration:a})}}))}return i},t.demuxSampleAes=function(e,t,i){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))},t.destroy=function(){},e}(),on=null,ln=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],un=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],cn=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],hn=[0,1,1,4];function dn(e,t,i,n,r){if(!(i+24>t.length)){var a=fn(t,i);if(a&&i+a.frameLength<=t.length){var s=9e4*a.samplesPerFrame/a.sampleRate,o=n+r*s,l={unit:t.subarray(i,i+a.frameLength),pts:o,dts:o};return e.config=[],e.channelCount=a.channelCount,e.samplerate=a.sampleRate,e.samples.push(l),{sample:l,length:a.frameLength,missing:0}}}}function fn(e,t){var i=e[t+1]>>3&3,n=e[t+1]>>1&3,r=e[t+2]>>4&15,a=e[t+2]>>2&3;if(1!==i&&0!==r&&15!==r&&3!==a){var s=e[t+2]>>1&1,o=e[t+3]>>6,l=3===i?3-n:3===n?3:4,u=1e3*ln[14*l+r-1],c=3===i?0:2===i?1:2,h=un[3*c+a],d=3===o?1:2,f=cn[i][n],g=hn[n],v=8*f*g,p=Math.floor(f*u/h+s)*g;if(null===on){var m=navigator.userAgent||"",y=m.match(/Chrome\/(\d+)/i);on=y?parseInt(y[1]):0}var b=!!on&&on<=87;return b&&2===n&&u>=224e3&&0===o&&(e[t+3]=128|e[t+3]),{sampleRate:h,channelCount:d,frameLength:p,samplesPerFrame:v}}}function gn(e,t){return 255===e[t]&&224===(224&e[t+1])&&0!==(6&e[t+1])}function vn(e,t){return t+1<e.length&&gn(e,t)}function pn(e,t){var i=4;return gn(e,t)&&i<=e.length-t}function mn(e,t){if(t+1<e.length&&gn(e,t)){var i=4,n=fn(e,t),r=i;null!=n&&n.frameLength&&(r=n.frameLength);var a=t+r;return a===e.length||vn(e,a)}return!1}var yn=function(){function e(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}var t=e.prototype;return t.loadWord=function(){var e=this.data,t=this.bytesAvailable,i=e.byteLength-t,n=new Uint8Array(4),r=Math.min(4,t);if(0===r)throw new Error("no bytes available");n.set(e.subarray(i,i+r)),this.word=new DataView(n.buffer).getUint32(0),this.bitsAvailable=8*r,this.bytesAvailable-=r},t.skipBits=function(e){var t;e=Math.min(e,8*this.bytesAvailable+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)},t.readBits=function(e){var t=Math.min(this.bitsAvailable,e),i=this.word>>>32-t;if(e>32&&x.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else{if(!(this.bytesAvailable>0))throw new Error("no bits available");this.loadWord()}return t=e-t,t>0&&this.bitsAvailable?i<<t|this.readBits(t):i},t.skipLZ=function(){var e;for(e=0;e<this.bitsAvailable;++e)if(0!==(this.word&2147483648>>>e))return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()},t.skipUEG=function(){this.skipBits(1+this.skipLZ())},t.skipEG=function(){this.skipBits(1+this.skipLZ())},t.readUEG=function(){var e=this.skipLZ();return this.readBits(e+1)-1},t.readEG=function(){var e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)},t.readBoolean=function(){return 1===this.readBits(1)},t.readUByte=function(){return this.readBits(8)},t.readUShort=function(){return this.readBits(16)},t.readUInt=function(){return this.readBits(32)},t.skipScalingList=function(e){for(var t,i=8,n=8,r=0;r<e;r++)0!==n&&(t=this.readEG(),n=(i+t+256)%256),i=0===n?i:n},t.readSPS=function(){var e,t,i,n=0,r=0,a=0,s=0,o=this.readUByte.bind(this),l=this.readBits.bind(this),u=this.readUEG.bind(this),c=this.readBoolean.bind(this),h=this.skipBits.bind(this),d=this.skipEG.bind(this),f=this.skipUEG.bind(this),g=this.skipScalingList.bind(this);o();var v=o();if(l(5),h(3),o(),f(),100===v||110===v||122===v||244===v||44===v||83===v||86===v||118===v||128===v){var p=u();if(3===p&&h(1),f(),f(),h(1),c())for(t=3!==p?8:12,i=0;i<t;i++)c()&&g(i<6?16:64)}f();var m=u();if(0===m)u();else if(1===m)for(h(1),d(),d(),e=u(),i=0;i<e;i++)d();f(),h(1);var y=u(),b=u(),E=l(1);0===E&&h(1),h(1),c()&&(n=u(),r=u(),a=u(),s=u());var T=[1,1];if(c()&&c()){var k=o();switch(k){case 1:T=[1,1];break;case 2:T=[12,11];break;case 3:T=[10,11];break;case 4:T=[16,11];break;case 5:T=[40,33];break;case 6:T=[24,11];break;case 7:T=[20,11];break;case 8:T=[32,11];break;case 9:T=[80,33];break;case 10:T=[18,11];break;case 11:T=[15,11];break;case 12:T=[64,33];break;case 13:T=[160,99];break;case 14:T=[4,3];break;case 15:T=[3,2];break;case 16:T=[2,1];break;case 255:T=[o()<<8|o(),o()<<8|o()];break}}return{width:Math.ceil(16*(y+1)-2*n-2*r),height:(2-E)*(b+1)*16-(E?2:4)*(a+s),pixelRatio:T}},t.readSliceType=function(){return this.readUByte(),this.readUEG(),this.readUEG()},e}(),bn=function(){function e(e,t,i){this.keyData=void 0,this.decrypter=void 0,this.keyData=i,this.decrypter=new Ni(t,{removePKCS7Padding:!1})}var t=e.prototype;return t.decryptBuffer=function(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer)},t.decryptAacSample=function(e,t,i){var n=this,r=e[t].unit;if(!(r.length<=16)){var a=r.subarray(16,r.length-r.length%16),s=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(s).then((function(a){var s=new Uint8Array(a);r.set(s,16),n.decrypter.isSync()||n.decryptAacSamples(e,t+1,i)}))}},t.decryptAacSamples=function(e,t,i){for(;;t++){if(t>=e.length)return void i();if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,i),!this.decrypter.isSync()))return}},t.getAvcEncryptedData=function(e){for(var t=16*Math.floor((e.length-48)/160)+16,i=new Int8Array(t),n=0,r=32;r<e.length-16;r+=160,n+=16)i.set(e.subarray(r,r+16),n);return i},t.getAvcDecryptedUnit=function(e,t){for(var i=new Uint8Array(t),n=0,r=32;r<e.length-16;r+=160,n+=16)e.set(i.subarray(n,n+16),r);return e},t.decryptAvcSample=function(e,t,i,n,r){var a=this,s=Ne(r.data),o=this.getAvcEncryptedData(s);this.decryptBuffer(o.buffer).then((function(o){r.data=a.getAvcDecryptedUnit(s,o),a.decrypter.isSync()||a.decryptAvcSamples(e,t,i+1,n)}))},t.decryptAvcSamples=function(e,t,i,n){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,i=0){if(t>=e.length)return void n();for(var r=e[t].units;;i++){if(i>=r.length)break;var a=r[i];if(!(a.data.length<=48||1!==a.type&&5!==a.type)&&(this.decryptAvcSample(e,t,i,n,a),!this.decrypter.isSync()))return}}},e}(),En=188,Tn=function(){function e(e,t,i){this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._duration=0,this._pmtId=-1,this._avcTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.observer=e,this.config=t,this.typeSupported=i}e.probe=function(t){var i=e.syncOffset(t);return i>0&&x.warn("MPEG2-TS detected but first sync word found @ offset "+i),-1!==i},e.syncOffset=function(e){var t=e.length,i=Math.min(5*En,e.length-En)+1,n=0;while(n<i){for(var r=!1,a=-1,s=0,o=n;o<t;o+=En){if(71!==e[o]){if(s)return-1;break}if(s++,-1===a&&(a=o,0!==a&&(i=Math.min(a+99*En,e.length-En)+1)),r||(r=0===Sn(e,o)),r&&s>1&&(0===a&&s>2||o+En>i))return a}n++}return-1},e.createTrack=function(e,t){return{container:"video"===e||"audio"===e?"video/mp2t":void 0,type:e,id:ge[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:"audio"===e?t:void 0}};var t=e.prototype;return t.resetInitSegment=function(t,i,n,r){this.pmtParsed=!1,this._pmtId=-1,this._avcTrack=e.createTrack("video"),this._audioTrack=e.createTrack("audio",r),this._id3Track=e.createTrack("id3"),this._txtTrack=e.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.avcSample=null,this.remainderData=null,this.audioCodec=i,this.videoCodec=n,this._duration=r},t.resetTimeStamp=function(){},t.resetContiguity=function(){var e=this._audioTrack,t=this._avcTrack,i=this._id3Track;e&&(e.pesData=null),t&&(t.pesData=null),i&&(i.pesData=null),this.aacOverFlow=null,this.avcSample=null,this.remainderData=null},t.demux=function(t,i,n,r){var a;void 0===n&&(n=!1),void 0===r&&(r=!1),n||(this.sampleAes=null);var s=this._avcTrack,o=this._audioTrack,l=this._id3Track,u=this._txtTrack,c=s.pid,h=s.pesData,d=o.pid,f=l.pid,g=o.pesData,v=l.pesData,p=null,m=this.pmtParsed,y=this._pmtId,b=t.length;if(this.remainderData&&(t=we(this.remainderData,t),b=t.length,this.remainderData=null),b<En&&!r)return this.remainderData=t,{audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};var E=Math.max(0,e.syncOffset(t));b-=(b-E)%En,b<t.byteLength&&!r&&(this.remainderData=new Uint8Array(t.buffer,b,t.buffer.byteLength-b));for(var T=0,L=E;L<b;L+=En)if(71===t[L]){var A=!!(64&t[L+1]),C=Sn(t,L),O=(48&t[L+3])>>4,R=void 0;if(O>1){if(R=L+5+t[L+4],R===L+En)continue}else R=L+4;switch(C){case c:A&&(h&&(a=An(h))&&this.parseAVCPES(s,u,a,!1),h={data:[],size:0}),h&&(h.data.push(t.subarray(R,L+En)),h.size+=L+En-R);break;case d:if(A){if(g&&(a=An(g)))switch(o.segmentCodec){case"aac":this.parseAACPES(o,a);break;case"mp3":this.parseMPEGPES(o,a);break}g={data:[],size:0}}g&&(g.data.push(t.subarray(R,L+En)),g.size+=L+En-R);break;case f:A&&(v&&(a=An(v))&&this.parseID3PES(l,a),v={data:[],size:0}),v&&(v.data.push(t.subarray(R,L+En)),v.size+=L+En-R);break;case 0:A&&(R+=t[R]+1),y=this._pmtId=_n(t,R);break;case y:A&&(R+=t[R]+1);var w=Ln(t,R,this.typeSupported,n);c=w.avc,c>0&&(s.pid=c),d=w.audio,d>0&&(o.pid=d,o.segmentCodec=w.segmentCodec),f=w.id3,f>0&&(l.pid=f),null===p||m||(x.warn("MPEG-TS PMT found at "+L+" after unknown PID '"+p+"'. Backtracking to sync byte @"+E+" to parse all TS packets."),p=null,L=E-188),m=this.pmtParsed=!0;break;case 17:case 8191:break;default:p=C;break}}else T++;if(T>0){var I=new Error("Found "+T+" TS packet/s that do not start with 0x47");this.observer.emit(k.ERROR,k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:I,reason:I.message})}s.pesData=h,o.pesData=g,l.pesData=v;var D={audioTrack:o,videoTrack:s,id3Track:l,textTrack:u};return r&&this.extractRemainingSamples(D),D},t.flush=function(){var e,t=this.remainderData;return this.remainderData=null,e=t?this.demux(t,-1,!1,!0):{videoTrack:this._avcTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(e),this.sampleAes?this.decrypt(e,this.sampleAes):e},t.extractRemainingSamples=function(e){var t,i=e.audioTrack,n=e.videoTrack,r=e.id3Track,a=e.textTrack,s=n.pesData,o=i.pesData,l=r.pesData;if(s&&(t=An(s))?(this.parseAVCPES(n,a,t,!0),n.pesData=null):n.pesData=s,o&&(t=An(o))){switch(i.segmentCodec){case"aac":this.parseAACPES(i,t);break;case"mp3":this.parseMPEGPES(i,t);break}i.pesData=null}else null!=o&&o.size&&x.log("last AAC PES packet truncated,might overlap between fragments"),i.pesData=o;l&&(t=An(l))?(this.parseID3PES(r,t),r.pesData=null):r.pesData=l},t.demuxSampleAes=function(e,t,i){var n=this.demux(e,i,!0,!this.config.progressive),r=this.sampleAes=new bn(this.observer,this.config,t);return this.decrypt(n,r)},t.decrypt=function(e,t){return new Promise((function(i){var n=e.audioTrack,r=e.videoTrack;n.samples&&"aac"===n.segmentCodec?t.decryptAacSamples(n.samples,0,(function(){r.samples?t.decryptAvcSamples(r.samples,0,0,(function(){i(e)})):i(e)})):r.samples&&t.decryptAvcSamples(r.samples,0,0,(function(){i(e)}))}))},t.destroy=function(){this._duration=0},t.parseAVCPES=function(e,t,i,n){var r,a=this,s=this.parseAVCNALu(e,i.data),o=this.avcSample,l=!1;i.data=null,o&&s.length&&!e.audFound&&(Cn(o,e),o=this.avcSample=kn(!1,i.pts,i.dts,"")),s.forEach((function(n){switch(n.type){case 1:r=!0,o||(o=a.avcSample=kn(!0,i.pts,i.dts,"")),o.frame=!0;var s=n.data;if(l&&s.length>4){var u=new yn(s).readSliceType();2!==u&&4!==u&&7!==u&&9!==u||(o.key=!0)}break;case 5:r=!0,o||(o=a.avcSample=kn(!0,i.pts,i.dts,"")),o.key=!0,o.frame=!0;break;case 6:r=!0,Pe(n.data,1,i.pts,t.samples);break;case 7:if(r=!0,l=!0,!e.sps){var c=n.data,h=new yn(c),d=h.readSPS();e.width=d.width,e.height=d.height,e.pixelRatio=d.pixelRatio,e.sps=[c],e.duration=a._duration;for(var f=c.subarray(1,4),g="avc1.",v=0;v<3;v++){var p=f[v].toString(16);p.length<2&&(p="0"+p),g+=p}e.codec=g}break;case 8:r=!0,e.pps||(e.pps=[n.data]);break;case 9:r=!1,e.audFound=!0,o&&Cn(o,e),o=a.avcSample=kn(!1,i.pts,i.dts,"");break;case 12:r=!0;break;default:r=!1,o&&(o.debug+="unknown NAL "+n.type+" ");break}if(o&&r){var m=o.units;m.push(n)}})),n&&o&&(Cn(o,e),this.avcSample=null)},t.getLastNalUnit=function(e){var t,i,n=this.avcSample;if(n&&0!==n.units.length||(n=e[e.length-1]),null!=(t=n)&&t.units){var r=n.units;i=r[r.length-1]}return i},t.parseAVCNALu=function(e,t){var i,n,r,a=t.byteLength,s=e.naluState||0,o=s,l=[],u=0,c=-1,h=0;-1===s&&(c=0,h=31&t[0],s=0,u=1);while(u<a)if(i=t[u++],s)if(1!==s)if(i)if(1===i){if(c>=0){var d={data:t.subarray(c,u-s-1),type:h};l.push(d)}else{var f=this.getLastNalUnit(e.samples);if(f&&(o&&u<=4-o&&f.state&&(f.data=f.data.subarray(0,f.data.byteLength-o)),n=u-s-1,n>0)){var g=new Uint8Array(f.data.byteLength+n);g.set(f.data,0),g.set(t.subarray(0,n),f.data.byteLength),f.data=g,f.state=0}}u<a?(r=31&t[u],c=u,h=r,s=0):s=-1}else s=0;else s=3;else s=i?0:2;else s=i?0:1;if(c>=0&&s>=0){var v={data:t.subarray(c,a),type:h,state:s};l.push(v)}if(0===l.length){var p=this.getLastNalUnit(e.samples);if(p){var m=new Uint8Array(p.data.byteLength+t.byteLength);m.set(p.data,0),m.set(t,p.data.byteLength),p.data=m}}return e.naluState=s,l},t.parseAACPES=function(e,t){var i,n,r,a=0,s=this.aacOverFlow,o=t.data;if(s){this.aacOverFlow=null;var l=s.missing,u=s.sample.unit.byteLength;if(-1===l){var c=new Uint8Array(u+o.byteLength);c.set(s.sample.unit,0),c.set(o,u),o=c}else{var h=u-l;s.sample.unit.set(o.subarray(0,l),h),e.samples.push(s.sample),a=s.missing}}for(i=a,n=o.length;i<n-1;i++)if(Zi(o,i))break;if(i!==a){var d,f=i<n-1;d=f?"AAC PES did not start with ADTS header,offset:"+i:"No ADTS header found in AAC PES";var g=new Error(d);if(x.warn("parsing error: "+d),this.observer.emit(k.ERROR,k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,levelRetry:f,error:g,reason:d}),!f)return}if($i(e,this.observer,o,i,this.audioCodec),void 0!==t.pts)r=t.pts;else{if(!s)return void x.warn("[tsdemuxer]: AAC PES unknown PTS");var v=en(e.samplerate);r=s.sample.pts+v}var p,m=0;while(i<n){if(p=nn(e,o,i,r,m),i+=p.length,p.missing){this.aacOverFlow=p;break}for(m++;i<n-1;i++)if(Zi(o,i))break}},t.parseMPEGPES=function(e,t){var i=t.data,n=i.length,r=0,a=0,s=t.pts;if(void 0!==s)while(a<n)if(vn(i,a)){var o=dn(e,i,a,s,r);if(!o)break;a+=o.length,r++}else a++;else x.warn("[tsdemuxer]: MPEG PES unknown PTS")},t.parseID3PES=function(e,t){if(void 0!==t.pts){var i=o({},t,{type:this._avcTrack?gt.emsg:gt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(i)}else x.warn("[tsdemuxer]: ID3 PES unknown PTS")},e}();function kn(e,t,i,n){return{key:e,frame:!1,pts:t,dts:i,units:[],debug:n,length:0}}function Sn(e,t){return((31&e[t+1])<<8)+e[t+2]}function _n(e,t){return(31&e[t+10])<<8|e[t+11]}function Ln(e,t,i,n){var r={audio:-1,avc:-1,id3:-1,segmentCodec:"aac"},a=(15&e[t+1])<<8|e[t+2],s=t+3+a-4,o=(15&e[t+10])<<8|e[t+11];t+=12+o;while(t<s){var l=Sn(e,t);switch(e[t]){case 207:if(!n){x.log("ADTS AAC with AES-128-CBC frame encryption found in unencrypted stream");break}case 15:-1===r.audio&&(r.audio=l);break;case 21:-1===r.id3&&(r.id3=l);break;case 219:if(!n){x.log("H.264 with AES-128-CBC slice encryption found in unencrypted stream");break}case 27:-1===r.avc&&(r.avc=l);break;case 3:case 4:!0!==i.mpeg&&!0!==i.mp3?x.log("MPEG audio found, not supported in this browser"):-1===r.audio&&(r.audio=l,r.segmentCodec="mp3");break;case 36:x.warn("Unsupported HEVC stream type found");break}t+=5+((15&e[t+3])<<8|e[t+4])}return r}function An(e){var t,i,n,r,a,s=0,o=e.data;if(!e||0===e.size)return null;while(o[0].length<19&&o.length>1){var l=new Uint8Array(o[0].length+o[1].length);l.set(o[0]),l.set(o[1],o[0].length),o[0]=l,o.splice(1,1)}t=o[0];var u=(t[0]<<16)+(t[1]<<8)+t[2];if(1===u){if(i=(t[4]<<8)+t[5],i&&i>e.size-6)return null;var c=t[7];192&c&&(r=536870912*(14&t[9])+4194304*(255&t[10])+16384*(254&t[11])+128*(255&t[12])+(254&t[13])/2,64&c?(a=536870912*(14&t[14])+4194304*(255&t[15])+16384*(254&t[16])+128*(255&t[17])+(254&t[18])/2,r-a>54e5&&(x.warn(Math.round((r-a)/9e4)+"s delta between PTS and DTS, align them"),r=a)):a=r),n=t[8];var h=n+9;if(e.size<=h)return null;e.size-=h;for(var d=new Uint8Array(e.size),f=0,g=o.length;f<g;f++){t=o[f];var v=t.byteLength;if(h){if(h>v){h-=v;continue}t=t.subarray(h),v-=h,h=0}d.set(t,s),s+=v}return i&&(i-=n+3),{data:d,pts:r,dts:a,len:i}}return null}function Cn(e,t){if(e.units.length&&e.frame){if(void 0===e.pts){var i=t.samples,n=i.length;if(!n)return void t.dropped++;var r=i[n-1];e.pts=r.pts,e.dts=r.dts}t.samples.push(e)}e.debug.length&&x.log(e.pts+"/"+e.dts+":"+e.debug)}var On=function(e){function t(){return e.apply(this,arguments)||this}l(t,e);var i=t.prototype;return i.resetInitSegment=function(t,i,n,r){e.prototype.resetInitSegment.call(this,t,i,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:i,duration:r,inputTimeScale:9e4,dropped:0}},t.probe=function(e){if(!e)return!1;for(var t=Q(e,0)||[],i=t.length,n=e.length;i<n;i++)if(mn(e,i))return x.log("MPEG Audio sync word found !"),!0;return!1},i.canParse=function(e,t){return pn(e,t)},i.appendFrame=function(e,t,i){if(null!==this.basePTS)return dn(e,t,i,this.basePTS,this.frameIndex)},t}(Vi),Rn=function(){function e(){}return e.getSilentFrame=function(e,t){switch(e){case"mp4a.40.2":if(1===t)return new Uint8Array([0,200,0,128,35,128]);if(2===t)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(3===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(4===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(5===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(6===t)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(1===t)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(2===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(3===t)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}},e}(),wn=Math.pow(2,32)-1,xn=function(){function e(){}return e.init=function(){var t;for(t in e.types={avc1:[],avcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]},e.types)e.types.hasOwnProperty(t)&&(e.types[t]=[t.charCodeAt(0),t.charCodeAt(1),t.charCodeAt(2),t.charCodeAt(3)]);var i=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);e.HDLR_TYPES={video:i,audio:n};var r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);e.STTS=e.STSC=e.STCO=a,e.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),e.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),e.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),e.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);var s=new Uint8Array([105,115,111,109]),o=new Uint8Array([97,118,99,49]),l=new Uint8Array([0,0,0,1]);e.FTYP=e.box(e.types.ftyp,s,l,s,o),e.DINF=e.box(e.types.dinf,e.box(e.types.dref,r))},e.box=function(e){for(var t=8,i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var a=n.length,s=a;while(a--)t+=n[a].byteLength;var o=new Uint8Array(t);for(o[0]=t>>24&255,o[1]=t>>16&255,o[2]=t>>8&255,o[3]=255&t,o.set(e,4),a=0,t=8;a<s;a++)o.set(n[a],t),t+=n[a].byteLength;return o},e.hdlr=function(t){return e.box(e.types.hdlr,e.HDLR_TYPES[t])},e.mdat=function(t){return e.box(e.types.mdat,t)},e.mdhd=function(t,i){i*=t;var n=Math.floor(i/(wn+1)),r=Math.floor(i%(wn+1));return e.box(e.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,85,196,0,0]))},e.mdia=function(t){return e.box(e.types.mdia,e.mdhd(t.timescale,t.duration),e.hdlr(t.type),e.minf(t))},e.mfhd=function(t){return e.box(e.types.mfhd,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,255&t]))},e.minf=function(t){return"audio"===t.type?e.box(e.types.minf,e.box(e.types.smhd,e.SMHD),e.DINF,e.stbl(t)):e.box(e.types.minf,e.box(e.types.vmhd,e.VMHD),e.DINF,e.stbl(t))},e.moof=function(t,i,n){return e.box(e.types.moof,e.mfhd(t),e.traf(n,i))},e.moov=function(t){var i=t.length,n=[];while(i--)n[i]=e.trak(t[i]);return e.box.apply(null,[e.types.moov,e.mvhd(t[0].timescale,t[0].duration)].concat(n).concat(e.mvex(t)))},e.mvex=function(t){var i=t.length,n=[];while(i--)n[i]=e.trex(t[i]);return e.box.apply(null,[e.types.mvex].concat(n))},e.mvhd=function(t,i){i*=t;var n=Math.floor(i/(wn+1)),r=Math.floor(i%(wn+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,255&t,n>>24,n>>16&255,n>>8&255,255&n,r>>24,r>>16&255,r>>8&255,255&r,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return e.box(e.types.mvhd,a)},e.sdtp=function(t){var i,n,r=t.samples||[],a=new Uint8Array(4+r.length);for(i=0;i<r.length;i++)n=r[i].flags,a[i+4]=n.dependsOn<<4|n.isDependedOn<<2|n.hasRedundancy;return e.box(e.types.sdtp,a)},e.stbl=function(t){return e.box(e.types.stbl,e.stsd(t),e.box(e.types.stts,e.STTS),e.box(e.types.stsc,e.STSC),e.box(e.types.stsz,e.STSZ),e.box(e.types.stco,e.STCO))},e.avc1=function(t){var i,n,r,a=[],s=[];for(i=0;i<t.sps.length;i++)n=t.sps[i],r=n.byteLength,a.push(r>>>8&255),a.push(255&r),a=a.concat(Array.prototype.slice.call(n));for(i=0;i<t.pps.length;i++)n=t.pps[i],r=n.byteLength,s.push(r>>>8&255),s.push(255&r),s=s.concat(Array.prototype.slice.call(n));var o=e.box(e.types.avcC,new Uint8Array([1,a[3],a[4],a[5],255,224|t.sps.length].concat(a).concat([t.pps.length]).concat(s))),l=t.width,u=t.height,c=t.pixelRatio[0],h=t.pixelRatio[1];return e.box(e.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,l>>8&255,255&l,u>>8&255,255&u,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),o,e.box(e.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),e.box(e.types.pasp,new Uint8Array([c>>24,c>>16&255,c>>8&255,255&c,h>>24,h>>16&255,h>>8&255,255&h])))},e.esds=function(e){var t=e.config.length;return new Uint8Array([0,0,0,0,3,23+t,0,1,0,4,15+t,64,21,0,0,0,0,0,0,0,0,0,0,0,5].concat([t]).concat(e.config).concat([6,1,2]))},e.mp4a=function(t){var i=t.samplerate;return e.box(e.types.mp4a,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]),e.box(e.types.esds,e.esds(t)))},e.mp3=function(t){var i=t.samplerate;return e.box(e.types[".mp3"],new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,t.channelCount,0,16,0,0,0,0,i>>8&255,255&i,0,0]))},e.stsd=function(t){return"audio"===t.type?"mp3"===t.segmentCodec&&"mp3"===t.codec?e.box(e.types.stsd,e.STSD,e.mp3(t)):e.box(e.types.stsd,e.STSD,e.mp4a(t)):e.box(e.types.stsd,e.STSD,e.avc1(t))},e.tkhd=function(t){var i=t.id,n=t.duration*t.timescale,r=t.width,a=t.height,s=Math.floor(n/(wn+1)),o=Math.floor(n%(wn+1));return e.box(e.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,i>>24&255,i>>16&255,i>>8&255,255&i,0,0,0,0,s>>24,s>>16&255,s>>8&255,255&s,o>>24,o>>16&255,o>>8&255,255&o,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,255&r,0,0,a>>8&255,255&a,0,0]))},e.traf=function(t,i){var n=e.sdtp(t),r=t.id,a=Math.floor(i/(wn+1)),s=Math.floor(i%(wn+1));return e.box(e.types.traf,e.box(e.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,255&r])),e.box(e.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,255&a,s>>24,s>>16&255,s>>8&255,255&s])),e.trun(t,n.length+16+20+8+16+8+8),n)},e.trak=function(t){return t.duration=t.duration||4294967295,e.box(e.types.trak,e.tkhd(t),e.mdia(t))},e.trex=function(t){var i=t.id;return e.box(e.types.trex,new Uint8Array([0,0,0,0,i>>24,i>>16&255,i>>8&255,255&i,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))},e.trun=function(t,i){var n,r,a,s,o,l,u=t.samples||[],c=u.length,h=12+16*c,d=new Uint8Array(h);for(i+=8+h,d.set(["video"===t.type?1:0,0,15,1,c>>>24&255,c>>>16&255,c>>>8&255,255&c,i>>>24&255,i>>>16&255,i>>>8&255,255&i],0),n=0;n<c;n++)r=u[n],a=r.duration,s=r.size,o=r.flags,l=r.cts,d.set([a>>>24&255,a>>>16&255,a>>>8&255,255&a,s>>>24&255,s>>>16&255,s>>>8&255,255&s,o.isLeading<<2|o.dependsOn,o.isDependedOn<<6|o.hasRedundancy<<4|o.paddingValue<<1|o.isNonSync,61440&o.degradPrio,15&o.degradPrio,l>>>24&255,l>>>16&255,l>>>8&255,255&l],12+16*n);return e.box(e.types.trun,d)},e.initSegment=function(t){e.types||e.init();var i=e.moov(t),n=new Uint8Array(e.FTYP.byteLength+i.byteLength);return n.set(e.FTYP),n.set(i,e.FTYP.byteLength),n},e}();xn.types=void 0,xn.HDLR_TYPES=void 0,xn.STTS=void 0,xn.STSC=void 0,xn.STCO=void 0,xn.STSZ=void 0,xn.VMHD=void 0,xn.SMHD=void 0,xn.STSD=void 0,xn.FTYP=void 0,xn.DINF=void 0;var In=9e4;function Dn(e,t,i,n){void 0===i&&(i=1),void 0===n&&(n=!1);var r=e*t*i;return n?Math.round(r):r}function Pn(e,t){return void 0===t&&(t=!1),Dn(e,1e3,1/In,t)}var Nn=1e4,Mn=1024,Fn=1152,jn=null,Un=null,Bn=function(){function e(e,t,i,n){if(this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextAvcDts=null,this.nextAudioPts=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.observer=e,this.config=t,this.typeSupported=i,this.ISGenerated=!1,null===jn){var r=navigator.userAgent||"",a=r.match(/Chrome\/(\d+)/i);jn=a?parseInt(a[1]):0}if(null===Un){var s=navigator.userAgent.match(/Safari\/(\d+)/i);Un=s?parseInt(s[1]):0}}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){x.log("[mp4-remuxer]: initPTS & initDTS reset"),this._initPTS=this._initDTS=e},t.resetNextTimestamp=function(){x.log("[mp4-remuxer]: reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1},t.resetInitSegment=function(){x.log("[mp4-remuxer]: ISGenerated flag reset"),this.ISGenerated=!1},t.getVideoStartPts=function(e){var t=!1,i=e.reduce((function(e,i){var n=i.pts-e;return n<-4294967296?(t=!0,Gn(e,i.pts)):n>0?e:i.pts}),e[0].pts);return t&&x.debug("PTS rollover detected"),i},t.remux=function(e,t,i,n,r,a,s,o){var l,u,c,h,d,f,g=r,v=r,p=e.pid>-1,m=t.pid>-1,y=t.samples.length,b=e.samples.length>0,E=s&&y>0||y>1,T=(!p||b)&&(!m||E)||this.ISGenerated||s;if(T){this.ISGenerated||(c=this.generateIS(e,t,r,a));var k,S=this.isVideoContiguous,_=-1;if(E&&(_=Hn(t.samples),!S&&this.config.forceKeyFrameOnDiscontinuity))if(f=!0,_>0){x.warn("[mp4-remuxer]: Dropped "+_+" out of "+y+" video samples due to a missing keyframe");var L=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(_),t.dropped+=_,v+=(t.samples[0].pts-L)/t.inputTimeScale,k=v}else-1===_&&(x.warn("[mp4-remuxer]: No keyframe found out of "+y+" video samples"),f=!1);if(this.ISGenerated){if(b&&E){var A=this.getVideoStartPts(t.samples),C=Gn(e.samples[0].pts,A)-A,O=C/t.inputTimeScale;g+=Math.max(0,O),v+=Math.max(0,-O)}if(b){if(e.samplerate||(x.warn("[mp4-remuxer]: regenerate InitSegment as audio detected"),c=this.generateIS(e,t,r,a)),u=this.remuxAudio(e,g,this.isAudioContiguous,a,m||E||o===at.AUDIO?v:void 0),E){var R=u?u.endPTS-u.startPTS:0;t.inputTimeScale||(x.warn("[mp4-remuxer]: regenerate InitSegment as video detected"),c=this.generateIS(e,t,r,a)),l=this.remuxVideo(t,v,S,R)}}else E&&(l=this.remuxVideo(t,v,S,0));l&&(l.firstKeyFrame=_,l.independent=-1!==_,l.firstKeyFramePTS=k)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(i.samples.length&&(d=Vn(i,r,this._initPTS,this._initDTS)),n.samples.length&&(h=Kn(n,r,this._initPTS))),{audio:u,video:l,initSegment:c,independent:f,text:h,id3:d}},t.generateIS=function(e,t,i,n){var r,a,s,o=e.samples,l=t.samples,u=this.typeSupported,c={},h=this._initPTS,d=!h||n,f="audio/mp4";if(d&&(r=a=1/0),e.config&&o.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(f="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break}c.audio={id:"audio",container:f,codec:e.codec,initSegment:"mp3"===e.segmentCodec&&u.mpeg?new Uint8Array(0):xn.initSegment([e]),metadata:{channelCount:e.channelCount}},d&&(s=e.inputTimeScale,h&&s===h.timescale?d=!1:r=a=o[0].pts-Math.round(s*i))}if(t.sps&&t.pps&&l.length&&(t.timescale=t.inputTimeScale,c.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:xn.initSegment([t]),metadata:{width:t.width,height:t.height}},d))if(s=t.inputTimeScale,h&&s===h.timescale)d=!1;else{var g=this.getVideoStartPts(l),v=Math.round(s*i);a=Math.min(a,Gn(l[0].dts,g)-v),r=Math.min(r,g-v)}if(Object.keys(c).length)return this.ISGenerated=!0,d?(this._initPTS={baseTime:r,timescale:s},this._initDTS={baseTime:a,timescale:s}):r=s=void 0,{tracks:c,initPTS:r,timescale:s}},t.remuxVideo=function(e,t,i,n){var r,a,s=e.inputTimeScale,l=e.samples,u=[],c=l.length,h=this._initPTS,d=this.nextAvcDts,f=8,g=this.videoSampleDuration,v=Number.POSITIVE_INFINITY,p=Number.NEGATIVE_INFINITY,m=!1;if(!i||null===d){var y=t*s,b=l[0].pts-Gn(l[0].dts,l[0].pts);d=y-b}for(var E=h.baseTime*s/h.timescale,T=0;T<c;T++){var L=l[T];L.pts=Gn(L.pts-E,d),L.dts=Gn(L.dts-E,d),L.dts<l[T>0?T-1:T].dts&&(m=!0)}m&&l.sort((function(e,t){var i=e.dts-t.dts,n=e.pts-t.pts;return i||n})),r=l[0].dts,a=l[l.length-1].dts;var A=a-r,C=A?Math.round(A/(c-1)):g||e.inputTimeScale/30;if(i){var O=r-d,R=O>C,w=O<-1;if((R||w)&&(R?x.warn("AVC: "+Pn(O,!0)+" ms ("+O+"dts) hole between fragments detected, filling it"):x.warn("AVC: "+Pn(-O,!0)+" ms ("+O+"dts) overlapping between fragments detected"),!w||d>=l[0].pts)){r=d;var I=l[0].pts-O;l[0].dts=r,l[0].pts=I,x.log("Video: First PTS/DTS adjusted: "+Pn(I,!0)+"/"+Pn(r,!0)+", delta: "+Pn(O,!0)+" ms")}}r=Math.max(0,r);for(var D=0,P=0,N=0;N<c;N++){for(var M=l[N],F=M.units,j=F.length,U=0,B=0;B<j;B++)U+=F[B].data.length;P+=U,D+=j,M.length=U,M.dts=Math.max(M.dts,r),v=Math.min(M.pts,v),p=Math.max(M.pts,p)}a=l[c-1].dts;var G,H=P+4*D+8;try{G=new Uint8Array(H)}catch(Ee){return void this.observer.emit(k.ERROR,k.ERROR,{type:S.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:Ee,bytes:H,reason:"fail allocating video mdat "+H})}var V=new DataView(G.buffer);V.setUint32(0,H),G.set(xn.types.mdat,4);for(var K=!1,W=Number.POSITIVE_INFINITY,Y=Number.POSITIVE_INFINITY,z=Number.NEGATIVE_INFINITY,X=Number.NEGATIVE_INFINITY,q=0;q<c;q++){for(var Z=l[q],Q=Z.units,J=0,$=0,ee=Q.length;$<ee;$++){var te=Q[$],ie=te.data,ne=te.data.byteLength;V.setUint32(f,ne),f+=4,G.set(ie,f),f+=ne,J+=4+ne}var re=void 0;if(q<c-1)g=l[q+1].dts-Z.dts,re=l[q+1].pts-Z.pts;else{var ae=this.config,se=q>0?Z.dts-l[q-1].dts:C;if(re=q>0?Z.pts-l[q-1].pts:C,ae.stretchShortVideoTrack&&null!==this.nextAudioPts){var oe=Math.floor(ae.maxBufferHole*s),le=(n?v+n*s:this.nextAudioPts)-Z.pts;le>oe?(g=le-se,g<0?g=se:K=!0,x.log("[mp4-remuxer]: It is approximately "+le/90+" ms to the next segment; using duration "+g/90+" ms for the last video frame.")):g=se}else g=se}var ue=Math.round(Z.pts-Z.dts);W=Math.min(W,g),z=Math.max(z,g),Y=Math.min(Y,re),X=Math.max(X,re),u.push(new Yn(Z.key,g,J,ue))}if(u.length)if(jn){if(jn<70){var ce=u[0].flags;ce.dependsOn=2,ce.isNonSync=0}}else if(Un&&X-Y<z-W&&C/z<.025&&0===u[0].cts){x.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");for(var he=r,de=0,fe=u.length;de<fe;de++){var ge=he+u[de].duration,ve=he+u[de].cts;if(de<fe-1){var pe=ge+u[de+1].cts;u[de].duration=pe-ve}else u[de].duration=de?u[de-1].duration:C;u[de].cts=0,he=ge}}g=K||!g?C:g,this.nextAvcDts=d=a+g,this.videoSampleDuration=g,this.isVideoContiguous=!0;var me=xn.moof(e.sequenceNumber++,r,o({},e,{samples:u})),ye="video",be={data1:me,data2:G,startPTS:v/s,endPTS:(p+g)/s,startDTS:r/s,endDTS:d/s,type:ye,hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,be},t.remuxAudio=function(e,t,i,n,r){var a=e.inputTimeScale,s=e.samplerate?e.samplerate:a,l=a/s,u="aac"===e.segmentCodec?Mn:Fn,c=u*l,h=this._initPTS,d="mp3"===e.segmentCodec&&this.typeSupported.mpeg,f=[],g=void 0!==r,v=e.samples,p=d?0:8,m=this.nextAudioPts||-1,y=t*a,b=h.baseTime*a/h.timescale;if(this.isAudioContiguous=i=i||v.length&&m>0&&(n&&Math.abs(y-m)<9e3||Math.abs(Gn(v[0].pts-b,y)-m)<20*c),v.forEach((function(e){e.pts=Gn(e.pts-b,y)})),!i||m<0){if(v=v.filter((function(e){return e.pts>=0})),!v.length)return;m=0===r?0:n&&!g?Math.max(0,y):v[0].pts}if("aac"===e.segmentCodec)for(var E=this.config.maxAudioFramesDrift,T=0,L=m;T<v.length;T++){var A=v[T],C=A.pts,O=C-L,R=Math.abs(1e3*O/a);if(O<=-E*c&&g)0===T&&(x.warn("Audio frame @ "+(C/a).toFixed(3)+"s overlaps nextAudioPts by "+Math.round(1e3*O/a)+" ms."),this.nextAudioPts=m=L=C);else if(O>=E*c&&R<Nn&&g){var w=Math.round(O/c);L=C-w*c,L<0&&(w--,L+=c),0===T&&(this.nextAudioPts=m=L),x.warn("[mp4-remuxer]: Injecting "+w+" audio frame @ "+(L/a).toFixed(3)+"s due to "+Math.round(1e3*O/a)+" ms gap.");for(var I=0;I<w;I++){var D=Math.max(L,0),P=Rn.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);P||(x.log("[mp4-remuxer]: Unable to get silent frame for given audio codec; duplicating last frame instead."),P=A.unit.subarray()),v.splice(T,0,{unit:P,pts:D}),L+=c,T++}}A.pts=L,L+=c}var N,M=null,F=null,j=0,U=v.length;while(U--)j+=v[U].unit.byteLength;for(var B=0,G=v.length;B<G;B++){var H=v[B],V=H.unit,K=H.pts;if(null!==F){var W=f[B-1];W.duration=Math.round((K-F)/l)}else{if(i&&"aac"===e.segmentCodec&&(K=m),M=K,!(j>0))return;j+=p;try{N=new Uint8Array(j)}catch(te){return void this.observer.emit(k.ERROR,k.ERROR,{type:S.MUX_ERROR,details:_.REMUX_ALLOC_ERROR,fatal:!1,error:te,bytes:j,reason:"fail allocating audio mdat "+j})}if(!d){var Y=new DataView(N.buffer);Y.setUint32(0,j),N.set(xn.types.mdat,4)}}N.set(V,p);var z=V.byteLength;p+=z,f.push(new Yn(!0,u,z,0)),F=K}var X=f.length;if(X){var q=f[f.length-1];this.nextAudioPts=m=F+l*q.duration;var Z=d?new Uint8Array(0):xn.moof(e.sequenceNumber++,M/l,o({},e,{samples:f}));e.samples=[];var Q=M/a,J=m/a,$="audio",ee={data1:Z,data2:N,startPTS:Q,endPTS:J,startDTS:Q,endDTS:J,type:$,hasAudio:!0,hasVideo:!1,nb:X};return this.isAudioContiguous=!0,ee}},t.remuxEmptyAudio=function(e,t,i,n){var r=e.inputTimeScale,a=e.samplerate?e.samplerate:r,s=r/a,o=this.nextAudioPts,l=this._initDTS,u=9e4*l.baseTime/l.timescale,c=(null!==o?o:n.startDTS*r)+u,h=n.endDTS*r+u,d=s*Mn,f=Math.ceil((h-c)/d),g=Rn.getSilentFrame(e.manifestCodec||e.codec,e.channelCount);if(x.warn("[mp4-remuxer]: remux empty Audio"),g){for(var v=[],p=0;p<f;p++){var m=c+p*d;v.push({unit:g,pts:m,dts:m})}return e.samples=v,this.remuxAudio(e,t,i,!1)}x.trace("[mp4-remuxer]: Unable to remuxEmptyAudio since we were unable to get a silent frame for given audio codec")},e}();function Gn(e,t){var i;if(null===t)return e;i=t<e?-8589934592:8589934592;while(Math.abs(e-t)>4294967296)e+=i;return e}function Hn(e){for(var t=0;t<e.length;t++)if(e[t].key)return t;return-1}function Vn(e,t,i,n){var r=e.samples.length;if(r){for(var a=e.inputTimeScale,s=0;s<r;s++){var o=e.samples[s];o.pts=Gn(o.pts-i.baseTime*a/i.timescale,t*a)/a,o.dts=Gn(o.dts-n.baseTime*a/n.timescale,t*a)/a}var l=e.samples;return e.samples=[],{samples:l}}}function Kn(e,t,i){var n=e.samples.length;if(n){for(var r=e.inputTimeScale,a=0;a<n;a++){var s=e.samples[a];s.pts=Gn(s.pts-9e4*i.baseTime/i.timescale,t*r)/r}e.samples.sort((function(e,t){return e.pts-t.pts}));var o=e.samples;return e.samples=[],{samples:o}}}var Wn,Yn=function(e,t,i,n){this.size=void 0,this.duration=void 0,this.cts=void 0,this.flags=void 0,this.duration=t,this.size=i,this.cts=n,this.flags=new zn(e)},zn=function(e){this.isLeading=0,this.isDependedOn=0,this.hasRedundancy=0,this.degradPrio=0,this.dependsOn=1,this.isNonSync=1,this.dependsOn=e?2:1,this.isNonSync=e?0:1},Xn=function(){function e(){this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null}var t=e.prototype;return t.destroy=function(){},t.resetTimeStamp=function(e){this.initPTS=e,this.lastEndTime=null},t.resetNextTimestamp=function(){this.lastEndTime=null},t.resetInitSegment=function(e,t,i,n){this.audioCodec=t,this.videoCodec=i,this.generateInitSegment(Se(e,n)),this.emitInitSegment=!0},t.generateInitSegment=function(e){var t=this.audioCodec,i=this.videoCodec;if(null==e||!e.byteLength)return this.initTracks=void 0,void(this.initData=void 0);var n=this.initData=ke(e);t||(t=Zn(n.audio,U.AUDIO)),i||(i=Zn(n.video,U.VIDEO));var r={};n.audio&&n.video?r.audiovideo={container:"video/mp4",codec:t+","+i,initSegment:e,id:"main"}:n.audio?r.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:n.video?r.video={container:"video/mp4",codec:i,initSegment:e,id:"main"}:x.warn("[passthrough-remuxer.ts]: initSegment does not contain moov or trak boxes."),this.initTracks=r},t.remux=function(e,t,i,n,r,a){var s,o,l=this.initPTS,u=this.lastEndTime,c={audio:void 0,video:void 0,text:n,id3:i,initSegment:void 0};T(u)||(u=this.lastEndTime=r||0);var h=t.samples;if(null==h||!h.length)return c;var d={initPTS:void 0,timescale:1},f=this.initData;if(null!=(s=f)&&s.length||(this.generateInitSegment(h),f=this.initData),null==(o=f)||!o.length)return x.warn("[passthrough-remuxer.ts]: Failed to generate initSegment."),c;this.emitInitSegment&&(d.tracks=this.initTracks,this.emitInitSegment=!1);var g=Ae(h,f),v=Le(f,h),p=null===v?r:v;(qn(l,p,r,g)||d.timescale!==l.timescale&&a)&&(d.initPTS=p-r,l&&1===l.timescale&&x.warn("Adjusting initPTS by "+(d.initPTS-l.baseTime)),this.initPTS=l={baseTime:d.initPTS,timescale:1});var m=e?p-l.baseTime/l.timescale:u,y=m+g;Oe(f,h,l.baseTime/l.timescale),g>0?this.lastEndTime=y:(x.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());var b=!!f.audio,E=!!f.video,k="";b&&(k+="audio"),E&&(k+="video");var S={data1:h,startPTS:m,startDTS:m,endPTS:y,endDTS:y,type:k,hasAudio:b,hasVideo:E,nb:1,dropped:0};return c.audio="audio"===S.type?S:void 0,c.video="audio"!==S.type?S:void 0,c.initSegment=d,c.id3=Vn(i,r,l,l),n.samples.length&&(c.text=Kn(n,r,l)),c},e}();function qn(e,t,i,n){if(null===e)return!0;var r=Math.max(n,1),a=t-e.baseTime/e.timescale;return Math.abs(a-i)>r}function Zn(e,t){var i=null==e?void 0:e.codec;return i&&i.length>4?i:"hvc1"===i||"hev1"===i?"hvc1.1.6.L120.90":"av01"===i?"av01.0.04M.08":"avc1"===i||t===U.VIDEO?"avc1.42e01e":"mp4a.40.5"}try{Wn=self.performance.now.bind(self.performance)}catch(Jr){x.debug("Unable to use Performance API on this environment"),Wn="undefined"!==typeof self&&self.Date.now}var Qn=[{demux:sn,remux:Xn},{demux:Tn,remux:Bn},{demux:rn,remux:Bn},{demux:On,remux:Bn}],Jn=function(){function e(e,t,i,n,r){this.async=!1,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.vendor=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=i,this.vendor=n,this.id=r}var t=e.prototype;return t.configure=function(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()},t.push=function(e,t,i,n){var r=this,a=i.transmuxing;a.executeStart=Wn();var s=new Uint8Array(e),o=this.currentTransmuxState,l=this.transmuxConfig;n&&(this.currentTransmuxState=n);var u=n||o,c=u.contiguous,h=u.discontinuity,d=u.trackSwitch,f=u.accurateTimeOffset,g=u.timeOffset,v=u.initSegmentChange,p=l.audioCodec,m=l.videoCodec,y=l.defaultInitPts,b=l.duration,E=l.initSegmentData,T=$n(s,t);if(T&&"AES-128"===T.method){var L=this.getDecrypter();if(!L.isSync())return this.decryptionPromise=L.webCryptoDecrypt(s,T.key.buffer,T.iv.buffer).then((function(e){var t=r.push(e,null,i);return r.decryptionPromise=null,t})),this.decryptionPromise;var A=L.softwareDecrypt(s,T.key.buffer,T.iv.buffer),C=i.part>-1;if(C&&(A=L.flush()),!A)return a.executeEnd=Wn(),er(i);s=new Uint8Array(A)}var O=this.needsProbing(h,d);if(O){var R=this.configureTransmuxer(s);if(R)return x.warn("[transmuxer] "+R.message),this.observer.emit(k.ERROR,k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,fatal:!1,error:R,reason:R.message}),a.executeEnd=Wn(),er(i)}(h||d||v||O)&&this.resetInitSegment(E,p,m,b,t),(h||v||O)&&this.resetInitialTimestamp(y),c||this.resetContiguity();var w=this.transmux(s,T,g,f,i),I=this.currentTransmuxState;return I.contiguous=!0,I.discontinuity=!1,I.trackSwitch=!1,a.executeEnd=Wn(),w},t.flush=function(e){var t=this,i=e.transmuxing;i.executeStart=Wn();var n=this.decrypter,r=this.currentTransmuxState,a=this.decryptionPromise;if(a)return a.then((function(){return t.flush(e)}));var s=[],o=r.timeOffset;if(n){var l=n.flush();l&&s.push(this.push(l,null,e))}var u=this.demuxer,c=this.remuxer;if(!u||!c)return i.executeEnd=Wn(),[er(e)];var h=u.flush(o);return tr(h)?h.then((function(i){return t.flushRemux(s,i,e),s})):(this.flushRemux(s,h,e),s)},t.flushRemux=function(e,t,i){var n=t.audioTrack,r=t.videoTrack,a=t.id3Track,s=t.textTrack,o=this.currentTransmuxState,l=o.accurateTimeOffset,u=o.timeOffset;x.log("[transmuxer.ts]: Flushed fragment "+i.sn+(i.part>-1?" p: "+i.part:"")+" of level "+i.level);var c=this.remuxer.remux(n,r,a,s,u,l,!0,this.id);e.push({remuxResult:c,chunkMeta:i}),i.transmuxing.executeEnd=Wn()},t.resetInitialTimestamp=function(e){var t=this.demuxer,i=this.remuxer;t&&i&&(t.resetTimeStamp(e),i.resetTimeStamp(e))},t.resetContiguity=function(){var e=this.demuxer,t=this.remuxer;e&&t&&(e.resetContiguity(),t.resetNextTimestamp())},t.resetInitSegment=function(e,t,i,n,r){var a=this.demuxer,s=this.remuxer;a&&s&&(a.resetInitSegment(e,t,i,n),s.resetInitSegment(e,t,i,r))},t.destroy=function(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)},t.transmux=function(e,t,i,n,r){var a;return a=t&&"SAMPLE-AES"===t.method?this.transmuxSampleAes(e,t,i,n,r):this.transmuxUnencrypted(e,i,n,r),a},t.transmuxUnencrypted=function(e,t,i,n){var r=this.demuxer.demux(e,t,!1,!this.config.progressive),a=r.audioTrack,s=r.videoTrack,o=r.id3Track,l=r.textTrack,u=this.remuxer.remux(a,s,o,l,t,i,!1,this.id);return{remuxResult:u,chunkMeta:n}},t.transmuxSampleAes=function(e,t,i,n,r){var a=this;return this.demuxer.demuxSampleAes(e,t,i).then((function(e){var t=a.remuxer.remux(e.audioTrack,e.videoTrack,e.id3Track,e.textTrack,i,n,!1,a.id);return{remuxResult:t,chunkMeta:r}}))},t.configureTransmuxer=function(e){for(var t,i=this.config,n=this.observer,r=this.typeSupported,a=this.vendor,s=0,o=Qn.length;s<o;s++)if(Qn[s].demux.probe(e)){t=Qn[s];break}if(!t)return new Error("Failed to find demuxer by probing fragment data");var l=this.demuxer,u=this.remuxer,c=t.remux,h=t.demux;u&&u instanceof c||(this.remuxer=new c(n,i,r,a)),l&&l instanceof h||(this.demuxer=new h(n,i,r),this.probe=h.probe)},t.needsProbing=function(e,t){return!this.demuxer||!this.remuxer||e||t},t.getDecrypter=function(){var e=this.decrypter;return e||(e=this.decrypter=new Ni(this.config)),e},e}();function $n(e,t){var i=null;return e.byteLength>0&&null!=t&&null!=t.key&&null!==t.iv&&null!=t.method&&(i=t),i}var er=function(e){return{remuxResult:{},chunkMeta:e}};function tr(e){return"then"in e&&e.then instanceof Function}var ir=function(e,t,i,n,r){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=i,this.duration=n,this.defaultInitPts=r||null},nr=function(e,t,i,n,r,a){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=i,this.trackSwitch=n,this.timeOffset=r,this.initSegmentChange=a},rr={exports:{}};(function(e){var t=Object.prototype.hasOwnProperty,i="~";function n(){}function r(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function a(e,t,n,a,s){if("function"!==typeof n)throw new TypeError("The listener must be a function");var o=new r(n,a||e,s),l=i?i+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function s(e,t){0===--e._eventsCount?e._events=new n:delete e._events[t]}function o(){this._events=new n,this._eventsCount=0}Object.create&&(n.prototype=Object.create(null),(new n).__proto__||(i=!1)),o.prototype.eventNames=function(){var e,n,r=[];if(0===this._eventsCount)return r;for(n in e=this._events)t.call(e,n)&&r.push(i?n.slice(1):n);return Object.getOwnPropertySymbols?r.concat(Object.getOwnPropertySymbols(e)):r},o.prototype.listeners=function(e){var t=i?i+e:e,n=this._events[t];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,a=n.length,s=new Array(a);r<a;r++)s[r]=n[r].fn;return s},o.prototype.listenerCount=function(e){var t=i?i+e:e,n=this._events[t];return n?n.fn?1:n.length:0},o.prototype.emit=function(e,t,n,r,a,s){var o=i?i+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,n),!0;case 4:return c.fn.call(c.context,t,n,r),!0;case 5:return c.fn.call(c.context,t,n,r,a),!0;case 6:return c.fn.call(c.context,t,n,r,a,s),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,n);break;case 4:c[u].fn.call(c[u].context,t,n,r);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},o.prototype.on=function(e,t,i){return a(this,e,t,i,!1)},o.prototype.once=function(e,t,i){return a(this,e,t,i,!0)},o.prototype.removeListener=function(e,t,n,r){var a=i?i+e:e;if(!this._events[a])return this;if(!t)return s(this,a),this;var o=this._events[a];if(o.fn)o.fn!==t||r&&!o.once||n&&o.context!==n||s(this,a);else{for(var l=0,u=[],c=o.length;l<c;l++)(o[l].fn!==t||r&&!o[l].once||n&&o[l].context!==n)&&u.push(o[l]);u.length?this._events[a]=1===u.length?u[0]:u:s(this,a)}return this},o.prototype.removeAllListeners=function(e){var t;return e?(t=i?i+e:e,this._events[t]&&s(this,t)):(this._events=new n,this._eventsCount=0),this},o.prototype.off=o.prototype.removeListener,o.prototype.addListener=o.prototype.on,o.prefixed=i,o.EventEmitter=o,e.exports=o})(rr);var ar=rr.exports,sr=y(ar);function or(e){var t=new sr,i=function(t,i){e.postMessage({event:t,data:i})};t.on(k.FRAG_DECRYPTED,i),t.on(k.ERROR,i);var n=function(){var e=function(e){var t=function(t){i("workerLog",{logType:e,message:t})};x[e]=t};for(var t in x)e(t)};e.addEventListener("message",(function(r){var a=r.data;switch(a.cmd){case"init":var s=JSON.parse(a.config);e.transmuxer=new Jn(t,a.typeSupported,s,a.vendor,a.id),w(s.debug,a.id),n(),i("init",null);break;case"configure":e.transmuxer.configure(a.config);break;case"demux":var o=e.transmuxer.push(a.data,a.decryptdata,a.chunkMeta,a.state);tr(o)?(e.transmuxer.async=!0,o.then((function(t){lr(e,t)})).catch((function(e){i(k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker push error"})}))):(e.transmuxer.async=!1,lr(e,o));break;case"flush":var l=a.chunkMeta,u=e.transmuxer.flush(l),c=tr(u);c||e.transmuxer.async?(tr(u)||(u=Promise.resolve(u)),u.then((function(t){cr(e,t,l)})).catch((function(e){i(k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:a.chunkMeta,fatal:!1,error:e,err:e,reason:"transmuxer-worker flush error"})}))):cr(e,u,l);break}}))}function lr(e,t){if(hr(t.remuxResult))return!1;var i=[],n=t.remuxResult,r=n.audio,a=n.video;return r&&ur(i,r),a&&ur(i,a),e.postMessage({event:"transmuxComplete",data:t},i),!0}function ur(e,t){t.data1&&e.push(t.data1.buffer),t.data2&&e.push(t.data2.buffer)}function cr(e,t,i){var n=t.reduce((function(t,i){return lr(e,i)||t}),!1);n||e.postMessage({event:"transmuxComplete",data:t[0]}),e.postMessage({event:"flush",data:i})}function hr(e){return!e.audio&&!e.video&&!e.text&&!e.id3&&!e.initSegment}function dr(){return"function"===typeof t}function fr(){var e=new self.Blob(["var exports={};var module={exports:exports};function define(f){f()};define.amd=true;("+t.toString()+")(true);"],{type:"text/javascript"}),i=self.URL.createObjectURL(e),n=new self.Worker(i);return{worker:n,objectURL:i}}function gr(e){var t=new self.URL(e,self.location.href).href,i=new self.Worker(t);return{worker:i,scriptURL:t}}"undefined"!==typeof i&&i&&or(self);var vr=Ue()||{isTypeSupported:function(){return!1}},pr=function(){function e(e,t,i,n){var r=this;this.error=null,this.hls=void 0,this.id=void 0,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.onwmsg=void 0,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0;var a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=i,this.onFlush=n;var s=function(e,t){t=t||{},t.frag=r.frag,t.id=r.id,e===k.ERROR&&(r.error=t.error),r.hls.trigger(e,t)};this.observer=new sr,this.observer.on(k.FRAG_DECRYPTED,s),this.observer.on(k.ERROR,s);var o={mp4:vr.isTypeSupported("video/mp4"),mpeg:vr.isTypeSupported("audio/mpeg"),mp3:vr.isTypeSupported('audio/mp4; codecs="mp3"')},l=navigator.vendor;if(this.useWorker&&"undefined"!==typeof Worker){var u=a.workerPath||dr();if(u){try{a.workerPath?(x.log("loading Web Worker "+a.workerPath+' for "'+t+'"'),this.workerContext=gr(a.workerPath)):(x.log('injecting Web Worker for "'+t+'"'),this.workerContext=fr()),this.onwmsg=function(e){return r.onWorkerMessage(e)};var c=this.workerContext.worker;c.addEventListener("message",this.onwmsg),c.onerror=function(e){var i=new Error(e.message+"  ("+e.filename+":"+e.lineno+")");a.enableWorker=!1,x.warn('Error in "'+t+'" Web Worker, fallback to inline'),r.hls.trigger(k.ERROR,{type:S.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:i})},c.postMessage({cmd:"init",typeSupported:o,vendor:l,id:t,config:JSON.stringify(a)})}catch(Jr){x.warn('Error setting up "'+t+'" Web Worker, fallback to inline',Jr),this.resetWorker(),this.error=null,this.transmuxer=new Jn(this.observer,o,a,l,t)}return}}this.transmuxer=new Jn(this.observer,o,a,l,t)}var t=e.prototype;return t.resetWorker=function(){if(this.workerContext){var e=this.workerContext,t=e.worker,i=e.objectURL;i&&self.URL.revokeObjectURL(i),t.removeEventListener("message",this.onwmsg),t.onerror=null,t.terminate(),this.workerContext=null}},t.destroy=function(){if(this.workerContext)this.resetWorker(),this.onwmsg=void 0;else{var e=this.transmuxer;e&&(e.destroy(),this.transmuxer=null)}var t=this.observer;t&&t.removeAllListeners(),this.frag=null,this.observer=null,this.hls=null},t.push=function(e,t,i,n,r,a,s,o,l,u){var c,h,d=this;l.transmuxing.start=self.performance.now();var f=this.transmuxer,g=a?a.start:r.start,v=r.decryptdata,p=this.frag,m=!(p&&r.cc===p.cc),y=!(p&&l.level===p.level),b=p?l.sn-p.sn:-1,E=this.part?l.part-this.part.index:-1,T=0===b&&l.id>1&&l.id===(null==p?void 0:p.stats.chunkCount),k=!y&&(1===b||0===b&&(1===E||T&&E<=0)),S=self.performance.now();(y||b||0===r.stats.parsing.start)&&(r.stats.parsing.start=S),!a||!E&&k||(a.stats.parsing.start=S);var _=!(p&&(null==(c=r.initSegment)?void 0:c.url)===(null==(h=p.initSegment)?void 0:h.url)),L=new nr(m,k,o,y,g,_);if(!k||m||_){x.log("[transmuxer-interface, "+r.type+"]: Starting new transmux session for sn: "+l.sn+" p: "+l.part+" level: "+l.level+" id: "+l.id+"\n        discontinuity: "+m+"\n        trackSwitch: "+y+"\n        contiguous: "+k+"\n        accurateTimeOffset: "+o+"\n        timeOffset: "+g+"\n        initSegmentChange: "+_);var A=new ir(i,n,t,s,u);this.configureTransmuxer(A)}if(this.frag=r,this.part=a,this.workerContext)this.workerContext.worker.postMessage({cmd:"demux",data:e,decryptdata:v,chunkMeta:l,state:L},e instanceof ArrayBuffer?[e]:[]);else if(f){var C=f.push(e,v,l,L);tr(C)?(f.async=!0,C.then((function(e){d.handleTransmuxComplete(e)})).catch((function(e){d.transmuxerError(e,l,"transmuxer-interface push error")}))):(f.async=!1,this.handleTransmuxComplete(C))}},t.flush=function(e){var t=this;e.transmuxing.start=self.performance.now();var i=this.transmuxer;if(this.workerContext)this.workerContext.worker.postMessage({cmd:"flush",chunkMeta:e});else if(i){var n=i.flush(e),r=tr(n);r||i.async?(tr(n)||(n=Promise.resolve(n)),n.then((function(i){t.handleFlushResult(i,e)})).catch((function(i){t.transmuxerError(i,e,"transmuxer-interface flush error")}))):this.handleFlushResult(n,e)}},t.transmuxerError=function(e,t,i){this.hls&&(this.error=e,this.hls.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.FRAG_PARSING_ERROR,chunkMeta:t,fatal:!1,error:e,err:e,reason:i}))},t.handleFlushResult=function(e,t){var i=this;e.forEach((function(e){i.handleTransmuxComplete(e)})),this.onFlush(t)},t.onWorkerMessage=function(e){var t=e.data,i=this.hls;switch(t.event){case"init":var n,r=null==(n=this.workerContext)?void 0:n.objectURL;r&&self.URL.revokeObjectURL(r);break;case"transmuxComplete":this.handleTransmuxComplete(t.data);break;case"flush":this.onFlush(t.data);break;case"workerLog":x[t.data.logType]&&x[t.data.logType](t.data.message);break;default:t.data=t.data||{},t.data.frag=this.frag,t.data.id=this.id,i.trigger(t.event,t.data);break}},t.configureTransmuxer=function(e){var t=this.transmuxer;this.workerContext?this.workerContext.worker.postMessage({cmd:"configure",config:e}):t&&t.configure(e)},t.handleTransmuxComplete=function(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)},e}(),mr=250,yr=2,br=.1,Er=.05,Tr=function(){function e(e,t,i,n){this.config=void 0,this.media=null,this.fragmentTracker=void 0,this.hls=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.config=e,this.media=t,this.fragmentTracker=i,this.hls=n}var t=e.prototype;return t.destroy=function(){this.media=null,this.hls=this.fragmentTracker=null},t.poll=function(e,t){var i=this.config,n=this.media,r=this.stalled;if(null!==n){var a=n.currentTime,s=n.seeking,o=this.seeking&&!s,l=!this.seeking&&s;if(this.seeking=s,a===e){if(l||o)this.stalled=null;else if(!(n.paused&&!s||n.ended||0===n.playbackRate)&&bi.getBuffered(n).length){var u=bi.bufferInfo(n,a,0),c=u.len>0,h=u.nextStart||0;if(c||h){if(s){var d=u.len>yr,f=!h||t&&t.start<=a||h-a>yr&&!this.fragmentTracker.getPartialFragment(a);if(d||f)return;this.moved=!1}if(!this.moved&&null!==this.stalled){var g,v=Math.max(h,u.start||0)-a,p=this.hls.levels?this.hls.levels[this.hls.currentLevel]:null,m=null==p||null==(g=p.details)?void 0:g.live,y=m?2*p.details.targetduration:yr,b=this.fragmentTracker.getPartialFragment(a);if(v>0&&(v<=y||b))return void this._trySkipBufferHole(b)}var E=self.performance.now();if(null!==r){var T=E-r;if(s||!(T>=mr)||(this._reportStall(u),this.media)){var k=bi.bufferInfo(n,a,i.maxBufferHole);this._tryFixBufferStall(k,T)}}else this.stalled=E}}}else if(this.moved=!0,null!==r){if(this.stallReported){var S=self.performance.now()-r;x.warn("playback not stuck anymore @"+a+", after "+Math.round(S)+"ms"),this.stallReported=!1}this.stalled=null,this.nudgeRetry=0}}},t._tryFixBufferStall=function(e,t){var i=this.config,n=this.fragmentTracker,r=this.media;if(null!==r){var a=r.currentTime,s=n.getPartialFragment(a);if(s){var o=this._trySkipBufferHole(s);if(o||!this.media)return}(e.len>i.maxBufferHole||e.nextStart&&e.nextStart-a<i.maxBufferHole)&&t>1e3*i.highBufferWatchdogPeriod&&(x.warn("Trying to nudge playhead over buffer-hole"),this.stalled=null,this._tryNudgeBuffer())}},t._reportStall=function(e){var t=this.hls,i=this.media,n=this.stallReported;if(!n&&i){this.stallReported=!0;var r=new Error("Playback stalling at @"+i.currentTime+" due to low buffer ("+JSON.stringify(e)+")");x.warn(r.message),t.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,fatal:!1,error:r,buffer:e.len})}},t._trySkipBufferHole=function(e){var t=this.config,i=this.hls,n=this.media;if(null===n)return 0;var r=n.currentTime,a=bi.bufferInfo(n,r,0),s=r<a.start?a.start:a.nextStart;if(s){var o=a.len<=t.maxBufferHole,l=a.len>0&&a.len<1&&n.readyState<3,u=s-r;if(u>0&&(o||l)){if(u>t.maxBufferHole){var c=this.fragmentTracker,h=!1;if(0===r){var d=c.getAppendedFrag(0,at.MAIN);d&&s<d.end&&(h=!0)}if(!h){var f=e||c.getAppendedFrag(r,at.MAIN);if(f){var g=!1,v=f.end;while(v<s){var p=c.getPartialFragment(v);if(!p){g=!0;break}v+=p.duration}if(g)return 0}}}var m=Math.max(s+Er,r+br);if(x.warn("skipping hole, adjusting currentTime from "+r+" to "+m),this.moved=!0,this.stalled=null,n.currentTime=m,e&&!e.gap){var y=new Error("fragment loaded with buffer holes, seeking from "+r+" to "+m);i.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e})}return m}}return 0},t._tryNudgeBuffer=function(){var e=this.config,t=this.hls,i=this.media,n=this.nudgeRetry;if(null!==i){var r=i.currentTime;if(this.nudgeRetry++,n<e.nudgeMaxRetry){var a=r+(n+1)*e.nudgeOffset,s=new Error("Nudging 'currentTime' from "+r+" to "+a);x.warn(s.message),i.currentTime=a,t.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_NUDGE_ON_STALL,error:s,fatal:!1})}else{var o=new Error("Playhead still not moving while enough data buffered @"+r+" after "+e.nudgeMaxRetry+" nudges");x.error(o.message),t.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_STALLED_ERROR,error:o,fatal:!0})}}},e}(),kr=100,Sr=function(e){function t(t,i,n){var r;return r=e.call(this,t,i,n,"[stream-controller]",at.MAIN)||this,r.audioCodecSwap=!1,r.gapController=null,r.level=-1,r._forceStartLoad=!1,r.altAudio=!1,r.audioOnly=!1,r.fragPlaying=null,r.onvplaying=null,r.onvseeked=null,r.fragLastKbps=0,r.couldBacktrack=!1,r.backtrackFragment=null,r.audioCodecSwitch=!1,r.videoBuffer=null,r._registerListeners(),r}l(t,e);var i=t.prototype;return i._registerListeners=function(){var e=this.hls;e.on(k.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(k.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(k.MANIFEST_LOADING,this.onManifestLoading,this),e.on(k.MANIFEST_PARSED,this.onManifestParsed,this),e.on(k.LEVEL_LOADING,this.onLevelLoading,this),e.on(k.LEVEL_LOADED,this.onLevelLoaded,this),e.on(k.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(k.ERROR,this.onError,this),e.on(k.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(k.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(k.BUFFER_CREATED,this.onBufferCreated,this),e.on(k.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(k.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(k.FRAG_BUFFERED,this.onFragBuffered,this)},i._unregisterListeners=function(){var e=this.hls;e.off(k.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(k.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(k.MANIFEST_LOADING,this.onManifestLoading,this),e.off(k.MANIFEST_PARSED,this.onManifestParsed,this),e.off(k.LEVEL_LOADED,this.onLevelLoaded,this),e.off(k.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(k.ERROR,this.onError,this),e.off(k.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(k.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(k.BUFFER_CREATED,this.onBufferCreated,this),e.off(k.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(k.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(k.FRAG_BUFFERED,this.onFragBuffered,this)},i.onHandlerDestroying=function(){this._unregisterListeners(),this.onMediaDetaching()},i.startLoad=function(e){if(this.levels){var t=this.lastCurrentTime,i=this.hls;if(this.stopLoad(),this.setInterval(kr),this.level=-1,!this.startFragRequested){var n=i.startLevel;-1===n&&(i.config.testBandwidth&&this.levels.length>1?(n=0,this.bitrateTest=!0):n=i.nextAutoLevel),this.level=i.nextLoadLevel=n,this.loadedmetadata=!1}t>0&&-1===e&&(this.log("Override startPosition with lastCurrentTime @"+t.toFixed(3)),e=t),this.state=Fi.IDLE,this.nextLoadPosition=this.startPosition=this.lastCurrentTime=e,this.tick()}else this._forceStartLoad=!0,this.state=Fi.STOPPED},i.stopLoad=function(){this._forceStartLoad=!1,e.prototype.stopLoad.call(this)},i.doTick=function(){switch(this.state){case Fi.WAITING_LEVEL:var e,t=this.levels,i=this.level,n=null==t||null==(e=t[i])?void 0:e.details;if(n&&(!n.live||this.levelLastLoaded===this.level)){if(this.waitForCdnTuneIn(n))break;this.state=Fi.IDLE;break}if(this.hls.nextLoadLevel!==this.level){this.state=Fi.IDLE;break}break;case Fi.FRAG_LOADING_WAITING_RETRY:var r,a=self.performance.now(),s=this.retryDate;(!s||a>=s||null!=(r=this.media)&&r.seeking)&&(this.resetStartWhenNotLoaded(this.level),this.state=Fi.IDLE);break}this.state===Fi.IDLE&&this.doTickIdle(),this.onTickEnd()},i.onTickEnd=function(){e.prototype.onTickEnd.call(this),this.checkBuffer(),this.checkFragmentChanged()},i.doTickIdle=function(){var e=this.hls,t=this.levelLastLoaded,i=this.levels,n=this.media,r=e.config,a=e.nextLoadLevel;if(null!==t&&(n||!this.startFragRequested&&r.startFragPrefetch)&&(!this.altAudio||!this.audioOnly)&&null!=i&&i[a]){var s=i[a],o=this.getMainFwdBufferInfo();if(null!==o){var l=this.getLevelDetails();if(l&&this._streamEnded(o,l)){var u={};return this.altAudio&&(u.type="video"),this.hls.trigger(k.BUFFER_EOS,u),void(this.state=Fi.ENDED)}e.loadLevel!==a&&-1===e.manualLevel&&this.log("Adapting to level "+a+" from level "+this.level),this.level=e.nextLoadLevel=a;var c=s.details;if(!c||this.state===Fi.WAITING_LEVEL||c.live&&this.levelLastLoaded!==a)return this.level=a,void(this.state=Fi.WAITING_LEVEL);var h=o.len,d=this.getMaxBufferLength(s.maxBitrate);if(!(h>=d)){this.backtrackFragment&&this.backtrackFragment.start>o.end&&(this.backtrackFragment=null);var f=this.backtrackFragment?this.backtrackFragment.start:o.end,g=this.getNextFragment(f,c);if(this.couldBacktrack&&!this.fragPrevious&&g&&"initSegment"!==g.sn&&this.fragmentTracker.getState(g)!==oi.OK){var v,p=(null!=(v=this.backtrackFragment)?v:g).sn,m=p-c.startSN,y=c.fragments[m-1];y&&g.cc===y.cc&&(g=y,this.fragmentTracker.removeFragment(y))}else this.backtrackFragment&&o.len&&(this.backtrackFragment=null);if(g&&this.isLoopLoading(g,f)){var b=g.gap;if(!b){var E=this.audioOnly&&!this.altAudio?U.AUDIO:U.VIDEO,T=(E===U.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;T&&this.afterBufferFlushed(T,E,at.MAIN)}g=this.getNextFragmentLoopLoading(g,c,o,at.MAIN,d)}g&&(!g.initSegment||g.initSegment.data||this.bitrateTest||(g=g.initSegment),this.loadFragment(g,s,f))}}}},i.loadFragment=function(t,i,n){var r=this.fragmentTracker.getState(t);this.fragCurrent=t,r===oi.NOT_LOADED||r===oi.PARTIAL?"initSegment"===t.sn?this._loadInitSegment(t,i):this.bitrateTest?(this.log("Fragment "+t.sn+" of level "+t.level+" is being downloaded to test bitrate and will not be buffered"),this._loadBitrateTestFrag(t,i)):(this.startFragRequested=!0,e.prototype.loadFragment.call(this,t,i,n)):this.clearTrackerIfNeeded(t)},i.getBufferedFrag=function(e){return this.fragmentTracker.getBufferedFrag(e,at.MAIN)},i.followingBufferedFrag=function(e){return e?this.getBufferedFrag(e.end+.5):null},i.immediateLevelSwitch=function(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)},i.nextLevelSwitch=function(){var e=this.levels,t=this.media;if(null!=t&&t.readyState){var i,n=this.getAppendedFrag(t.currentTime);n&&n.start>1&&this.flushMainBuffer(0,n.start-1);var r=this.getLevelDetails();if(null!=r&&r.live){var a=this.getMainFwdBufferInfo();if(!a||a.len<2*r.targetduration)return}if(!t.paused&&e){var s=this.hls.nextLoadLevel,o=e[s],l=this.fragLastKbps;i=l&&this.fragCurrent?this.fragCurrent.duration*o.maxBitrate/(1e3*l)+1:0}else i=0;var u=this.getBufferedFrag(t.currentTime+i);if(u){var c=this.followingBufferedFrag(u);if(c){this.abortCurrentFrag();var h=c.maxStartPTS?c.maxStartPTS:c.start,d=c.duration,f=Math.max(u.end,h+Math.min(Math.max(d-this.config.maxFragLookUpTolerance,.5*d),.75*d));this.flushMainBuffer(f,Number.POSITIVE_INFINITY)}}}},i.abortCurrentFrag=function(){var e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Fi.KEY_LOADING:case Fi.FRAG_LOADING:case Fi.FRAG_LOADING_WAITING_RETRY:case Fi.PARSING:case Fi.PARSED:this.state=Fi.IDLE;break}this.nextLoadPosition=this.getLoadPosition()},i.flushMainBuffer=function(t,i){e.prototype.flushMainBuffer.call(this,t,i,this.altAudio?"video":null)},i.onMediaAttached=function(t,i){e.prototype.onMediaAttached.call(this,t,i);var n=i.media;this.onvplaying=this.onMediaPlaying.bind(this),this.onvseeked=this.onMediaSeeked.bind(this),n.addEventListener("playing",this.onvplaying),n.addEventListener("seeked",this.onvseeked),this.gapController=new Tr(this.config,n,this.fragmentTracker,this.hls)},i.onMediaDetaching=function(){var t=this.media;t&&this.onvplaying&&this.onvseeked&&(t.removeEventListener("playing",this.onvplaying),t.removeEventListener("seeked",this.onvseeked),this.onvplaying=this.onvseeked=null,this.videoBuffer=null),this.fragPlaying=null,this.gapController&&(this.gapController.destroy(),this.gapController=null),e.prototype.onMediaDetaching.call(this)},i.onMediaPlaying=function(){this.tick()},i.onMediaSeeked=function(){var e=this.media,t=e?e.currentTime:null;T(t)&&this.log("Media seeked to "+t.toFixed(3));var i=this.getMainFwdBufferInfo();null!==i&&0!==i.len?this.tick():this.warn('Main forward buffer length on "seeked" event '+(i?i.len:"empty")+")")},i.onManifestLoading=function(){this.log("Trigger BUFFER_RESET"),this.hls.trigger(k.BUFFER_RESET,void 0),this.fragmentTracker.removeAllFragments(),this.couldBacktrack=!1,this.startPosition=this.lastCurrentTime=0,this.levels=this.fragPlaying=this.backtrackFragment=null,this.altAudio=this.audioOnly=!1},i.onManifestParsed=function(e,t){var i,n=!1,r=!1;t.levels.forEach((function(e){i=e.audioCodec,i&&(-1!==i.indexOf("mp4a.40.2")&&(n=!0),-1!==i.indexOf("mp4a.40.5")&&(r=!0))})),this.audioCodecSwitch=n&&r&&!Gi(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1},i.onLevelLoading=function(e,t){var i=this.levels;if(i&&this.state===Fi.IDLE){var n=i[t.level];(!n.details||n.details.live&&this.levelLastLoaded!==t.level||this.waitForCdnTuneIn(n.details))&&(this.state=Fi.WAITING_LEVEL)}},i.onLevelLoaded=function(e,t){var i,n=this.levels,r=t.level,a=t.details,s=a.totalduration;if(n){this.log("Level "+r+" loaded ["+a.startSN+","+a.endSN+"]"+(a.lastPartSn?"[part-"+a.lastPartSn+"-"+a.lastPartIndex+"]":"")+", cc ["+a.startCC+", "+a.endCC+"] duration:"+s);var o=n[r],l=this.fragCurrent;!l||this.state!==Fi.FRAG_LOADING&&this.state!==Fi.FRAG_LOADING_WAITING_RETRY||l.level===t.level&&l.urlId===o.urlId||!l.loader||this.abortCurrentFrag();var u=0;if(a.live||null!=(i=o.details)&&i.live){if(a.fragments[0]||(a.deltaUpdateFailed=!0),a.deltaUpdateFailed)return;u=this.alignPlaylists(a,o.details)}if(o.details=a,this.levelLastLoaded=r,this.hls.trigger(k.LEVEL_UPDATED,{details:a,level:r}),this.state===Fi.WAITING_LEVEL){if(this.waitForCdnTuneIn(a))return;this.state=Fi.IDLE}this.startFragRequested?a.live&&this.synchronizeToLiveEdge(a):this.setStartPosition(a,u),this.tick()}else this.warn("Levels were reset while loading level "+r)},i._handleFragmentLoadProgress=function(e){var t,i=e.frag,n=e.part,r=e.payload,a=this.levels;if(a){var s=a[i.level],o=s.details;if(!o)return this.warn("Dropping fragment "+i.sn+" of level "+i.level+" after level details were reset"),void this.fragmentTracker.removeFragment(i);var l=s.videoCodec,u=o.PTSKnown||!o.live,c=null==(t=i.initSegment)?void 0:t.data,h=this._getAudioCodec(s),d=this.transmuxer=this.transmuxer||new pr(this.hls,at.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),f=n?n.index:-1,g=-1!==f,v=new Ei(i.level,i.sn,i.stats.chunkCount,r.byteLength,f,g),p=this.initPTS[i.cc];d.push(r,c,h,l,i,n,o.totalduration,u,v,p)}else this.warn("Levels were reset while fragment load was in progress. Fragment "+i.sn+" of level "+i.level+" will not be buffered")},i.onAudioTrackSwitching=function(e,t){var i=this.altAudio,n=!!t.url;if(!n){if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;var r=this.fragCurrent;r&&(this.log("Switching to main audio track, cancel main fragment load"),r.abortRequests(),this.fragmentTracker.removeFragment(r)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();var a=this.hls;i&&(a.trigger(k.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null}),this.fragmentTracker.removeAllFragments()),a.trigger(k.AUDIO_TRACK_SWITCHED,t)}},i.onAudioTrackSwitched=function(e,t){var i=t.id,n=!!this.hls.audioTracks[i].url;if(n){var r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n,this.tick()},i.onBufferCreated=function(e,t){var i,n,r=t.tracks,a=!1;for(var s in r){var o=r[s];if("main"===o.id){if(n=s,i=o,"video"===s){var l=r[s];l&&(this.videoBuffer=l.buffer)}}else a=!0}a&&i?(this.log("Alternate track found, use "+n+".buffered to schedule main fragment loading"),this.mediaBuffer=i.buffer):this.mediaBuffer=this.media},i.onFragBuffered=function(e,t){var i=t.frag,n=t.part;if(!i||i.type===at.MAIN){if(this.fragContextChanged(i))return this.warn("Fragment "+i.sn+(n?" p: "+n.index:"")+" of level "+i.level+" finished buffering, but was aborted. state: "+this.state),void(this.state===Fi.PARSED&&(this.state=Fi.IDLE));var r=n?n.stats:i.stats;this.fragLastKbps=Math.round(8*r.total/(r.buffering.end-r.loading.first)),"initSegment"!==i.sn&&(this.fragPrevious=i),this.fragBufferedComplete(i,n)}},i.onError=function(e,t){var i;if(t.fatal)this.state=Fi.ERROR;else switch(t.details){case _.FRAG_GAP:case _.FRAG_PARSING_ERROR:case _.FRAG_DECRYPT_ERROR:case _.FRAG_LOAD_ERROR:case _.FRAG_LOAD_TIMEOUT:case _.KEY_LOAD_ERROR:case _.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(at.MAIN,t);break;case _.LEVEL_LOAD_ERROR:case _.LEVEL_LOAD_TIMEOUT:case _.LEVEL_PARSING_ERROR:t.levelRetry||this.state!==Fi.WAITING_LEVEL||(null==(i=t.context)?void 0:i.type)!==rt.LEVEL||(this.state=Fi.IDLE);break;case _.BUFFER_FULL_ERROR:if(!t.parent||"main"!==t.parent)return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case _.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}},i.checkBuffer=function(){var e=this.media,t=this.gapController;if(e&&t&&e.readyState){if(this.loadedmetadata||!bi.getBuffered(e).length){var i=this.state!==Fi.IDLE?this.fragCurrent:null;t.poll(this.lastCurrentTime,i)}this.lastCurrentTime=e.currentTime}},i.onFragLoadEmergencyAborted=function(){this.state=Fi.IDLE,this.loadedmetadata||(this.startFragRequested=!1,this.nextLoadPosition=this.startPosition),this.tickImmediate()},i.onBufferFlushed=function(e,t){var i=t.type;if(i!==U.AUDIO||this.audioOnly&&!this.altAudio){var n=(i===U.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;this.afterBufferFlushed(n,i,at.MAIN)}},i.onLevelsUpdated=function(e,t){this.levels=t.levels},i.swapAudioCodec=function(){this.audioCodecSwap=!this.audioCodecSwap},i.seekToStartPos=function(){var e=this.media;if(e){var t=e.currentTime,i=this.startPosition;if(i>=0&&t<i){if(e.seeking)return void this.log("could not seek to "+i+", already seeking at "+t);var n=bi.getBuffered(e),r=n.length?n.start(0):0,a=r-i;a>0&&(a<this.config.maxBufferHole||a<this.config.maxFragLookUpTolerance)&&(this.log("adjusting start position by "+a+" to match buffer start"),i+=a,this.startPosition=i),this.log("seek to target start position "+i+" from current time "+t),e.currentTime=i}}},i._getAudioCodec=function(e){var t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t=-1!==t.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),t},i._loadBitrateTestFrag=function(e,t){var i=this;e.bitrateTest=!0,this._doFragLoad(e,t).then((function(n){var r=i.hls;if(n&&!i.fragContextChanged(e)){t.fragmentError=0,i.state=Fi.IDLE,i.startFragRequested=!1,i.bitrateTest=!1;var a=e.stats;a.parsing.start=a.parsing.end=a.buffering.start=a.buffering.end=self.performance.now(),r.trigger(k.FRAG_LOADED,n),e.bitrateTest=!1}}))},i._handleTransmuxComplete=function(e){var t,i="main",n=this.hls,r=e.remuxResult,a=e.chunkMeta,s=this.getCurrentContext(a);if(s){var o=s.frag,l=s.part,u=s.level,c=r.video,h=r.text,d=r.id3,f=r.initSegment,g=u.details,v=this.altAudio?void 0:r.audio;if(this.fragContextChanged(o))this.fragmentTracker.removeFragment(o);else{if(this.state=Fi.PARSING,f){if(null!=f&&f.tracks){var p=o.initSegment||o;this._bufferInitSegment(u,f.tracks,p,a),n.trigger(k.FRAG_PARSING_INIT_SEGMENT,{frag:p,id:i,tracks:f.tracks})}var m=f.initPTS,y=f.timescale;T(m)&&(this.initPTS[o.cc]={baseTime:m,timescale:y},n.trigger(k.INIT_PTS_FOUND,{frag:o,id:i,initPTS:m,timescale:y}))}if(c&&!1!==r.independent){if(g){var b=c.startPTS,E=c.endPTS,S=c.startDTS,_=c.endDTS;if(l)l.elementaryStreams[c.type]={startPTS:b,endPTS:E,startDTS:S,endDTS:_};else if(c.firstKeyFrame&&c.independent&&1===a.id&&(this.couldBacktrack=!0),c.dropped&&c.independent){var L=this.getMainFwdBufferInfo(),A=(L?L.end:this.getLoadPosition())+this.config.maxBufferHole,C=c.firstKeyFramePTS?c.firstKeyFramePTS:b;if(A<C-this.config.maxBufferHole)return void this.backtrack(o);o.setElementaryStreamInfo(c.type,o.start,E,o.start,_,!0)}o.setElementaryStreamInfo(c.type,b,E,S,_),this.backtrackFragment&&(this.backtrackFragment=o),this.bufferFragmentData(c,o,l,a)}}else if(!1===r.independent)return void this.backtrack(o);if(v){var O=v.startPTS,R=v.endPTS,w=v.startDTS,x=v.endDTS;l&&(l.elementaryStreams[U.AUDIO]={startPTS:O,endPTS:R,startDTS:w,endDTS:x}),o.setElementaryStreamInfo(U.AUDIO,O,R,w,x),this.bufferFragmentData(v,o,l,a)}if(g&&null!=d&&null!=(t=d.samples)&&t.length){var I={id:i,frag:o,details:g,samples:d.samples};n.trigger(k.FRAG_PARSING_METADATA,I)}if(g&&h){var D={id:i,frag:o,details:g,samples:h.samples};n.trigger(k.FRAG_PARSING_USERDATA,D)}}}else this.resetWhenMissingContext(a)},i._bufferInitSegment=function(e,t,i,n){var r=this;if(this.state===Fi.PARSING){this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&delete t.audio;var a=t.audio,s=t.video,o=t.audiovideo;if(a){var l=e.audioCodec,u=navigator.userAgent.toLowerCase();this.audioCodecSwitch&&(l&&(l=-1!==l.indexOf("mp4a.40.5")?"mp4a.40.2":"mp4a.40.5"),1!==a.metadata.channelCount&&-1===u.indexOf("firefox")&&(l="mp4a.40.5")),-1!==u.indexOf("android")&&"audio/mpeg"!==a.container&&(l="mp4a.40.2",this.log("Android: force audio codec to "+l)),e.audioCodec&&e.audioCodec!==l&&this.log('Swapping manifest audio codec "'+e.audioCodec+'" for "'+l+'"'),a.levelCodec=l,a.id="main",this.log("Init audio buffer, container:"+a.container+", codecs[selected/level/parsed]=["+(l||"")+"/"+(e.audioCodec||"")+"/"+a.codec+"]")}s&&(s.levelCodec=e.videoCodec,s.id="main",this.log("Init video buffer, container:"+s.container+", codecs[level/parsed]=["+(e.videoCodec||"")+"/"+s.codec+"]")),o&&this.log("Init audiovideo buffer, container:"+o.container+", codecs[level/parsed]=["+(e.attrs.CODECS||"")+"/"+o.codec+"]"),this.hls.trigger(k.BUFFER_CODECS,t),Object.keys(t).forEach((function(e){var a=t[e],s=a.initSegment;null!=s&&s.byteLength&&r.hls.trigger(k.BUFFER_APPENDING,{type:e,data:s,frag:i,part:null,chunkMeta:n,parent:i.type})})),this.tick()}},i.getMainFwdBufferInfo=function(){return this.getFwdBufferInfo(this.mediaBuffer?this.mediaBuffer:this.media,at.MAIN)},i.backtrack=function(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Fi.IDLE},i.checkFragmentChanged=function(){var e=this.media,t=null;if(e&&e.readyState>1&&!1===e.seeking){var i=e.currentTime;if(bi.isBuffered(e,i)?t=this.getAppendedFrag(i):bi.isBuffered(e,i+.1)&&(t=this.getAppendedFrag(i+.1)),t){this.backtrackFragment=null;var n=this.fragPlaying,r=t.level;n&&t.sn===n.sn&&n.level===r&&t.urlId===n.urlId||(this.fragPlaying=t,this.hls.trigger(k.FRAG_CHANGED,{frag:t}),n&&n.level===r||this.hls.trigger(k.LEVEL_SWITCHED,{level:r}))}}},a(t,[{key:"nextLevel",get:function(){var e=this.nextBufferedFrag;return e?e.level:-1}},{key:"currentFrag",get:function(){var e=this.media;return e?this.fragPlaying||this.getAppendedFrag(e.currentTime):null}},{key:"currentProgramDateTime",get:function(){var e=this.media;if(e){var t=e.currentTime,i=this.currentFrag;if(i&&T(t)&&T(i.programDateTime)){var n=i.programDateTime+1e3*(t-i.start);return new Date(n)}}return null}},{key:"currentLevel",get:function(){var e=this.currentFrag;return e?e.level:-1}},{key:"nextBufferedFrag",get:function(){var e=this.currentFrag;return e?this.followingBufferedFrag(e):null}},{key:"forceStartLoad",get:function(){return this._forceStartLoad}}]),t}(ji),_r=function(){function e(e,t,i){void 0===t&&(t=0),void 0===i&&(i=0),this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=i}var t=e.prototype;return t.sample=function(e,t){var i=Math.pow(this.alpha_,e);this.estimate_=t*(1-i)+i*this.estimate_,this.totalWeight_+=e},t.getTotalWeight=function(){return this.totalWeight_},t.getEstimate=function(){if(this.alpha_){var e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_},e}(),Lr=function(){function e(e,t,i,n){void 0===n&&(n=100),this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=i,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new _r(e),this.fast_=new _r(t),this.defaultTTFB_=n,this.ttfb_=new _r(e)}var t=e.prototype;return t.update=function(e,t){var i=this.slow_,n=this.fast_,r=this.ttfb_;i.halfLife!==e&&(this.slow_=new _r(e,i.getEstimate(),i.getTotalWeight())),n.halfLife!==t&&(this.fast_=new _r(t,n.getEstimate(),n.getTotalWeight())),r.halfLife!==e&&(this.ttfb_=new _r(e,r.getEstimate(),r.getTotalWeight()))},t.sample=function(e,t){e=Math.max(e,this.minDelayMs_);var i=8*t,n=e/1e3,r=i/n;this.fast_.sample(n,r),this.slow_.sample(n,r)},t.sampleTTFB=function(e){var t=e/1e3,i=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(i,Math.max(e,5))},t.canEstimate=function(){return this.fast_.getTotalWeight()>=this.minWeight_},t.getEstimate=function(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_},t.getEstimateTTFB=function(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_},t.destroy=function(){},e}(),Ar=function(){function e(e){this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=0,this._nextAutoLevel=-1,this.timer=-1,this.onCheck=this._abandonRulesCheck.bind(this),this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.bwEstimator=void 0,this.hls=e;var t=e.config;this.bwEstimator=new Lr(t.abrEwmaSlowVoD,t.abrEwmaFastVoD,t.abrEwmaDefaultEstimate),this.registerListeners()}var t=e.prototype;return t.registerListeners=function(){var e=this.hls;e.on(k.FRAG_LOADING,this.onFragLoading,this),e.on(k.FRAG_LOADED,this.onFragLoaded,this),e.on(k.FRAG_BUFFERED,this.onFragBuffered,this),e.on(k.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(k.LEVEL_LOADED,this.onLevelLoaded,this)},t.unregisterListeners=function(){var e=this.hls;e.off(k.FRAG_LOADING,this.onFragLoading,this),e.off(k.FRAG_LOADED,this.onFragLoaded,this),e.off(k.FRAG_BUFFERED,this.onFragBuffered,this),e.off(k.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(k.LEVEL_LOADED,this.onLevelLoaded,this)},t.destroy=function(){this.unregisterListeners(),this.clearTimer(),this.hls=this.onCheck=null,this.fragCurrent=this.partCurrent=null},t.onFragLoading=function(e,t){var i,n=t.frag;this.ignoreFragment(n)||(this.fragCurrent=n,this.partCurrent=null!=(i=t.part)?i:null,this.clearTimer(),this.timer=self.setInterval(this.onCheck,100))},t.onLevelSwitching=function(e,t){this.clearTimer()},t.getTimeToLoadFrag=function(e,t,i,n){var r=e+i/t,a=n?this.lastLevelLoadSec:0;return r+a},t.onLevelLoaded=function(e,t){var i=this.hls.config,n=t.stats,r=n.total,a=n.bwEstimate;T(r)&&T(a)&&(this.lastLevelLoadSec=8*r/a),t.details.live?this.bwEstimator.update(i.abrEwmaSlowLive,i.abrEwmaFastLive):this.bwEstimator.update(i.abrEwmaSlowVoD,i.abrEwmaFastVoD)},t._abandonRulesCheck=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls,n=i.autoLevelEnabled,r=i.media;if(e&&r){var a=performance.now(),s=t?t.stats:e.stats,o=t?t.duration:e.duration,l=a-s.loading.start;if(s.aborted||s.loaded&&s.loaded===s.total||0===e.level)return this.clearTimer(),void(this._nextAutoLevel=-1);if(n&&!r.paused&&r.playbackRate&&r.readyState){var u=i.mainForwardBufferInfo;if(null!==u){var c=this.bwEstimator.getEstimateTTFB(),h=Math.abs(r.playbackRate);if(!(l<=Math.max(c,o/(2*h)*1e3))){var d=u.len/h;if(!(d>=2*o/h)){var f=s.loading.first?s.loading.first-s.loading.start:-1,g=s.loaded&&f>-1,v=this.bwEstimator.getEstimate(),p=i.levels,m=i.minAutoLevel,y=p[e.level],b=s.total||Math.max(s.loaded,Math.round(o*y.maxBitrate/8)),E=l-f;E<1&&g&&(E=Math.min(l,8*s.loaded/v));var S=g?1e3*s.loaded/E:0,_=S?(b-s.loaded)/S:8*b/v+c/1e3;if(!(_<=d)){var L,A=S?8*S:v,C=Number.POSITIVE_INFINITY;for(L=e.level-1;L>m;L--){var O=p[L].maxBitrate;if(C=this.getTimeToLoadFrag(c/1e3,A,o*O,!p[L].details),C<d)break}C>=_||C>10*o||(i.nextLoadLevel=L,g?this.bwEstimator.sample(l-Math.min(c,f),s.loaded):this.bwEstimator.sampleTTFB(l),this.clearTimer(),x.warn("[abr] Fragment "+e.sn+(t?" part "+t.index:"")+" of level "+e.level+" is loading too slowly;\n      Time to underbuffer: "+d.toFixed(3)+" s\n      Estimated load time for current fragment: "+_.toFixed(3)+" s\n      Estimated load time for down switch fragment: "+C.toFixed(3)+" s\n      TTFB estimate: "+f+"\n      Current BW estimate: "+(T(v)?(v/1024).toFixed(3):"Unknown")+" Kb/s\n      New BW estimate: "+(this.bwEstimator.getEstimate()/1024).toFixed(3)+" Kb/s\n      Aborting and switching to level "+L),e.loader&&(this.fragCurrent=this.partCurrent=null,e.abortRequests()),i.trigger(k.FRAG_LOAD_EMERGENCY_ABORTED,{frag:e,part:t,stats:s}))}}}}}}},t.onFragLoaded=function(e,t){var i=t.frag,n=t.part,r=n?n.stats:i.stats;if(i.type===at.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(i)){if(this.clearTimer(),this.lastLoadedFragLevel=i.level,this._nextAutoLevel=-1,this.hls.config.abrMaxWithRealBitrate){var a=n?n.duration:i.duration,s=this.hls.levels[i.level],o=(s.loaded?s.loaded.bytes:0)+r.loaded,l=(s.loaded?s.loaded.duration:0)+a;s.loaded={bytes:o,duration:l},s.realBitrate=Math.round(8*o/l)}if(i.bitrateTest){var u={stats:r,frag:i,part:n,id:i.type};this.onFragBuffered(k.FRAG_BUFFERED,u),i.bitrateTest=!1}}},t.onFragBuffered=function(e,t){var i=t.frag,n=t.part,r=null!=n&&n.stats.loaded?n.stats:i.stats;if(!r.aborted&&!this.ignoreFragment(i)){var a=r.parsing.end-r.loading.start-Math.min(r.loading.first-r.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(a,r.loaded),r.bwEstimate=this.bwEstimator.getEstimate(),i.bitrateTest?this.bitrateTestDelay=a/1e3:this.bitrateTestDelay=0}},t.ignoreFragment=function(e){return e.type!==at.MAIN||"initSegment"===e.sn},t.clearTimer=function(){self.clearInterval(this.timer)},t.getNextABRAutoLevel=function(){var e=this.fragCurrent,t=this.partCurrent,i=this.hls,n=i.maxAutoLevel,r=i.config,a=i.minAutoLevel,s=i.media,o=t?t.duration:e?e.duration:0,l=s&&0!==s.playbackRate?Math.abs(s.playbackRate):1,u=this.bwEstimator?this.bwEstimator.getEstimate():r.abrEwmaDefaultEstimate,c=i.mainForwardBufferInfo,h=(c?c.len:0)/l,d=this.findBestLevel(u,a,n,h,r.abrBandWidthFactor,r.abrBandWidthUpFactor);if(d>=0)return d;x.trace("[abr] "+(h?"rebuffering expected":"buffer is empty")+", finding optimal quality level");var f=o?Math.min(o,r.maxStarvationDelay):r.maxStarvationDelay,g=r.abrBandWidthFactor,v=r.abrBandWidthUpFactor;if(!h){var p=this.bitrateTestDelay;if(p){var m=o?Math.min(o,r.maxLoadingDelay):r.maxLoadingDelay;f=m-p,x.trace("[abr] bitrate test took "+Math.round(1e3*p)+"ms, set first fragment max fetchDuration to "+Math.round(1e3*f)+" ms"),g=v=1}}return d=this.findBestLevel(u,a,n,h+f,g,v),Math.max(d,0)},t.findBestLevel=function(e,t,i,n,r,a){for(var s,o=this.fragCurrent,l=this.partCurrent,u=this.lastLoadedFragLevel,c=this.hls.levels,h=c[u],d=!(null==h||null==(s=h.details)||!s.live),f=null==h?void 0:h.codecSet,g=l?l.duration:o?o.duration:0,v=this.bwEstimator.getEstimateTTFB()/1e3,p=t,m=-1,y=i;y>=t;y--){var b=c[y];if(!b||f&&b.codecSet!==f)b&&(p=Math.min(y,p),m=Math.max(y,m));else{-1!==m&&x.trace("[abr] Skipped level(s) "+p+"-"+m+' with CODECS:"'+c[m].attrs.CODECS+'"; not compatible with "'+h.attrs.CODECS+'"');var E=b.details,k=(l?null==E?void 0:E.partTarget:null==E?void 0:E.averagetargetduration)||g,S=void 0;S=y<=u?r*e:a*e;var _=c[y].maxBitrate,L=this.getTimeToLoadFrag(v,S,_*k,void 0===E);if(x.trace("[abr] level:"+y+" adjustedbw-bitrate:"+Math.round(S-_)+" avgDuration:"+k.toFixed(1)+" maxFetchDuration:"+n.toFixed(1)+" fetchDuration:"+L.toFixed(1)),S>_&&(0===L||!T(L)||d&&!this.bitrateTestDelay||L<n))return y}}return-1},a(e,[{key:"nextAutoLevel",get:function(){var e=this._nextAutoLevel,t=this.bwEstimator;if(-1!==e&&!t.canEstimate())return e;var i=this.getNextABRAutoLevel();if(-1!==e){var n=this.hls.levels;if(n.length>Math.max(e,i)&&n[e].loadError<=n[i].loadError)return e}return-1!==e&&(i=Math.min(e,i)),i},set:function(e){this._nextAutoLevel=e}}]),e}(),Cr=function(){function e(e){this.buffers=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.buffers=e}var t=e.prototype;return t.append=function(e,t){var i=this.queues[t];i.push(e),1===i.length&&this.buffers[t]&&this.executeNext(t)},t.insertAbort=function(e,t){var i=this.queues[t];i.unshift(e),this.executeNext(t)},t.appendBlocker=function(e){var t,i=new Promise((function(e){t=e})),n={execute:t,onStart:function(){},onComplete:function(){},onError:function(){}};return this.append(n,e),i},t.executeNext=function(e){var t=this.buffers,i=this.queues,n=t[e],r=i[e];if(r.length){var a=r[0];try{a.execute()}catch(s){x.warn("[buffer-operation-queue]: Unhandled exception executing the current operation"),a.onError(s),null!=n&&n.updating||(r.shift(),this.executeNext(e))}}},t.shiftAndExecuteNext=function(e){this.queues[e].shift(),this.executeNext(e)},t.current=function(e){return this.queues[e][0]},e}(),Or=Ue(),Rr=/([ha]vc.)(?:\.[^.,]+)+/,wr=function(){function e(e){var t=this;this.details=null,this._objectUrl=null,this.operationQueue=void 0,this.listeners=void 0,this.hls=void 0,this.bufferCodecEventsExpected=0,this._bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.appendError=0,this.tracks={},this.pendingTracks={},this.sourceBuffer=void 0,this._onMediaSourceOpen=function(){var e=t.media,i=t.mediaSource;x.log("[buffer-controller]: Media source opened"),e&&(e.removeEventListener("emptied",t._onMediaEmptied),t.updateMediaElementDuration(),t.hls.trigger(k.MEDIA_ATTACHED,{media:e})),i&&i.removeEventListener("sourceopen",t._onMediaSourceOpen),t.checkPendingTracks()},this._onMediaSourceClose=function(){x.log("[buffer-controller]: Media source closed")},this._onMediaSourceEnded=function(){x.log("[buffer-controller]: Media source ended")},this._onMediaEmptied=function(){var e=t.media,i=t._objectUrl;e&&e.src!==i&&x.error("Media element src was set while attaching MediaSource ("+i+" > "+e.src+")")},this.hls=e,this._initSourceBuffer(),this.registerListeners()}var t=e.prototype;return t.hasSourceTypes=function(){return this.getSourceBufferTypes().length>0||Object.keys(this.pendingTracks).length>0},t.destroy=function(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=null},t.registerListeners=function(){var e=this.hls;e.on(k.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(k.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(k.MANIFEST_LOADING,this.onManifestLoading,this),e.on(k.MANIFEST_PARSED,this.onManifestParsed,this),e.on(k.BUFFER_RESET,this.onBufferReset,this),e.on(k.BUFFER_APPENDING,this.onBufferAppending,this),e.on(k.BUFFER_CODECS,this.onBufferCodecs,this),e.on(k.BUFFER_EOS,this.onBufferEos,this),e.on(k.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(k.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(k.FRAG_PARSED,this.onFragParsed,this),e.on(k.FRAG_CHANGED,this.onFragChanged,this)},t.unregisterListeners=function(){var e=this.hls;e.off(k.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(k.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(k.MANIFEST_LOADING,this.onManifestLoading,this),e.off(k.MANIFEST_PARSED,this.onManifestParsed,this),e.off(k.BUFFER_RESET,this.onBufferReset,this),e.off(k.BUFFER_APPENDING,this.onBufferAppending,this),e.off(k.BUFFER_CODECS,this.onBufferCodecs,this),e.off(k.BUFFER_EOS,this.onBufferEos,this),e.off(k.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(k.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(k.FRAG_PARSED,this.onFragParsed,this),e.off(k.FRAG_CHANGED,this.onFragChanged,this)},t._initSourceBuffer=function(){this.sourceBuffer={},this.operationQueue=new Cr(this.sourceBuffer),this.listeners={audio:[],video:[],audiovideo:[]},this.lastMpegAudioChunk=null},t.onManifestLoading=function(){this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=0,this.details=null},t.onManifestParsed=function(e,t){var i=2;t.audio&&!t.video||t.altAudio,i=1,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal=i,x.log(this.bufferCodecEventsExpected+" bufferCodec event(s) expected")},t.onMediaAttaching=function(e,t){var i=this.media=t.media;if(i&&Or){var n=this.mediaSource=new Or;n.addEventListener("sourceopen",this._onMediaSourceOpen),n.addEventListener("sourceended",this._onMediaSourceEnded),n.addEventListener("sourceclose",this._onMediaSourceClose),i.src=self.URL.createObjectURL(n),this._objectUrl=i.src,i.addEventListener("emptied",this._onMediaEmptied)}},t.onMediaDetaching=function(){var e=this.media,t=this.mediaSource,i=this._objectUrl;if(t){if(x.log("[buffer-controller]: media source detaching"),"open"===t.readyState)try{t.endOfStream()}catch(Jr){x.warn("[buffer-controller]: onMediaDetaching: "+Jr.message+" while calling endOfStream")}this.onBufferReset(),t.removeEventListener("sourceopen",this._onMediaSourceOpen),t.removeEventListener("sourceended",this._onMediaSourceEnded),t.removeEventListener("sourceclose",this._onMediaSourceClose),e&&(e.removeEventListener("emptied",this._onMediaEmptied),i&&self.URL.revokeObjectURL(i),e.src===i?(e.removeAttribute("src"),e.load()):x.warn("[buffer-controller]: media.src was changed by a third party - skip cleanup")),this.mediaSource=null,this.media=null,this._objectUrl=null,this.bufferCodecEventsExpected=this._bufferCodecEventsTotal,this.pendingTracks={},this.tracks={}}this.hls.trigger(k.MEDIA_DETACHED,void 0)},t.onBufferReset=function(){var e=this;this.getSourceBufferTypes().forEach((function(t){var i=e.sourceBuffer[t];try{i&&(e.removeBufferListeners(t),e.mediaSource&&e.mediaSource.removeSourceBuffer(i),e.sourceBuffer[t]=void 0)}catch(Jr){x.warn("[buffer-controller]: Failed to reset the "+t+" buffer",Jr)}})),this._initSourceBuffer()},t.onBufferCodecs=function(e,t){var i=this,n=this.getSourceBufferTypes().length;Object.keys(t).forEach((function(e){if(n){var r=i.tracks[e];if(r&&"function"===typeof r.buffer.changeType){var a=t[e],s=a.id,o=a.codec,l=a.levelCodec,u=a.container,c=a.metadata,h=(r.levelCodec||r.codec).replace(Rr,"$1"),d=(l||o).replace(Rr,"$1");if(h!==d){var f=u+";codecs="+(l||o);i.appendChangeType(e,f),x.log("[buffer-controller]: switching codec "+h+" to "+d),i.tracks[e]={buffer:r.buffer,codec:o,container:u,levelCodec:l,metadata:c,id:s}}}}else i.pendingTracks[e]=t[e]})),n||(this.bufferCodecEventsExpected=Math.max(this.bufferCodecEventsExpected-1,0),this.mediaSource&&"open"===this.mediaSource.readyState&&this.checkPendingTracks())},t.appendChangeType=function(e,t){var i=this,n=this.operationQueue,r={execute:function(){var r=i.sourceBuffer[e];r&&(x.log("[buffer-controller]: changing "+e+" sourceBuffer type to "+t),r.changeType(t)),n.shiftAndExecuteNext(e)},onStart:function(){},onComplete:function(){},onError:function(t){x.warn("[buffer-controller]: Failed to change "+e+" SourceBuffer type",t)}};n.append(r,e)},t.onBufferAppending=function(e,t){var i=this,n=this.hls,r=this.operationQueue,a=this.tracks,s=t.data,o=t.type,l=t.frag,u=t.part,c=t.chunkMeta,h=c.buffering[o],d=self.performance.now();h.start=d;var f=l.stats.buffering,g=u?u.stats.buffering:null;0===f.start&&(f.start=d),g&&0===g.start&&(g.start=d);var v=a.audio,p=!1;"audio"===o&&"audio/mpeg"===(null==v?void 0:v.container)&&(p=!this.lastMpegAudioChunk||1===c.id||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);var m=l.start,y={execute:function(){if(h.executeStart=self.performance.now(),p){var e=i.sourceBuffer[o];if(e){var t=m-e.timestampOffset;Math.abs(t)>=.1&&(x.log("[buffer-controller]: Updating audio SourceBuffer timestampOffset to "+m+" (delta: "+t+") sn: "+l.sn+")"),e.timestampOffset=m)}}i.appendExecutor(s,o)},onStart:function(){},onComplete:function(){var e=self.performance.now();h.executeEnd=h.end=e,0===f.first&&(f.first=e),g&&0===g.first&&(g.first=e);var t=i.sourceBuffer,n={};for(var r in t)n[r]=bi.getBuffered(t[r]);i.appendError=0,i.hls.trigger(k.BUFFER_APPENDED,{type:o,frag:l,part:u,chunkMeta:c,parent:l.type,timeRanges:n})},onError:function(e){x.error("[buffer-controller]: Error encountered while trying to append to the "+o+" SourceBuffer",e);var t={type:S.MEDIA_ERROR,parent:l.type,details:_.BUFFER_APPEND_ERROR,frag:l,part:u,chunkMeta:c,error:e,err:e,fatal:!1};e.code===DOMException.QUOTA_EXCEEDED_ERR?t.details=_.BUFFER_FULL_ERROR:(i.appendError++,t.details=_.BUFFER_APPEND_ERROR,i.appendError>n.config.appendErrorMaxRetry&&(x.error("[buffer-controller]: Failed "+n.config.appendErrorMaxRetry+" times to append segment in sourceBuffer"),t.fatal=!0)),n.trigger(k.ERROR,t)}};r.append(y,o)},t.onBufferFlushing=function(e,t){var i=this,n=this.operationQueue,r=function(e){return{execute:i.removeExecutor.bind(i,e,t.startOffset,t.endOffset),onStart:function(){},onComplete:function(){i.hls.trigger(k.BUFFER_FLUSHED,{type:e})},onError:function(t){x.warn("[buffer-controller]: Failed to remove from "+e+" SourceBuffer",t)}}};t.type?n.append(r(t.type),t.type):this.getSourceBufferTypes().forEach((function(e){n.append(r(e),e)}))},t.onFragParsed=function(e,t){var i=this,n=t.frag,r=t.part,a=[],s=r?r.elementaryStreams:n.elementaryStreams;s[U.AUDIOVIDEO]?a.push("audiovideo"):(s[U.AUDIO]&&a.push("audio"),s[U.VIDEO]&&a.push("video"));var o=function(){var e=self.performance.now();n.stats.buffering.end=e,r&&(r.stats.buffering.end=e);var t=r?r.stats:n.stats;i.hls.trigger(k.FRAG_BUFFERED,{frag:n,part:r,stats:t,id:n.type})};0===a.length&&x.warn("Fragments must have at least one ElementaryStreamType set. type: "+n.type+" level: "+n.level+" sn: "+n.sn),this.blockBuffers(o,a)},t.onFragChanged=function(e,t){this.flushBackBuffer()},t.onBufferEos=function(e,t){var i=this,n=this.getSourceBufferTypes().reduce((function(e,n){var r=i.sourceBuffer[n];return!r||t.type&&t.type!==n||(r.ending=!0,r.ended||(r.ended=!0,x.log("[buffer-controller]: "+n+" sourceBuffer now EOS"))),e&&!(r&&!r.ended)}),!0);n&&(x.log("[buffer-controller]: Queueing mediaSource.endOfStream()"),this.blockBuffers((function(){i.getSourceBufferTypes().forEach((function(e){var t=i.sourceBuffer[e];t&&(t.ending=!1)}));var e=i.mediaSource;e&&"open"===e.readyState?(x.log("[buffer-controller]: Calling mediaSource.endOfStream()"),e.endOfStream()):e&&x.info("[buffer-controller]: Could not call mediaSource.endOfStream(). mediaSource.readyState: "+e.readyState)})))},t.onLevelUpdated=function(e,t){var i=t.details;i.fragments.length&&(this.details=i,this.getSourceBufferTypes().length?this.blockBuffers(this.updateMediaElementDuration.bind(this)):this.updateMediaElementDuration())},t.flushBackBuffer=function(){var e=this.hls,t=this.details,i=this.media,n=this.sourceBuffer;if(i&&null!==t){var r=this.getSourceBufferTypes();if(r.length){var a=t.live&&null!==e.config.liveBackBufferLength?e.config.liveBackBufferLength:e.config.backBufferLength;if(T(a)&&!(a<0)){var s=i.currentTime,o=t.levelTargetDuration,l=Math.max(a,o),u=Math.floor(s/o)*o-l;r.forEach((function(i){var r=n[i];if(r){var a=bi.getBuffered(r);if(a.length>0&&u>a.start(0)){if(e.trigger(k.BACK_BUFFER_REACHED,{bufferEnd:u}),t.live)e.trigger(k.LIVE_BACK_BUFFER_REACHED,{bufferEnd:u});else if(r.ended&&a.end(a.length-1)-s<2*o)return void x.info("[buffer-controller]: Cannot flush "+i+" back buffer while SourceBuffer is in ended state");e.trigger(k.BUFFER_FLUSHING,{startOffset:0,endOffset:u,type:i})}}}))}}}},t.updateMediaElementDuration=function(){if(this.details&&this.media&&this.mediaSource&&"open"===this.mediaSource.readyState){var e=this.details,t=this.hls,i=this.media,n=this.mediaSource,r=e.fragments[0].start+e.totalduration,a=i.duration,s=T(n.duration)?n.duration:0;e.live&&t.config.liveDurationInfinity?(x.log("[buffer-controller]: Media Source duration is set to Infinity"),n.duration=1/0,this.updateSeekableRange(e)):(r>s&&r>a||!T(a))&&(x.log("[buffer-controller]: Updating Media Source duration to "+r.toFixed(3)),n.duration=r)}},t.updateSeekableRange=function(e){var t=this.mediaSource,i=e.fragments,n=i.length;if(n&&e.live&&null!=t&&t.setLiveSeekableRange){var r=Math.max(0,i[0].start),a=Math.max(r,r+e.totalduration);t.setLiveSeekableRange(r,a)}},t.checkPendingTracks=function(){var e=this.bufferCodecEventsExpected,t=this.operationQueue,i=this.pendingTracks,n=Object.keys(i).length;if(n&&!e||2===n){this.createSourceBuffers(i),this.pendingTracks={};var r=this.getSourceBufferTypes();if(r.length)this.hls.trigger(k.BUFFER_CREATED,{tracks:this.tracks}),r.forEach((function(e){t.executeNext(e)}));else{var a=new Error("could not create source buffer for media codec(s)");this.hls.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:a,reason:a.message})}}},t.createSourceBuffers=function(e){var t=this.sourceBuffer,i=this.mediaSource;if(!i)throw Error("createSourceBuffers called when mediaSource was null");for(var n in e)if(!t[n]){var r=e[n];if(!r)throw Error("source buffer exists for track "+n+", however track does not");var a=r.levelCodec||r.codec,s=r.container+";codecs="+a;x.log("[buffer-controller]: creating sourceBuffer("+s+")");try{var o=t[n]=i.addSourceBuffer(s),l=n;this.addBufferListener(l,"updatestart",this._onSBUpdateStart),this.addBufferListener(l,"updateend",this._onSBUpdateEnd),this.addBufferListener(l,"error",this._onSBUpdateError),this.tracks[n]={buffer:o,codec:a,container:r.container,levelCodec:r.levelCodec,metadata:r.metadata,id:r.id}}catch(Jr){x.error("[buffer-controller]: error while trying to add sourceBuffer: "+Jr.message),this.hls.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:Jr,mimeType:s})}}},t._onSBUpdateStart=function(e){var t=this.operationQueue,i=t.current(e);i.onStart()},t._onSBUpdateEnd=function(e){var t=this.operationQueue,i=t.current(e);i.onComplete(),t.shiftAndExecuteNext(e)},t._onSBUpdateError=function(e,t){var i=new Error(e+" SourceBuffer error");x.error("[buffer-controller]: "+i,t),this.hls.trigger(k.ERROR,{type:S.MEDIA_ERROR,details:_.BUFFER_APPENDING_ERROR,error:i,fatal:!1});var n=this.operationQueue.current(e);n&&n.onError(t)},t.removeExecutor=function(e,t,i){var n=this.media,r=this.mediaSource,a=this.operationQueue,s=this.sourceBuffer,o=s[e];if(!n||!r||!o)return x.warn("[buffer-controller]: Attempting to remove from the "+e+" SourceBuffer, but it does not exist"),void a.shiftAndExecuteNext(e);var l=T(n.duration)?n.duration:1/0,u=T(r.duration)?r.duration:1/0,c=Math.max(0,t),h=Math.min(i,l,u);h>c&&!o.ending?(o.ended=!1,x.log("[buffer-controller]: Removing ["+c+","+h+"] from the "+e+" SourceBuffer"),o.remove(c,h)):a.shiftAndExecuteNext(e)},t.appendExecutor=function(e,t){var i=this.operationQueue,n=this.sourceBuffer,r=n[t];if(!r)return x.warn("[buffer-controller]: Attempting to append to the "+t+" SourceBuffer, but it does not exist"),void i.shiftAndExecuteNext(t);r.ended=!1,r.appendBuffer(e)},t.blockBuffers=function(e,t){var i=this;if(void 0===t&&(t=this.getSourceBufferTypes()),!t.length)return x.log("[buffer-controller]: Blocking operation requested, but no SourceBuffers exist"),void Promise.resolve().then(e);var n=this.operationQueue,r=t.map((function(e){return n.appendBlocker(e)}));Promise.all(r).then((function(){e(),t.forEach((function(e){var t=i.sourceBuffer[e];null!=t&&t.updating||n.shiftAndExecuteNext(e)}))}))},t.getSourceBufferTypes=function(){return Object.keys(this.sourceBuffer)},t.addBufferListener=function(e,t,i){var n=this.sourceBuffer[e];if(n){var r=i.bind(this,e);this.listeners[e].push({event:t,listener:r}),n.addEventListener(t,r)}},t.removeBufferListeners=function(e){var t=this.sourceBuffer[e];t&&this.listeners[e].forEach((function(e){t.removeEventListener(e.event,e.listener)}))},e}(),xr=function(){function e(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.destroy=function(){this.unregisterListener(),this.hls.config.capLevelToPlayerSize&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null},t.registerListeners=function(){var e=this.hls;e.on(k.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(k.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(k.MANIFEST_PARSED,this.onManifestParsed,this),e.on(k.BUFFER_CODECS,this.onBufferCodecs,this),e.on(k.MEDIA_DETACHING,this.onMediaDetaching,this)},t.unregisterListener=function(){var e=this.hls;e.off(k.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(k.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(k.MANIFEST_PARSED,this.onManifestParsed,this),e.off(k.BUFFER_CODECS,this.onBufferCodecs,this),e.off(k.MEDIA_DETACHING,this.onMediaDetaching,this)},t.onFpsDropLevelCapping=function(e,t){var i=this.hls.levels[t.droppedLevel];this.isLevelAllowed(i)&&this.restrictedLevels.push({bitrate:i.bitrate,height:i.height,width:i.width})},t.onMediaAttaching=function(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null},t.onManifestParsed=function(e,t){var i=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onBufferCodecs=function(e,t){var i=this.hls;i.config.capLevelToPlayerSize&&t.video&&this.startCapping()},t.onMediaDetaching=function(){this.stopCapping()},t.detectPlayerSize=function(){if(this.media&&this.mediaHeight>0&&this.mediaWidth>0){var e=this.hls.levels;if(e.length){var t=this.hls;t.autoLevelCapping=this.getMaxLevel(e.length-1),t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}},t.getMaxLevel=function(t){var i=this,n=this.hls.levels;if(!n.length)return-1;var r=n.filter((function(e,n){return i.isLevelAllowed(e)&&n<=t}));return this.clientRect=null,e.getMaxLevelByMediaSize(r,this.mediaWidth,this.mediaHeight)},t.startCapping=function(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,this.hls.firstLevel=this.getMaxLevel(this.firstLevel),self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())},t.stopCapping=function(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)},t.getDimensions=function(){if(this.clientRect)return this.clientRect;var e=this.media,t={width:0,height:0};if(e){var i=e.getBoundingClientRect();t.width=i.width,t.height=i.height,t.width||t.height||(t.width=i.right-i.left||e.width||0,t.height=i.bottom-i.top||e.height||0)}return this.clientRect=t,t},t.isLevelAllowed=function(e){var t=this.restrictedLevels;return!t.some((function(t){return e.bitrate===t.bitrate&&e.width===t.width&&e.height===t.height}))},e.getMaxLevelByMediaSize=function(e,t,i){if(null==e||!e.length)return-1;for(var n=function(e,t){return!t||(e.width!==t.width||e.height!==t.height)},r=e.length-1,a=0;a<e.length;a+=1){var s=e[a];if((s.width>=t||s.height>=i)&&n(s,e[a+1])){r=a;break}}return r},a(e,[{key:"mediaWidth",get:function(){return this.getDimensions().width*this.contentScaleFactor}},{key:"mediaHeight",get:function(){return this.getDimensions().height*this.contentScaleFactor}},{key:"contentScaleFactor",get:function(){var e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch(t){}return e}}]),e}(),Ir=function(){function e(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}var t=e.prototype;return t.setStreamController=function(e){this.streamController=e},t.registerListeners=function(){this.hls.on(k.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.unregisterListeners=function(){this.hls.off(k.MEDIA_ATTACHING,this.onMediaAttaching,this)},t.destroy=function(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null},t.onMediaAttaching=function(e,t){var i=this.hls.config;if(i.capLevelOnFPSDrop){var n=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=n,n&&"function"===typeof n.getVideoPlaybackQuality&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),i.fpsDroppedMonitoringPeriod)}},t.checkFPS=function(e,t,i){var n=performance.now();if(t){if(this.lastTime){var r=n-this.lastTime,a=i-this.lastDroppedFrames,s=t-this.lastDecodedFrames,o=1e3*a/r,l=this.hls;if(l.trigger(k.FPS_DROP,{currentDropped:a,currentDecoded:s,totalDroppedFrames:i}),o>0&&a>l.config.fpsDroppedMonitoringThreshold*s){var u=l.currentLevel;x.warn("drop FPS ratio greater than max allowed value for currentLevel: "+u),u>0&&(-1===l.autoLevelCapping||l.autoLevelCapping>=u)&&(u-=1,l.trigger(k.FPS_DROP_LEVEL_CAPPING,{level:u,droppedLevel:l.currentLevel}),l.autoLevelCapping=u,this.streamController.nextLevelSwitch())}}this.lastTime=n,this.lastDroppedFrames=i,this.lastDecodedFrames=t}},t.checkFPSInterval=function(){var e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){var t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)},e}(),Dr=/^age:\s*[\d.]+\s*$/im,Pr=function(){function e(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=void 0,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new j,this.retryDelay=0}var t=e.prototype;return t.destroy=function(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null},t.abortInternal=function(){var e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,4!==e.readyState&&(this.stats.aborted=!0,e.abort()))},t.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)},t.load=function(e,t,i){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=i,this.loadInternal()},t.loadInternal=function(){var e=this,t=this.config,i=this.context;if(t){var n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;var a=this.xhrSetup;a?Promise.resolve().then((function(){if(!e.stats.aborted)return a(n,i.url)})).catch((function(e){return n.open("GET",i.url,!0),a(n,i.url)})).then((function(){e.stats.aborted||e.openAndSendXhr(n,i,t)})).catch((function(t){e.callbacks.onError({code:n.status,text:t.message},i,n,r)})):this.openAndSendXhr(n,i,t)}},t.openAndSendXhr=function(e,t,i){e.readyState||e.open("GET",t.url,!0);var n=this.context.headers,r=i.loadPolicy,a=r.maxTimeToFirstByteMs,s=r.maxLoadTimeMs;if(n)for(var o in n)e.setRequestHeader(o,n[o]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),i.timeout=a&&T(a)?a:s,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),i.timeout),e.send()},t.readystatechange=function(){var e=this.context,t=this.loader,i=this.stats;if(e&&t){var n=t.readyState,r=this.config;if(!i.aborted&&n>=2&&(0===i.loading.first&&(i.loading.first=Math.max(self.performance.now(),i.loading.start),r.timeout!==r.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),r.timeout=r.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),r.loadPolicy.maxLoadTimeMs-(i.loading.first-i.loading.start)))),4===n)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;var a=t.status,s="text"!==t.responseType;if(a>=200&&a<300&&(s&&t.response||null!==t.responseText)){i.loading.end=Math.max(self.performance.now(),i.loading.first);var o=s?t.response:t.responseText,l="arraybuffer"===t.responseType?o.byteLength:o.length;if(i.loaded=i.total=l,i.bwEstimate=8e3*i.total/(i.loading.end-i.loading.first),!this.callbacks)return;var u=this.callbacks.onProgress;if(u&&u(i,e,o,t),!this.callbacks)return;var c={url:t.responseURL,data:o,code:a};this.callbacks.onSuccess(c,i,e,t)}else{var h=r.loadPolicy.errorRetry,d=i.retry;Vt(h,d,!1,a)?this.retry(h):(x.error(a+" while loading "+e.url),this.callbacks.onError({code:a,text:t.statusText},e,t,i))}}}},t.loadtimeout=function(){var e,t=null==(e=this.config)?void 0:e.loadPolicy.timeoutRetry,i=this.stats.retry;if(Vt(t,i,!0))this.retry(t);else{x.warn("timeout while loading "+this.context.url);var n=this.callbacks;n&&(this.abortInternal(),n.onTimeout(this.stats,this.context,this.loader))}},t.retry=function(e){var t=this.context,i=this.stats;this.retryDelay=Gt(e,i.retry),i.retry++,x.warn((status?"HTTP Status "+status:"Timeout")+" while loading "+t.url+", retrying "+i.retry+"/"+e.maxNumRetry+" in "+this.retryDelay+"ms"),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)},t.loadprogress=function(e){var t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)},t.getCacheAge=function(){var e=null;if(this.loader&&Dr.test(this.loader.getAllResponseHeaders())){var t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e},t.getResponseHeader=function(e){return this.loader&&new RegExp("^"+e+":\\s*[\\d.]+\\s*$","im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null},e}(),Nr=function(){function e(){this.chunks=[],this.dataLength=0}var t=e.prototype;return t.push=function(e){this.chunks.push(e),this.dataLength+=e.length},t.flush=function(){var e,t=this.chunks,i=this.dataLength;return t.length?(e=1===t.length?t[0]:Mr(t,i),this.reset(),e):new Uint8Array(0)},t.reset=function(){this.chunks.length=0,this.dataLength=0},e}();function Mr(e,t){for(var i=new Uint8Array(t),n=0,r=0;r<e.length;r++){var a=e[r];i.set(a,n),n+=a.length}return i}function Fr(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch(e){}return!1}var jr=/(\d+)-(\d+)\/(\d+)/,Ur=function(){function e(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=void 0,this.response=void 0,this.controller=void 0,this.context=void 0,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||Vr,this.controller=new self.AbortController,this.stats=new j}var t=e.prototype;return t.destroy=function(){this.loader=this.callbacks=null,this.abortInternal()},t.abortInternal=function(){var e=this.response;null!=e&&e.ok||(this.stats.aborted=!0,this.controller.abort())},t.abort=function(){var e;this.abortInternal(),null!=(e=this.callbacks)&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)},t.load=function(e,t,i){var n=this,r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();var a=Br(e,this.controller.signal),s=i.onProgress,o="arraybuffer"===e.responseType,l=o?"byteLength":"length",u=t.loadPolicy,c=u.maxTimeToFirstByteMs,h=u.maxLoadTimeMs;this.context=e,this.config=t,this.callbacks=i,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=c&&T(c)?c:h,this.requestTimeout=self.setTimeout((function(){n.abortInternal(),i.onTimeout(r,e,n.response)}),t.timeout),self.fetch(this.request).then((function(a){n.response=n.loader=a;var l=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(n.requestTimeout),t.timeout=h,n.requestTimeout=self.setTimeout((function(){n.abortInternal(),i.onTimeout(r,e,n.response)}),h-(l-r.loading.start)),!a.ok){var u=a.status,c=a.statusText;throw new Kr(c||"fetch, bad network response",u,a)}return r.loading.first=l,r.total=Hr(a.headers)||r.total,s&&T(t.highWaterMark)?n.loadProgressively(a,r,e,t.highWaterMark,s):o?a.arrayBuffer():"json"===e.responseType?a.json():a.text()})).then((function(a){var o=n.response;self.clearTimeout(n.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);var u=a[l];u&&(r.loaded=r.total=u);var c={url:o.url,data:a,code:o.status};s&&!T(t.highWaterMark)&&s(r,e,a,o),i.onSuccess(c,r,e,o)})).catch((function(t){if(self.clearTimeout(n.requestTimeout),!r.aborted){var a=t&&t.code||0,s=t?t.message:null;i.onError({code:a,text:s},e,t?t.details:null,r)}}))},t.getCacheAge=function(){var e=null;if(this.response){var t=this.response.headers.get("age");e=t?parseFloat(t):null}return e},t.getResponseHeader=function(e){return this.response?this.response.headers.get(e):null},t.loadProgressively=function(e,t,i,n,r){void 0===n&&(n=0);var a=new Nr,s=e.body.getReader(),o=function o(){return s.read().then((function(s){if(s.done)return a.dataLength&&r(t,i,a.flush(),e),Promise.resolve(new ArrayBuffer(0));var l=s.value,u=l.length;return t.loaded+=u,u<n||a.dataLength?(a.push(l),a.dataLength>=n&&r(t,i,a.flush(),e)):r(t,i,l,e),o()})).catch((function(){return Promise.reject()}))};return o()},e}();function Br(e,t){var i={method:"GET",mode:"cors",credentials:"same-origin",signal:t,headers:new self.Headers(o({},e.headers))};return e.rangeEnd&&i.headers.set("Range","bytes="+e.rangeStart+"-"+String(e.rangeEnd-1)),i}function Gr(e){var t=jr.exec(e);if(t)return parseInt(t[2])-parseInt(t[1])+1}function Hr(e){var t=e.get("Content-Range");if(t){var i=Gr(t);if(T(i))return i}var n=e.get("Content-Length");if(n)return parseInt(n)}function Vr(e,t){return new self.Request(e.url,t)}var Kr=function(e){function t(t,i,n){var r;return r=e.call(this,t)||this,r.code=void 0,r.details=void 0,r.code=i,r.details=n,r}return l(t,e),t}(g(Error)),Wr={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},Yr=n(n({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,maxBufferSize:6e7,maxBufferHole:.1,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,maxFragLookUpTolerance:.25,liveSyncDurationCount:3,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,loader:Pr,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:Ar,bufferController:wr,capLevelController:xr,errorController:ei,fpsController:Ir,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:null,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableID3MetadataCues:!0,certLoadPolicy:{default:Wr},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:Wr},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},zr()),{},{subtitleStreamController:void 0,subtitleTrackController:void 0,timelineController:void 0,audioStreamController:void 0,audioTrackController:void 0,emeController:void 0,cmcdController:void 0,contentSteeringController:void 0});function zr(){return{cueHandler:Y,enableWebVTT:!1,enableIMSC1:!1,enableCEA708Captions:!1,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function Xr(e,t){if((t.liveSyncDurationCount||t.liveMaxLatencyDurationCount)&&(t.liveSyncDuration||t.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(void 0!==t.liveMaxLatencyDurationCount&&(void 0===t.liveSyncDurationCount||t.liveMaxLatencyDurationCount<=t.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(void 0!==t.liveMaxLatencyDuration&&(void 0===t.liveSyncDuration||t.liveMaxLatencyDuration<=t.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');var i=qr(e),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach((function(e){var n=("level"===e?"playlist":e)+"LoadPolicy",r=void 0===t[n],s=[];a.forEach((function(a){var o=e+"Loading"+a,l=t[o];if(void 0!==l&&r){s.push(o);var u=i[n].default;switch(t[n]={default:u},a){case"TimeOut":u.maxLoadTimeMs=l,u.maxTimeToFirstByteMs=l;break;case"MaxRetry":u.errorRetry.maxNumRetry=l,u.timeoutRetry.maxNumRetry=l;break;case"RetryDelay":u.errorRetry.retryDelayMs=l,u.timeoutRetry.retryDelayMs=l;break;case"MaxRetryTimeout":u.errorRetry.maxRetryDelayMs=l,u.timeoutRetry.maxRetryDelayMs=l;break}}})),s.length&&x.warn('hls.js config: "'+s.join('", "')+'" setting(s) are deprecated, use "'+n+'": '+JSON.stringify(t[n]))})),n(n({},i),t)}function qr(e){return e&&"object"===typeof e?Array.isArray(e)?e.map(qr):Object.keys(e).reduce((function(t,i){return t[i]=qr(e[i]),t}),{}):e}function Zr(e){var t=e.loader;if(t!==Ur&&t!==Pr)x.log("[config]: Custom loader detected, cannot enable progressive streaming"),e.progressive=!1;else{var i=Fr();i&&(e.loader=Ur,e.progressive=!0,e.enableSoftwareAES=!0,x.log("[config]: Progressive streaming enabled, using FetchLoader"))}}var Qr=function(){function e(t){void 0===t&&(t={}),this.config=void 0,this.userConfig=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new sr,this._autoLevelCapping=void 0,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this.url=null,w(t.debug||!1,"Hls instance");var i=this.config=Xr(e.DefaultConfig,t);this.userConfig=t,this._autoLevelCapping=-1,i.progressive&&Zr(i);var n=i.abrController,r=i.bufferController,a=i.capLevelController,s=i.errorController,o=i.fpsController,l=new s(this),u=this.abrController=new n(this),c=this.bufferController=new r(this),h=this.capLevelController=new a(this),d=new o(this),f=new lt(this),g=new Et(this),v=i.contentSteeringController,p=v?new v(this):null,m=this.levelController=new ri(this,p),y=new li(this),b=new pi(this.config),E=this.streamController=new Sr(this,y,b);h.setStreamController(E),d.setStreamController(E);var T=[f,m,E];p&&T.splice(1,0,p),this.networkControllers=T;var S=[u,c,h,d,g,y];this.audioTrackController=this.createController(i.audioTrackController,T);var _=i.audioStreamController;_&&T.push(new _(this,y,b)),this.subtitleTrackController=this.createController(i.subtitleTrackController,T);var L=i.subtitleStreamController;L&&T.push(new L(this,y,b)),this.createController(i.timelineController,S),b.emeController=this.emeController=this.createController(i.emeController,S),this.cmcdController=this.createController(i.cmcdController,S),this.latencyController=this.createController(Tt,S),this.coreComponents=S,T.push(l);var A=l.onErrorOut;"function"===typeof A&&this.on(k.ERROR,A,l)}e.isSupported=function(){return Bi()};var t=e.prototype;return t.createController=function(e,t){if(e){var i=new e(this);return t&&t.push(i),i}return null},t.on=function(e,t,i){void 0===i&&(i=this),this._emitter.on(e,t,i)},t.once=function(e,t,i){void 0===i&&(i=this),this._emitter.once(e,t,i)},t.removeAllListeners=function(e){this._emitter.removeAllListeners(e)},t.off=function(e,t,i,n){void 0===i&&(i=this),this._emitter.off(e,t,i,n)},t.listeners=function(e){return this._emitter.listeners(e)},t.emit=function(e,t,i){return this._emitter.emit(e,t,i)},t.trigger=function(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(i){x.error("An internal error happened while handling event "+e+'. Error message: "'+i.message+'". Here is a stacktrace:',i),this.trigger(k.ERROR,{type:S.OTHER_ERROR,details:_.INTERNAL_EXCEPTION,fatal:!1,event:e,error:i})}return!1},t.listenerCount=function(e){return this._emitter.listenerCount(e)},t.destroy=function(){x.log("destroy"),this.trigger(k.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this.url=null,this.networkControllers.forEach((function(e){return e.destroy()})),this.networkControllers.length=0,this.coreComponents.forEach((function(e){return e.destroy()})),this.coreComponents.length=0;var e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null},t.attachMedia=function(e){x.log("attachMedia"),this._media=e,this.trigger(k.MEDIA_ATTACHING,{media:e})},t.detachMedia=function(){x.log("detachMedia"),this.trigger(k.MEDIA_DETACHING,void 0),this._media=null},t.loadSource=function(e){this.stopLoad();var t=this.media,i=this.url,n=this.url=E.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});x.log("loadSource:"+n),t&&i&&(i!==n||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(k.MANIFEST_LOADING,{url:e})},t.startLoad=function(e){void 0===e&&(e=-1),x.log("startLoad("+e+")"),this.networkControllers.forEach((function(t){t.startLoad(e)}))},t.stopLoad=function(){x.log("stopLoad"),this.networkControllers.forEach((function(e){e.stopLoad()}))},t.swapAudioCodec=function(){x.log("swapAudioCodec"),this.streamController.swapAudioCodec()},t.recoverMediaError=function(){x.log("recoverMediaError");var e=this._media;this.detachMedia(),e&&this.attachMedia(e)},t.removeLevel=function(e,t){void 0===t&&(t=0),this.levelController.removeLevel(e,t)},a(e,[{key:"levels",get:function(){var e=this.levelController.levels;return e||[]}},{key:"currentLevel",get:function(){return this.streamController.currentLevel},set:function(e){x.log("set currentLevel:"+e),this.loadLevel=e,this.abrController.clearTimer(),this.streamController.immediateLevelSwitch()}},{key:"nextLevel",get:function(){return this.streamController.nextLevel},set:function(e){x.log("set nextLevel:"+e),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}},{key:"loadLevel",get:function(){return this.levelController.level},set:function(e){x.log("set loadLevel:"+e),this.levelController.manualLevel=e}},{key:"nextLoadLevel",get:function(){return this.levelController.nextLoadLevel},set:function(e){this.levelController.nextLoadLevel=e}},{key:"firstLevel",get:function(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)},set:function(e){x.log("set firstLevel:"+e),this.levelController.firstLevel=e}},{key:"startLevel",get:function(){return this.levelController.startLevel},set:function(e){x.log("set startLevel:"+e),-1!==e&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}},{key:"capLevelToPlayerSize",get:function(){return this.config.capLevelToPlayerSize},set:function(e){var t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}},{key:"autoLevelCapping",get:function(){return this._autoLevelCapping},set:function(e){this._autoLevelCapping!==e&&(x.log("set autoLevelCapping:"+e),this._autoLevelCapping=e)}},{key:"bandwidthEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimate():NaN}},{key:"ttfbEstimate",get:function(){var e=this.abrController.bwEstimator;return e?e.getEstimateTTFB():NaN}},{key:"maxHdcpLevel",get:function(){return this._maxHdcpLevel},set:function(e){kt.indexOf(e)>-1&&(this._maxHdcpLevel=e)}},{key:"autoLevelEnabled",get:function(){return-1===this.levelController.manualLevel}},{key:"manualLevel",get:function(){return this.levelController.manualLevel}},{key:"minAutoLevel",get:function(){var e=this.levels,t=this.config.minAutoBitrate;if(!e)return 0;for(var i=e.length,n=0;n<i;n++)if(e[n].maxBitrate>=t)return n;return 0}},{key:"maxAutoLevel",get:function(){var e,t=this.levels,i=this.autoLevelCapping,n=this.maxHdcpLevel;if(e=-1===i&&t&&t.length?t.length-1:i,n)for(var r=e;r--;){var a=t[r].attrs["HDCP-LEVEL"];if(a&&a<=n)return r}return e}},{key:"nextAutoLevel",get:function(){return Math.min(Math.max(this.abrController.nextAutoLevel,this.minAutoLevel),this.maxAutoLevel)},set:function(e){this.abrController.nextAutoLevel=Math.max(this.minAutoLevel,e)}},{key:"playingDate",get:function(){return this.streamController.currentProgramDateTime}},{key:"mainForwardBufferInfo",get:function(){return this.streamController.getMainFwdBufferInfo()}},{key:"audioTracks",get:function(){var e=this.audioTrackController;return e?e.audioTracks:[]}},{key:"audioTrack",get:function(){var e=this.audioTrackController;return e?e.audioTrack:-1},set:function(e){var t=this.audioTrackController;t&&(t.audioTrack=e)}},{key:"subtitleTracks",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTracks:[]}},{key:"subtitleTrack",get:function(){var e=this.subtitleTrackController;return e?e.subtitleTrack:-1},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}},{key:"media",get:function(){return this._media}},{key:"subtitleDisplay",get:function(){var e=this.subtitleTrackController;return!!e&&e.subtitleDisplay},set:function(e){var t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}},{key:"lowLatencyMode",get:function(){return this.config.lowLatencyMode},set:function(e){this.config.lowLatencyMode=e}},{key:"liveSyncPosition",get:function(){return this.latencyController.liveSyncPosition}},{key:"latency",get:function(){return this.latencyController.latency}},{key:"maxLatency",get:function(){return this.latencyController.maxLatency}},{key:"targetLatency",get:function(){return this.latencyController.targetLatency}},{key:"drift",get:function(){return this.latencyController.drift}},{key:"forceStartLoad",get:function(){return this.streamController.forceStartLoad}}],[{key:"version",get:function(){return"1.4.7"}},{key:"Events",get:function(){return k}},{key:"ErrorTypes",get:function(){return S}},{key:"ErrorDetails",get:function(){return _}},{key:"DefaultConfig",get:function(){return e.defaultConfig?e.defaultConfig:Yr},set:function(t){e.defaultConfig=t}}]),e}();return Qr.defaultConfig=void 0,Qr}))})(!1)},"476e":function(e,t,i){"use strict";i.d(t,"a",(function(){return F}));var n=i("0210"),r=i("ba10"),a=i.n(r),s=i("9a98"),o=i("b857"),l=i("2bdd"),u=i("b28d");function c(e,t){this&&this.emit&&("error"===e?this.errorHandler(e,t.error):this.emit(e,t))}function h(e,t){return function(i,n){var r={player:t,eventName:e,originalEvent:i,detail:i.detail||{},timeStamp:i.timeStamp,currentTime:t.currentTime,duration:t.duration,paused:t.paused,ended:t.ended,isInternalOp:!!t._internalOp[i.type],muted:t.muted,volume:t.volume,host:s["b"].getHostFromUrl(t.currentSrc),vtype:t.vtype};if(t.removeInnerOP(i.type),"timeupdate"===e&&(t._currentTime=t.media&&t.media.currentTime),"ratechange"===e){var a=t.media?t.media.playbackRate:0;if(a&&t._rate===a)return;t._rate=t.media&&t.media.playbackRate}if("durationchange"===e&&(t._duration=t.media.duration),"volumechange"===e&&(r.isMutedChange=t._lastMuted!==t.muted,t._lastMuted=t.muted),"error"===e&&(r.error=n||t.video.error),t.mediaEventMiddleware[e]){var o=c.bind(t,e,r);try{t.mediaEventMiddleware[e].call(t,r,o)}catch(l){throw c.call(t,e,r),l}}else c.call(t,e,r)}}var d=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;Object(n["b"])(this,i),r=t.call(this,e),r._hasStart=!1,r._currentTime=0,r._duration=0,r._internalOp={},r._lastMuted=!1,r.vtype="MP4",r._rate=-1,r.mediaConfig=Object.assign({},{controls:!1,autoplay:e.autoplay,playsinline:e.playsinline,"x5-playsinline":e.playsinline,"webkit-playsinline":e.playsinline,"x5-video-player-fullscreen":e["x5-video-player-fullscreen"]||e.x5VideoPlayerFullscreen,"x5-video-orientation":e["x5-video-orientation"]||e.x5VideoOrientation,airplay:e.airplay,"webkit-airplay":e.airplay,tabindex:0|e.tabindex,mediaType:e.mediaType||"video"},e.videoConfig,e.videoAttributes);var a=e["x5-video-player-type"]||e.x5VideoPlayerType;return o["a"].isWeixin&&o["a"].os.isAndroid&&a&&(r.mediaConfig["x5-video-player-type"]=a,delete r.mediaConfig.playsinline,delete r.mediaConfig["webkit-playsinline"],delete r.mediaConfig["x5-playsinline"]),e.loop&&(r.mediaConfig.loop="loop"),r.media=s["b"].createDom(r.mediaConfig.mediaType,"",r.mediaConfig,""),e.defaultPlaybackRate&&(r.media.defaultPlaybackRate=r.media.playbackRate=e.defaultPlaybackRate),"Number"===s["b"].typeOf(e.volume)&&(r.volume=e.volume),e.autoplayMuted&&(r.media.muted=!0,r._lastMuted=!0),e.autoplay&&(r.media.autoplay=!0),r._interval={},r.mediaEventMiddleware={},r.attachVideoEvents(),r}return Object(n["c"])(i,[{key:"setEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(i){t.mediaEventMiddleware[i]=e[i]}))}},{key:"removeEventsMiddleware",value:function(e){var t=this;Object.keys(e).map((function(e){delete t.mediaEventMiddleware[e]}))}},{key:"attachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers||(this._evHandlers=u["VIDEO_EVENTS"].map((function(t){var i="on".concat(t.charAt(0).toUpperCase()).concat(t.slice(1));return"function"===typeof e[i]&&e.on(t,e[i]),Object(n["e"])({},t,h(t,e))}))),this._evHandlers.forEach((function(e){var i=Object.keys(e)[0];t.addEventListener(i,e[i],!1)}))}},{key:"detachVideoEvents",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.media;this._evHandlers.forEach((function(e){var i=Object.keys(e)[0];t.removeEventListener(i,e[i],!1)})),this._evHandlers.forEach((function(t){var i=Object.keys(t)[0],n="on".concat(i.charAt(0).toUpperCase()).concat(i.slice(1));"function"===typeof e[n]&&e.off(i,e[n])})),this._evHandlers=null}},{key:"_attachSourceEvents",value:function(e,t){var i=this;e.removeAttribute("src"),e.load(),t.forEach((function(e){i.media.appendChild(s["b"].createDom("source","",{src:"".concat(e.src),type:"".concat(e.type||"")}))}));var n=e.children;if(n){this._videoSourceCount=n.length;for(var r=null,a=0;a<this._evHandlers.length;a++)if("error"===Object.keys(this._evHandlers[a])[0]){r=this._evHandlers[a];break}!this._sourceError&&(this._sourceError=function(e){if(i._videoSourceCount--,0===i._videoSourceCount){var t={code:4,message:"sources load error"};r?r.error(e,t):i.errorHandler("error",t)}});for(var o=0;o<n.length;o++)n[o].addEventListener("error",this._sourceError)}}},{key:"_detachSourceEvents",value:function(e){var t=e.children;if(t&&0!==t.length&&this._sourceError){for(var i=0;i<t.length;i++)t[i].removeEventListener("error",this._sourceError);while(t.length>0)e.removeChild(t[0])}}},{key:"errorHandler",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(this.media&&(this.media.error||t)){var i=this.media.error||t,n=i.code?l["a"][i.code]:"other",r=i.message;this.media.currentSrc||(r="empty_src",i={code:6,message:r}),this.emit(e,new l["b"](this,{errorType:n,errorCode:i.code,errorMessage:i.message||"",mediaError:i}))}}},{key:"destroy",value:function(){for(var e in this.media&&(this.media.pause&&(this.media.pause(),this.media.muted=!0),this.media.removeAttribute("src"),this.media.load()),this._currentTime=0,this._duration=0,this.mediaConfig=null,this._interval)Object.prototype.hasOwnProperty.call(this._interval,e)&&(clearInterval(this._interval[e]),this._interval[e]=null);this.detachVideoEvents(),this.media=null,this.mediaEventMiddleware={},this.removeAllListeners()}},{key:"video",get:function(){return this.media},set:function(e){this.media=e}},{key:"play",value:function(){var e=this.media?this.media.play():null;return e}},{key:"pause",value:function(){this.media&&this.media.pause()}},{key:"load",value:function(){this.media&&this.media.load()}},{key:"canPlayType",value:function(e){return!!this.media&&this.media.canPlayType(e)}},{key:"getBufferedRange",value:function(e){var t=[0,0];if(!this.media)return t;e||(e=this.media.buffered);var i=this.media.currentTime;if(e)for(var n=0,r=e.length;n<r;n++)if(t[0]=e.start(n),t[1]=e.end(n),t[0]<=i&&i<=t[1])break;return t[0]-i<=0&&i-t[1]<=0?t:[0,0]}},{key:"autoplay",get:function(){return!!this.media&&this.media.autoplay},set:function(e){this.media&&(this.media.autoplay=e)}},{key:"buffered",get:function(){return this.media?this.media.buffered:null}},{key:"buffered2",get:function(){return this.media&&this.media.buffered?s["b"].getBuffered2(this.media.buffered):null}},{key:"bufferedPoint",get:function(){var e={start:0,end:0};if(!this.media)return e;var t=this.media.buffered;if(!t||0===t.length)return e;for(var i=0;i<t.length;i++)if((t.start(i)<=this.currentTime||t.start(i)<.1)&&t.end(i)>=this.currentTime)return{start:t.start(i),end:t.end(i)};return e}},{key:"crossOrigin",get:function(){return this.media?this.media.crossOrigin:""},set:function(e){this.media&&(this.media.crossOrigin=e)}},{key:"currentSrc",get:function(){return this.media?this.media.currentSrc:""},set:function(e){this.media&&(this.media.currentSrc=e)}},{key:"currentTime",get:function(){return this.media?void 0!==this.media.currentTime?this.media.currentTime:this._currentTime:0},set:function(e){this.media&&(this.media.currentTime=e)}},{key:"defaultMuted",get:function(){return!!this.media&&this.media.defaultMuted},set:function(e){this.media&&(this.media.defaultMuted=e)}},{key:"duration",get:function(){return this._duration}},{key:"ended",get:function(){return!!this.media&&this.media.ended}},{key:"error",get:function(){return this.media.error}},{key:"errorNote",get:function(){var e=this.media.error;if(!e)return"";var t=["MEDIA_ERR_ABORTED","MEDIA_ERR_NETWORK","MEDIA_ERR_DECODE","MEDIA_ERR_SRC_NOT_SUPPORTED"];return t[this.media.error.code-1]}},{key:"loop",get:function(){return!!this.media&&this.media.loop},set:function(e){this.media&&(this.media.loop=e)}},{key:"muted",get:function(){return!!this.media&&this.media.muted},set:function(e){this.media&&this.media.muted!==e&&(this._lastMuted=this.media.muted,this.media.muted=e)}},{key:"networkState",get:function(){return this.media.networkState}},{key:"paused",get:function(){return!this.media||this.media.paused}},{key:"playbackRate",get:function(){return this.media?this.media.playbackRate:0},set:function(e){this.media&&e!==1/0&&(this.media.defaultPlaybackRate=e,this.media.playbackRate=e)}},{key:"played",get:function(){return this.media?this.media.played:null}},{key:"preload",get:function(){return!!this.media&&this.media.preload},set:function(e){this.media&&(this.media.preload=e)}},{key:"readyState",get:function(){return this.media.readyState}},{key:"seekable",get:function(){return!!this.media&&this.media.seekable}},{key:"seeking",get:function(){return!!this.media&&this.media.seeking}},{key:"src",get:function(){return this.media?this.media.src:""},set:function(e){this.media&&(this.emit(u["URL_CHANGE"],e),this.emit(u["WAITING"]),this._currentTime=0,this._duration=0,/^blob/.test(this.media.currentSrc)||/^blob/.test(this.media.src)?this.onWaiting():(this._detachSourceEvents(this.media),"Array"===s["b"].typeOf(e)?this._attachSourceEvents(this.media,e):e?this.media.src=e:this.media.removeAttribute("src"),this.load()))}},{key:"volume",get:function(){return this.media?this.media.volume:0},set:function(e){e!==1/0&&this.media&&(this.media.volume=e)}},{key:"addInnerOP",value:function(e){this._internalOp[e]=!0}},{key:"removeInnerOP",value:function(e){delete this._internalOp[e]}},{key:"emit",value:function(e,t){for(var r,a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];(r=Object(n["f"])(Object(n["g"])(i.prototype),"emit",this)).call.apply(r,[this,e,t].concat(s))}},{key:"on",value:function(e,t){for(var r,a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];(r=Object(n["f"])(Object(n["g"])(i.prototype),"on",this)).call.apply(r,[this,e,t].concat(s))}},{key:"once",value:function(e,t){for(var r,a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];(r=Object(n["f"])(Object(n["g"])(i.prototype),"once",this)).call.apply(r,[this,e,t].concat(s))}},{key:"off",value:function(e,t){for(var r,a=arguments.length,s=new Array(a>2?a-2:0),o=2;o<a;o++)s[o-2]=arguments[o];(r=Object(n["f"])(Object(n["g"])(i.prototype),"off",this)).call.apply(r,[this,e,t].concat(s))}},{key:"offAll",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"removeAllListeners",this).call(this)}}]),i}(a.a),f=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{name:"xgplayer",version:1,db:null,ojstore:{name:"xg-m4a",keypath:"vid"}};Object(n["b"])(this,e),this.indexedDB=window.indexedDB||window.webkitindexedDB,this.IDBKeyRange=window.IDBKeyRange||window.webkitIDBKeyRange,this.myDB=t}return Object(n["c"])(e,[{key:"openDB",value:function(e){var t=this,i=this,n=this.myDB.version||1,r=i.indexedDB.open(i.myDB.name,n);r.onerror=function(e){},r.onsuccess=function(n){t.myDB.db=n.target.result,e.call(i)},r.onupgradeneeded=function(e){var t=e.target.result;e.target.transaction,t.objectStoreNames.contains(i.myDB.ojstore.name)||t.createObjectStore(i.myDB.ojstore.name,{keyPath:i.myDB.ojstore.keypath})}}},{key:"deletedb",value:function(){var e=this;e.indexedDB.deleteDatabase(this.myDB.name)}},{key:"closeDB",value:function(){this.myDB.db.close()}},{key:"addData",value:function(e,t){for(var i,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),r=0;r<t.length;r++)i=n.add(t[r]),i.onerror=function(){},i.onsuccess=function(){}}},{key:"putData",value:function(e,t){for(var i,n=this.myDB.db.transaction(e,"readwrite").objectStore(e),r=0;r<t.length;r++)i=n.put(t[r]),i.onerror=function(){},i.onsuccess=function(){}}},{key:"getDataByKey",value:function(e,t,i){var n=this,r=this.myDB.db.transaction(e,"readwrite").objectStore(e),a=r.get(t);a.onerror=function(){i.call(n,null)},a.onsuccess=function(e){var t=e.target.result;i.call(n,t)}}},{key:"deleteData",value:function(e,t){var i=this.myDB.db.transaction(e,"readwrite").objectStore(e);i.delete(t)}},{key:"clearData",value:function(e){var t=this.myDB.db.transaction(e,"readwrite").objectStore(e);t.clear()}}]),e}(),g=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],v=["requestFullscreen","webkitRequestFullscreen","mozRequestFullScreen","msRequestFullscreen"],p=["exitFullscreen","webkitExitFullscreen","mozCancelFullScreen","msExitFullscreen"],m="data-xgplayerid",y=i("dc4a"),b=i("2a75"),E=function(){function e(){var t=this;if(Object(n["b"])(this,e),Object(n["e"])(this,"__trigger",(function(e){var i=(new Date).getTime();t.timeStamp=i;for(var n=0;n<e.length;n++)t.__runHandler(e[n].target)})),this.__handlers=[],this.timeStamp=0,this.observer=null,window.ResizeObserver)try{this.observer=new window.ResizeObserver(Object(s["d"])(this.__trigger,100,{trailing:!0})),this.timeStamp=(new Date).getTime()}catch(i){}}return Object(n["c"])(e,[{key:"addObserver",value:function(e,t){if(this.observer){this.observer&&this.observer.observe(e);for(var i=e.getAttribute(m),n=this.__handlers,r=-1,a=0;a<n.length;a++)n[a]&&e===n[a].target&&(r=a);r>-1?this.__handlers[r].handler=t:this.__handlers.push({target:e,handler:t,playerId:i})}}},{key:"unObserver",value:function(e){var t=-1;this.__handlers.map((function(i,n){e===i.target&&(t=n)}));try{this.observer&&this.observer.unobserve(e)}catch(i){}this.observer&&this.observer.unobserve(e),t>-1&&this.__handlers.splice(t,1)}},{key:"destroyObserver",value:function(){this.observer&&this.observer.disconnect(),this.observer=null,this.__handlers=null}},{key:"__runHandler",value:function(e){for(var t=this.__handlers,i=0;i<t.length;i++)if(t[i]&&e===t[i].target){try{t[i].handler(e)}catch(n){}return!0}return!1}}]),e}(),T=null;function k(e,t){return T||(T=new E),T.addObserver(e,t),T}function S(e,t){T.unObserver(e,t)}var _={pluginGroup:{},init:function(e){var t=e._pluginInfoId;t||(t=(new Date).getTime(),e._pluginInfoId=t),!e.config.closeResizeObserver&&k(e.root,(function(){e.resize()})),0===Object.keys(this.pluginGroup).length&&(e.isUserActive=!0),this.pluginGroup[t]={_player:e,_originalOptions:e.config||{},_plugins:{}}},checkPlayerRoot:function(e){if(this.pluginGroup){for(var t=Object.keys(this.pluginGroup),i=0;i<t.length;i++){var n=this.pluginGroup[t[i]]._player;if(n.root===e)return n}return null}return null},formatPluginInfo:function(e,t){var i=null,n=null;return e.plugin&&"function"===typeof e.plugin?(i=e.plugin,n=e.options):(i=e,n={}),t&&(n.config=t||{}),{PLUFGIN:i,options:n}},checkPluginIfExits:function(e,t){for(var i=0;i<t.length;i++)if(e.toLowerCase()===t[i].pluginName.toLowerCase())return!0;return!1},getRootByConfig:function(e,t){for(var i=Object.keys(t),n=null,r=0;r<i.length;r++)if(e.toLowerCase()===i[r].toLowerCase()){n=t[i[r]];break}return"Object"===s["b"].typeOf(n)?{root:n.root,position:n.position}:{}},lazyRegister:function(e,t){var i=this,n=t.timeout||1500;return Promise.race([t.loader().then((function(t){var n;n=t&&t.__esModule?t.default:t,i.register(e,n,t.options)})),new Promise((function(e,t){setTimeout((function(){t(new Error("timeout"))}),n)}))])},register:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(e&&t&&"function"===typeof t&&void 0!==t.prototype){var n=e._pluginInfoId;if(n&&this.pluginGroup[n]){this.pluginGroup[n]._plugins||(this.pluginGroup[n]._plugins={});var r=this.pluginGroup[n]._plugins,a=this.pluginGroup[n]._originalOptions;i.player=this.pluginGroup[n]._player;var o=i.pluginName||t.pluginName;if(!o)throw new Error("The property pluginName is necessary");if(!t.isSupported||t.isSupported(e.config.mediaType,e.config.codecType)){i.config||(i.config={});for(var l=Object.keys(a),u=0;u<l.length;u++)if(o.toLowerCase()===l[u].toLowerCase()){var c=a[l[u]];"Object"===s["b"].typeOf(c)?i.config=Object.assign({},i.config,a[l[u]]):"Boolean"===s["b"].typeOf(c)&&(i.config.disable=!c);break}t.defaultConfig&&Object.keys(t.defaultConfig).forEach((function(e){"undefined"===typeof i.config[e]&&(i.config[e]=t.defaultConfig[e])})),i.root?"string"===typeof i.root&&(i.root=e[i.root]):i.root=e.root,i.index=i.config.index||0;try{r[o.toLowerCase()]&&this.unRegister(n,o.toLowerCase());var h=new t(i);return r[o.toLowerCase()]=h,r[o.toLowerCase()].func=t,h&&"function"===typeof h.afterCreate&&h.afterCreate(),h}catch(d){throw d}}}}},unRegister:function(e,t){e._pluginInfoId&&(e=e._pluginInfoId),t=t.toLowerCase();try{var i=this.pluginGroup[e]._plugins[t];i&&(i.pluginName&&i.__destroy(),delete this.pluginGroup[e]._plugins[t])}catch(n){}},deletePlugin:function(e,t){var i=e._pluginInfoId;i&&this.pluginGroup[i]&&this.pluginGroup[i]._plugins&&delete this.pluginGroup[i]._plugins[t]},getPlugins:function(e){var t=e._pluginInfoId;return t&&this.pluginGroup[t]?this.pluginGroup[t]._plugins:{}},findPlugin:function(e,t){var i=e._pluginInfoId;if(!i||!this.pluginGroup[i])return null;var n=t.toLowerCase();return this.pluginGroup[i]._plugins[n]},beforeInit:function(e){var t=this;function i(e){return e&&e.then?e:new Promise((function(e){e()}))}return new Promise((function(n){var r;if(t.pluginGroup)return r=e._loadingPlugins&&e._loadingPlugins.length?Promise.all(e._loadingPlugins):Promise.resolve(),r.then((function(){var r=e._pluginInfoId;if(t.pluginGroup[r]){var a=t.pluginGroup[r]._plugins,s=[];Object.keys(a).forEach((function(e){if(a[e]&&a[e].beforePlayerInit)try{var t=a[e].beforePlayerInit();s.push(i(t))}catch(n){throw s.push(i(null)),n}})),Promise.all([].concat(s)).then((function(){n()})).catch((function(e){n()}))}else n()}))}))},afterInit:function(e){var t=e._pluginInfoId;if(t&&this.pluginGroup[t]){var i=this.pluginGroup[t]._plugins;Object.keys(i).forEach((function(e){i[e]&&i[e].afterPlayerInit&&i[e].afterPlayerInit()}))}},setLang:function(e,t){var i=t._pluginInfoId;if(i&&this.pluginGroup[i]){var n=this.pluginGroup[i]._plugins;Object.keys(n).forEach((function(t){if(n[t].updateLang)n[t].updateLang(e);else try{n[t].lang=e}catch(i){}}))}},reRender:function(e){var t=this,i=e._pluginInfoId;if(i&&this.pluginGroup[i]){var n=[],r=this.pluginGroup[i]._plugins;Object.keys(r).forEach((function(e){"controls"!==e&&r[e]&&(n.push({plugin:r[e].func,options:r[e].__args}),t.unRegister(i,e))})),n.forEach((function(i){t.register(e,i.plugin,i.options)}))}},onPluginsReady:function(e){var t=e._pluginInfoId;if(t&&this.pluginGroup[t]){var i=this.pluginGroup[t]._plugins||{};Object.keys(i).forEach((function(e){i[e].onPluginsReady&&"function"===typeof i[e].onPluginsReady&&i[e].onPluginsReady()}))}},setCurrentUserActive:function(e,t){if(this.pluginGroup[e]){if(!t)return this.pluginGroup[e]._player.isUserActive=t,e;for(var i=Object.keys(this.pluginGroup),n=0;n<i.length;n++){var r=this.pluginGroup[i[n]];r&&r._player&&(this.pluginGroup[i[n]]._player.isUserActive=!1)}return this.pluginGroup[e]._player.isUserActive=t,e}},getCurrentUseActiveId:function(){if(this.pluginGroup){for(var e=Object.keys(this.pluginGroup),t=0;t<e.length;t++){var i=this.pluginGroup[e[t]];if(i&&i._player&&i._player.isUserActive)return e[t]}return null}},destroy:function(e){var t=e._pluginInfoId;if(this.pluginGroup[t]){S(e.root);for(var i=this.pluginGroup[t]._plugins,n=0,r=Object.keys(i);n<r.length;n++){var a=r[n];this.unRegister(t,a)}var s=e.isUseActive;if(delete this.pluginGroup[t],delete e._pluginInfoId,s){var o=Object.keys(this.pluginGroup);o.length>0&&this.setCurrentUserActive(o[o.length-1],!0)}}}},L=i("b39b");function A(){return{id:"",el:null,url:"",domEventType:"default",nullUrlStart:!1,width:600,height:337.5,fluid:!1,fitVideoSize:"fixed",videoFillMode:"auto",volume:.6,autoplay:!1,autoplayMuted:!1,loop:!1,isLive:!1,zoom:1,videoInit:!0,poster:"",isMobileSimulateMode:!1,defaultPlaybackRate:1,execBeforePluginsCall:null,allowSeekAfterEnded:!0,enableContextmenu:!0,closeVideoClick:!1,closeVideoDblclick:!1,closePlayerBlur:!1,closeDelayBlur:!1,leavePlayerTime:3e3,closePlayVideoFocus:!1,closePauseVideoFocus:!1,closeFocusVideoFocus:!0,closeControlsBlur:!0,topBarAutoHide:!0,videoAttributes:{},startTime:0,seekedStatus:"play",miniprogress:!1,disableSwipeHandler:function(){},enableSwipeHandler:function(){},ignores:[],whitelist:[],inactive:3e3,lang:Object(s["c"])(),controls:!0,marginControls:!1,fullscreenTarget:null,screenShot:!1,rotate:!1,pip:!1,download:!1,mini:!1,cssFullscreen:!0,keyShortcut:!0,presets:[],plugins:[],playbackRate:1,definition:{list:[]},playsinline:!0,customDuration:0,timeOffset:0,icons:{},i18n:[],tabindex:0,thumbnail:null,videoConfig:{},isHideTips:!1,commonStyle:{progressColor:"",playedColor:"",cachedColor:"",sliderBtnStyle:{},volumeColor:""}}}var C=function(e,t){var i,r,a;a=t.preset&&t.options?new t.preset(t.options,e.config):new t({},e.config);var s=a,o=s.plugins,l=void 0===o?[]:o,u=s.ignores,c=void 0===u?[]:u,h=s.icons,d=void 0===h?{}:h,f=s.i18n,g=void 0===f?[]:f;e.config.plugins||(e.config.plugins=[]),e.config.ignores||(e.config.ignores=[]),(i=e.config.plugins).push.apply(i,Object(n["k"])(l)),(r=e.config.ignores).push.apply(r,Object(n["k"])(c)),Object.keys(d).map((function(t){e.config.icons[t]||(e.config.icons[t]=d[t])}));var v=e.config.i18n||[];g.push.apply(g,Object(n["k"])(v)),e.config.i18n=g},O=i("2535"),R=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"onMouseEnter",(function(t){var i=Object(n["a"])(e),r=i.player,a=i.playerConfig;a.closeControlsBlur&&r.focus({autoHide:!1})})),Object(n["e"])(Object(n["a"])(e),"onMouseLeave",(function(){var t=Object(n["a"])(e),i=t.player;i.focus()})),e}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){e.config.mode||"mobile"!==o["a"].device||(e.config.mode="flex"),e.player.config.marginControls&&(e.config.autoHide=!1)}},{key:"afterCreate",value:function(){var e=this,t=this.config,i=t.disable,n=t.height,r=t.mode;if(!i){"flex"===r&&this.player.addClass(L["a"].FLEX_CONTROLS);var a={height:"".concat(n,"px")};Object.keys(a).map((function(t){e.root.style[t]=a[t]})),this.left=this.find("xg-left-grid"),this.center=this.find("xg-center-grid"),this.right=this.find("xg-right-grid"),this.innerRoot=this.find("xg-inner-controls"),this.on(u["MINI_STATE_CHANGE"],(function(t){t?s["b"].addClass(e.root,"mini-controls"):s["b"].removeClass(e.root,"mini-controls")}));var l=this.playerConfig.isMobileSimulateMode;"mobile"!==o["a"].device&&"mobile"!==l&&(this.bind("mouseenter",this.onMouseEnter),this.bind("mouseleave",this.onMouseLeave))}}},{key:"focus",value:function(){this.player.focus({autoHide:!1})}},{key:"focusAwhile",value:function(){this.player.focus({autoHide:!0})}},{key:"blur",value:function(){this.player.blur({ignorePaused:!0})}},{key:"recoverAutoHide",value:function(){this.config.autoHide&&s["b"].addClass(this.root,L["a"].CONTROLS_AUTOHIDE)}},{key:"pauseAutoHide",value:function(){s["b"].removeClass(this.root,L["a"].CONTROLS_AUTOHIDE)}},{key:"show",value:function(){s["b"].addClass(this.root,"show")}},{key:"hide",value:function(){s["b"].removeClass(this.root,"show")}},{key:"mode",get:function(){return this.config.mode}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2?arguments[2]:void 0;if(this.root){var a=e.defaultConfig||{};if(!t.root){var s=t.position?t.position:t.config&&t.config.position?t.config.position:a.position;switch(s){case y["a"].CONTROLS_LEFT:t.root=this.left;break;case y["a"].CONTROLS_RIGHT:t.root=this.right;break;case y["a"].CONTROLS_CENTER:t.root=this.center;break;case y["a"].CONTROLS:t.root=this.root;break;default:t.root=this.left}return Object(n["f"])(Object(n["g"])(i.prototype),"registerPlugin",this).call(this,e,t,r)}}}},{key:"destroy",value:function(){"mobile"!==o["a"].device&&(this.unbind("mouseenter",this.onMouseEnter),this.unbind("mouseleave",this.onMouseLeave))}},{key:"render",value:function(){var e=this.config,t=e.mode,i=e.autoHide,r=e.initShow,a=e.disable;if(!a){var o=s["b"].classNames({"xgplayer-controls":!0},{"flex-controls":"flex"===t},{"bottom-controls":"bottom"===t},Object(n["e"])({},L["a"].CONTROLS_AUTOHIDE,i),{"xgplayer-controls-initshow":r||!i});return'<xg-controls class="'.concat(o,'" unselectable="on">\n    <xg-inner-controls class="xg-inner-controls xg-pos">\n      <xg-left-grid class="xg-left-grid">\n      </xg-left-grid>\n      <xg-center-grid class="xg-center-grid"></xg-center-grid>\n      <xg-right-grid class="xg-right-grid">\n      </xg-right-grid>\n    </xg-inner-controls>\n    </xg-controls>')}}}],[{key:"pluginName",get:function(){return"controls"}},{key:"defaultConfig",get:function(){return{disable:!1,autoHide:!0,mode:"",initShow:!1}}}]),i}(y["b"]),w=i("d2c7"),x=i("5e99"),I=i("301b"),D=i("a45c"),P=["play","pause","replay","retry"],N=0,M=0,F=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;Object(n["b"])(this,i);var a=s["b"].deepMerge(A(),e);r=t.call(this,a),Object(n["e"])(Object(n["a"])(r),"canPlayFunc",(function(){if(r.config){var e=r.config,t=e.autoplay,i=e.startTime,n=e.defaultPlaybackRate;w["b"].logInfo("player","canPlayFunc, startTime",i),i&&(r.currentTime=i>r.duration?r.duration:i,r.config.startTime=0),r.playbackRate=n,(t||r._useAutoplay)&&r.mediaPlay(),r.off(u["CANPLAY"],r.canPlayFunc),r.removeClass(L["a"].ENTER)}})),Object(n["e"])(Object(n["a"])(r),"onFullscreenChange",(function(e,t){var i=function(){s["b"].setTimeout(Object(n["a"])(r),(function(){r.resize()}),100)},a=s["b"].getFullScreenEl();r._fullActionFrom?r._fullActionFrom="":r.emit(u["USER_ACTION"],{eventType:"system",action:"switch_fullscreen",pluginName:"player",currentTime:r.currentTime,duration:r.duration,props:[{prop:"fullscreen",from:!0,to:!1}]});var o=Object(s["a"])(a,r.playerId,m);if(t||a&&(a===r._fullscreenEl||o))i(),!r.config.closeFocusVideoFocus&&r.media.focus(),r.fullscreen=!0,r.changeFullStyle(r.root,a,L["a"].FULLSCREEN),r.emit(u["FULLSCREEN_CHANGE"],!0,r._fullScreenOffset),r.cssfullscreen&&r.exitCssFullscreen();else if(r.fullscreen){i();var l=Object(n["a"])(r),c=l._fullScreenOffset,h=l.config;h.needFullscreenScroll?(window.scrollTo(c.left,c.top),s["b"].setTimeout(Object(n["a"])(r),(function(){r.fullscreen=!1,r._fullScreenOffset=null}),100)):(!r.config.closeFocusVideoFocus&&r.media.focus(),r.fullscreen=!1,r._fullScreenOffset=null),r.cssfullscreen?r.removeClass(L["a"].FULLSCREEN):r.recoverFullStyle(r.root,r._fullscreenEl,L["a"].FULLSCREEN),r._fullscreenEl=null,r.emit(u["FULLSCREEN_CHANGE"],!1)}})),Object(n["e"])(Object(n["a"])(r),"_onWebkitbeginfullscreen",(function(e){r._fullscreenEl=r.media,r.onFullscreenChange(e,!0)})),Object(n["e"])(Object(n["a"])(r),"_onWebkitendfullscreen",(function(e){r.onFullscreenChange(e,!1)})),Object(O["a"])(Object(n["a"])(r),P),r.config=a,r._pluginInfoId=s["b"].generateSessionId(),Object(w["a"])(Object(n["a"])(r));var l=r.constructor.defaultPreset;if(r.config.presets.length){var c=r.config.presets.indexOf("default");c>=0&&l&&(r.config.presets[c]=l)}else l&&r.config.presets.push(l);r.userTimer=null,r.waitTimer=null,r._state=D["a"].INITIAL,r.isError=!1,r._hasStart=!1,r.isSeeking=!1,r.isCanplay=!1,r._useAutoplay=!1,r.rotateDeg=0,r.isActive=!1,r.fullscreen=!1,r.cssfullscreen=!1,r.isRotateFullscreen=!1,r._fullscreenEl=null,r._cssfullscreenEl=null,r.curDefinition=null,r._orgCss="",r._fullScreenOffset=null,r._videoHeight=0,r._videoWidth=0,r._accPlayed={t:0,acc:0,loopAcc:0},r.innerContainer=null,r.controls=null,r.topBar=null,r.root=null,r.__i18n=x["a"].init(r._pluginInfoId),o["a"].os.isAndroid&&o["a"].osVersion>0&&o["a"].osVersion<6&&(r.config.autoplay=!1),r.database=new f,r.isUserActive=!1,r._onceSeekCanplay=null,r._isPauseBeforeSeek=0;var h=r._initDOM();if(!h)return Object(n["j"])(r);var d=r.config,g=d.definition,v=void 0===g?{}:g,p=d.url;if(!p&&v.list&&v.list.length>0){var y=v.list.find((function(e){return e.definition&&e.definition===v.defaultDefinition}));y||(v.defaultDefinition=v.list[0].definition,y=v.list[0]),r.config.url=y.url,r.curDefinition=y}return r._bindEvents(),r._registerPresets(),r._registerPlugins(),_.onPluginsReady(Object(n["a"])(r)),r.getInitDefinition(),r.setState(D["a"].READY),s["b"].setTimeout(Object(n["a"])(r),(function(){r.emit(u["READY"])}),0),r.onReady&&r.onReady(),(r.config.videoInit||r.config.autoplay)&&(!r.hasStart||r.state<D["a"].ATTACHED)&&r.start(),r}return Object(n["c"])(i,[{key:"_initDOM",value:function(){var e=this;if(this.root=this.config.id?document.getElementById(this.config.id):null,!this.root){var t=this.config.el;if(!t||1!==t.nodeType)return this.emit(u["ERROR"],new l["b"]("use",this.config.vid,{line:32,handle:"Constructor",msg:"container id can't be empty"})),!1;this.root=t}var i=_.checkPlayerRoot(this.root);i&&(w["b"].logWarn("The is an Player instance already exists in this.root, destroy it and reinitialize"),i.destroy()),this.root.setAttribute(m,this.playerId),_.init(this),this._initBaseDoms();var n=this.constructor.XgVideoProxy;if(n&&this.mediaConfig.mediaType===n.mediaType){var r=this.innerContainer||this.root;this.detachVideoEvents(this.media);var a=new n(r,this.config,this.mediaConfig);this.attachVideoEvents(a),this.media=a}if(this.media.setAttribute(m,this.playerId),this.config.controls){var s=this.config.controls.root||null,c=_.register(this,R,{root:s});this.controls=c}var h="mobile"===this.config.isMobileSimulateMode?"mobile":o["a"].device;if(this.addClass("".concat(L["a"].DEFAULT," ").concat(L["a"].INACTIVE," xgplayer-").concat(h," ").concat(this.config.controls?"":L["a"].NO_CONTROLS)),this.config.autoplay?this.addClass(L["a"].ENTER):this.addClass(L["a"].NO_START),this.config.fluid){var d=this.config,f=d.width,g=d.height;"number"===typeof f&&"number"===typeof g||(f=600,g=337.5);var v={width:"100%",height:"0","max-width":"100%","padding-top":"".concat(100*g/f,"%")};Object.keys(v).forEach((function(t){e.root.style[t]=v[t]}))}else["width","height"].forEach((function(t){e.config[t]&&("number"!==typeof e.config[t]?e.root.style[t]=e.config[t]:e.root.style[t]="".concat(e.config[t],"px"))}));return!0}},{key:"_initBaseDoms",value:function(){this.topBar=null,this.leftBar=null,this.rightBar=null,this.config.marginControls&&(this.innerContainer=s["b"].createDom("xg-video-container","",{"data-index":-1},"xg-video-container"),this.root.appendChild(this.innerContainer))}},{key:"_bindEvents",value:function(){var e=this;["focus","blur"].forEach((function(t){e.on(t,e["on"+t.charAt(0).toUpperCase()+t.slice(1)])})),g.forEach((function(t){document&&document.addEventListener(t,e.onFullscreenChange)})),o["a"].os.isIos&&(this.media.addEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.addEventListener("webkitendfullscreen",this._onWebkitendfullscreen)),this.once(u["LOADED_DATA"],this.resize),this.playFunc=function(){e.config.closeFocusVideoFocus||e.media.focus()},this.once(u["PLAY"],this.playFunc)}},{key:"_unbindEvents",value:function(){var e=this;this.root.removeEventListener("mousemove",this.mousemoveFunc),g.forEach((function(t){document.removeEventListener(t,e.onFullscreenChange)})),this.playFunc&&this.off(u["PLAY"],this.playFunc),this.off(u["CANPLAY"],this.canPlayFunc),this.media.removeEventListener("webkitbeginfullscreen",this._onWebkitbeginfullscreen),this.media.removeEventListener("webkitendfullscreen",this._onWebkitendfullscreen)}},{key:"_startInit",value:function(e){var t=this;if(this.media&&(e&&""!==e&&("Array"!==s["b"].typeOf(e)||0!==e.length)||(e="",this.emit(u["URL_NULL"]),w["b"].logWarn("config.url is null, please get url and run player._startInit(url)"),!this.config.nullUrlStart))){this._detachSourceEvents(this.media),"Array"===s["b"].typeOf(e)&&e.length>0?this._attachSourceEvents(this.media,e):this.media.src&&this.media.src===e?e||this.media.removeAttribute("src"):this.media.src=e,"Number"===s["b"].typeOf(this.config.volume)&&(this.volume=this.config.volume);var i=this.innerContainer?this.innerContainer:this.root;this.media instanceof window.Element&&!i.contains(this.media)&&i.insertBefore(this.media,i.firstChild);var n=this.media.readyState;w["b"].logInfo("_startInit readyState",n),this.config.autoplay&&(!/^blob/.test(this.media.currentSrc)&&!/^blob/.test(this.media.src)&&this.load(),(o["a"].os.isIpad||o["a"].os.isPhone)&&this.mediaPlay()),n>=2?this.canPlayFunc():this.once(u["CANPLAY"],this.canPlayFunc),(!this.hasStart||this.state<D["a"].ATTACHED)&&_.afterInit(this),this.hasStart=!0,this.setState(D["a"].ATTACHED),s["b"].setTimeout(this,(function(){t.emit(u["COMPLETE"])}),0)}}},{key:"_registerPlugins",value:function(){var e=this,t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this._loadingPlugins=[];var i=this.config.ignores||[],n=this.config.plugins||[],r=this.config.i18n||[];t&&x["a"].extend(r,this.__i18n);var a=i.join("||").toLowerCase().split("||"),s=this.plugins;n.forEach((function(i){try{var n=i.plugin?i.plugin.pluginName:i.pluginName;if(n&&a.indexOf(n.toLowerCase())>-1)return null;if(!t&&s[n.toLowerCase()])return;if(i.lazy&&i.loader){var r=_.lazyRegister(e,i);return void(i.forceBeforeInit&&(r.then((function(){e._loadingPlugins.splice(e._loadingPlugins.indexOf(r),1)})).catch((function(t){w["b"].logError("_registerPlugins:loadingPlugin",t),e._loadingPlugins.splice(e._loadingPlugins.indexOf(r),1)})),e._loadingPlugins.push(r)))}return e.registerPlugin(i)}catch(o){w["b"].logError("_registerPlugins:",o)}}))}},{key:"_registerPresets",value:function(){var e=this;this.config.presets.forEach((function(t){C(e,t)}))}},{key:"_getRootByPosition",value:function(e){var t=null;switch(e){case y["a"].ROOT_RIGHT:this.rightBar||(this.rightBar=s["b"].createPositionBar("xg-right-bar",this.root)),t=this.rightBar;break;case y["a"].ROOT_LEFT:this.leftBar||(this.leftBar=s["b"].createPositionBar("xg-left-bar",this.root)),t=this.leftBar;break;case y["a"].ROOT_TOP:this.topBar||(this.topBar=s["b"].createPositionBar("xg-top-bar",this.root),this.config.topBarAutoHide&&s["b"].addClass(this.topBar,L["a"].TOP_BAR_AUTOHIDE)),t=this.topBar;break;default:t=this.innerContainer||this.root;break}return t}},{key:"registerPlugin",value:function(e,t){var i=_.formatPluginInfo(e,t),n=i.PLUFGIN,r=i.options,a=this.config.plugins,s=_.checkPluginIfExits(n.pluginName,a);!s&&a.push(n);var o=_.getRootByConfig(n.pluginName,this.config);o.root&&(r.root=o.root),o.position&&(r.position=o.position);var l=r.position?r.position:r.config&&r.config.position||n.defaultConfig&&n.defaultConfig.position;return!r.root&&"string"===typeof l&&l.indexOf("controls")>-1?this.controls&&this.controls.registerPlugin(n,r,n.pluginName):(r.root||(r.root=this._getRootByPosition(l)),_.register(this,n,r))}},{key:"deregister",value:function(e){"string"===typeof e?_.unRegister(this,e):e instanceof b["a"]&&_.unRegister(this,e.pluginName)}},{key:"unRegisterPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];this.deregister(e),t&&this.removePluginFromConfig(e)}},{key:"removePluginFromConfig",value:function(e){var t;if("string"===typeof e?t=e:e instanceof b["a"]&&(t=e.pluginName),t)for(var i=this.config.plugins.length-1;i>-1;i--){var n=this.config.plugins[i];if(n.pluginName.toLowerCase()===t.toLowerCase()){this.config.plugins.splice(i,1);break}}}},{key:"plugins",get:function(){return _.getPlugins(this)}},{key:"getPlugin",value:function(e){var t=_.findPlugin(this,e);return t&&t.pluginName?t:null}},{key:"addClass",value:function(e){this.root&&(s["b"].hasClass(this.root,e)||s["b"].addClass(this.root,e))}},{key:"removeClass",value:function(e){this.root&&s["b"].removeClass(this.root,e)}},{key:"hasClass",value:function(e){if(this.root)return s["b"].hasClass(this.root,e)}},{key:"setAttribute",value:function(e,t){this.root&&this.root.setAttribute(e,t)}},{key:"removeAttribute",value:function(e,t){this.root&&this.root.removeAttribute(e,t)}},{key:"start",value:function(e){var t=this;if(!(this.state>D["a"].ATTACHING))return e||this.config.url||this.getInitDefinition(),this.hasStart=!0,this.setState(D["a"].ATTACHING),this._registerPlugins(!1),_.beforeInit(this).then((function(){if(t.config){e||(e=t.url||t.config.url);var i=t._startInit(e);return i}})).catch((function(e){throw e.fileName="player",e.lineNumber="236",w["b"].logError("start:beforeInit:",e),e}))}},{key:"switchURL",value:function(e,t){var i=this,n=e;"Object"===s["b"].typeOf(e)&&(n=e.url);var r=this.currentTime,a=this.paused&&!this.isError;return this.src=n,new Promise((function(e){var t=function(){i.currentTime=r,a&&i.once("canplay",(function(){i.pause()})),e()};o["a"].os.isAndroid?i.once("timeupdate",(function(){t()})):i.once("canplay",(function(){t()})),i.play()}))}},{key:"videoPlay",value:function(){this.mediaPlay()}},{key:"mediaPlay",value:function(){var e=this;if(!this.hasStart&&this.state<D["a"].ATTACHED)return this.removeClass(L["a"].NO_START),this.addClass(L["a"].ENTER),this.start(),void(this._useAutoplay=!0);this.state<D["a"].RUNNING&&(this.removeClass(L["a"].NO_START),!this.isCanplay&&this.addClass(L["a"].ENTER));var t=Object(n["f"])(Object(n["g"])(i.prototype),"play",this).call(this);return void 0!==t&&t&&t.then?t.then((function(){e.removeClass(L["a"].NOT_ALLOW_AUTOPLAY),e.addClass(L["a"].PLAYING),e.state<D["a"].RUNNING&&(w["b"].logInfo(">>>>playPromise.then"),e.setState(D["a"].RUNNING),e.emit(u["AUTOPLAY_STARTED"]))})).catch((function(t){if(w["b"].logWarn(">>>>playPromise.catch",t.name),e.media&&e.media.error)return e.onError(),void e.removeClass(L["a"].ENTER);"NotAllowedError"===t.name&&(e._errorTimer=s["b"].setTimeout(e,(function(){e._errorTimer=null,e.emit(u["AUTOPLAY_PREVENTED"]),e.addClass(L["a"].NOT_ALLOW_AUTOPLAY),e.removeClass(L["a"].ENTER),e.pause(),e.setState(D["a"].NOTALLOW)}),0))})):(w["b"].logWarn("video.play not return promise"),this.state<D["a"].RUNNING&&(this.setState(D["a"].RUNNING),this.removeClass(L["a"].NOT_ALLOW_AUTOPLAY),this.removeClass(L["a"].NO_START),this.removeClass(L["a"].ENTER),this.addClass(L["a"].PLAYING),this.emit(u["AUTOPLAY_STARTED"]))),t}},{key:"mediaPause",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"pause",this).call(this)}},{key:"videoPause",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"pause",this).call(this)}},{key:"play",value:function(){var e=this;return this.removeClass(L["a"].PAUSED),Object(O["f"])(this,"play",(function(){return e.mediaPlay()}))}},{key:"pause",value:function(){var e=this;Object(O["f"])(this,"pause",(function(){Object(n["f"])(Object(n["g"])(i.prototype),"pause",e).call(e)}))}},{key:"seek",value:function(e,t){var i=this;if(this.media&&!Number.isNaN(Number(e)||!this.hasStart)){var n=this.config,r=n.isSeekedPlay,a=n.seekedStatus,s=t||(r?"play":a);e=e<0?0:e>this.duration?parseInt(this.duration,10):e,!this._isPauseBeforeSeek&&(this._isPauseBeforeSeek=this.paused?2:1),this._onceSeekCanplay&&this.off(u["CANPLAY"],this._onceSeekCanplay),this._onceSeekCanplay=function(){switch(i.removeClass(L["a"].ENTER),i.isSeeking=!1,s){case"play":i.play();break;case"pause":i.pause();break;default:i._isPauseBeforeSeek>1||i.paused?i.pause():i.play()}i._isPauseBeforeSeek=0,i._onceSeekCanplay=null},this.once(u["CANPLAY"],this._onceSeekCanplay),this.state<D["a"].RUNNING?(this.removeClass(L["a"].NO_START),this.addClass(L["a"].ENTER),this.currentTime=e,this.play()):this.currentTime=e}}},{key:"getInitDefinition",value:function(){var e=this,t=this.config,i=t.definition,n=t.url;!n&&i&&i.list&&i.list.length>0&&i.defaultDefinition&&i.list.map((function(t){t.definition===i.defaultDefinition&&(e.config.url=t.url,e.curDefinition=t)}))}},{key:"changeDefinition",value:function(e,t){var i=this,r=this.config.definition;if(Array.isArray(null===r||void 0===r?void 0:r.list)&&r.list.forEach((function(t){(null===e||void 0===e?void 0:e.definition)===t.definition&&(i.curDefinition=t)})),null!==e&&void 0!==e&&e.bitrate&&"number"!==typeof e.bitrate&&(e.bitrate=parseInt(e.bitrate,10)||0),this.emit(u["DEFINITION_CHANGE"],{from:t,to:e}),this.hasStart){var a=this.switchURL(e.url,Object(n["i"])({seamless:!1!==r.seamless&&"undefined"!==typeof MediaSource&&"function"===typeof MediaSource.isTypeSupported},e));a&&a.then?a.then((function(){i.emit(u["AFTER_DEFINITION_CHANGE"],{from:t,to:e})})):this.emit(u["AFTER_DEFINITION_CHANGE"],{from:t,to:e})}else this.config.url=e.url}},{key:"reload",value:function(){this.load(),this.reloadFunc=function(){this.play()},this.once(u["LOADED_DATA"],this.reloadFunc)}},{key:"resetState",value:function(){var e=this,t=L["a"].NOT_ALLOW_AUTOPLAY,i=L["a"].PLAYING,n=L["a"].NO_START,r=L["a"].PAUSED,a=L["a"].REPLAY,s=L["a"].ENTER,o=L["a"].ENDED,l=L["a"].ERROR,c=L["a"].LOADING,h=[t,i,n,r,a,s,o,l,c];this.hasStart=!1,this.isError=!1,this._useAutoplay=!1,this.mediaPause(),this._accPlayed.acc=0,this._accPlayed.t=0,this._accPlayed.loopAcc=0,h.forEach((function(t){e.removeClass(t)})),this.addClass(L["a"].ENTER),this.emit(u["RESET"])}},{key:"reset",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1?arguments[1]:void 0;this.resetState();var n=this.plugins;if(n&&(t.map((function(t){e.deregister(t)})),i)){var r=A();Object.keys(this.config).keys((function(t){"undefined"===e.config[t]||"plugins"!==t&&"presets"!==t&&"el"!==t&&"id"!==t||(e.config[t]=r[t])}))}}},{key:"destroy",value:function(){var e=this,t=this.innerContainer,r=this.root,a=this.media;if(r&&a){if(this.hasStart=!1,this._useAutoplay=!1,r.removeAttribute(m),this.updateAcc("destroy"),this._unbindEvents(),this._detachSourceEvents(this.media),s["b"].clearAllTimers(this),this.emit(u["DESTROY"]),_.destroy(this),Object(O["b"])(this),Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.fullscreen&&this._fullscreenEl===this.root&&this.exitFullscreen(),t)for(var o=t.children,l=0;l<o.length;l++)t.removeChild(o[l]);!t&&a instanceof window.Node&&r.contains(a)&&r.removeChild(a),["topBar","leftBar","rightBar","innerContainer"].map((function(t){e[t]&&r.removeChild(e[t]),e[t]=null}));var c=r.className.split(" ");c.length>0?r.className=c.filter((function(e){return e.indexOf("xgplayer")<0})).join(" "):r.className="",this.removeAttribute("data-xgfill"),["isSeeking","isCanplay","isActive","cssfullscreen","fullscreen"].forEach((function(t){e[t]=!1}))}}},{key:"replay",value:function(){var e=this;this.removeClass(L["a"].ENDED),this.currentTime=0,this.isSeeking=!1,Object(O["f"])(this,"replay",(function(){e.once(u["CANPLAY"],(function(){var t=e.mediaPlay();t&&t.catch&&t.catch((function(e){}))})),e.play(),e.emit(u["REPLAY"]),e.onPlay()}))}},{key:"retry",value:function(){var e=this;this.removeClass(L["a"].ERROR),this.addClass(L["a"].LOADING),Object(O["f"])(this,"retry",(function(){var t=e.currentTime;e.src=e.config.url,!e.config.isLive&&(e.currentTime=t),e.once(u["CANPLAY"],(function(){e.mediaPlay()}))}))}},{key:"changeFullStyle",value:function(e,t,i,n){e&&(n||(n=L["a"].PARENT_FULLSCREEN),this._orgCss||(this._orgCss=s["b"].filterStyleFromText(e)),s["b"].addClass(e,i),t&&t!==e&&!this._orgPCss&&(this._orgPCss=s["b"].filterStyleFromText(t),s["b"].addClass(t,n),t.setAttribute(m,this.playerId)))}},{key:"recoverFullStyle",value:function(e,t,i,n){n||(n=L["a"].PARENT_FULLSCREEN),this._orgCss&&(s["b"].setStyleFromCsstext(e,this._orgCss),this._orgCss=""),s["b"].removeClass(e,i),t&&t!==e&&this._orgPCss&&(s["b"].setStyleFromCsstext(t,this._orgPCss),this._orgPCss="",s["b"].removeClass(t,n),t.removeAttribute(m))}},{key:"getFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget,t=this.root,i=this.media;e||(e=t),this._fullScreenOffset={top:s["b"].scrollTop(),left:s["b"].scrollLeft()},this._fullscreenEl=e,this._fullActionFrom="get";var n=s["b"].getFullScreenEl();if(n!==this._fullscreenEl)try{for(var r=0;r<v.length;r++){var a=v[r];if(e[a]){var o="webkitRequestFullscreen"===a?e.webkitRequestFullscreen(window.Element.ALLOW_KEYBOARD_INPUT):e[a]();return o&&o.then?o:Promise.resolve()}}return i.fullscreenEnabled||i.webkitSupportsFullscreen?(i.webkitEnterFullscreen(),Promise.resolve()):Promise.reject(new Error("call getFullscreen fail"))}catch(l){return Promise.reject(new Error("call getFullscreen fail"))}else this.onFullscreenChange()}},{key:"exitFullscreen",value:function(e){if(this.isRotateFullscreen&&this.exitRotateFullscreen(),this._fullscreenEl||s["b"].getFullScreenEl()){this.root;var t=this.media;this._fullActionFrom="exit";try{for(var i=0;i<p.length;i++){var n=p[i];if(document[n]){var r=document[n]();return r&&r.then?r:Promise.resolve()}}return t&&t.webkitSupportsFullscreen?(t.webkitExitFullScreen(),Promise.resolve()):Promise.reject(new Error("call exitFullscreen fail"))}catch(a){return Promise.reject(new Error("call exitFullscreen fail"))}}}},{key:"getCssFullscreen",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.fullscreenTarget;this.isRotateFullscreen?this.exitRotateFullscreen():this.fullscreen&&this.exitFullscreen();var t=e?"".concat(L["a"].INNER_FULLSCREEN," ").concat(L["a"].CSS_FULLSCREEN):L["a"].CSS_FULLSCREEN;this.changeFullStyle(this.root,e,t);var i=this.config.fullscreen,n=void 0===i?{}:i,r=!0===n.useCssFullscreen||"function"===typeof n.useCssFullscreen&&n.useCssFullscreen();r&&(this.fullscreen=!0,this.emit(u["FULLSCREEN_CHANGE"],!0)),this._cssfullscreenEl=e,this.cssfullscreen=!0,this.emit(u["CSS_FULLSCREEN_CHANGE"],!0)}},{key:"exitCssFullscreen",value:function(){var e=this._cssfullscreenEl?"".concat(L["a"].INNER_FULLSCREEN," ").concat(L["a"].CSS_FULLSCREEN):L["a"].CSS_FULLSCREEN;if(this.fullscreen){var t=this.config.fullscreen,i=void 0===t?{}:t,n=!0===i.useCssFullscreen||"function"===typeof i.useCssFullscreen&&i.useCssFullscreen();n?(this.recoverFullStyle(this.root,this._cssfullscreenEl,e),this.fullscreen=!1,this.emit(u["FULLSCREEN_CHANGE"],!1)):this.removeClass(e)}else this.recoverFullStyle(this.root,this._cssfullscreenEl,e);this._cssfullscreenEl=null,this.cssfullscreen=!1,this.emit(u["CSS_FULLSCREEN_CHANGE"],!1)}},{key:"getRotateFullscreen",value:function(e){this.cssfullscreen&&this.exitCssFullscreen(e);var t=e?"".concat(L["a"].INNER_FULLSCREEN," ").concat(L["a"].ROTATE_FULLSCREEN):L["a"].ROTATE_FULLSCREEN;this._fullscreenEl=e||this.root,this.changeFullStyle(this.root,e,t,L["a"].PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!0,this.fullscreen=!0,this.setRotateDeg(90),this.emit(u["FULLSCREEN_CHANGE"],!0)}},{key:"exitRotateFullscreen",value:function(e){var t=this._fullscreenEl!==this.root?"".concat(L["a"].INNER_FULLSCREEN," ").concat(L["a"].ROTATE_FULLSCREEN):L["a"].ROTATE_FULLSCREEN;this.recoverFullStyle(this.root,this._fullscreenEl,t,L["a"].PARENT_ROTATE_FULLSCREEN),this.isRotateFullscreen=!1,this.fullscreen=!1,this.setRotateDeg(0),this.emit(u["FULLSCREEN_CHANGE"],!1)}},{key:"setRotateDeg",value:function(e){90===window.orientation||-90===window.orientation?this.rotateDeg=0:this.rotateDeg=e}},{key:"focus",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{autoHide:!this.config.closeDelayBlur,delay:this.config.inactive};this.isActive?this.onFocus(e):this.emit(u["PLAYER_FOCUS"],Object(n["i"])({paused:this.paused,ended:this.ended},e))}},{key:"blur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{ignorePaused:!1};this.isActive?this.emit(u["PLAYER_BLUR"],Object(n["i"])({paused:this.paused,ended:this.ended},e)):this.onBlur(e)}},{key:"onFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},i=t.autoHide,n=void 0===i?!this.config.closePlayerBlur:i,r=t.delay,a=void 0===r?this.config.inactive:r;this.isActive=!0,this.removeClass(L["a"].INACTIVE),this.userTimer&&(s["b"].clearTimeout(this,this.userTimer),this.userTimer=null),n?this.userTimer=s["b"].setTimeout(this,(function(){e.userTimer=null,e.blur()}),a):this.userTimer&&(s["b"].clearTimeout(this,this.userTimer),this.userTimer=null)}},{key:"onBlur",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.ignorePaused,i=void 0!==t&&t;if(this.isActive){var n=this.config.closePauseVideoFocus;this.isActive=!1,(i||n||!this.paused&&!this.ended)&&this.addClass(L["a"].INACTIVE)}}},{key:"onEmptied",value:function(){this.updateAcc("emptied")}},{key:"onCanplay",value:function(){this.removeClass(L["a"].ENTER),this.removeClass(L["a"].ERROR),this.removeClass(L["a"].LOADING),this.isCanplay=!0,this.waitTimer&&s["b"].clearTimeout(this,this.waitTimer)}},{key:"onLoadeddata",value:function(){this.isError=!1,this.isSeeking=!1}},{key:"onLoadstart",value:function(){this.removeClass(L["a"].ERROR),this.isCanplay=!1}},{key:"onPlay",value:function(){this.state===D["a"].ENDED&&this.setState(D["a"].RUNNING),this.removeClass(L["a"].PAUSED),this.ended&&this.removeClass(L["a"].ENDED),!this.config.closePlayVideoFocus&&this.focus()}},{key:"onPause",value:function(){this.addClass(L["a"].PAUSED),this.updateAcc("pause"),this.config.closePauseVideoFocus||(this.userTimer&&(s["b"].clearTimeout(this,this.userTimer),this.userTimer=null),this.focus())}},{key:"onEnded",value:function(){this.updateAcc("ended"),this.addClass(L["a"].ENDED),this.setState(D["a"].ENDED)}},{key:"onError",value:function(){this.isError=!0,this.updateAcc("error"),this.removeClass(L["a"].NOT_ALLOW_AUTOPLAY),this.removeClass(L["a"].NO_START),this.removeClass(L["a"].ENTER),this.removeClass(L["a"].LOADING),this.addClass(L["a"].ERROR)}},{key:"onSeeking",value:function(){this.isSeeking||this.updateAcc("seeking"),this.isSeeking=!0,this.addClass(L["a"].SEEKING)}},{key:"onSeeked",value:function(){this.isSeeking=!1,this.waitTimer&&s["b"].clearTimeout(this,this.waitTimer),this.removeClass(L["a"].LOADING),this.removeClass(L["a"].SEEKING)}},{key:"onWaiting",value:function(){var e=this;this.waitTimer&&s["b"].clearTimeout(this,this.waitTimer),this.updateAcc("waiting"),this.waitTimer=s["b"].setTimeout(this,(function(){e.addClass(L["a"].LOADING),s["b"].clearTimeout(e,e.waitTimer),e.waitTimer=null}),200)}},{key:"onPlaying",value:function(){var e=this;this.isError=!1;var t=L["a"].NO_START,i=L["a"].PAUSED,n=L["a"].ENDED,r=L["a"].ERROR,a=L["a"].REPLAY,s=L["a"].LOADING,o=[t,i,n,r,a,s];o.forEach((function(t){e.removeClass(t)}))}},{key:"onTimeupdate",value:function(){!this._videoHeight&&this.resize(),(this.waitTimer||this.hasClass(L["a"].LOADING))&&this.media.readyState>2&&(this.removeClass(L["a"].LOADING),s["b"].clearTimeout(this,this.waitTimer),this.waitTimer=null),!this.paused&&this.state<D["a"].RUNNING&&this.duration&&(this.setState(D["a"].RUNNING),this.emit(u["AUTOPLAY_STARTED"])),this._accPlayed.t||this.paused||this.ended||(this._accPlayed.t=(new Date).getTime())}},{key:"onVolumechange",value:function(){"Number"===s["b"].typeOf(this.config.volume)&&(this.config.volume=this.volume)}},{key:"onRatechange",value:function(){this.config.defaultPlaybackRate=this.playbackRate}},{key:"emitUserAction",value:function(e,t,i){if(this.media&&t&&e){var r="String"===s["b"].typeOf(e)?e:e.type||"";i.props&&"Array"!==s["b"].typeOf(i.props)&&(i.props=[i.props]),this.emit(u["USER_ACTION"],Object(n["i"])({eventType:r,action:t,currentTime:this.currentTime,duration:this.duration,ended:this.ended,event:e},i))}}},{key:"updateAcc",value:function(e){if(this._accPlayed.t){var t=(new Date).getTime()-this._accPlayed.t;this._accPlayed.acc+=t,this._accPlayed.t=0,("ended"===e||this.ended)&&(this._accPlayed.loopAcc=this._accPlayed.acc)}}},{key:"checkBuffer",value:function(e){var t=this.media.buffered;if(!t||0===t.length||!this.duration)return!0;for(var i=e||this.media.currentTime||.2,n=t.length,r=0;r<n;r++)if(t.start(r)<=i&&t.end(r)>i)return!0;return!1}},{key:"position",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{h:0,y:0,x:0,w:0};if(this.media&&e&&e.h){var t=1/e.h,i=1!==t?"scale(".concat(t,")"):"",n=0,r=0;e.y&&(r=(100-100*e.h)/2-100*e.y),e.w&&e.x&&(n=(100-100*e.w)/2-100*e.x),i+=" translate(".concat(n,"%, ").concat(r,"%)"),this.media.style.transform=i,this.media.style.webkitTransform=i}}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(i){if("plugins"!==i){t.config[i]=e[i];var n=t.plugins[i.toLowerCase()];n&&"Function"===s["b"].typeOf(n.setConfig)&&n.setConfig(e[i])}}))}},{key:"playNext",value:function(e){var t=this;this.resetState(),this.setConfig(e),this._currentTime=0,this._duration=0,Object(O["f"])(this,"playnext",(function(){t.start(),t.emit(u["PLAYNEXT"],e)}))}},{key:"resize",value:function(){var e=this;if(this.media){var t=this.media,i=t.videoWidth,n=t.videoHeight,r=this.config,a=r.fitVideoSize,s=r.videoFillMode;if("fill"!==s&&"cover"!==s||this.setAttribute("data-xgfill",s),n&&i){this._videoHeight=n,this._videoWidth=i;var o=this.root.getBoundingClientRect(),l=this.controls&&this.innerContainer?this.controls.root.getBoundingClientRect().height:0,c=o.width,h=o.height-l,d=parseInt(i/n*1e3,10),f=parseInt(c/h*1e3,10),g=c,v=h,p={};"auto"===a&&f>d||"fixWidth"===a?(v=c/d*1e3,this.config.fluid?p.paddingTop="".concat(100*v/g,"%"):p.height="".concat(v+l,"px")):("auto"===a&&f<d||"fixHeight"===a)&&(g=d*h/1e3,p.width="".concat(g,"px")),this.fullscreen||this.cssfullscreen||Object.keys(p).forEach((function(t){e.root.style[t]=p[t]})),("fillHeight"===s&&f<d||"fillWidth"===s&&f>d)&&this.setAttribute("data-xgfill","cover");var m={videoScale:d,vWidth:g,vHeight:v,cWidth:g,cHeight:v+l};this.emit(u["VIDEO_RESIZE"],m)}}}},{key:"updateObjectPosition",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.media.updateObjectPosition?this.media.updateObjectPosition(e,t):this.media.style.objectPosition="".concat(100*e,"% ").concat(100*t,"%")}},{key:"setState",value:function(e){w["b"].logInfo("setState","state from:".concat(D["b"][this.state]," to:").concat(D["b"][e])),this._state=e}},{key:"state",get:function(){return this._state}},{key:"isFullscreen",get:function(){return this.fullscreen}},{key:"isCssfullScreen",get:function(){return this.cssfullscreen}},{key:"hasStart",get:function(){return this._hasStart},set:function(e){"boolean"===typeof e&&(this._hasStart=e,!1===e&&this.setState(D["a"].READY),this.emit("hasstart"))}},{key:"isPlaying",get:function(){return this._state===D["a"].RUNNING||this._state===D["a"].ENDED},set:function(e){e?this.setState(D["a"].RUNNING):this._state>=D["a"].RUNNING&&this.setState(D["a"].ATTACHED)}},{key:"definitionList",get:function(){return this.config&&this.config.definition&&this.config.definition.list||[]},set:function(e){var t=this,i=this.config.definition,n=null,r=null;i.list=e,this.emit("resourceReady",e),e.forEach((function(e){var a;(null===(a=t.curDefinition)||void 0===a?void 0:a.definition)===e.definition&&(n=e),i.defaultDefinition===e.definition&&(r=e)})),!r&&e.length>0&&(r=e[0]),n?this.changeDefinition(n):r&&this.changeDefinition(r)}},{key:"videoFrameInfo",get:function(){var e={total:0,dropped:0,corrupted:0,droppedRate:0,droppedDuration:0};if(!this.media||!this.media.getVideoPlaybackQuality)return e;var t=this.media.getVideoPlaybackQuality();return e.dropped=t.droppedVideoFrames||0,e.total=t.totalVideoFrames||0,e.corrupted=t.corruptedVideoFrames||0,e.total>0&&(e.droppedRate=e.dropped/e.total*100,e.droppedDuration=parseInt(this.cumulateTime/e.total*e.dropped,0)),e}},{key:"lang",get:function(){return this.config.lang},set:function(e){var t=x["a"].langKeys.filter((function(t){return t===e}));0===t.length&&"zh"!==e||(this.config.lang=e,_.setLang(e,this))}},{key:"i18n",get:function(){var e=this.config.lang;return"zh"===e&&(e="zh-cn"),this.__i18n.lang[e]||this.__i18n.lang.en}},{key:"i18nKeys",get:function(){return this.__i18n.textKeys||{}}},{key:"version",get:function(){return I["a"]}},{key:"playerId",get:function(){return this._pluginInfoId}},{key:"url",get:function(){return this.__url||this.config.url},set:function(e){this.__url=e}},{key:"poster",get:function(){return this.plugins.poster?this.plugins.poster.config.poster:this.config.poster},set:function(e){this.plugins.poster&&this.plugins.poster.update(e)}},{key:"readyState",get:function(){return Object(n["f"])(Object(n["g"])(i.prototype),"readyState",this)}},{key:"error",get:function(){var e=Object(n["f"])(Object(n["g"])(i.prototype),"error",this);return this.i18n[e]||e}},{key:"networkState",get:function(){return Object(n["f"])(Object(n["g"])(i.prototype),"networkState",this)}},{key:"fullscreenChanging",get:function(){return!(null===this._fullScreenOffset)}},{key:"cumulateTime",get:function(){var e=this._accPlayed;return this.updateAcc("get"),e.acc}},{key:"zoom",get:function(){return this.config.zoom},set:function(e){this.config.zoom=e}},{key:"avgSpeed",get:function(){return M},set:function(e){M=e}},{key:"realTimeSpeed",get:function(){return N},set:function(e){N=e}},{key:"hook",value:function(e,t){return O["c"].call.apply(O["c"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"useHooks",value:function(e,t){return O["g"].call.apply(O["g"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removeHooks",value:function(e,t){return O["d"].call.apply(O["d"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"usePluginHooks",value:function(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];return O["h"].call.apply(O["h"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"removePluginHooks",value:function(e,t,i){for(var n=arguments.length,r=new Array(n>3?n-3:0),a=3;a<n;a++)r[a-3]=arguments[a];return O["e"].call.apply(O["e"],[this].concat(Array.prototype.slice.call(arguments)))}},{key:"setUserActive",value:function(e,t){"boolean"===typeof t&&t!==this.muted&&(this.addInnerOP("volumechange"),this.muted=t),_.setCurrentUserActive(this.playerId,e)}}],[{key:"debugger",get:function(){return w["b"].config.debug},set:function(e){w["b"].config.debug=e}},{key:"getCurrentUserActivePlayerId",value:function(){return _.getCurrentUseActiveId()}},{key:"setCurrentUserActive",value:function(e,t){_.setCurrentUserActive(e,t)}},{key:"isHevcSupported",value:function(){return o["a"].isHevcSupported()}},{key:"probeConfigSupported",value:function(e){return o["a"].probeConfigSupported(e)}},{key:"install",value:function(e,t){i.plugins||(i.plugins={}),i.plugins[e]||(i.plugins[e]=t)}},{key:"use",value:function(e,t){i.plugins||(i.plugins={}),i.plugins[e]=t}}]),i}(d);Object(n["e"])(F,"defaultPreset",null),Object(n["e"])(F,"XgVideoProxy",null)},"5e99":function(e,t,i){"use strict";i.d(t,"a",(function(){return d}));var n=i("0210"),r=i("9a98"),a={LANG:"en",TEXT:{ERROR_TYPES:{network:{code:1,msg:"video download error"},mse:{code:2,msg:"stream append error"},parse:{code:3,msg:"parsing error"},format:{code:4,msg:"wrong format"},decoder:{code:5,msg:"decoding error"},runtime:{code:6,msg:"grammatical errors"},timeout:{code:7,msg:"play timeout"},other:{code:8,msg:"other errors"}},HAVE_NOTHING:"There is no information on whether audio/video is ready",HAVE_METADATA:"Audio/video metadata is ready ",HAVE_CURRENT_DATA:"Data about the current play location is available, but there is not enough data to play the next frame/millisecond",HAVE_FUTURE_DATA:"Current and at least one frame of data is available",HAVE_ENOUGH_DATA:"The available data is sufficient to start playing",NETWORK_EMPTY:"Audio/video has not been initialized",NETWORK_IDLE:"Audio/video is active and has been selected for resources, but no network is used",NETWORK_LOADING:"The browser is downloading the data",NETWORK_NO_SOURCE:"No audio/video source was found",MEDIA_ERR_ABORTED:"The fetch process is aborted by the user",MEDIA_ERR_NETWORK:"An error occurred while downloading",MEDIA_ERR_DECODE:"An error occurred while decoding",MEDIA_ERR_SRC_NOT_SUPPORTED:"Audio/video is not supported",REPLAY:"Replay",ERROR:"Network is offline",PLAY_TIPS:"Play",PAUSE_TIPS:"Pause",PLAYNEXT_TIPS:"Play next",DOWNLOAD_TIPS:"Download",ROTATE_TIPS:"Rotate",RELOAD_TIPS:"Reload",FULLSCREEN_TIPS:"Fullscreen",EXITFULLSCREEN_TIPS:"Exit fullscreen",CSSFULLSCREEN_TIPS:"Cssfullscreen",EXITCSSFULLSCREEN_TIPS:"Exit cssfullscreen",TEXTTRACK:"Caption",PIP:"PIP",SCREENSHOT:"Screenshot",LIVE:"LIVE",OFF:"Off",OPEN:"Open",MINI_DRAG:"Click and hold to drag",MINISCREEN:"Miniscreen",REFRESH_TIPS:"Please Try",REFRESH:"Refresh",FORWARD:"forward",LIVE_TIP:"Live"}},s={lang:{},langKeys:[],textKeys:[]};function o(e,t){return Object.keys(t).forEach((function(i){var a,s=r["b"].typeOf(t[i]),l=r["b"].typeOf(e[i]);"Array"===s?("Array"!==l&&(e[i]=[]),(a=e[i]).push.apply(a,Object(n["k"])(t[i]))):"Object"===s?("Object"!==l&&(e[i]={}),o(e[i],t[i])):e[i]=t[i]})),e}function l(){Object.keys(s.lang.en).map((function(e){s.textKeys[e]=e}))}function u(e,t){var i=[];if(t||(t=s),t.lang){i="Array"!==r["b"].typeOf(e)?Object.keys(e).map((function(t){var i="zh"===t?"zh-cn":t;return{LANG:i,TEXT:e[t]}})):e;var n=t,a=n.lang;i.map((function(e){"zh"===e.LANG&&(e.LANG="zh-cn"),a[e.LANG]?o(a[e.LANG]||{},e.TEXT||{}):c(e,t)})),l()}}function c(e,t){var i=e.LANG;if(t||(t=s),t.lang){var n=e.TEXT||{};"zh"===i&&(i="zh-cn"),t.lang[i]?o(t.lang[i],n):(t.langKeys.push(i),t.lang[i]=n),l()}}function h(e){var t,i={lang:{},langKeys:[],textKeys:{},pId:e};return o(i.lang,s.lang),(t=i.langKeys).push.apply(t,Object(n["k"])(s.langKeys)),o(i.textKeys,s.textKeys),i}c(a);var d={get textKeys(){return s.textKeys},get langKeys(){return s.langKeys},get lang(){var e={};return s.langKeys.map((function(t){e[t]=s.lang[t]})),s.lang["zh-cn"]&&(e.zh=s.lang["zh-cn"]||{}),e},extend:u,use:c,init:h}},"674d":function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n={LANG:"zh-cn",TEXT:{ERROR_TYPES:{network:{code:1,msg:""},mse:{code:2,msg:""},parse:{code:3,msg:""},format:{code:4,msg:""},decoder:{code:5,msg:""},runtime:{code:6,msg:""},timeout:{code:7,msg:""},other:{code:8,msg:""}},HAVE_NOTHING:"/",HAVE_METADATA:"/",HAVE_CURRENT_DATA:"/",HAVE_FUTURE_DATA:"",HAVE_ENOUGH_DATA:"",NETWORK_EMPTY:"/",NETWORK_IDLE:"/",NETWORK_LOADING:"",NETWORK_NO_SOURCE:"/",MEDIA_ERR_ABORTED:"",MEDIA_ERR_NETWORK:"",MEDIA_ERR_DECODE:"",MEDIA_ERR_SRC_NOT_SUPPORTED:"/",REPLAY:"",ERROR:"",PLAY_TIPS:"",PAUSE_TIPS:"",PLAYNEXT_TIPS:"",DOWNLOAD_TIPS:"",ROTATE_TIPS:"",RELOAD_TIPS:"",FULLSCREEN_TIPS:"",EXITFULLSCREEN_TIPS:"",CSSFULLSCREEN_TIPS:"",EXITCSSFULLSCREEN_TIPS:"",TEXTTRACK:"",PIP:"",SCREENSHOT:"",LIVE:"",OFF:"",OPEN:"",MINI_DRAG:"",MINISCREEN:"",REFRESH_TIPS:"",REFRESH:"",FORWARD:"",LIVE_TIP:""}}},"8c50":function(e,t,i){var n=i("94d8");function r(e,t,i,n,r){var a=s.apply(this,arguments);return e.addEventListener(i,a,r),{destroy:function(){e.removeEventListener(i,a,r)}}}function a(e,t,i,n,a){return"function"===typeof e.addEventListener?r.apply(null,arguments):"function"===typeof i?r.bind(null,document).apply(null,arguments):("string"===typeof e&&(e=document.querySelectorAll(e)),Array.prototype.map.call(e,(function(e){return r(e,t,i,n,a)})))}function s(e,t,i,r){return function(i){i.delegateTarget=n(i.target,t),i.delegateTarget&&r.call(e,i)}}e.exports=a},"94d8":function(e,t){var i=9;if("undefined"!==typeof Element&&!Element.prototype.matches){var n=Element.prototype;n.matches=n.matchesSelector||n.mozMatchesSelector||n.msMatchesSelector||n.oMatchesSelector||n.webkitMatchesSelector}function r(e,t){while(e&&e.nodeType!==i){if("function"===typeof e.matches&&e.matches(t))return e;e=e.parentNode}}e.exports=r},"9a98":function(e,t,i){"use strict";i.d(t,"a",(function(){return d})),i.d(t,"b",(function(){return s})),i.d(t,"c",(function(){return h})),i.d(t,"d",(function(){return c}));var n=i("0210"),r=i("d2c7"),a=function(){function e(t){Object(n["b"])(this,e),this.bufferedList=t}return Object(n["c"])(e,[{key:"start",value:function(e){return this.bufferedList[e].start}},{key:"end",value:function(e){return this.bufferedList[e].end}},{key:"length",get:function(){return this.bufferedList.length}}]),e}(),s={};function o(e,t){for(var i=0,n=t.length;i<n;i++)if(e.indexOf(t[i])>-1)return!0;return!1}function l(e){var t=Object(n["l"])(e);return null!==e&&("object"===t||"function"===t)}function u(e,t,i){var n,r,a,s,o,u,c=0,h=!1,d=!1,f=!0,g=!t&&0!==t&&"function"===typeof window.requestAnimationFrame;if("function"!==typeof e)throw new TypeError("Expected a function");function v(t){var i=n,a=r;return n=r=void 0,c=t,s=e.apply(a,i),s}function p(e,t){return g?(window.cancelAnimationFrame(o),window.requestAnimationFrame(e)):setTimeout(e,t)}function m(e){if(g)return window.cancelAnimationFrame(e);clearTimeout(e)}function y(e){return c=e,o=p(T,t),h?v(e):s}function b(e){var i=e-u,n=e-c,r=t-i;return d?Math.min(r,a-n):r}function E(e){var i=e-u,n=e-c;return void 0===u||i>=t||i<0||d&&n>=a}function T(){var e=Date.now();if(E(e))return k(e);o=p(T,b(e))}function k(e){return o=void 0,f&&n?v(e):(n=r=void 0,s)}function S(){void 0!==o&&m(o),c=0,n=u=r=o=void 0}function _(){return void 0===o?s:k(Date.now())}function L(){return void 0!==o}function A(){for(var e=Date.now(),i=E(e),a=arguments.length,l=new Array(a),c=0;c<a;c++)l[c]=arguments[c];if(n=l,r=this,u=e,i){if(void 0===o)return y(u);if(d)return o=p(T,t),v(u)}return void 0===o&&(o=p(T,t)),s}return t=+t||0,l(i)&&(h=!!i.leading,d="maxWait"in i,a=d?Math.max(+i.maxWait||0,t):a,f="trailing"in i?!!i.trailing:f),A.cancel=S,A.flush=_,A.pending=L,A}function c(e,t,i){var n=!0,r=!0;if("function"!==typeof e)throw new TypeError("Expected a function");return l(i)&&(n="leading"in i?!!i.leading:n,r="trailing"in i?!!i.trailing:r),u(e,t,{leading:n,trailing:r,maxWait:t})}function h(){var e=(document.documentElement.getAttribute("lang")||navigator.language||"zh-cn").toLocaleLowerCase();return"zh-cn"===e&&(e="zh"),e}function d(e,t,i){if(e){var n=e.getAttribute(i);return!(!n||n!==t||"VIDEO"!==e.tagName&&"AUDIO"!==e.tagName)}}s.createDom=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"div",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",r=document.createElement(e);return r.className=n,r.innerHTML=t,Object.keys(i).forEach((function(t){var n=t,a=i[t];"video"===e||"audio"===e||"live-video"===e?a&&r.setAttribute(n,a):r.setAttribute(n,a)})),r},s.createDomFromHtml=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";try{var n=document.createElement("div");n.innerHTML=e;var a=n.children;return n=null,a.length>0?(a=a[0],i&&s.addClass(a,i),t&&Object.keys(t).forEach((function(e){a.setAttribute(e,t[e])})),a):null}catch(o){return r["b"].logError("util.createDomFromHtml",o),null}},s.hasClass=function(e,t){if(!e||!t)return!1;try{return Array.prototype.some.call(e.classList,(function(e){return e===t}))}catch(r){var i=e.className&&"object"===Object(n["l"])(e.className)?e.getAttribute("class"):e.className;return i&&!!i.match(new RegExp("(\\s|^)"+t+"(\\s|$)"))}},s.addClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.add(t)}))}catch(i){s.hasClass(e,t)||(e.className&&"object"===Object(n["l"])(e.className)?e.setAttribute("class",e.getAttribute("class")+" "+t):e.className+=" "+t)}},s.removeClass=function(e,t){if(e&&t)try{t.replace(/(^\s+|\s+$)/g,"").split(/\s+/g).forEach((function(t){t&&e.classList.remove(t)}))}catch(i){s.hasClass(e,t)&&t.split(/\s+/g).forEach((function(t){var i=new RegExp("(\\s|^)"+t+"(\\s|$)");e.className&&"object"===Object(n["l"])(e.className)?e.setAttribute("class",e.getAttribute("class").replace(i," ")):e.className=e.className.replace(i," ")}))}},s.toggleClass=function(e,t){e&&t.split(/\s+/g).forEach((function(t){s.hasClass(e,t)?s.removeClass(e,t):s.addClass(e,t)}))},s.classNames=function(){for(var e=arguments,t=[],i=function(i){"String"===s.typeOf(e[i])?t.push(e[i]):"Object"===s.typeOf(e[i])&&Object.keys(e[i]).map((function(n){e[i][n]&&t.push(n)}))},n=0;n<arguments.length;n++)i(n);return t.join(" ")},s.findDom=function(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document,i=arguments.length>1?arguments[1]:void 0;try{e=t.querySelector(i)}catch(n){r["b"].logError("util.findDom",n),0===i.indexOf("#")&&(e=t.getElementById(i.slice(1)))}return e},s.getCss=function(e,t){return e.currentStyle?e.currentStyle[t]:document.defaultView.getComputedStyle(e,!1)[t]},s.padStart=function(e,t,i){var n=String(i),r=t>>0,a=Math.ceil(r/n.length),s=[],o=String(e);while(a--)s.push(n);return s.join("").substring(0,r-o.length)+o},s.format=function(e){if(window.isNaN(e))return"";e=Math.round(e);var t=s.padStart(Math.floor(e/3600),2,0),i=s.padStart(Math.floor((e-3600*t)/60),2,0),n=s.padStart(Math.floor(e-3600*t-60*i),2,0);return("00"===t?[i,n]:[t,i,n]).join(":")},s.event=function(e){if(e.touches){var t=e.touches[0]||e.changedTouches[0];e.clientX=t.clientX||0,e.clientY=t.clientY||0,e.offsetX=t.pageX-t.target.offsetLeft,e.offsetY=t.pageY-t.target.offsetTop}e._target=e.target||e.srcElement},s.typeOf=function(e){return Object.prototype.toString.call(e).match(/([^\s.*]+)(?=]$)/g)[0]},s.deepCopy=function(e,t){if("Object"===s.typeOf(t)&&"Object"===s.typeOf(e))return Object.keys(t).forEach((function(i){"Object"!==s.typeOf(t[i])||t[i]instanceof Node?"Array"===s.typeOf(t[i])?e[i]="Array"===s.typeOf(e[i])?e[i].concat(t[i]):t[i]:e[i]=t[i]:void 0===e[i]||void 0===e[i]?e[i]=t[i]:s.deepCopy(e[i],t[i])})),e},s.deepMerge=function(e,t){return Object.keys(t).map((function(i){var r;"Array"===s.typeOf(t[i])&&"Array"===s.typeOf(e[i])?"Array"===s.typeOf(e[i])&&(r=e[i]).push.apply(r,Object(n["k"])(t[i])):s.typeOf(e[i])!==s.typeOf(t[i])||null===e[i]||"Object"!==s.typeOf(e[i])||t[i]instanceof window.Node?null!==t[i]&&(e[i]=t[i]):s.deepMerge(e[i],t[i])})),e},s.getBgImage=function(e){var t=(e.currentStyle||window.getComputedStyle(e,null)).backgroundImage;if(!t||"none"===t)return"";var i=document.createElement("a");return i.href=t.replace(/url\("|"\)/g,""),i.href},s.copyDom=function(e){if(e&&1===e.nodeType){var t=document.createElement(e.tagName);return Array.prototype.forEach.call(e.attributes,(function(e){t.setAttribute(e.name,e.value)})),e.innerHTML&&(t.innerHTML=e.innerHTML),t}return""},s.setInterval=function(e,t,i,n){e._interval[t]||(e._interval[t]=window.setInterval(i.bind(e),n))},s.clearInterval=function(e,t){clearInterval(e._interval[t]),e._interval[t]=null},s.setTimeout=function(e,t,i){e._timers||(e._timers=[]);var n=setTimeout((function(){t(),s.clearTimeout(e,n)}),i);return e._timers.push(n),n},s.clearTimeout=function(e,t){var i=e._timers;if("Array"===s.typeOf(i)){for(var n=0;n<i.length;n++)if(i[n]===t){i.splice(n,1),clearTimeout(t);break}}else clearTimeout(t)},s.clearAllTimers=function(e){var t=e._timers;"Array"===s.typeOf(t)&&(t.map((function(e){clearTimeout(e)})),e._timerIds=[])},s.createImgBtn=function(e,t,i,n){var r,a,o,l=s.createDom("xg-".concat(e),"",{},"xgplayer-".concat(e,"-img"));(l.style.backgroundImage='url("'.concat(t,'")'),i&&n)&&(["px","rem","em","pt","dp","vw","vh","vm","%"].every((function(e){return!(i.indexOf(e)>-1&&n.indexOf(e)>-1)||(r=parseFloat(i.slice(0,i.indexOf(e)).trim()),a=parseFloat(n.slice(0,n.indexOf(e)).trim()),o=e,!1)})),l.style.width="".concat(r).concat(o),l.style.height="".concat(a).concat(o),l.style.backgroundSize="".concat(r).concat(o," ").concat(a).concat(o),l.style.margin="start"===e?"-".concat(a/2).concat(o," auto auto -").concat(r/2).concat(o):"auto 5px auto 5px");return l},s.Hex2RGBA=function(e,t){var i=[];if(/^\#[0-9A-F]{3}$/i.test(e)){var n="#";e.replace(/[0-9A-F]/gi,(function(e){n+=e+e})),e=n}return/^#[0-9A-F]{6}$/i.test(e)?(e.replace(/[0-9A-F]{2}/gi,(function(e){i.push(parseInt(e,16))})),"rgba(".concat(i.join(","),", ").concat(t,")")):"rgba(255, 255, 255, 0.1)"},s.getFullScreenEl=function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},s.checkIsFunction=function(e){return e&&"function"===typeof e},s.checkIsObject=function(e){return null!==e&&"object"===Object(n["l"])(e)},s.hide=function(e){e.style.display="none"},s.show=function(e,t){e.style.display=t||"block"},s.isUndefined=function(e){if("undefined"===typeof e||null===e)return!0},s.isNotNull=function(e){return!(void 0===e||null===e)},s.setStyleFromCsstext=function(e,t){if(t)if("String"===s.typeOf(t)){var i=t.replace(/\s+/g,"").split(";");i.map((function(t){if(t){var i=t.split(":");i.length>1&&(e.style[i[0]]=i[1])}}))}else Object.keys(t).map((function(i){e.style[i]=t[i]}))},s.filterStyleFromText=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:["width","height","top","left","bottom","right","position","z-index","padding","margin","transform"],i=e.style.cssText;if(!i)return{};var n=i.replace(/\s+/g,"").split(";"),r={},a={};return n.map((function(e){if(e){var i=e.split(":");i.length>1&&(o(i[0],t)?r[i[0]]=i[1]:a[i[0]]=i[1])}})),e.setAttribute("style",""),Object.keys(a).map((function(t){e.style[t]=a[t]})),r},s.getStyleFromCsstext=function(e){var t=e.style.cssText;if(!t)return{};var i=t.replace(/\s+/g,"").split(";"),n={};return i.map((function(e){if(e){var t=e.split(":");t.length>1&&(n[t[0]]=t[1])}})),n},s.preloadImg=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(){},i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){var n=new window.Image;n.onload=function(e){n=null,t&&t(e)},n.onerror=function(e){n=null,i&&i(e)},n.src=e}},s.stopPropagation=function(e){e&&(e.stopPropagation(),e.cancelable&&e.preventDefault())},s.scrollTop=function(){return window.pageYOffset||document.documentElement.scrollTop||document.body.scrollTop||0},s.scrollLeft=function(){return window.pageXOffset||document.documentElement.scrollLeft||document.body.scrollLeft||0},s.checkTouchSupport=function(){return"ontouchstart"in window},s.getBuffered2=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.5,i=[],n=0;n<e.length;n++)i.push({start:e.start(n)<.5?0:e.start(n),end:e.end(n)});i.sort((function(e,t){var i=e.start-t.start;return i||t.end-e.end}));var r=[];if(t)for(var s=0;s<i.length;s++){var o=r.length;if(o){var l=r[o-1].end;i[s].start-l<t?i[s].end>l&&(r[o-1].end=i[s].end):r.push(i[s])}else r.push(i[s])}else r=i;return new a(r)},s.getEventPos=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.touches&&e.touches.length>0&&(e=e.touches[0]),{x:e.x/t,y:e.y/t,clientX:e.clientX/t,clientY:e.clientY/t,offsetX:e.offsetX/t,offsetY:e.offsetY/t,pageX:e.pageX/t,pageY:e.pageY/t}},s.requestAnimationFrame=function(e){var t=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame;if(t)return t(e)},s.getHostFromUrl=function(e){if("String"!==s.typeOf(e))return"";var t=e.split("/"),i="";return t.length>3&&t[2]&&(i=t[2]),i},s.cancelAnimationFrame=function(e){var t=window.cancelAnimationFrame||window.mozCancelAnimationFrame||window.cancelRequestAnimationFrame;t&&t(e)},s.isMSE=function(e){return!!(e&&e instanceof HTMLMediaElement)&&(/^blob/.test(e.currentSrc)||/^blob/.test(e.src))},s.generateSessionId=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=(new Date).getTime();try{e=parseInt(e)}catch(n){e=0}t+=e,window.performance&&"function"===typeof window.performance.now&&(t+=parseInt(window.performance.now()));var i="xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"===e?i:3&i|8).toString(16)}));return i},s.createEvent=function(e){var t;return"function"===typeof window.Event?t=new Event(e):(t=document.createEvent("Event"),t.initEvent(e,!0,!0)),t},s.adjustTimeByDuration=function(e,t,i){return t&&e&&(e>t||i&&e<t)?t:e},s.createPositionBar=function(e,t){var i=s.createDom("xg-bar","",{"data-index":-1},e);return t.appendChild(i),i}},a45c:function(e,t,i){"use strict";i.d(t,"a",(function(){return n})),i.d(t,"b",(function(){return r}));var n={INITIAL:1,READY:2,ATTACHING:3,ATTACHED:4,NOTALLOW:5,RUNNING:6,ENDED:7,DESTROYED:8},r=["ERROR","INITIAL","READY","ATTACHING","ATTACHED","NOTALLOW","RUNNING","ENDED","DESTROYED"]},aeb1:function(e,t,i){var n,r,a;(function(i,s){r=[],n=s,a="function"===typeof n?n.apply(t,r):n,void 0===a||(e.exports=a)})(0,(function(){return function e(t,i,n){var r,a,s=window,o="application/octet-stream",l=n||o,u=t,c=!i&&!n&&u,h=document.createElement("a"),d=function(e){return String(e)},f=s.Blob||s.MozBlob||s.WebKitBlob||d,g=i||"download";if(f=f.call?f.bind(s):Blob,"true"===String(this)&&(u=[u,l],l=u[0],u=u[1]),c&&c.length<2048&&(g=c.split("/").pop().split("?")[0],h.href=c,-1!==h.href.indexOf(c))){var v=new XMLHttpRequest;return v.open("GET",c,!0),v.responseType="blob",v.onload=function(t){e(t.target.response,g,o)},setTimeout((function(){v.send()}),0),v}if(/^data:([\w+-]+\/[\w+.-]+)?[,;]/.test(u)){if(!(u.length>2096103.424&&f!==d))return navigator.msSaveBlob?navigator.msSaveBlob(b(u),g):E(u);u=b(u),l=u.type||o}else if(/([\x80-\xff])/.test(u)){var p=0,m=new Uint8Array(u.length),y=m.length;for(p;p<y;++p)m[p]=u.charCodeAt(p);u=new f([m],{type:l})}function b(e){var t=e.split(/[:;,]/),i=t[1],n="base64"==t[2]?atob:decodeURIComponent,r=n(t.pop()),a=r.length,s=0,o=new Uint8Array(a);for(s;s<a;++s)o[s]=r.charCodeAt(s);return new f([o],{type:i})}function E(e,t){if("download"in h)return h.href=e,h.setAttribute("download",g),h.className="download-js-link",h.innerHTML="downloading...",h.style.display="none",document.body.appendChild(h),setTimeout((function(){h.click(),document.body.removeChild(h),!0===t&&setTimeout((function(){s.URL.revokeObjectURL(h.href)}),250)}),66),!0;if(/(Version)\/(\d+)\.(\d+)(?:\.(\d+))?.*Safari\//.test(navigator.userAgent))return/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),window.open(e)||confirm("Displaying New Document\n\nUse Save As... to download, then click back to return to this page.")&&(location.href=e),!0;var i=document.createElement("iframe");document.body.appendChild(i),!t&&/^data:/.test(e)&&(e="data:"+e.replace(/^data:([\w\/\-\+]+)/,o)),i.src=e,setTimeout((function(){document.body.removeChild(i)}),333)}if(r=u instanceof f?u:new f([u],{type:l}),navigator.msSaveBlob)return navigator.msSaveBlob(r,g);if(s.URL)E(s.URL.createObjectURL(r),!0);else{if("string"===typeof r||r.constructor===d)try{return E("data:"+l+";base64,"+s.btoa(r))}catch(T){return E("data:"+l+","+encodeURIComponent(r))}a=new FileReader,a.onload=function(e){E(this.result)},a.readAsDataURL(r)}return!0}}))},b28d:function(e,t,i){"use strict";i.r(t),i.d(t,"ABORT",(function(){return S})),i.d(t,"AFTER_DEFINITION_CHANGE",(function(){return G})),i.d(t,"AUTOPLAY_PREVENTED",(function(){return w})),i.d(t,"AUTOPLAY_STARTED",(function(){return R})),i.d(t,"BEFORE_DEFINITION_CHANGE",(function(){return B})),i.d(t,"BUFFER_CHANGE",(function(){return _})),i.d(t,"CANPLAY",(function(){return d})),i.d(t,"CANPLAY_THROUGH",(function(){return f})),i.d(t,"COMPLETE",(function(){return x})),i.d(t,"CSS_FULLSCREEN_CHANGE",(function(){return F})),i.d(t,"DEFINITION_CHANGE",(function(){return U})),i.d(t,"DESTROY",(function(){return D})),i.d(t,"DOWNLOAD_SPEED_CHANGE",(function(){return N})),i.d(t,"DURATION_CHANGE",(function(){return g})),i.d(t,"EMPTIED",(function(){return E})),i.d(t,"ENDED",(function(){return a})),i.d(t,"ERROR",(function(){return o})),i.d(t,"FPS_STUCK",(function(){return ie})),i.d(t,"FULLSCREEN_CHANGE",(function(){return M})),i.d(t,"LOADED_DATA",(function(){return p})),i.d(t,"LOAD_START",(function(){return b})),i.d(t,"MINI_STATE_CHANGE",(function(){return j})),i.d(t,"PAUSE",(function(){return s})),i.d(t,"PIP_CHANGE",(function(){return W})),i.d(t,"PLAY",(function(){return n})),i.d(t,"PLAYER_BLUR",(function(){return A})),i.d(t,"PLAYER_FOCUS",(function(){return L})),i.d(t,"PLAYING",(function(){return r})),i.d(t,"PLAYNEXT",(function(){return X})),i.d(t,"PROGRESS",(function(){return y})),i.d(t,"RATE_CHANGE",(function(){return m})),i.d(t,"READY",(function(){return C})),i.d(t,"REPLAY",(function(){return I})),i.d(t,"RESET",(function(){return J})),i.d(t,"RETRY",(function(){return V})),i.d(t,"ROTATE",(function(){return Y})),i.d(t,"SCREEN_SHOT",(function(){return z})),i.d(t,"SEEKED",(function(){return u})),i.d(t,"SEEKING",(function(){return l})),i.d(t,"SEI_PARSED",(function(){return H})),i.d(t,"SHORTCUT",(function(){return q})),i.d(t,"STALLED",(function(){return T})),i.d(t,"STATS_EVENTS",(function(){return te})),i.d(t,"SUSPEND",(function(){return k})),i.d(t,"SWITCH_SUBTITLE",(function(){return $})),i.d(t,"TIME_UPDATE",(function(){return c})),i.d(t,"URL_CHANGE",(function(){return P})),i.d(t,"URL_NULL",(function(){return O})),i.d(t,"USER_ACTION",(function(){return Q})),i.d(t,"VIDEO_EVENTS",(function(){return ee})),i.d(t,"VIDEO_RESIZE",(function(){return K})),i.d(t,"VOLUME_CHANGE",(function(){return v})),i.d(t,"WAITING",(function(){return h})),i.d(t,"XGLOG",(function(){return Z}));var n="play",r="playing",a="ended",s="pause",o="error",l="seeking",u="seeked",c="timeupdate",h="waiting",d="canplay",f="canplaythrough",g="durationchange",v="volumechange",p="loadeddata",m="ratechange",y="progress",b="loadstart",E="emptied",T="stalled",k="suspend",S="abort",_="bufferedChange",L="focus",A="blur",C="ready",O="urlNull",R="autoplay_started",w="autoplay_was_prevented",x="complete",I="replay",D="destroy",P="urlchange",N="download_speed_change",M="fullscreen_change",F="cssFullscreen_change",j="mini_state_change",U="definition_change",B="before_definition_change",G="after_definition_change",H="SEI_PARSED",V="retry",K="video_resize",W="pip_change",Y="rotate",z="screenShot",X="playnext",q="shortcut",Z="xglog",Q="user_action",J="reset",$="switch_subtitle",ee=["play","playing","ended","pause","error","seeking","seeked","timeupdate","waiting","canplay","canplaythrough","durationchange","volumechange","loadeddata","ratechange","progress","loadstart","emptied","stalled","suspend","abort","lowdecode"],te={STATS_INFO:"stats_info",STATS_DOWNLOAD:"stats_download",STATS_RESET:"stats_reset"},ie="fps_stuck"},b39b:function(e,t,i){"use strict";i.d(t,"a",(function(){return n}));var n={DEFAULT:"xgplayer",DEFAULT_SKIN:"xgplayer-skin-default",ENTER:"xgplayer-is-enter",PAUSED:"xgplayer-pause",PLAYING:"xgplayer-playing",ENDED:"xgplayer-ended",CANPLAY:"xgplayer-canplay",LOADING:"xgplayer-isloading",ERROR:"xgplayer-is-error",REPLAY:"xgplayer-replay",NO_START:"xgplayer-nostart",ACTIVE:"xgplayer-active",INACTIVE:"xgplayer-inactive",FULLSCREEN:"xgplayer-is-fullscreen",CSS_FULLSCREEN:"xgplayer-is-cssfullscreen",ROTATE_FULLSCREEN:"xgplayer-rotate-fullscreen",PARENT_ROTATE_FULLSCREEN:"xgplayer-rotate-parent",PARENT_FULLSCREEN:"xgplayer-fullscreen-parent",INNER_FULLSCREEN:"xgplayer-fullscreen-inner",NO_CONTROLS:"no-controls",FLEX_CONTROLS:"flex-controls",CONTROLS_FOLLOW:"controls-follow",CONTROLS_AUTOHIDE:"controls-autohide",TOP_BAR_AUTOHIDE:"top-bar-autohide",NOT_ALLOW_AUTOPLAY:"not-allow-autoplay",SEEKING:"seeking",PC:"xgplayer-pc",MOBILE:"xgplayer-mobile",MINI:"xgplayer-mini"}},b857:function(e,t,i){"use strict";i.d(t,"a",(function(){return a}));var n={android:/(Android)\s([\d.]+)/,ios:/(Version)\/([\d.]+)/},r=["avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","avc1.42E01E","mp4v.20.8","avc1.42E01E, mp4a.40.2","avc1.58A01E, mp4a.40.2","avc1.4D401E, mp4a.40.2","avc1.64001E, mp4a.40.2","mp4v.20.8, mp4a.40.2","mp4v.20.240, mp4a.40.2"],a={get device(){var e=a.os;return e.isPc?"pc":"mobile"},get browser(){if("undefined"===typeof navigator)return"";var e=navigator.userAgent.toLowerCase(),t={ie:/rv:([\d.]+)\) like gecko/,firefox:/firefox\/([\d.]+)/,chrome:/chrome\/([\d.]+)/,opera:/opera.([\d.]+)/,safari:/version\/([\d.]+).*safari/};return[].concat(Object.keys(t).filter((function(i){return t[i].test(e)})))[0]},get os(){if("undefined"===typeof navigator)return{};var e=navigator.userAgent,t=/(?:Windows Phone)/.test(e),i=/(?:SymbianOS)/.test(e)||t,n=/(?:Android)/.test(e),r=/(?:Firefox)/.test(e),a=/(?:iPad|PlayBook)/.test(e)||n&&!/(?:Mobile)/.test(e)||r&&/(?:Tablet)/.test(e),s=/(?:iPhone)/.test(e)&&!a,o=!s&&!n&&!i&&!a,l=/(?:iPad|PlayBook)/.test(e);return{isTablet:a,isPhone:s,isIpad:l,isIos:s||l,isAndroid:n,isPc:o,isSymbian:i,isWindowsPhone:t,isFireFox:r}},get osVersion(){if("undefined"===typeof navigator)return 0;var e=navigator.userAgent,t="";t=/(?:iPhone)|(?:iPad|PlayBook)/.test(e)?n.ios:n.android;var i=t?t.exec(e):[];if(i&&i.length>=3){var r=i[2].split(".");return r.length>0?parseInt(r[0]):0}return 0},get isWeixin(){if("undefined"===typeof navigator)return!1;var e=/(micromessenger)\/([\d.]+)/,t=e.exec(navigator.userAgent.toLocaleLowerCase());return!!t},isSupportMP4:function(){var e={isSupport:!1,mime:""};if("undefined"===typeof document)return e;if(this.supportResult)return this.supportResult;var t=document.createElement("video");return"function"===typeof t.canPlayType&&r.map((function(i){"probably"===t.canPlayType('video/mp4; codecs="'.concat(i,'"'))&&(e.isSupport=!0,e.mime+="||".concat(i))})),this.supportResult=e,t=null,e},isHevcSupported:function(){return!("undefined"===typeof MediaSource||!MediaSource.isTypeSupported)&&(MediaSource.isTypeSupported('video/mp4;codecs="hev1.1.6.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.2.4.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.3.E.L120.90"')||MediaSource.isTypeSupported('video/mp4;codecs="hev1.4.10.L120.90"'))},probeConfigSupported:function(e){var t={supported:!1,smooth:!1,powerEfficient:!1};if(!e||"undefined"===typeof navigator)return Promise.resolve(t);if(navigator.mediaCapabilities&&navigator.mediaCapabilities.decodingInfo)return navigator.mediaCapabilities.decodingInfo(e);var i=e.video||{},n=e.audio||{};try{var r=MediaSource.isTypeSupported(i.contentType),a=MediaSource.isTypeSupported(n.contentType);return Promise.resolve({supported:r&&a,smooth:!1,powerEfficient:!1})}catch(s){return Promise.resolve(t)}}}},b908:function(e,t,i){"use strict";i.d(t,"a",(function(){return g}));var n=i("0210"),r=i("476e"),a=i("dc4a"),s=i("2a75"),o=i("b28d"),l=i("b39b"),u=i("5e99"),c=i("2bdd"),h=i("b857"),d=i("9a98"),f=i("ea87"),g=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i)}(r["a"]);Object(n["e"])(g,"defaultPreset",f["a"]),Object(n["e"])(g,"Util",d["b"]),Object(n["e"])(g,"Sniffer",h["a"]),Object(n["e"])(g,"Errors",c["b"]),Object(n["e"])(g,"Events",o),Object(n["e"])(g,"Plugin",a["b"]),Object(n["e"])(g,"BasePlugin",s["a"]),Object(n["e"])(g,"I18N",u["a"]),Object(n["e"])(g,"STATE_CLASS",l["a"])},ba10:function(e,t,i){"use strict";var n=Object.prototype.hasOwnProperty,r="~";function a(){}function s(e,t,i){this.fn=e,this.context=t,this.once=i||!1}function o(e,t,i,n,a){if("function"!==typeof i)throw new TypeError("The listener must be a function");var o=new s(i,n||e,a),l=r?r+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],o]:e._events[l].push(o):(e._events[l]=o,e._eventsCount++),e}function l(e,t){0===--e._eventsCount?e._events=new a:delete e._events[t]}function u(){this._events=new a,this._eventsCount=0}Object.create&&(a.prototype=Object.create(null),(new a).__proto__||(r=!1)),u.prototype.eventNames=function(){var e,t,i=[];if(0===this._eventsCount)return i;for(t in e=this._events)n.call(e,t)&&i.push(r?t.slice(1):t);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},u.prototype.listeners=function(e){var t=r?r+e:e,i=this._events[t];if(!i)return[];if(i.fn)return[i.fn];for(var n=0,a=i.length,s=new Array(a);n<a;n++)s[n]=i[n].fn;return s},u.prototype.listenerCount=function(e){var t=r?r+e:e,i=this._events[t];return i?i.fn?1:i.length:0},u.prototype.emit=function(e,t,i,n,a,s){var o=r?r+e:e;if(!this._events[o])return!1;var l,u,c=this._events[o],h=arguments.length;if(c.fn){switch(c.once&&this.removeListener(e,c.fn,void 0,!0),h){case 1:return c.fn.call(c.context),!0;case 2:return c.fn.call(c.context,t),!0;case 3:return c.fn.call(c.context,t,i),!0;case 4:return c.fn.call(c.context,t,i,n),!0;case 5:return c.fn.call(c.context,t,i,n,a),!0;case 6:return c.fn.call(c.context,t,i,n,a,s),!0}for(u=1,l=new Array(h-1);u<h;u++)l[u-1]=arguments[u];c.fn.apply(c.context,l)}else{var d,f=c.length;for(u=0;u<f;u++)switch(c[u].once&&this.removeListener(e,c[u].fn,void 0,!0),h){case 1:c[u].fn.call(c[u].context);break;case 2:c[u].fn.call(c[u].context,t);break;case 3:c[u].fn.call(c[u].context,t,i);break;case 4:c[u].fn.call(c[u].context,t,i,n);break;default:if(!l)for(d=1,l=new Array(h-1);d<h;d++)l[d-1]=arguments[d];c[u].fn.apply(c[u].context,l)}}return!0},u.prototype.on=function(e,t,i){return o(this,e,t,i,!1)},u.prototype.once=function(e,t,i){return o(this,e,t,i,!0)},u.prototype.removeListener=function(e,t,i,n){var a=r?r+e:e;if(!this._events[a])return this;if(!t)return l(this,a),this;var s=this._events[a];if(s.fn)s.fn!==t||n&&!s.once||i&&s.context!==i||l(this,a);else{for(var o=0,u=[],c=s.length;o<c;o++)(s[o].fn!==t||n&&!s[o].once||i&&s[o].context!==i)&&u.push(s[o]);u.length?this._events[a]=1===u.length?u[0]:u:l(this,a)}return this},u.prototype.removeAllListeners=function(e){var t;return e?(t=r?r+e:e,this._events[t]&&l(this,t)):(this._events=new a,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=r,u.EventEmitter=u,e.exports=u},d2c7:function(e,t,i){"use strict";i.d(t,"a",(function(){return o})),i.d(t,"b",(function(){return s}));var n="undefined"!==typeof window&&window.location&&window.location.href.indexOf("xgplayerdebugger=1")>-1,r={info:"color: #525252; background-color: #90ee90;",error:"color: #525252; background-color: red;",warn:"color: #525252; background-color: yellow; "},a="%c[xgplayer]",s={config:{debug:n?3:0},logInfo:function(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];this.config.debug>=3&&(t=console).log.apply(t,[a,r.info,e].concat(n))},logWarn:function(e){for(var t,i=arguments.length,n=new Array(i>1?i-1:0),s=1;s<i;s++)n[s-1]=arguments[s];this.config.debug>=1&&(t=console).warn.apply(t,[a,r.warn,e].concat(n))},logError:function(e){var t;if(!(this.config.debug<1)){for(var i=this.config.debug>=2?"trace":"error",n=arguments.length,s=new Array(n>1?n-1:0),o=1;o<n;o++)s[o-1]=arguments[o];(t=console)[i].apply(t,[a,r.error,e].concat(s))}}};function o(e){e.logInfo=s.logInfo.bind(e),e.logWarn=s.logWarn.bind(e),e.logError=s.logError.bind(e)}},dc4a:function(e,t,i){"use strict";i.d(t,"a",(function(){return c})),i.d(t,"b",(function(){return m}));var n=i("0210"),r=i("2a75"),a=i("8c50"),s=i.n(a),o=i("d2c7"),l=i("9a98"),u={CONTROLS:"controls",ROOT:"root"},c={ROOT:"root",ROOT_LEFT:"rootLeft",ROOT_RIGHT:"rootRight",ROOT_TOP:"rootTop",CONTROLS_LEFT:"controlsLeft",CONTROLS_RIGTH:"controlsRight",CONTROLS_RIGHT:"controlsRight",CONTROLS_CENTER:"controlsCenter",CONTROLS:"controls"};function h(e){return!!e&&(e.indexOf&&/^(?:http|data:|\/)/.test(e))}function d(e,t){return"object"===Object(n["l"])(e)&&e.class&&"string"===typeof e.class?"".concat(t," ").concat(e.class):t}function f(e,t){return"object"===Object(n["l"])(e)&&e.attr&&"object"===Object(n["l"])(e.attr)&&Object.keys(e.attr).map((function(i){t[i]=e.attr[i]})),t}function g(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=null;if(e instanceof window.Element)return l["b"].addClass(e,i),Object.keys(n).map((function(t){e.setAttribute(t,n[t])})),e;if(h(e)||h(e.url))return n.src=h(e)?e:e.url||"",a=l["b"].createDom(e.tag||"img","",n,"xg-img ".concat(i)),a;if("function"===typeof e)try{return a=e(),a instanceof window.Element?(l["b"].addClass(a,i),Object.keys(n).map((function(e){a.setAttribute(e,n[e])})),a):(o["b"].logWarn("warn>>icons.".concat(t," in config of plugin named [").concat(r,"] is a function mast return an Element Object")),null)}catch(s){return o["b"].logError("Plugin named [".concat(r,"]:createIcon"),s),null}return"string"===typeof e?l["b"].createDomFromHtml(e,n,i):(o["b"].logWarn("warn>>icons.".concat(t," in config of plugin named [").concat(r,"] is invalid")),null)}function v(e,t){var i=t.config.icons||t.playerConfig.icons;Object.keys(e).map((function(n){var r=e[n],a=r&&r.class?r.class:"",s=r&&r.attr?r.attr:{},o=null;i&&i[n]&&(a=d(i[n],a),s=f(i[n],s),o=g(i[n],n,a,s,t.pluginName)),!o&&r&&(o=g(r.icon?r.icon:r,s,a,{},t.pluginName)),t.icons[n]=o}))}function p(e,t){Object.keys(e).map((function(i){Object.defineProperty(t.langText,i,{get:function(){var n=t.lang,r=t.i18n;return r[i]?r[i]:e[i]&&e[i][n]||""}})}))}var m=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Object(n["b"])(this,i),e=t.call(this,r),e.__delegates=[],e}return Object(n["c"])(i,[{key:"__init",value:function(e){if(Object(n["f"])(Object(n["g"])(i.prototype),"__init",this).call(this,e),e.root){var t=e.root,r=null;this.icons={},this.root=null,this.parent=null;var a=this.registerIcons()||{};v(a,this),this.langText={};var s=this.registerLanguageTexts()||{};p(s,this);var u="";try{u=this.render()}catch(d){throw o["b"].logError("Plugin:".concat(this.pluginName,":render"),d),new Error("Plugin:".concat(this.pluginName,":render:").concat(d.message))}if(u)r=i.insert(u,t,e.index),r.setAttribute("data-index",e.index);else{if(!e.tag)return;r=l["b"].createDom(e.tag,"",e.attr,e.name),r.setAttribute("data-index",e.index),t.appendChild(r)}this.root=r,this.parent=t;var c=this.config.attr||{},h=this.config.style||{};this.setAttr(c),this.setStyle(h),this.config.index&&this.root.setAttribute("data-index",this.config.index),this.__registerChildren()}}},{key:"__registerChildren",value:function(){var e=this;if(this.root){this._children=[];var t=this.children();t&&"object"===Object(n["l"])(t)&&Object.keys(t).length>0&&Object.keys(t).map((function(i){var r,a,s=i,o=t[s],u={root:e.root};"function"===typeof o?(r=e.config[s]||{},a=o):"object"===Object(n["l"])(o)&&"function"===typeof o.plugin&&(r=o.options?l["b"].deepCopy(e.config[s]||{},o.options):e.config[s]||{},a=o.plugin),u.config=r,void 0!==r.index&&(u.index=r.index),r.root&&(u.root=r.root),e.registerPlugin(a,u,s)}))}}},{key:"updateLang",value:function(e){function t(e,i){for(var n=0;n<e.children.length;n++)e.children[n].children.length>0?t(e.children[n],i):i(e.children[n])}e||(e=this.lang);var i=this.root,n=this.i18n,r=this.langText;i&&t(i,(function(t){var i=t.getAttribute&&t.getAttribute("lang-key");if(i){var a=n[i.toUpperCase()]||r[i];a&&(t.innerHTML="function"===typeof a?a(e):a)}}))}},{key:"lang",get:function(){return this.player.lang}},{key:"changeLangTextKey",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",i=this.i18n||{},n=this.langText;e.setAttribute&&e.setAttribute("lang-key",t);var r=i[t]||n[t]||"";r&&(e.innerHTML=r)}},{key:"plugins",value:function(){return this._children}},{key:"children",value:function(){return{}}},{key:"registerPlugin",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";t.root=t.root||this.root;var a=Object(n["f"])(Object(n["g"])(i.prototype),"registerPlugin",this).call(this,e,t,r);return this._children.push(a),a}},{key:"registerIcons",value:function(){return{}}},{key:"registerLanguageTexts",value:function(){return{}}},{key:"find",value:function(e){if(this.root)return this.root.querySelector(e)}},{key:"bind",value:function(e,t,n){var r=this;if(arguments.length<3&&"function"===typeof t)Array.isArray(e)?e.forEach((function(e){r.bindEL(e,t)})):this.bindEL(e,t);else{var a=i.delegate.call(this,this.root,e,t,n);this.__delegates=this.__delegates.concat(a)}}},{key:"unbind",value:function(e,t){var i=this;if(arguments.length<3&&"function"===typeof t)Array.isArray(e)?e.forEach((function(e){i.unbindEL(e,t)})):this.unbindEL(e,t);else for(var n="".concat(e,"_").concat(t),r=0;r<this.__delegates.length;r++)if(this.__delegates[r].key===n){this.__delegates[r].destroy(),this.__delegates.splice(r,1);break}}},{key:"setStyle",value:function(e,t){var i=this;if(this.root)return"String"===l["b"].typeOf(e)?this.root.style[e]=t:void("Object"===l["b"].typeOf(e)&&Object.keys(e).map((function(t){i.root.style[t]=e[t]})))}},{key:"setAttr",value:function(e,t){var i=this;if(this.root)return"String"===l["b"].typeOf(e)?this.root.setAttribute(e,t):void("Object"===l["b"].typeOf(e)&&Object.keys(e).map((function(t){i.root.setAttribute(t,e[t])})))}},{key:"setHtml",value:function(e,t){this.root&&(this.root.innerHTML=e,"function"===typeof t&&t())}},{key:"bindEL",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"===typeof t&&this.root.addEventListener(e,t,i)}},{key:"unbindEL",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.root&&"on".concat(e)in this.root&&"function"===typeof t&&this.root.removeEventListener(e,t,i)}},{key:"show",value:function(e){if(this.root){this.root.style.display=void 0!==e?e:"block";var t=window.getComputedStyle(this.root,null),i=t.getPropertyValue("display");return"none"===i?this.root.style.display="block":void 0}}},{key:"hide",value:function(){this.root&&(this.root.style.display="none")}},{key:"appendChild",value:function(e,t){if(!this.root)return null;if(arguments.length<2&&arguments[0]instanceof window.Element)return this.root.appendChild(arguments[0]);if(!t||!(t instanceof window.Element))return null;try{return"string"===typeof e?this.find(e).appendChild(t):e.appendChild(t)}catch(i){return o["b"].logError("Plugin:appendChild",i),null}}},{key:"render",value:function(){return""}},{key:"destroy",value:function(){}},{key:"__destroy",value:function(){var e=this,t=this.player;this.__delegates.map((function(e){e.destroy()})),this.__delegates=[],this._children instanceof Array&&(this._children.map((function(e){t.unRegisterPlugin(e.pluginName)})),this._children=null),this.root&&(this.root.hasOwnProperty("remove")?this.root.remove():this.root.parentNode&&this.root.parentNode.removeChild(this.root)),Object(n["f"])(Object(n["g"])(i.prototype),"__destroy",this).call(this),this.icons={},["root","parent"].map((function(t){e[t]=null}))}}],[{key:"insert",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=t.children.length,r=Number(i),a=e instanceof window.Node;if(n){for(var s=0,o=null,l="";s<n;s++){o=t.children[s];var u=Number(o.getAttribute("data-index"));if(u>=r){l="beforebegin";break}u<r&&(l="afterend")}return a?"afterend"===l?t.appendChild(e):t.insertBefore(e,o):o.insertAdjacentHTML(l,e),"afterend"===l?t.children[t.children.length-1]:t.children[s]}return a?t.appendChild(e):t.insertAdjacentHTML("beforeend",e),t.children[t.children.length-1]}},{key:"defaultConfig",get:function(){return{}}},{key:"delegate",value:function(e,t,i,n){var r=arguments.length>4&&void 0!==arguments[4]&&arguments[4],a=[];if(e instanceof window.Node&&"function"===typeof n)if(Array.isArray(i))i.forEach((function(i){var o=s()(e,t,i,n,r);o.key="".concat(t,"_").concat(i),a.push(o)}));else{var o=s()(e,t,i,n,r);o.key="".concat(t,"_").concat(i),a.push(o)}return a}},{key:"ROOT_TYPES",get:function(){return u}},{key:"POSITIONS",get:function(){return c}}]),i}(r["a"])},ea87:function(e,t,i){"use strict";i.d(t,"a",(function(){return pt}));var n=i("0210"),r=i("b857"),a=i("9a98"),s=i("b28d"),o=i("d2c7"),l=i("dc4a");function u(){return(new Date).getTime()}var c={LOAD_START:"loadstart",LOADED_DATA:"loadeddata",FIRST_FRAME:"firstFrame",WAIT_START:"waitingStart",WAIT_END:"waitingEnd",SEEK_START:"seekStart",SEEK_END:"seekEnd"},h=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,s=new Array(r),l=0;l<r;l++)s[l]=arguments[l];return e=t.call.apply(t,[this].concat(s)),Object(n["e"])(Object(n["a"])(e),"_onTimeupdate",(function(){e._state.isTimeUpdate=!0,e._state.autoplayStart&&(o["b"].logInfo("[xgLogger]".concat(e.player.playerId," _onTimeupdate")),e._sendFF("onTimeupdate"))})),Object(n["e"])(Object(n["a"])(e),"_onAutoplayStart",(function(){o["b"].logInfo("[xgLogger]".concat(e.player.playerId," _onAutoplayStart")),e._state.autoplayStart=!0,e.vt&&e._sendFF("onAutoplayStart")})),Object(n["e"])(Object(n["a"])(e),"_onReset",(function(){e._state={autoplayStart:!1,isFFLoading:!1,isTimeUpdate:!1,isFFSend:!1,isLs:!1},e.vt=0,e.pt=0,e.fvt=0,e.newPointTime=u(),e.loadedCostTime=0,e.startCostTime=0,e._isSeeking=!1,e.seekingStart=0,e.waitingStart=0,e.fixedWaitingStart=0,e._isWaiting=!1,e._waitTimer&&a["b"].clearTimeout(Object(n["a"])(e),e._waitTimer),e._waittTimer&&a["b"].clearTimeout(Object(n["a"])(e),e._waittTimer),e._waitTimer=null,e._waittTimer=null,e._waitType=0})),Object(n["e"])(Object(n["a"])(e),"_onSeeking",(function(){e.seekingStart||(e.suspendWaitingStatus("seek"),e.seekingStart=u(),e.emitLog(c.SEEK_START,{start:u()}))})),Object(n["e"])(Object(n["a"])(e),"_onSeeked",(function(){e.suspendSeekingStatus("seeked")})),Object(n["e"])(Object(n["a"])(e),"_onWaitingLoadStart",(function(){e._isWaiting||e.vt||(e._isWaiting=!0,e.waitingStart=u(),e.fixedWaitingStart=u(),e._waitType=1,e.emitLog(c.WAIT_START,{fixedStart:e.fixedWaitingStart,start:e.waitingStart,type:1,endType:"loadstart"}))})),Object(n["e"])(Object(n["a"])(e),"_onWaiting",(function(){!e._isWaiting&&e.vt&&(e._isWaiting=!0,e.vt?e.seekingStart?e._waitType=2:e._waitType=0:e._waitType=1,e.fixedWaitingStart=u(),e._waitTimer=a["b"].setTimeout(Object(n["a"])(e),(function(){e._isWaiting&&(e.waitingStart=u(),a["b"].clearTimeout(Object(n["a"])(e),e._waitTimer),e._waitTimer=null,e._startWaitTimeout(),e.emitLog(c.WAIT_START,{fixedStart:e.fixedWaitingStart,start:e.waitingStart,type:e._waitType,endType:2===e._waitType?"seek":"playing"}))}),200))})),Object(n["e"])(Object(n["a"])(e),"_onError",(function(){e.suspendSeekingStatus("error"),e.suspendWaitingStatus("error")})),Object(n["e"])(Object(n["a"])(e),"_onPlaying",(function(){e._isWaiting&&e.suspendWaitingStatus("playing")})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this._onReset(),this._waitType="firstFrame",this._initOnceEvents(),this.newPointTime=u(),this.loadedCostTime=0,this.startCostTime=0,this.on(s["LOAD_START"],(function(){var t=e._state,i=t.autoplayStart,n=t.isFFSend;e.startCostTime=u()-e.newPointTime,o["b"].logInfo("[xgLogger]".concat(e.player.playerId," LOAD_START"),"autoplayStart:".concat(i," isFFSend:").concat(n," startCostTime:").concat(e.startCostTime," newPointTime").concat(e.newPointTime)),n||(!t.isLs&&e.emitLog(c.LOAD_START,{}),t.isLs=!0,t.isTimeUpdate=!1,t.isFFLoading=!0,e.pt=u(),e.vt=0,e.fvt=0,e._initOnceEvents(),e._onWaitingLoadStart())})),this.on(s["LOADED_DATA"],(function(){e.vt=u(),e.fvt=e.vt-e.pt,e.loadedCostTime=e.vt-e.newPointTime;var t=e._state,i=t.isTimeUpdate,n=t.isFFSend,r=t.autoplayStart;o["b"].logInfo("[xgLogger]".concat(e.player.playerId," LOADED_DATA"),"fvt:".concat(e.fvt," isTimeUpdate:").concat(e._state.isTimeUpdate," loadedCostTime:").concat(e.loadedCostTime)),(i||r)&&e._sendFF("loadedData"),n||e.emitLog(c.LOADED_DATA,{}),e.suspendWaitingStatus("loadeddata")})),this.on(s["SEEKING"],this._onSeeking),this.on(s["SEEKED"],this._onSeeked),this.on(s["DESTROY"],(function(){e.endState("destroy")})),this.on(s["URL_CHANGE"],(function(){e.endState("urlChange"),o["b"].logInfo("[xgLogger]".concat(e.player.playerId," URL_CHANGE")),e._state.isFFSend&&e._onReset()})),this.on([s["PLAYING"],s["CANPLAY"]],this._onPlaying),this.on(s["WAITING"],this._onWaiting),this.on(s["ERROR"],this._onError),this.on(s["RESET"],(function(){o["b"].logInfo("[xgLogger]".concat(e.player.playerId," RESET")),e.endState("reset"),e._initOnceEvents(),e._onReset()}))}},{key:"_initOnceEvents",value:function(){this.off(s["AUTOPLAY_STARTED"],this._onAutoplayStart),this.off(s["TIME_UPDATE"],this._onTimeupdate),this.once(s["AUTOPLAY_STARTED"],this._onAutoplayStart),this.once(s["TIME_UPDATE"],this._onTimeupdate)}},{key:"_sendFF",value:function(e){this.s=u();var t=this._state,i=t.isFFLoading,n=t.isFFSend;o["b"].logInfo("[xgLogger]".concat(this.player.playerId," _sendFF"),"".concat(e," fvt:").concat(this.fvt," isFFLoading:").concat(i," !isFFSend:").concat(!n)),this.vt>0&&i&&!n&&(o["b"].logInfo("[xgLogger]".concat(this.player.playerId," emitLog_firstFrame"),e),this._state.isFFLoading=!1,this._state.isFFSend=!0,this.emitLog(c.FIRST_FRAME,{fvt:this.fvt,costTime:this.fvt,vt:this.vt,startCostTime:this.startCostTime,loadedCostTime:this.loadedCostTime}))}},{key:"_startWaitTimeout",value:function(){var e=this;this._waittTimer&&a["b"].clearTimeout(this,this._waittTimer),this._waittTimer=a["b"].setTimeout(this,(function(){e.suspendWaitingStatus("timeout"),a["b"].clearTimeout(e,e._waittTimer),e._waittTimer=null}),this.config.waitTimeout)}},{key:"endState",value:function(e){this.suspendWaitingStatus(e),this.suspendSeekingStatus(e)}},{key:"suspendSeekingStatus",value:function(e){if(this.seekingStart){var t=u(),i=t-this.seekingStart;this.seekingStart=0,this.emitLog(c.SEEK_END,{end:t,costTime:i,endType:e})}}},{key:"suspendWaitingStatus",value:function(e){if(this._waitTimer&&(a["b"].clearTimeout(this,this._waitTimer),this._waitTimer=null),this._waittTimer&&(a["b"].clearTimeout(this,this._waittTimer),this._waittTimer=null),this._isWaiting=!1,this.waitingStart){var t=u(),i=t-this.waitingStart,n=t-this.fixedWaitingStart,r=this.config.waitTimeout;this._isWaiting=!1,this.waitingStart=0,this.fixedWaitingStart=0,this.emitLog(c.WAIT_END,{fixedCostTime:n>r?r:n,costTime:i>r?r:i,type:"loadeddata"===e?1:this._waitType,endType:2===this._waitType?"seek":e})}}},{key:"emitLog",value:function(e,t){var i=this.player;this.emit(s["XGLOG"],Object(n["i"])({t:u(),host:a["b"].getHostFromUrl(i.currentSrc),vtype:i.vtype,eventType:e,currentTime:this.player.currentTime,readyState:i.video.readyState,networkState:i.video.networkState},t))}}],[{key:"pluginName",get:function(){return"xgLogger"}},{key:"defaultConfig",get:function(){return{waitTimeout:1e4}}}]),i}(l["b"]);function d(){return(new DOMParser).parseFromString('<svg class="xgplayer-replay-svg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 78 78" width="78" height="78">\n  <path fill="#fff" transform="translate(20, 20)" d="M8.22708362,13.8757234 L11.2677371,12.6472196 C11.7798067,12.4403301 12.3626381,12.6877273 12.5695276,13.1997969 L12.9441342,14.1269807 C13.1510237,14.6390502 12.9036264,15.2218816 12.3915569,15.4287712 L6.8284538,17.6764107 L5.90126995,18.0510173 C5.38920044,18.2579068 4.80636901,18.0105096 4.5994795,17.49844 L1.97723335,11.0081531 C1.77034384,10.4960836 2.0177411,9.91325213 2.52981061,9.70636262 L3.45699446,9.33175602 C3.96906396,9.12486652 4.5518954,9.37226378 4.75878491,9.88433329 L5.67885163,12.1615783 C7.99551726,6.6766934 13.3983951,3 19.5,3 C27.7842712,3 34.5,9.71572875 34.5,18 C34.5,26.2842712 27.7842712,33 19.5,33 C15.4573596,33 11.6658607,31.3912946 8.87004692,28.5831991 C8.28554571,27.9961303 8.28762719,27.0463851 8.87469603,26.4618839 C9.46176488,25.8773827 10.4115101,25.8794641 10.9960113,26.466533 C13.2344327,28.7147875 16.263503,30 19.5,30 C26.127417,30 31.5,24.627417 31.5,18 C31.5,11.372583 26.127417,6 19.5,6 C14.4183772,6 9.94214483,9.18783811 8.22708362,13.8757234 Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var f=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"registerIcons",value:function(){return{replay:d}}},{key:"afterCreate",value:function(){var e=this;l["b"].insert(this.icons.replay,this.root,0),this.__handleReplay=this.hook("replayClick",(function(){e.player.replay()}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(".xgplayer-replay",["click","touchend"],this.__handleReplay),this.on(s["ENDED"],(function(){if(e.playerConfig.loop||a["b"].addClass(e.player.root,"replay"),!e.config.disable){e.show();var t=e.root.querySelector("path");if(t){var i=window.getComputedStyle(t).getPropertyValue("transform");if("string"===typeof i&&i.indexOf("none")>-1)return null;t.setAttribute("transform",i)}}})),this.on(s["PLAY"],(function(){e.hide()}))}},{key:"handleReplay",value:function(e){e.preventDefault(),e.stopPropagation(),this.player.replay(),a["b"].removeClass(this.player.root,"replay")}},{key:"show",value:function(){this.config.disable||(this.root.style.display="flex")}},{key:"enable",value:function(){this.config.disable=!1}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){this.unbind(".xgplayer-replay",["click","touchend"],this.__handleReplay)}},{key:"render",value:function(){return'<xg-replay class="xgplayer-replay">\n      <xg-replay-txt class="xgplayer-replay-txt" lang-key="'.concat(this.i18nKeys.REPLAY,'">').concat(this.i18n.REPLAY,"</xg-replay-txt>\n    </xg-replay>")}}],[{key:"pluginName",get:function(){return"replay"}},{key:"defaultConfig",get:function(){return{disable:!1}}}]),i}(l["b"]),g=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"isEndedShow",get:function(){return this.config.isEndedShow},set:function(e){this.config.isEndedShow=e}},{key:"hide",value:function(){a["b"].addClass(this.root,"hide")}},{key:"show",value:function(){a["b"].removeClass(this.root,"hide")}},{key:"beforeCreate",value:function(e){"string"===typeof e.player.config.poster&&(e.config.poster=e.player.config.poster)}},{key:"afterCreate",value:function(){var e=this;this.on(s["ENDED"],(function(){e.isEndedShow&&a["b"].removeClass(e.root,"hide")})),this.config.hideCanplay?(this.once(s["TIME_UPDATE"],(function(){e.onTimeUpdate()})),this.on(s["URL_CHANGE"],(function(){a["b"].removeClass(e.root,"hide"),a["b"].addClass(e.root,"xg-showplay"),e.once(s["TIME_UPDATE"],(function(){e.onTimeUpdate()}))}))):this.on(s["PLAY"],(function(){a["b"].addClass(e.root,"hide")}))}},{key:"onTimeUpdate",value:function(){var e=this;this.player.currentTime?a["b"].removeClass(this.root,"xg-showplay"):this.once(s["TIME_UPDATE"],(function(){e.onTimeUpdate()}))}},{key:"update",value:function(e){e&&(this.config.poster=e,this.root.style.backgroundImage="url(".concat(e,")"))}},{key:"render",value:function(){var e=this.config,t=e.poster,i=e.hideCanplay,n=t?"background-image:url(".concat(t,");"):"";return'<xg-poster class="xgplayer-poster '.concat(i?"xg-showplay":"",'" style="').concat(n,'">\n    </xg-poster>')}}],[{key:"pluginName",get:function(){return"poster"}},{key:"defaultConfig",get:function(){return{isEndedShow:!0,hideCanplay:!1,poster:""}}}]),i}(l["b"]),v=i("a45c");function p(){return(new DOMParser).parseFromString('<svg class="play" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M576,363L810,512L576,661zM342,214L576,363L576,661L342,810z"></path>\n</svg>\n',"image/svg+xml").firstChild}function m(){return(new DOMParser).parseFromString('<svg class="pause" xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="3 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598,214h170v596h-170v-596zM256 810v-596h170v596h-170z"></path>\n</svg>\n',"image/svg+xml").firstChild}var y={};function b(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{start:null,end:null};y[e]&&window.clearTimeout(y[e].id),y[e]={},i.start&&i.start(),y[e].id=window.setTimeout((function(){i.end&&i.end(),window.clearTimeout(y[e].id),delete y[e]}),t)}function E(){Object.keys(y).map((function(e){window.clearTimeout(y[e].id),delete y[e]}))}var T=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"onPlayerReset",(function(){r.autoPlayStart=!1;var e="auto"===r.config.mode?"auto-hide":"hide";r.setAttr("data-state","play"),a["b"].removeClass(r.root,e),r.show()})),Object(n["e"])(Object(n["a"])(r),"onAutoplayStart",(function(){if(!r.autoPlayStart){var e="auto"===r.config.mode?"auto-hide":"hide";a["b"].addClass(r.root,e),r.autoPlayStart=!0,r.onPlayPause("play")}})),r.autoPlayStart=!1,r}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this,t=this.player,i=this.playerConfig;this.initIcons(),this.once(s["READY"],(function(){i&&(i.lang&&"en"===i.lang?a["b"].addClass(t.root,"lang-is-en"):"jp"===i.lang&&a["b"].addClass(t.root,"lang-is-jp"))})),this.on(s["AUTOPLAY_STARTED"],this.onAutoplayStart),i.autoplay||this.show(),this.on(s["AUTOPLAY_PREVENTED"],(function(){var t="auto"===e.config.mode?"auto-hide":"hide";e.setAttr("data-state","play"),a["b"].removeClass(e.root,t),e.show()})),this.on(s["PLAY"],(function(){e.onPlayPause("play")})),this.on(s["PAUSE"],(function(){e.onPlayPause("pause")})),this.on(s["RESET"],(function(){e.onPlayerReset()})),this.clickHandler=this.hook("startClick",this.switchPausePlay,{pre:function(t){t.cancelable&&t.preventDefault(),t.stopPropagation();var i=e.player.paused;e.emitUserAction(t,"switch_play_pause",{props:"paused",from:i,to:!i})}}),this.bind(["click","touchend"],this.clickHandler)}},{key:"registerIcons",value:function(){return{startPlay:{icon:p,class:"xg-icon-play"},startPause:{icon:m,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild("xg-start-inner",e.startPlay),this.appendChild("xg-start-inner",e.startPause)}},{key:"hide",value:function(){a["b"].addClass(this.root,"hide")}},{key:"show",value:function(){a["b"].removeClass(this.root,"hide")}},{key:"focusHide",value:function(){a["b"].addClass(this.root,"focus-hide")}},{key:"recover",value:function(){a["b"].removeClass(this.root,"focus-hide")}},{key:"switchStatus",value:function(e){e?this.setAttr("data-state",this.player.paused?"pause":"play"):this.setAttr("data-state",this.player.paused?"play":"pause")}},{key:"animate",value:function(e){var t=this;b("pauseplay",400,{start:function(){a["b"].addClass(t.root,"interact"),t.show(),t.switchStatus(!0)},end:function(){a["b"].removeClass(t.root,"interact"),!e&&t.hide()}})}},{key:"switchPausePlay",value:function(e){var t=this.player;if(e.cancelable&&e.preventDefault(),e.stopPropagation(),!(t.state<v["a"].READY)){var i=this.player.paused;i||t.state!==v["a"].RUNNING?t.play():t.pause()}}},{key:"onPlayPause",value:function(e){var t=this.config,i=this.player;if(i&&!(i.state<v["a"].RUNNING)&&this.autoPlayStart){if("show"===t.mode)return this.switchStatus(),void this.show();if("auto"!==t.mode){if(t.isShowPause&&i.paused&&!i.ended||t.isShowEnd&&i.ended)return this.switchStatus(),void this.show();if(t.disableAnimate)return this.switchStatus(),void this.hide();if("play"===e)this.autoPlayStart?this.animate():this.hide();else{if(!this.autoPlayStart||i.ended)return;this.animate()}}else this.switchStatus()}}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.clickHandler),E()}},{key:"render",value:function(){var e=this.playerConfig.autoplay?"auto"===this.config.mode?"auto-hide":"hide":"";return'\n    <xg-start class="xgplayer-start '.concat(e,'">\n    <xg-start-inner></xg-start-inner>\n    </xg-start>')}}],[{key:"pluginName",get:function(){return"start"}},{key:"defaultConfig",get:function(){return{isShowPause:!1,isShowEnd:!1,disableAnimate:!1,mode:"hide"}}}]),i}(l["b"]),k=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"render",value:function(){var e=this.config.innerHtml,t=a["b"].createDom("xg-enter","",{},"xgplayer-enter");if(e&&e instanceof window.HTMLElement)t.appendChild(e);else if(e&&"string"===typeof e)t.innerHTML=e;else{for(var i="",n=1;n<=12;n++)i+='<div class="xgplayer-enter-bar'.concat(n,'"></div>');t.innerHTML='<div class="xgplayer-enter-spinner">'.concat(i,"</div>")}return t}}],[{key:"pluginName",get:function(){return"enter"}},{key:"defaultConfig",get:function(){return{innerHtml:"",logo:""}}}]),i}(l["b"]);function S(e,t,i){try{return' <div class="xg-tips '.concat(i?"hide":" ",'" lang-key="').concat(e.i18nKeys[t],'">\n    ').concat(e.i18n[t],"\n    </div>")}catch(n){return'<div class="xg-tips hide"></div>'}}var _=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){this.getMini=this.getMini.bind(this),this.exitMini=this.exitMini.bind(this),this.bind("click",this.getMini)}},{key:"getMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"exitMini",value:function(){this.config.onClick&&this.config.onClick()}},{key:"destroy",value:function(){this.unbind(["click","touchend"],this.getMini)}},{key:"render",value:function(){var e="MINISCREEN";return'\n      <xg-icon class="xgplayer-miniicon">\n      <div class="xgplayer-icon btn-text"><span class="icon-text" lang-key="'.concat(this.i18nKeys[e],'">').concat(this.i18n[e],"</span></div>\n      </xg-icon>")}}],[{key:"pluginName",get:function(){return"miniscreenIcon"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:10}}}]),i}(l["b"]),L=i("ba10"),A=i.n(L);function C(e){var t=parseFloat(e),i=-1===e.indexOf("%")&&!Number.isNaN(t);return i&&t}var O=["paddingLeft","paddingRight","paddingTop","paddingBottom","marginLeft","marginRight","marginTop","marginBottom","borderLeftWidth","borderRightWidth","borderTopWidth","borderBottomWidth"],R=O.length;function w(){for(var e={width:0,height:0,innerWidth:0,innerHeight:0,outerWidth:0,outerHeight:0},t=0;t<R;t++){var i=O[t];e[i]=0}return e}function x(e){var t=window.getComputedStyle(e);return t}function I(e){if("string"===typeof e&&(e=document.querySelector(e)),e&&"object"===Object(n["l"])(e)&&e.nodeType){var t=x(e);if("none"===t.display)return w();var i={};i.width=e.offsetWidth,i.height=e.offsetHeight;for(var r=i.isBorderBox="border-box"===t.boxSizing,a=0;a<R;a++){var s=O[a],o=t[s],l=parseFloat(o);i[s]=Number.isNaN(l)?0:l}var u=i.paddingLeft+i.paddingRight,c=i.paddingTop+i.paddingBottom,h=i.marginLeft+i.marginRight,d=i.marginTop+i.marginBottom,f=i.borderLeftWidth+i.borderRightWidth,g=i.borderTopWidth+i.borderBottomWidth,v=r,p=C(t.width);!1!==p&&(i.width=p+(v?0:u+f));var m=C(t.height);return!1!==m&&(i.height=m+(v?0:c+g)),i.innerWidth=i.width-(u+f),i.innerHeight=i.height-(c+g),i.outerWidth=i.width+h,i.outerHeight=i.height+d,i}}function D(e,t){for(var i=0;i<e.length;i++){var n=e[i];if(n.identifier===t)return n}}var P={START:"dragStart",MOVE:"dragMove",ENDED:"dragEnded"},N={mousedown:["mousemove","mouseup"],touchstart:["touchmove","touchend","touchcancel"],pointerdown:["pointermove","pointerup","pointercancel"]},M=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r,a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Object(n["b"])(this,i),r=t.call(this),r.isEnabled=!0,r.isDragging=!1,r.isDown=!1,r.position={},r.downPoint={},r.dragPoint={x:0,y:0},r.startPos={x:0,y:0},r._root=e instanceof Element?e:document.querySelector(e),r._handlerDom=a.handle instanceof Element?a.handle:document.querySelector(a.handle),r._root&&r._handlerDom?(r._bindStartEvent(),r):Object(n["j"])(r)}return Object(n["c"])(i,[{key:"_bindStartEvent",value:function(){var e=this;"ontouchstart"in window?this._startKey="touchstart":this._startKey="mousedown",this["on".concat(this._startKey)]=this["on".concat(this._startKey)].bind(this),this._handlerDom.addEventListener(this._startKey,this["on".concat(this._startKey)]),N[this._startKey].map((function(t){e["on".concat(t)]=e["on".concat(t)].bind(e)}))}},{key:"_unbindStartEvent",value:function(){this._handlerDom.removeEventListener(this._startKey,this["on".concat(this._startKey)])}},{key:"_bindPostStartEvents",value:function(e){var t=this;if(e){var i=N[this._startKey];i.map((function(e){window.addEventListener(e,t["on".concat(e)])})),this._boundPointerEvents=i}}},{key:"_unbindPostStartEvents",value:function(){var e=this;this._boundPointerEvents&&(this._boundPointerEvents.map((function(t){window.removeEventListener(t,e["on".concat(t)])})),delete this._boundPointerEvents)}},{key:"enable",value:function(){this.isEnabled=!0}},{key:"disable",value:function(){this.isEnabled=!1,this.isDragging&&this.onUp()}},{key:"onDocUp",value:function(e){this.onUp()}},{key:"animate",value:function(){var e=this;this.isDragging&&(this.positionDrag(),window.requestAnimationFrame((function(){e.animate()})))}},{key:"positionDrag",value:function(){var e="translate3d(".concat(this.dragPoint.x,"px, ").concat(this.dragPoint.y,"px, 0)");this._root.style.transform=e,this._root.style.webKitTransform=e}},{key:"setLeftTop",value:function(){this._root.style.left=this.position.x+"px",this._root.style.top=this.position.y+"px"}},{key:"onmousedown",value:function(e){this.dragStart(e,e)}},{key:"onmousemove",value:function(e){this.dragMove(e,e)}},{key:"onmouseup",value:function(e){this.dragEnd(e,e)}},{key:"ontouchstart",value:function(e){var t=e.changedTouches[0];this.dragStart(e,t),this.touchIdentifier=void 0!==t.pointerId?t.pointerId:t.identifier,e.preventDefault()}},{key:"ontouchmove",value:function(e){var t=D(e.changedTouches,this.touchIdentifier);t&&this.dragMove(e,t)}},{key:"ontouchend",value:function(e){var t=D(e.changedTouches,this.touchIdentifier);t&&this.dragEnd(e,t),e.preventDefault()}},{key:"ontouchcancel",value:function(e){var t=D(e.changedTouches,this.touchIdentifier);t&&this.dragCancel(e,t)}},{key:"dragStart",value:function(e,t){if(this._root&&!this.isDown&&this.isEnabled){this.downPoint=t,this.dragPoint.x=0,this.dragPoint.y=0,this._getPosition();var i=I(this._root);this.startPos.x=this.position.x,this.startPos.y=this.position.y,this.startPos.maxY=window.innerHeight-i.height,this.startPos.maxX=window.innerWidth-i.width,this.setLeftTop(),this.isDown=!0,this._bindPostStartEvents(e)}}},{key:"dragRealStart",value:function(e,t){this.isDragging=!0,this.animate(),this.emit(P.START,this.startPos)}},{key:"dragEnd",value:function(e,t){this._root&&(this._unbindPostStartEvents(),this.isDragging&&(this._root.style.transform="",this.setLeftTop(),this.emit(P.ENDED)),this.presetInfo())}},{key:"_dragPointerMove",value:function(e,t){var i={x:t.pageX-this.downPoint.pageX,y:t.pageY-this.downPoint.pageY};return!this.isDragging&&this.hasDragStarted(i)&&this.dragRealStart(e,t),i}},{key:"dragMove",value:function(e,t){if(e=e||window.event,this.isDown){var i=this.startPos,n=i.x,r=i.y,a=this._dragPointerMove(e,t),s=a.x,o=a.y;s=this.checkContain("x",s,n),o=this.checkContain("y",o,r),this.position.x=n+s,this.position.y=r+o,this.dragPoint.x=s,this.dragPoint.y=o,this.emit(P.MOVE,this.position)}}},{key:"dragCancel",value:function(e,t){this.dragEnd(e,t)}},{key:"presetInfo",value:function(){this.isDragging=!1,this.startPos={x:0,y:0},this.dragPoint={x:0,y:0},this.isDown=!1}},{key:"destroy",value:function(){this._unbindStartEvent(),this._unbindPostStartEvents(),this.isDragging&&this.dragEnd(),this.removeAllListeners(),this._handlerDom=null}},{key:"hasDragStarted",value:function(e){return Math.abs(e.x)>3||Math.abs(e.y)>3}},{key:"checkContain",value:function(e,t,i){return t+i<0?0-i:"x"===e&&t+i>this.startPos.maxX?this.startPos.maxX-i:"y"===e&&t+i>this.startPos.maxY?this.startPos.maxY-i:t}},{key:"_getPosition",value:function(){var e=window.getComputedStyle(this._root),t=this._getPositionCoord(e.left,"width"),i=this._getPositionCoord(e.top,"height");this.position.x=Number.isNaN(t)?0:t,this.position.y=Number.isNaN(i)?0:i,this._addTransformPosition(e)}},{key:"_addTransformPosition",value:function(e){var t=e.transform;if(0===t.indexOf("matrix")){var i=t.split(","),n=0===t.indexOf("matrix3d")?12:4,r=parseInt(i[n],10),a=parseInt(i[n+1],10);this.position.x+=r,this.position.y+=a}}},{key:"_getPositionCoord",value:function(e,t){if(-1!==e.indexOf("%")){var i=I(this._root.parentNode);return i?parseFloat(e)/100*i[t]:0}return parseInt(e,10)}}]),i}(A.a),F=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"onCancelClick",(function(e){r.exitMini(),r.isClose=!0})),Object(n["e"])(Object(n["a"])(r),"onCenterClick",(function(e){var t=Object(n["a"])(r),i=t.player;i.paused?i.play():i.pause()})),Object(n["e"])(Object(n["a"])(r),"onScroll",(function(e){if(!(!window.scrollY&&0!==window.scrollY||Math.abs(window.scrollY-r.pos.scrollY)<50)){var t=parseInt(a["b"].getCss(r.player.root,"height"));t+=r.config.scrollTop,r.pos.scrollY=window.scrollY,window.scrollY>t+5?!r.isMini&&!r.isClose&&r.getMini():window.scrollY<=t&&(r.isMini&&r.exitMini(),r.isClose=!1)}})),r.isMini=!1,r.isClose=!1;var s=Object(n["a"])(r),o=s.config;return r.pos={left:o.left<0?window.innerWidth-o.width-20:o.left,top:o.top<0?window.innerHeight-o.height-20:o.top,height:r.config.height,width:r.config.width,scrollY:window.scrollY||0},r.lastStyle=null,r}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.mini&&(e.config.isShowIcon=e.player.config.mini)}},{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.on(s["PAUSE"],(function(){e.setAttr("data-state","pause")})),this.on(s["PLAY"],(function(){e.setAttr("data-state","play")}))}},{key:"onPluginsReady",value:function(){var e=this,t=this.player,i=this.config;if(!i.disable){if(this.config.isShowIcon){var n={config:{onClick:function(){e.getMini()}}};t.controls.registerPlugin(_,n,_.pluginName)}var r=a["b"].checkTouchSupport()?"touchend":"click";this.bind(".mini-cancel-btn",r,this.onCancelClick),this.bind(".play-icon",r,this.onCenterClick),this.config.disableDrag||(this._draggabilly=new M(this.player.root,{handle:this.root})),this.config.isScrollSwitch&&window.addEventListener("scroll",this.onScroll)}}},{key:"registerIcons",value:function(){return{play:{icon:p,class:"xg-icon-play"},pause:{icon:m,class:"xg-icon-pause"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".play-icon",e.play),this.appendChild(".play-icon",e.pause)}},{key:"getMini",value:function(){var e=this;if(!this.isMini){var t=this.player,i=this.playerConfig,n=this.config.target||this.player.root;this.lastStyle={},a["b"].addClass(t.root,"xgplayer-mini"),["width","height","top","left"].map((function(t){e.lastStyle[t]=n.style[t],n.style[t]="".concat(e.pos[t],"px")})),i.fluid&&(n.style["padding-top"]=""),this.emit(s["MINI_STATE_CHANGE"],!0),t.isMini=this.isMini=!0}}},{key:"exitMini",value:function(){var e=this;if(!this.isMini)return!1;var t=this.player,i=this.playerConfig,n=this.config.target||this.player.root;a["b"].removeClass(t.root,"xgplayer-mini"),this.lastStyle&&Object.keys(this.lastStyle).map((function(t){n.style[t]=e.lastStyle[t]})),this.lastStyle=null,i.fluid&&(t.root.style.width="100%",t.root.style.height="0",t.root.style["padding-top"]="".concat(100*i.height/i.width,"%")),this.emit(s["MINI_STATE_CHANGE"],!1),this.isMini=t.isMini=!1}},{key:"destroy",value:function(){window.removeEventListener("scroll",this.onScroll);var e=a["b"].checkTouchSupport()?"touchend":"click";this.unbind(".mini-cancel-btn",e,this.onCancelClick),this.unbind(".play-icon",e,this.onCenterClick),this._draggabilly&&this._draggabilly.destroy(),this._draggabilly=null,this.exitMini()}},{key:"render",value:function(){if(!this.config.disable)return'\n      <xg-mini-layer class="xg-mini-layer">\n      <xg-mini-header class="xgplayer-mini-header">\n      '.concat(S(this,"MINI_DRAG",this.playerConfig.isHideTips),'\n      </xg-mini-header>\n      <div class="mini-cancel-btn">\n        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20">\n          <path fill="#fff" fill-rule="evenodd" d="M3.99 3.49a1 1 0 0 1 1.414 0L10 8.085l4.596-4.595a1 1 0 1 1 1.414 1.414L11.414 9.5l4.596 4.596a1 1 0 0 1 .084 1.32l-.084.094a1 1 0 0 1-1.414 0L10 10.914 5.404 15.51a1 1 0 0 1-1.414-1.414L8.585 9.5 3.99 4.904a1 1 0 0 1-.084-1.32z"></path>\n        </svg>\n      </div>\n      <div class="play-icon">\n      </div>\n      </xg-mini-layer>')}}],[{key:"pluginName",get:function(){return"miniscreen"}},{key:"defaultConfig",get:function(){return{index:10,disable:!1,width:320,height:180,left:-1,top:-1,isShowIcon:!1,isScrollSwitch:!1,scrollTop:0,disableDrag:!1}}}]),i}(l["b"]),j=i("2a75"),U=(i("8c50"),i("2535")),B={mouseenter:"onMouseEnter",mouseleave:"onMouseLeave",mousemove:"onMouseMove"},G=["videoClick","videoDbClick"],H=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"onMouseMove",(function(t){var i=Object(n["a"])(e),r=i.player,a=i.playerConfig;r.isActive||(r.focus({autoHide:!a.closeDelayBlur}),!a.closeFocusVideoFocus&&r.media.focus())})),Object(n["e"])(Object(n["a"])(e),"onMouseEnter",(function(t){var i=Object(n["a"])(e),r=i.playerConfig,a=i.player;!r.closeFocusVideoFocus&&a.media.focus(),r.closeDelayBlur?a.focus({autoHide:!1}):a.focus()})),Object(n["e"])(Object(n["a"])(e),"onMouseLeave",(function(t){var i=e.playerConfig,n=i.closePlayerBlur,r=i.leavePlayerTime,a=i.closeDelayBlur;n||a||(r?e.player.focus({autoHide:!0,delay:r}):e.player.blur())})),Object(n["e"])(Object(n["a"])(e),"onVideoClick",(function(t){var i=Object(n["a"])(e),r=i.player,a=i.playerConfig;t.target&&a.closeVideoClick||t.target!==r.root&&t.target!==r.media&&t.target!==r.innerContainer&&t.target!==r.media.__canvas||(t.preventDefault(),a.closeVideoStopPropagation||t.stopPropagation(),e._clickCount++,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),e.clickTimer=setTimeout((function(){e._clickCount&&(e._clickCount--,Object(U["f"])(Object(n["a"])(e),G[0],(function(t,i){e.switchPlayPause(i.e)}),{e:t,paused:r.paused}),clearTimeout(e.clickTimer),e.clickTimer=null)}),300))})),Object(n["e"])(Object(n["a"])(e),"onVideoDblClick",(function(t){var i=Object(n["a"])(e),r=i.player,a=i.playerConfig;a.closeVideoDblclick||!t.target||t.target!==r.media&&t.target!==r.media.__canvas||(!a.closeVideoClick&&e._clickCount<2?e._clickCount=0:(e._clickCount=0,e.clickTimer&&(clearTimeout(e.clickTimer),e.clickTimer=null),t.preventDefault(),t.stopPropagation(),Object(U["f"])(Object(n["a"])(e),G[1],(function(t,i){e.emitUserAction(i.e,"switch_fullscreen",{props:"fullscreen",from:r.fullscreen,to:!r.fullscreen}),r.fullscreen?r.exitFullscreen():r.getFullscreen()}),{e:t,fullscreen:r.fullscreen})))})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this._clickCount=0,G.map((function(t){e.__hooks[t]=null}));var t=this.playerConfig.isMobileSimulateMode;"mobile"===t||"mobile"===r["a"].device&&!r["a"].os.isIpad||this.initEvents()}},{key:"initEvents",value:function(){var e=this,t=this.player,i=t.video,n=t.root,r=this.playerConfig.enableContextmenu;n&&n.addEventListener("click",this.onVideoClick,!1),n&&n.addEventListener("dblclick",this.onVideoDblClick,!1),Object.keys(B).map((function(t){n.addEventListener(t,e[B[t]],!1)})),r&&i&&i.addEventListener("contextmenu",this.onContextmenu,!1)}},{key:"switchPlayPause",value:function(e){var t=this.player;this.emitUserAction(e,"switch_play_pause",{props:"paused",from:t.paused,to:!t.paused}),t.ended?t.duration!==1/0&&t.duration>0&&t.replay():t.paused?t.play():t.pause()}},{key:"onContextmenu",value:function(e){e=e||window.event,e.preventDefault&&e.preventDefault(),e.stopPropagation?e.stopPropagation():(e.returnValue=!1,e.cancelBubble=!0)}},{key:"destroy",value:function(){var e=this,t=this.player,i=t.video,n=t.root;this.clickTimer&&clearTimeout(this.clickTimer),n.removeEventListener("click",this.onVideoClick,!1),n.removeEventListener("dblclick",this.onVideoDblClick,!1),i.removeEventListener("contextmenu",this.onContextmenu,!1),Object.keys(B).map((function(t){n.removeEventListener(t,e[B[t]],!1)}))}}],[{key:"pluginName",get:function(){return"pc"}},{key:"defaultConfig",get:function(){return{}}}]),i}(j["a"]),V={PRESS:"press",PRESS_END:"pressend",DOUBlE_CLICK:"doubleclick",CLICK:"click",TOUCH_MOVE:"touchmove",TOUCH_START:"touchstart",TOUCH_END:"touchend"},K={start:"touchstart",end:"touchend",move:"touchmove",cancel:"touchcancel"},W={start:"mousedown",end:"mouseup",move:"mousemove",cancel:"mouseleave"};function Y(e){return e&&e.length>0?e[e.length-1]:null}function z(e){var t=navigator.userAgent;/(?:iPhone|iPad)/.test(t)&&e.cancelable&&e.preventDefault()}function X(){return{pressDelay:600,dbClickDelay:200,disablePress:!1,disableDbClick:!1,miniStep:2,needPreventDefault:!0}}var q=function(){function e(t){var i=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{eventType:"touch"};Object(n["b"])(this,e),this._pos={moving:!1,start:!1,x:0,y:0},this.config=X(),Object.keys(r).map((function(e){i.config[e]=r[e]})),this.root=t,this.events="mouse"===r.eventType?W:K,this.pressIntrvalId=null,this.dbIntrvalId=null,this.__handlers={},this._initEvent()}return Object(n["c"])(e,[{key:"_initEvent",value:function(){this.onTouchStart=this.onTouchStart.bind(this),this.onTouchMove=this.onTouchMove.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.onTouchCancel=this.onTouchCancel.bind(this),this.root.addEventListener(this.events.start,this.onTouchStart)}},{key:"__setPress",value:function(e){var t=this,i=this.config;this.pressIntrvalId&&this.__clearPress(),this.pressIntrvalId=setTimeout((function(){t.trigger(V.PRESS,e),t._pos.press=!0,t.__clearPress()}),i.pressDelay)}},{key:"__clearPress",value:function(){window.clearTimeout(this.pressIntrvalId),this.pressIntrvalId=null}},{key:"__setDb",value:function(e){var t=this,i=this.config;if(this.dbIntrvalId)return this.__clearDb(),void this.trigger(V.DOUBlE_CLICK,e);this.dbIntrvalId=setTimeout((function(){t.__clearDb(),t._pos.start||t._pos.press||t._pos.moving||t.trigger(V.CLICK,e)}),i.dbClickDelay)}},{key:"__clearDb",value:function(){clearTimeout(this.dbIntrvalId),this.dbIntrvalId=null}},{key:"on",value:function(e,t){this.__handlers[e]||(this.__handlers[e]=[]),this.__handlers[e].push(t)}},{key:"off",value:function(e,t){if(this.__handlers[e]){for(var i=this.__handlers[e],n=-1,r=0;r<i.length;r++)if(i[r]===t){n=r;break}n>=0&&this.__handlers[e].splice(n,1)}}},{key:"trigger",value:function(e,t){this.__handlers[e]&&this.__handlers[e].map((function(e){try{e(t)}catch(i){}}))}},{key:"onTouchStart",value:function(e){var t=this._pos,i=this.root,n=this.config;n.needPreventDefault&&z(e);var r=Y(e.touches);t.x=r?parseInt(r.pageX,10):e.pageX,t.y=r?parseInt(r.pageX,10):e.pageX,t.start=!0,this.__setPress(e),i.addEventListener(this.events.end,this.onTouchEnd),i.addEventListener(this.events.cancel,this.onTouchCancel),i.addEventListener(this.events.move,this.onTouchMove),this.trigger(V.TOUCH_START,e)}},{key:"onTouchCancel",value:function(e){this.onTouchEnd(e)}},{key:"onTouchEnd",value:function(e){var t=this._pos,i=this.root,n=this.config;n.needPreventDefault&&z(e),this.__clearPress(),i.removeEventListener(this.events.cancel,this.onTouchCancel),i.removeEventListener(this.events.end,this.onTouchEnd),i.removeEventListener(this.events.move,this.onTouchMove),e.moving=t.moving,e.press=t.press,t.press&&this.trigger(V.PRESS_END,e),this.trigger(V.TOUCH_END,e),!t.press&&!t.moving&&this.__setDb(e),t.press=!1,t.start=!1,t.moving=!1}},{key:"onTouchMove",value:function(e){var t=this._pos,i=this.config,n=Y(e.touches),r=n?parseInt(n.pageX,10):e.pageX,a=n?parseInt(n.pageY,10):e.pageX,s=r-t.x,o=a-t.y;Math.abs(o)<i.miniStep&&Math.abs(s)<i.miniStep||(this.__clearPress(),t.press&&this.trigger(V.PRESS_END,e),t.press=!1,t.moving=!0,this.trigger(V.TOUCH_MOVE,e))}},{key:"destroy",value:function(){var e=this,t={touchend:"onTouchEnd",touchmove:"onTouchMove",touchstart:"onTouchStart"};Object.keys(t).map((function(i){e.root.removeEventListener("touchend",e[t[i]])}))}}]),e}();function Z(){return(new DOMParser).parseFromString('<svg width="20" height="9" viewBox="0 0 8 9" fill="none" xmlns="http://www.w3.org/2000/svg"\n  xmlns:xlink="http://www.w3.org/1999/xlink">\n  <path opacity="0.54"\n    d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z"\n    fill="white" />\n  <path transform="translate(5 0)" d="M7.5 3.63397C8.16667 4.01887 8.16667 4.98113 7.5 5.36603L1.5 8.83013C0.833334 9.21503 0 8.7339 0 7.9641L0 1.0359C0 0.266098 0.833333 -0.215027 1.5 0.169873L7.5 3.63397Z" fill="white"/>\n</svg>',"image/svg+xml").firstChild}var Q={AUTO:"auto",SEEKING:"seeking",PLAYBACK:"playbackrate",LIGHT:""},J=["videoClick","videoDbClick"],$=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"onTouchStart",(function(e){var t=Object(n["a"])(r),i=t.player,s=t.config,o=t.pos,l=t.playerConfig,u=r.getTouche(e);if(u&&!s.disableGesture&&r.duration>0&&!i.ended){o.isStart=!0,a["b"].checkIsFunction(l.disableSwipeHandler)&&l.disableSwipeHandler(),r.find(".xg-dur").innerHTML=a["b"].format(r.duration);var c=r.root.getBoundingClientRect();90===i.rotateDeg?(o.top=c.left,o.left=c.top,o.width=c.height,o.height=c.width):(o.top=c.top,o.left=c.left,o.width=c.width,o.height=c.height);var h=parseInt(u.pageX-o.left,10),d=parseInt(u.pageY-o.top,10);o.x=90===i.rotateDeg?d:h,o.y=90===i.rotateDeg?h:d,o.scopeL=s.scopeL*o.width,o.scopeR=(1-s.scopeR)*o.width,o.scopeM1=o.width*(1-s.scopeM)/2,o.scopeM2=o.width-o.scopeM1}})),Object(n["e"])(Object(n["a"])(r),"onTouchMove",(function(e){var t=r.getTouche(e),i=Object(n["a"])(r),a=i.pos,s=i.config,o=i.player;if(t&&!s.disableGesture&&r.duration&&a.isStart){var l=s.miniMoveStep,u=s.hideControlsActive,c=parseInt(t.pageX-a.left,10),h=parseInt(t.pageY-a.top,10),d=90===o.rotateDeg?h:c,f=90===o.rotateDeg?c:h;if(Math.abs(d-a.x)>l||Math.abs(f-a.y)>l){var g=d-a.x,v=f-a.y,p=a.scope;if(-1===p&&(p=r.checkScope(d,f,g,v,a),0===p&&(u?o.blur():o.focus({autoHide:!1}),!a.time&&(a.time=parseInt(1e3*o.currentTime,10)+1e3*r.timeOffset)),a.scope=p),-1===p||p>0&&!s.gestureY||0===p&&!s.gestureX)return;e.cancelable&&e.preventDefault(),r.executeMove(g,v,p,a.width,a.height),a.x=d,a.y=f}}})),Object(n["e"])(Object(n["a"])(r),"onTouchEnd",(function(e){var t=Object(n["a"])(r),i=t.player,s=t.pos,o=t.playerConfig;if(s.isStart){s.scope>-1&&e.cancelable&&e.preventDefault();var l=r.config,u=l.disableGesture,c=l.gestureX;!u&&c?(r.endLastMove(s.scope),setTimeout((function(){i.getPlugin("progress")&&i.getPlugin("progress").resetSeekState()}),10)):s.time=0,s.scope=-1,r.resetPos(),a["b"].checkIsFunction(o.enableSwipeHandler)&&o.enableSwipeHandler(),r.changeAction(Q.AUTO)}})),Object(n["e"])(Object(n["a"])(r),"onRootTouchMove",(function(e){!r.config.disableGesture&&r.config.gestureX&&r.checkIsRootTarget(e)&&(e.stopPropagation(),r.pos.isStart?r.onTouchMove(e):r.onTouchStart(e))})),Object(n["e"])(Object(n["a"])(r),"onRootTouchEnd",(function(e){r.pos.isStart&&r.checkIsRootTarget(e)&&(e.stopPropagation(),r.onTouchEnd(e))})),r.pos={isStart:!1,x:0,y:0,time:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1},r.timer=null,r}return Object(n["c"])(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"registerIcons",value:function(){return{seekTipIcon:{icon:Z,class:"xg-seek-pre"}}}},{key:"afterCreate",value:function(){var e=this;J.map((function(t){e.__hooks[t]=null}));var t=this.playerConfig,i=this.config,n=this.player;!0===t.closeVideoDblclick&&(i.closedbClick=!0),this.resetPos(),a["b"].isUndefined(t.disableGesture)||(i.disableGesture=!!t.disableGesture),this.appendChild(".xg-seek-icon",this.icons.seekTipIcon),this.xgMask=a["b"].createDom("xg-mask","",{},"xgmask"),n.root.appendChild(this.xgMask),this.initCustomStyle(),this.registerThumbnail();var r="mouse"===this.domEventType?"mouse":"touch";this.touch=new q(this.root,{eventType:r,needPreventDefault:!this.config.disableGesture}),this.root.addEventListener("contextmenu",(function(e){e.preventDefault()})),n.root.addEventListener("touchmove",this.onRootTouchMove,!0),n.root.addEventListener("touchend",this.onRootTouchEnd,!0),this.on(s["DURATION_CHANGE"],(function(){var t=e.player,i=e.config;1e3*t.duration<i.moveDuration&&(i.moveDuration=1e3*t.duration)})),this.on([s["CANPLAY"],s["ENDED"]],(function(){var t=e.pos,i=t.time,n=t.isStart;!n&&i>0&&(e.pos.time=0)}));var o={touchstart:"onTouchStart",touchmove:"onTouchMove",touchend:"onTouchEnd",press:"onPress",pressend:"onPressEnd",click:"onClick",doubleclick:"onDbClick"};if(Object.keys(o).map((function(t){e.touch.on(t,(function(i){e[o[t]](i)}))})),!i.disableActive){var l=n.plugins.progress;l&&(l.addCallBack("dragmove",(function(t){e.activeSeekNote(t.currentTime,t.forward)})),l.addCallBack("dragend",(function(){e.changeAction(Q.AUTO)})))}}},{key:"registerThumbnail",value:function(){var e=this.player,t=e.plugins.thumbnail;if(t&&t.usable){this.thumbnail=t.createThumbnail(null,"mobile-thumbnail");var i=this.find(".time-preview");i.insertBefore(this.thumbnail,i.children[0])}}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},t=e.commonStyle,i=t.playedColor,n=t.progressColor;i&&(this.find(".xg-curbar").style.backgroundColor=i,this.find(".xg-cur").style.color=i),n&&(this.find(".xg-bar").style.backgroundColor=n,this.find(".time-preview").style.color=n),this.config.disableTimeProgress&&a["b"].addClass(this.find(".xg-timebar"),"hide")}},{key:"resetPos",value:function(){var e=this;this.pos?(this.pos.isStart=!1,this.pos.scope=-1,["x","y","width","height","scopeL","scopeR","scopeM1","scopeM2"].map((function(t){e.pos[t]=0}))):this.pos={isStart:!1,x:0,y:0,volume:0,rate:1,light:0,width:0,height:0,scopeL:0,scopeR:0,scopeM1:0,scopeM2:0,scope:-1,time:0}}},{key:"changeAction",value:function(e){var t=this.player,i=this.root;i.setAttribute("data-xg-action",e);var n=t.plugins.start;n&&n.recover()}},{key:"getTouche",value:function(e){this.player.rotateDeg;var t=e.touches&&e.touches.length>0?e.touches[e.touches.length-1]:e;return{pageX:t.pageX,pageY:t.pageY}}},{key:"checkScope",value:function(e,t,i,n,r){var a=r.width,s=-1;if(e<0||e>a)return s;var o=0===n?Math.abs(i):Math.abs(i/n);return Math.abs(i)>0&&o>=1.73&&e>r.scopeM1&&e<r.scopeM2?s=0:(0===Math.abs(i)||o<=.57)&&(s=e<r.scopeL?1:e>r.scopeR?2:3),s}},{key:"executeMove",value:function(e,t,i,n,a){switch(i){case 0:this.updateTime(e/n*this.config.scopeM);break;case 1:this.updateBrightness(t/a);break;case 2:r["a"].os.isIos||this.updateVolume(t/a);break}}},{key:"endLastMove",value:function(e){var t=this,i=this.pos,n=this.player,r=this.config,a=(i.time-this.timeOffset)/1e3;switch(e){case 0:n.seek(Number(a).toFixed(1)),r.hideControlsEnd?n.blur():n.focus(),this.timer=setTimeout((function(){t.pos.time=0}),500);break}this.changeAction(Q.AUTO)}},{key:"checkIsRootTarget",value:function(e){var t=this.player.plugins||{};return(!t.progress||!t.progress.root.contains(e.target))&&(t.start&&t.start.root.contains(e.target)||t.controls&&t.controls.root.contains(e.target))}},{key:"sendUseAction",value:function(e){var t=this.player.paused;this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t,to:!t})}},{key:"clickHandler",value:function(e){var t=this.player,i=this.config,n=this.playerConfig;t.state<v["a"].RUNNING?n.closeVideoClick||(this.sendUseAction(a["b"].createEvent("click")),t.play()):!i.closedbClick||n.closeVideoClick?t.isActive?t.blur():t.focus():n.closeVideoClick||((t.isActive||i.focusVideoClick)&&(this.sendUseAction(a["b"].createEvent("click")),this.switchPlayPause()),t.focus())}},{key:"dbClickHandler",value:function(e){var t=this.config,i=this.player;!t.closedbClick&&i.state>=v["a"].RUNNING&&(this.sendUseAction(a["b"].createEvent("dblclick")),this.switchPlayPause())}},{key:"onClick",value:function(e){var t=this,i=this.player;Object(U["f"])(this,J[0],(function(e,i){t.clickHandler(i.e)}),{e:e,paused:i.paused})}},{key:"onDbClick",value:function(e){var t=this,i=this.player;Object(U["f"])(this,J[1],(function(e,i){t.dbClickHandler(i.e)}),{e:e,paused:i.paused})}},{key:"onPress",value:function(e){var t=this.pos,i=this.config,n=this.player;i.disablePress||(t.rate=this.player.playbackRate,this.emitUserAction("press","change_rate",{prop:"playbackRate",from:n.playbackRate,to:i.pressRate}),n.playbackRate=i.pressRate,this.changeAction(Q.PLAYBACK))}},{key:"onPressEnd",value:function(e){var t=this.pos,i=this.config,n=this.player;i.disablePress||(this.emitUserAction("pressend","change_rate",{prop:"playbackRate",from:n.playbackRate,to:t.rate}),n.playbackRate=t.rate,t.rate=1,this.changeAction(Q.AUTO))}},{key:"updateTime",value:function(e){var t=this.player,i=this.config,n=this.player.duration;e=Number(e.toFixed(4));var r=parseInt(e*i.moveDuration,10)+this.timeOffset;r+=this.pos.time,r=r<0?0:r>1e3*n?1e3*n-200:r,t.getPlugin("time")&&t.getPlugin("time").updateTime(r/1e3),t.getPlugin("progress")&&t.getPlugin("progress").updatePercent(r/1e3/this.duration,!0),this.activeSeekNote(r/1e3,e>0),i.isTouchingSeek&&t.seek(Number((r-this.timeOffset)/1e3).toFixed(1)),this.pos.time=r}},{key:"updateVolume",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.player,i=this.pos;if(e=parseInt(100*e,10),i.volume+=e,!(Math.abs(i.volume)<10)){var n=parseInt(10*t.volume,10)-parseInt(i.volume/10,10);n=n>10?10:n<1?0:n,t.volume=n/10,i.volume=0}}},{key:"updateBrightness",value:function(e){this.player.rotateDeg&&(e=-e);var t=this.pos,i=this.config,n=this.xgMask,r=t.light+.8*e;r=r>i.maxDarkness?i.maxDarkness:r<0?0:r,n&&(n.style.backgroundColor="rgba(0,0,0,".concat(r,")")),t.light=r}},{key:"activeSeekNote",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.player,n=this.config,r=!(this.duration!==1/0&&this.duration>0);if(e&&"number"===typeof e&&!r&&!n.disableActive){e<0?e=0:e>i.duration&&(e=i.duration-.2),this.changeAction(Q.SEEKING);var s=i.plugins.start;s&&s.focusHide(),this.find(".xg-dur").innerHTML=a["b"].format(this.duration),this.find(".xg-cur").innerHTML=a["b"].format(e),this.find(".xg-curbar").style.width="".concat(e/this.duration*100,"%"),t?a["b"].removeClass(this.find(".xg-seek-show"),"xg-back"):a["b"].addClass(this.find(".xg-seek-show"),"xg-back"),this.updateThumbnails(e)}}},{key:"updateThumbnails",value:function(e){var t=this.player,i=t.plugins.thumbnail;i&&i.usable&&this.thumbnail&&i.update(this.thumbnail,e,160,90)}},{key:"switchPlayPause",value:function(){var e=this.player;if(e.state<v["a"].ATTACHED)return!1;e.ended||(e.paused?e.play():e.pause())}},{key:"disableGesture",value:function(){this.config.disableGesture=!1}},{key:"enableGesture",value:function(){this.config.disableGesture=!0}},{key:"destroy",value:function(){var e=this.player;this.timer&&clearTimeout(this.timer),this.thumbnail=null,e.root.removeChild(this.xgMask),this.xgMask=null,this.touch&&this.touch.destroy(),this.touch=null,e.root.removeEventListener("touchmove",this.onRootTouchMove,!0),e.root.removeEventListener("touchend",this.onRootTouchEnd,!0)}},{key:"render",value:function(){var e="normal"!==this.config.gradient?"gradient ".concat(this.config.gradient):"gradient";return'\n     <xg-trigger class="trigger">\n     <div class="'.concat(e,'"></div>\n        <div class="time-preview">\n            <div class="xg-seek-show ').concat(this.config.disableSeekIcon?" hide-seek-icon":"",'">\n              <i class="xg-seek-icon"></i>\n              <span class="xg-cur">00:00</span>\n              <span>/</span>\n              <span class="xg-dur">00:00</span>\n            </div>\n              <div class="xg-bar xg-timebar">\n                <div class="xg-curbar"></div>\n              </div>\n        </div>\n        <div class="xg-playbackrate xg-top-note">\n            <span><i>').concat(this.config.pressRate,"X</i>").concat(this.i18n.FORWARD,"</span>\n        </div>\n     </xg-trigger>\n    ")}}],[{key:"pluginName",get:function(){return"mobile"}},{key:"defaultConfig",get:function(){return{index:0,disableGesture:!1,gestureX:!0,gestureY:!0,gradient:"normal",isTouchingSeek:!1,miniMoveStep:5,miniYPer:5,scopeL:.25,scopeR:.25,scopeM:.9,pressRate:2,darkness:!0,maxDarkness:.8,disableActive:!1,disableTimeProgress:!1,hideControlsActive:!1,hideControlsEnd:!1,moveDuration:36e4,closedbClick:!1,disablePress:!0,disableSeekIcon:!1,focusVideoClick:!1}}}]),i}(l["b"]);function ee(e){e.preventDefault(),e.returnValue=!1}function te(e){var t=e.tagName;return!("INPUT"!==t&&"TEXTAREA"!==t&&!e.isContentEditable)}var ie=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"onBodyKeyDown",(function(t){var i=t||window.event;if(e.player&&(e.player.isUserActive||e.config.isIgnoreUserActive)&&!(e.config.disable||e.config.disableBodyTrigger||!e.checkIsVisible()||i.metaKey||i.altKey||i.ctrlKey)){var n=i.keyCode;return!(i.target!==document.body&&(!e.config.isGlobalTrigger||te(i.target))||!e.checkCode(n,!0))&&(ee(i),e.handleKeyCode(n,t),!1)}})),Object(n["e"])(Object(n["a"])(e),"onKeydown",(function(t){var i=t||window.event;if(!(e.config.disable||e.config.disableRootTrigger||i.metaKey||i.altKey||i.ctrlKey)&&(e.player.isUserActive||e.config.isIgnoreUserActive)&&(e.player.isUserActive||e.config.isIgnoreUserActive)){if(!i||37!==i.keyCode&&!e.checkCode(i.keyCode)||i.target!==e.player.root&&i.target!==e.player.video&&i.target!==e.player.controls.el)return!0;ee(i),e.handleKeyCode(i.keyCode,t)}})),e}return Object(n["c"])(i,[{key:"mergekeyCodeMap",value:function(){var e=this,t=this.config.keyCodeMap;t&&Object.keys(t).map((function(i){e.keyCodeMap[i]?["keyCode","action","disable","isBodyTarget"].map((function(n){t[i][n]&&(e.keyCodeMap[i][n]=t[i][n])})):e.keyCodeMap[i]=t[i]}))}},{key:"afterCreate",value:function(){this.config.disable=!this.playerConfig.keyShortcut;var e="function"===typeof this.config.seekStep?this.config.seekStep(this.player):this.config.seekStep;e&&"number"===typeof e&&(this.seekStep=e),this.keyCodeMap={space:{keyCode:32,action:"playPause",disable:!1,noBodyTarget:!1},up:{keyCode:38,action:"upVolume",disable:!1,noBodyTarget:!0},down:{keyCode:40,action:"downVolume",disable:!1,noBodyTarget:!0},left:{keyCode:37,action:"seekBack",disable:!1},right:{keyCode:39,action:"seek",disable:!1},esc:{keyCode:27,action:"exitFullscreen",disable:!1}},this.mergekeyCodeMap(),this.player.root.addEventListener("keydown",this.onKeydown),document.addEventListener("keydown",this.onBodyKeyDown)}},{key:"checkIsVisible",value:function(){if(!this.config.checkVisible)return!0;var e=this.player.root.getBoundingClientRect(),t=e.height,i=e.top,n=e.bottom,r=window.innerHeight;return!(i<0&&i<0-.9*t||n>0&&n-r>.9*t)}},{key:"checkCode",value:function(e,t){var i=this,n=!1;return Object.keys(this.keyCodeMap).map((function(r){i.keyCodeMap[r]&&e===i.keyCodeMap[r].keyCode&&!i.keyCodeMap[r].disable&&(n=!t||t&&!i.keyCodeMap[r].noBodyTarget)})),n}},{key:"downVolume",value:function(e){var t=this.player,i=parseFloat((t.volume-.1).toFixed(1)),n={volume:{from:t.volume,to:i}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=i>=0?i:0}},{key:"upVolume",value:function(e){var t=this.player,i=parseFloat((t.volume+.1).toFixed(1)),n={volume:{from:t.volume,to:i}};this.emitUserAction(e,"change_volume",{props:n}),t.volume=i<=1?i:1}},{key:"seek",value:function(e){var t=this.player,i=t.currentTime,n=t.duration,r=i;r=i+this.seekStep<=n?i+this.seekStep:n-1;var a={currentTime:{from:i,to:r}};this.emitUserAction(e,"seek",{props:a}),this.player.currentTime=r}},{key:"seekBack",value:function(e){var t=this.player.currentTime,i=0;t-this.seekStep>=0&&(i=t-this.seekStep);var n={currentTime:{from:t,to:i}};this.emitUserAction(e,"seek",{props:n}),this.player.currentTime=i}},{key:"playPause",value:function(e){var t=this.player;t&&(this.emitUserAction(e,"switch_play_pause"),t.paused?t.play():t.pause())}},{key:"exitFullscreen",value:function(e){var t=this.player,i=t.fullscreen,n=t.cssfullscreen;i&&(this.emitUserAction("keyup","switch_fullscreen",{prop:"fullscreen",from:i,to:!i}),t.exitFullscreen()),n&&(this.emitUserAction("keyup","switch_css_fullscreen",{prop:"cssfullscreen",from:n,to:!n}),t.exitCssFullscreen())}},{key:"handleKeyCode",value:function(e,t){var i=this;Object.keys(this.keyCodeMap).map((function(r){var a=i.keyCodeMap[r],o=a.action,l=a.keyCode,u=a.disable;l!==e||u||("function"===typeof o?o(t,i.player):"string"===typeof o&&"function"===typeof i[o]&&i[o](t,i.player),i.emit(s["SHORTCUT"],Object(n["i"])({key:r,target:t.target},i.keyCodeMap[r])))}))}},{key:"destroy",value:function(){this.player.root.removeEventListener("keydown",this.onKeydown),document.removeEventListener("keydown",this.onBodyKeyDown)}},{key:"disable",value:function(){this.config.disable=!0}},{key:"enable",value:function(){this.config.disable=!1}}],[{key:"pluginName",get:function(){return"keyboard"}},{key:"defaultConfig",get:function(){return{seekStep:10,checkVisible:!0,disableBodyTrigger:!1,disableRootTrigger:!1,isGlobalTrigger:!1,keyCodeMap:{},disable:!1,isIgnoreUserActive:!1}}}]),i}(j["a"]);function ne(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="100" height="100" viewBox="-5 -5 110 110">\n  <path d="M100,50A50,50,0,1,1,50,0" stroke-width="5" stroke="#ddd" stroke-dasharray="236" fill="none"></path>\n</svg>\n',"image/svg+xml").firstChild}var re=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"registerIcons",value:function(){return{loadingIcon:ne}}},{key:"afterCreate",value:function(){this.appendChild("xg-loading-inner",this.icons.loadingIcon)}},{key:"render",value:function(){return'\n    <xg-loading class="xgplayer-loading">\n      <xg-loading-inner></xg-loading-inner>\n    </xg-loading>'}}],[{key:"pluginName",get:function(){return"loading"}},{key:"defaultConfig",get:function(){return{position:l["a"].ROOT}}}]),i}(l["b"]),ae=[{tag:"xg-cache",className:"xgplayer-progress-cache",styleKey:"cachedColor"},{tag:"xg-played",className:"xgplayer-progress-played",styleKey:"playedColor"}],se=function(){function e(t){Object(n["b"])(this,e),this.fragments=t.fragments||[],0===this.fragments.length&&this.fragments.push({percent:1}),this._callBack=t.actionCallback,this.fragConfig={fragFocusClass:t.fragFocusClass||"inner-focus-point",fragAutoFocus:!!t.fragAutoFocus,fragClass:t.fragClass||""},this.style=t.style||{playedColor:"",cachedColor:"",progressColor:""},this.duration=0,this.cachedIndex=0,this.playedIndex=0,this.focusIndex=-1}return Object(n["c"])(e,[{key:"updateDuration",value:function(e){var t=this;this.duration=e;var i=0,n=this.fragments;this.fragments=n.map((function(e){return e.start=parseInt(i,10),e.end=parseInt(i+e.percent*t.duration,10),e.duration=parseInt(e.percent*t.duration,10),i+=e.percent*t.duration,e}))}},{key:"updateProgress",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"played",t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{newIndex:0,curIndex:0,millisecond:0},i=this.progressList,n=this.fragments;if(!(i.length<1)){var r=t.newIndex,a=t.curIndex,s=t.millisecond;r!==a&&i.map((function(t,i){i<r?t[e].style.width="100%":i>r&&(t[e].style.width=0)}));var o=n[r],l=0===s?0:(s-o.start)/o.duration;i[r][e].style.width=l<0?0:"".concat(100*l,"%")}}},{key:"updateFocus",value:function(e){if(this.fragConfig.fragAutoFocus&&!(this.fragments.length<2))if(e){var t=this.findIndex(1e3*e.currentTime,this.focusIndex);if(t>=0&&t!==this.focusIndex){this.focusIndex>-1&&this.unHightLight(this.focusIndex),this.setHightLight(t);var i={index:t,preIndex:this.focusIndex,fragment:this.fragments[this.focusIndex]};this.focusIndex=t,this._callBack&&this._callBack(i)}}else if(this.focusIndex>-1){this.unHightLight(this.focusIndex);var n={index:-1,preIndex:this.focusIndex,fragment:null};this._callBack&&this._callBack(n),this.focusIndex=-1}}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;if(!this.duration||parseInt(1e3*t,10)!==this.duration){if(!t&&0!==t)return;this.updateDuration(parseInt(1e3*t,10))}var i=this.playedIndex,n=this.cachedIndex;if("Undefined"!==a["b"].typeOf(e.played)){var r=this.findIndex(1e3*e.played,i);if(r<0)return;this.updateProgress("played",{newIndex:r,curIndex:i,millisecond:parseInt(1e3*e.played,10)}),this.playedIndex=r}if("Undefined"!==a["b"].typeOf(e.cached)){var s=this.findIndex(1e3*e.cached,n);if(s<0)return;this.updateProgress("cached",{newIndex:s,curIndex:n,millisecond:parseInt(1e3*e.cached,10)}),this.cachedIndex=s}}},{key:"findIndex",value:function(e,t){var i=this.fragments;if(!i||0===i.length)return-1;if(1===i.length)return 0;if(t>-1&&t<i.length&&e>i[t].start&&e<i[t].end)return t;if(e>i[i.length-1].start)return i.length-1;for(var n=0;n<i.length;n++)if(e>i[n].start&&e<=i[n].end){t=n;break}return t}},{key:"findHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)if(a["b"].hasClass(e[t],this.fragConfig.fragFocusClass))return{dom:e[t],pos:e[t].getBoundingClientRect()}}},{key:"findFragment",value:function(e){var t=this.root.children;return e<0||e>=t.length?null:{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"unHightLight",value:function(){for(var e=this.root.children,t=0;t<e.length;t++)a["b"].removeClass(e[t],this.fragConfig.fragFocusClass)}},{key:"setHightLight",value:function(e){var t=this.root.children;if(e<t.length)return a["b"].addClass(t[e],this.fragConfig.fragFocusClass),{dom:t[e],pos:t[e].getBoundingClientRect()}}},{key:"destroy",value:function(){this.progressList=null,this.fragments=null,this.root.innerHTML=""}},{key:"reset",value:function(e){var t=this;if(Object.keys(this.fragConfig).forEach((function(i){void 0!==e[i]&&(t.fragConfig[i]=e[i])})),e.fragments){if(this.fragments=0===e.fragments.length?[{percent:1}]:e.fragments,this.updateDuration(this.duration),this.playedIndex=0,this.cachedIndex=0,this.root){var i=this.root.children;while(i.length>0)this.root.removeChild(i[0])}this.render()}}},{key:"render",value:function(){var e=this,t=this.style.progressColor;if(this.root||(this.root=a["b"].createDom("xg-inners","",{},"progress-list")),this.fragments){var i=this.fragConfig,n=i.fragClass,r=i.fragFocusClass;this.progressList=this.fragments.map((function(i){var s=a["b"].createDom("xg-inner","",{style:t?"background:".concat(t,"; flex: ").concat(i.percent):"flex: ".concat(i.percent)},"".concat(i.isFocus?r:""," xgplayer-progress-inner ").concat(n));return e.root.appendChild(s),ae.forEach((function(t){s.appendChild(a["b"].createDom(t.tag,"",{style:t.styleKey?"background: ".concat(e.style[t.styleKey],"; width:0;"):"width:0;"},t.className))})),{cached:s.children[0],played:s.children[1]}}))}return this.root}}]),e}(),oe={POINT:"inner-focus-point",HIGHLIGHT:"inner-focus-highlight"},le=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"onMoveOnly",(function(e,t){var i=Object(n["a"])(r),s=i.pos,o=i.config,l=i.player,u=t;if(e){a["b"].event(e);var c=a["b"].getEventPos(e,l.zoom),h=90===l.rotateDeg?c.clientY:c.clientX;if(s.moving&&Math.abs(s.x-h)<o.miniMoveStep)return;s.moving=!0,s.x=h,u=r.computeTime(e,h)}r.triggerCallbacks("dragmove",u,e),r._updateInnerFocus(u)})),Object(n["e"])(Object(n["a"])(r),"onBodyClick",(function(e){r.pos.isLocked&&(r.pos.isLocked=!1,e.preventDefault(),e.stopPropagation())})),Object(n["e"])(Object(n["a"])(r),"_mouseDownHandler",(function(e,t){r._state.time=t.currentTime,r.updateWidth(t.currentTime,t.percent,0),r._updateInnerFocus(t)})),Object(n["e"])(Object(n["a"])(r),"_mouseUpHandler",(function(e,t){var i=Object(n["a"])(r),a=i.pos;a.moving&&r.updateWidth(t.currentTime,t.percent,2)})),Object(n["e"])(Object(n["a"])(r),"_mouseMoveHandler",(function(e,t){var i=Object(n["a"])(r),a=i._state,s=i.pos,o=i.config,l=i.player;a.time<t.currentTime?t.forward=!0:t.forward=!1,a.time=t.currentTime,s.isDown&&!s.moving&&(s.moving=!0,o.isPauseMoving&&l.pause(),r.triggerCallbacks("dragstart",t,e),r.emitUserAction("drag","dragstart",t)),r.updateWidth(t.currentTime,t.percent,1),r.triggerCallbacks("dragmove",t,e),r._updateInnerFocus(t)})),Object(n["e"])(Object(n["a"])(r),"onMouseDown",(function(e){var t=Object(n["a"])(r),i=t._state,s=t.player,o=t.pos,l=t.config,u=t.playerConfig,c=a["b"].getEventPos(e,s.zoom),h=90===s.rotateDeg?c.clientY:c.clientX;if(!(s.isMini||l.closeMoveSeek||!u.allowSeekAfterEnded&&s.ended)){if(s.duration||s.isPlaying){e.stopPropagation(),r.focus(),a["b"].checkIsFunction(u.disableSwipeHandler)&&u.disableSwipeHandler(),a["b"].checkIsFunction(l.onMoveStart)&&l.onMoveStart(),a["b"].event(e),o.x=h,o.isDown=!0,o.moving=!1,i.prePlayTime=s.currentTime,s.focus({autoHide:!1}),r.isProgressMoving=!0,a["b"].addClass(r.progressBtn,"active");var d=r.computeTime(e,h);d.prePlayTime=i.prePlayTime,r._mouseDownHandlerHook(e,d);var f=e.type;return"touchstart"===f?(r.root.addEventListener("touchmove",r.onMouseMove),r.root.addEventListener("touchend",r.onMouseUp)):(r.unbind("mousemove",r.onMoveOnly),document.addEventListener("mousemove",r.onMouseMove,!1),document.addEventListener("mouseup",r.onMouseUp,!1)),!0}s.play()}})),Object(n["e"])(Object(n["a"])(r),"onMouseUp",(function(e){var t=Object(n["a"])(r),i=t.player,s=t.config,o=t.pos,l=t.playerConfig,u=t._state;e.stopPropagation(),e.preventDefault(),a["b"].checkIsFunction(l.enableSwipeHandler)&&l.enableSwipeHandler(),a["b"].checkIsFunction(s.onMoveEnd)&&s.onMoveEnd(),a["b"].event(e),a["b"].removeClass(r.progressBtn,"active");var c=r.computeTime(e,o.x);c.prePlayTime=u.prePlayTime,o.moving?(r.triggerCallbacks("dragend",c,e),r.emitUserAction("drag","dragend",c)):(r.triggerCallbacks("click",c,e),r.emitUserAction("click","click",c)),r._mouseUpHandlerHook(e,c),o.moving=!1,o.isDown=!1,o.x=0,o.y=0,o.isLocked=!0,u.prePlayTime=0,u.time=0;var h=e.type;"touchend"===h?(r.root.removeEventListener("touchmove",r.onMouseMove),r.root.removeEventListener("touchend",r.onMouseUp),r.blur()):(document.removeEventListener("mousemove",r.onMouseMove,!1),document.removeEventListener("mouseup",r.onMouseUp,!1),o.isEnter?"mobile"!==l.isMobileSimulateMode&&r.bind("mousemove",r.onMoveOnly):r.onMouseLeave(e)),a["b"].setTimeout(Object(n["a"])(r),(function(){r.resetSeekState()}),10),i.focus()})),Object(n["e"])(Object(n["a"])(r),"onMouseMove",(function(e){var t=Object(n["a"])(r),i=t._state,s=t.pos,o=t.player,l=t.config;a["b"].checkTouchSupport()&&e.preventDefault(),a["b"].event(e);var u=a["b"].getEventPos(e,o.zoom),c=90===o.rotateDeg?u.clientY:u.clientX,h=Math.abs(s.x-c);if(!(s.moving&&h<l.miniMoveStep||!s.moving&&h<l.miniStartStep)){s.x=c;var d=r.computeTime(e,c);d.prePlayTime=i.prePlayTime,r._mouseMoveHandlerHook(e,d)}})),Object(n["e"])(Object(n["a"])(r),"onMouseOut",(function(e){r.triggerCallbacks("mouseout",null,e)})),Object(n["e"])(Object(n["a"])(r),"onMouseOver",(function(e){r.triggerCallbacks("mouseover",null,e)})),Object(n["e"])(Object(n["a"])(r),"onMouseEnter",(function(e){var t=Object(n["a"])(r),i=t.player,s=t.pos;if(!(s.isDown||s.isEnter||i.isMini||!i.config.allowSeekAfterEnded&&i.ended)){s.isEnter=!0,r.bind("mousemove",r.onMoveOnly),r.bind("mouseleave",r.onMouseLeave),a["b"].event(e);var o=a["b"].getEventPos(e,i.zoom),l=90===i.rotateDeg?o.clientY:o.clientX,u=r.computeTime(e,l);r.triggerCallbacks("mouseenter",u,e),r.focus()}})),Object(n["e"])(Object(n["a"])(r),"onMouseLeave",(function(e){r.triggerCallbacks("mouseleave",null,e),r.unlock(),r._updateInnerFocus(null)})),Object(n["e"])(Object(n["a"])(r),"onVideoResize",(function(){var e=r.pos,t=e.x,i=e.isDown,n=e.isEnter;if(n&&!i){var a=r.computeTime(null,t);r.onMoveOnly(null,a)}})),r.useable=!1,r.isProgressMoving=!1,r.__dragCallBacks=[],r._state={now:-1,direc:0,time:0,prePlayTime:-1},r._disableBlur=!1,r}return Object(n["c"])(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"changeState",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.useable=e}},{key:"show",value:function(){this.root&&(this.root.style.display="flex")}},{key:"_initInner",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t&&0!==t.length||(t=[{percent:1}]);var r=Object(n["i"])(Object(n["i"])({fragments:t},i),{},{actionCallback:function(t){e.emitUserAction("fragment_focus","fragment_focus",t)}});this.innerList?this.innerList.reset(r):(this.innerList=new se(r),this.outer.insertBefore(this.innerList.render(),this.outer.children[0]),["findHightLight","unHightLight","setHightLight","findFragment"].map((function(t){e[t]=e.innerList[t].bind(e.innerList)})))}},{key:"_updateInnerFocus",value:function(e){this.innerList&&this.innerList.updateFocus(e)}},{key:"afterCreate",value:function(){var e=this;if(!this.config.disable&&!this.playerConfig.isLive){this.pos={x:0,y:0,moving:!1,isDown:!1,isEnter:!1,isLocked:!1},this.outer=this.find("xg-outer");var t=this.config,i=t.fragFocusClass,n=t.fragAutoFocus,a=t.fragClass;this._initInner(this.config.fragments,{fragFocusClass:i,fragAutoFocus:n,fragClass:a,style:this.playerConfig.commonStyle||{}}),"mobile"===r["a"].device&&(this.config.isDragingSeek=!1,this.isMobile=!0),this.progressBtn=this.find(".xgplayer-progress-btn"),this.on(s["DURATION_CHANGE"],(function(){e.onMouseLeave()})),this.on(s["TIME_UPDATE"],(function(){e.onTimeupdate()})),this.on(s["SEEKED"],(function(){e.onTimeupdate(),e.onCacheUpdate()})),this.on(s["PROGRESS"],(function(){e.onCacheUpdate()})),this.on(s["ENDED"],(function(){e.onCacheUpdate(!0),e.onTimeupdate(!0),e._state.now=0})),this.on(s["EMPTIED"],(function(){e.onReset()})),this.on(s["VIDEO_RESIZE"],(function(){e.onVideoResize()})),this.bindDomEvents(),this.initCustomStyle()}}},{key:"setConfig",value:function(e){var t=this,i=null;Object.keys(e).forEach((function(n){t.config[n]=e[n],"fragments"===n&&(i=e[n])})),i&&this._initInner(i,e)}},{key:"initCustomStyle",value:function(){var e=this.playerConfig||{},t=e.commonStyle,i=t.sliderBtnStyle,r=this.progressBtn;i&&("string"===typeof i?r.style.boxShadow=i:"object"===Object(n["l"])(i)&&Object.keys(i).map((function(e){r.style[e]=i[e]})))}},{key:"triggerCallbacks",value:function(e,t,i){this.__dragCallBacks.length>0&&this.__dragCallBacks.map((function(n){if(n&&n.handler&&n.type===e)try{n.handler(t,i)}catch(r){}}))}},{key:"addCallBack",value:function(e,t){t&&"function"===typeof t&&this.__dragCallBacks.push({type:e,handler:t})}},{key:"removeCallBack",value:function(e,t){var i=this.__dragCallBacks,n=-1;i.map((function(i,r){i&&i.type===e&&i.handler===t&&(n=r)})),n>-1&&i.splice(n,1)}},{key:"unlock",value:function(){var e=this.player,t=this.pos;t.isEnter=!1,e.isMini||(this.unbind("mousemove",this.onMoveOnly),t.isDown?this.unbind("mouseleave",this.onMouseLeave):this.blur())}},{key:"bindDomEvents",value:function(){var e=this.player,t=e.controls,i=e.config;this._mouseDownHandlerHook=this.hook("dragstart",this._mouseDownHandler),this._mouseUpHandlerHook=this.hook("dragend",this._mouseUpHandler),this._mouseMoveHandlerHook=this.hook("drag",this._mouseMoveHandler),"touch"!==this.domEventType&&"compatible"!==this.domEventType||(this.root.addEventListener("touchstart",this.onMouseDown),t&&(t.root&&t.root.addEventListener("touchmove",a["b"].stopPropagation),t.center&&t.center.addEventListener("touchend",a["b"].stopPropagation))),"mouse"!==this.domEventType&&"compatible"!==this.domEventType||(this.bind("mousedown",this.onMouseDown),"mobile"!==i.isMobileSimulateMode&&this.bind("mouseenter",this.onMouseEnter),this.bind("mouseover",this.onMouseOver),this.bind("mouseout",this.onMouseOut),this.player.root.addEventListener("click",this.onBodyClick,!0))}},{key:"focus",value:function(){this.player.controls.pauseAutoHide(),a["b"].addClass(this.root,"active")}},{key:"blur",value:function(){this._disableBlur||(this.player.controls.recoverAutoHide(),a["b"].removeClass(this.root,"active"))}},{key:"disableBlur",value:function(){this._disableBlur=!0}},{key:"enableBlur",value:function(){this._disableBlur=!1}},{key:"updateWidth",value:function(e,t,i){var n=this.config,r=this.player;if(!n.isCloseClickSeek||0!==i){var a=e>=r.duration?r.duration-n.endedDiff:Number(e).toFixed(1);this.updatePercent(t),this.updateTime(e),(1!==i||n.isDragingSeek&&"audio"!==r.config.mediaType)&&(this._state.now=a,this._state.direc=a>r.currentTime?0:1,r.seek(a))}}},{key:"computeTime",value:function(e,t){var i,n,r=this.player,a=this.root.getBoundingClientRect(),s=a.width,o=a.height,l=a.top,u=a.left,c=t;90===r.rotateDeg?(i=o,n=l):(i=s,n=u);var h=c-n;h=h>i?i:h<0?0:h;var d=h/i;d=d<0?0:d>1?1:d;var f=parseInt(d*this.duration*1e3,10)/1e3;return{percent:d,currentTime:f,offset:h,width:i,left:n,e:e}}},{key:"updateTime",value:function(e){var t=this.player,i=this.duration;e>i?e=i:e<0&&(e=0);var n=t.plugins.time;n&&n.updateTime(e)}},{key:"resetSeekState",value:function(){this.isProgressMoving=!1;var e=this.player.plugins.time;e&&e.resetActive()}},{key:"updatePercent",value:function(e,t){if(this.isProgressMoving=!0,!this.config.disable){e=e>1?1:e<0?0:e,this.progressBtn.style.left="".concat(100*e,"%"),this.innerList.update({played:e*this.duration},this.duration);var i=this.player.plugins.miniprogress;i&&i.update({played:e*this.duration},this.duration)}}},{key:"onTimeupdate",value:function(e){var t=this.player,i=this._state,n=this.duration;if(!t.isSeeking&&!this.isProgressMoving){if(i.now>-1){var r=parseInt(1e3*i.now,10)-parseInt(1e3*t.currentTime,10);if(0===i.direc&&r>300||1===i.direc&&r>-300)return void(i.now=-1);i.now=-1}var s=this.timeOffset+t.currentTime;s=a["b"].adjustTimeByDuration(s,n,e),this.innerList.update({played:s},n),this.progressBtn.style.left="".concat(s/n*100,"%");var o=this.player.plugins.miniprogress;o&&o.update({played:s},n)}}},{key:"onCacheUpdate",value:function(e){var t=this.player,i=this.duration;if(t){var n=t.bufferedPoint.end;n=a["b"].adjustTimeByDuration(n,i,e),this.innerList.update({cached:n},i);var r=this.player.plugins.miniprogress;r&&r.update({cached:n},i)}}},{key:"onReset",value:function(){this.innerList.update({played:0,cached:0},0);var e=this.player.plugins.miniprogress;e&&e.update({cached:0,played:0},0)}},{key:"destroy",value:function(){var e=this.player,t=e.controls;this.thumbnailPlugin=null,this.innerList.destroy(),this.innerList=null;var i=this.domEventType;"touch"!==i&&"compatible"!==i||(this.root.removeEventListener("touchstart",this.onMouseDown),this.root.removeEventListener("touchmove",this.onMouseMove),this.root.removeEventListener("touchend",this.onMouseUp),t&&(t.root&&t.root.removeEventListener("touchmove",a["b"].stopPropagation),t.center&&t.center.removeEventListener("touchend",a["b"].stopPropagation))),"mouse"!==i&&"compatible"!==i||(this.unbind("mousedown",this.onMouseDown),this.unbind("mouseenter",this.onMouseEnter),this.unbind("mousemove",this.onMoveOnly),this.unbind("mouseleave",this.onMouseLeave),document.removeEventListener("mousemove",this.onMouseMove,!1),document.removeEventListener("mouseup",this.onMouseUp,!1),e.root.removeEventListener("click",this.onBodyClick,!0))}},{key:"render",value:function(){if(!this.config.disable&&!this.playerConfig.isLive){var e=this.player.controls?this.player.controls.config.mode:"",t="bottom"===e?"xgplayer-progress-bottom":"";return'\n    <xg-progress class="xgplayer-progress '.concat(t,'">\n      <xg-outer class="xgplayer-progress-outer">\n        <xg-progress-btn class="xgplayer-progress-btn"></xg-progress-btn>\n      </xg-outer>\n    </xg-progress>\n    ')}}}],[{key:"pluginName",get:function(){return"progress"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_CENTER,index:0,disable:!1,isDragingSeek:!0,closeMoveSeek:!1,isPauseMoving:!1,isCloseClickSeek:!1,fragments:[{percent:1}],fragFocusClass:oe.POINT,fragClass:"",fragAutoFocus:!1,miniMoveStep:5,miniStartStep:2,onMoveStart:function(){},onMoveEnd:function(){},endedDiff:.2}}},{key:"FRAGMENT_FOCUS_CLASS",get:function(){return oe}}]),i}(l["b"]),ue=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"_onMouseenter",(function(t){e.emit("icon_mouseenter",{pluginName:e.pluginName})})),Object(n["e"])(Object(n["a"])(e),"_onMouseLeave",(function(t){e.emit("icon_mouseleave",{pluginName:e.pluginName})})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){this.bind("mouseenter",this._onMouseenter),this.bind("mouseleave",this._onMouseLeave)}},{key:"destroy",value:function(){this.unbind("mouseenter",this._onMouseenter),this.unbind("mouseleave",this._onMouseLeave)}}]),i}(l["b"]),ce=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this);var t=this.player,r=this.config;r.disable||(this.initIcons(),this.btnClick=this.btnClick.bind(this),this.bind(["touchend","click"],this.btnClick),this.on([s["PAUSE"],s["ERROR"],s["EMPTIED"]],(function(){e.animate(t.paused)})),this.on(s["PLAY"],(function(){e.animate(t.paused)})),this.animate(!0))}},{key:"registerIcons",value:function(){return{play:{icon:p,class:"xg-icon-play"},pause:{icon:m,class:"xg-icon-pause"}}}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player;return this.emitUserAction(e,"switch_play_pause",{prop:"paused",from:t.paused,to:!t.paused}),t.ended?t.replay():t.paused?(t.play(),this.animate(!1)):(t.pause(),this.animate(!0)),!1}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.play),this.appendChild(".xgplayer-icon",e.pause)}},{key:"animate",value:function(e){if(this.player){var t=this.i18nKeys,i=this.find(".xg-tips");e?(this.setAttr("data-state","pause"),i&&this.changeLangTextKey(i,t.PLAY_TIPS)):(this.setAttr("data-state","play"),i&&this.changeLangTextKey(i,t.PAUSE_TIPS))}}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.unbind(["touchend","click"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-play">\n    <div class="xgplayer-icon">\n    </div>\n    '.concat(S(this,"PLAY_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"play"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_LEFT,index:0,disable:!1}}}]),i}(ue);function he(){return(new DOMParser).parseFromString('<svg width="32px" height="40px" viewBox="0 0 32 32" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">\n    <g stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n        <path d="M11.2374369,14 L17.6187184,7.61871843 C17.9604272,7.27700968 17.9604272,6.72299032 17.6187184,6.38128157 C17.2770097,6.03957281 16.7229903,6.03957281 16.3812816,6.38128157 L9.38128157,13.3812816 C9.03957281,13.7229903 9.03957281,14.2770097 9.38128157,14.6187184 L16.3812816,21.6187184 C16.7229903,21.9604272 17.2770097,21.9604272 17.6187184,21.6187184 C17.9604272,21.2770097 17.9604272,20.7229903 17.6187184,20.3812816 L11.2374369,14 L11.2374369,14 Z" fill="#FFFFFF"></path>\n    </g>\n</svg>',"image/svg+xml").firstChild}var de=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this.initIcons(),this.onClick=function(t){t.preventDefault(),t.stopPropagation(),e.config.onClick(t)},this.bind(["click","touchend"],this.onClick)}},{key:"registerIcons",value:function(){return{screenBack:{icon:he,class:"xg-fullscreen-back"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(this.root,e.screenBack)}},{key:"show",value:function(){a["b"].addClass(this.root,"show")}},{key:"hide",value:function(){a["b"].removeClass(this.root,"show")}},{key:"render",value:function(){return'<xg-icon class="xgplayer-back">\n    </xg-icon>'}}],[{key:"pluginName",get:function(){return"topbackicon"}},{key:"defaultConfig",get:function(){return{position:l["a"].ROOT_TOP,index:0}}}]),i}(l["b"]);function fe(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M598 214h212v212h-84v-128h-128v-84zM726 726v-128h84v212h-212v-84h128zM214 426v-212h212v84h-128v128h-84zM298 598v128h128v84h-212v-212h84z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ge(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="2 -4 28 40">\n  <path fill="#fff" transform="scale(0.0320625 0.0320625)" d="M682 342h128v84h-212v-212h84v128zM598 810v-212h212v84h-128v128h-84zM342 342v-128h84v212h-212v-84h128zM214 682v-84h212v212h-84v-128h-128z"></path>\n</svg>\n',"image/svg+xml").firstChild}var ve=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"_onOrientationChange",(function(t){e.player.fullscreen&&e.config.rotateFullscreen&&(90===window.orientation||-90===window.orientation?e.player.setRotateDeg(0):e.player.setRotateDeg(90))})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this);var t=this.config,o=this.playerConfig;if(!t.disable){t.target&&(this.playerConfig.fullscreenTarget=this.config.target);var l=a["b"].getFullScreenEl();o.fullscreenTarget===l&&this.player.getFullscreen().catch((function(e){})),this.initIcons(),this.handleFullscreen=this.hook("fullscreenChange",this.toggleFullScreen,{pre:function(t){var i=e.player.fullscreen;e.emitUserAction(t,"switch_fullscreen",{prop:"fullscreen",from:i,to:!i})}}),this.bind(".xgplayer-fullscreen",["touchend","click"],this.handleFullscreen),this.on(s["FULLSCREEN_CHANGE"],(function(t){var i=e.find(".xg-tips");i&&e.changeLangTextKey(i,t?e.i18nKeys.EXITFULLSCREEN_TIPS:e.i18nKeys.FULLSCREEN_TIPS),e.animate(t)})),this.config.needBackIcon&&(this.topBackIcon=this.player.registerPlugin({plugin:de,options:{config:{onClick:function(t){e.handleFullscreen(t)}}}})),"mobile"===r["a"].device&&window.addEventListener("orientationchange",this._onOrientationChange)}}},{key:"registerIcons",value:function(){return{fullscreen:{icon:fe,class:"xg-get-fullscreen"},exitFullscreen:{icon:ge,class:"xg-exit-fullscreen"}}}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon","mobile"===r["a"].device?"touchend":"click",this.handleFullscreen),"mobile"===r["a"].device&&window.removeEventListener("orientationchange",this._onOrientationChange)}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.fullscreen),this.appendChild(".xgplayer-icon",e.exitFullscreen)}},{key:"toggleFullScreen",value:function(e){e&&(e.preventDefault(),e.stopPropagation());var t=this.player,i=this.config,n=!0===i.useCssFullscreen||"function"===typeof i.useCssFullscreen&&i.useCssFullscreen();n?(t.fullscreen?t.exitCssFullscreen():t.getCssFullscreen(),this.animate(t.fullscreen)):i.rotateFullscreen?(t.fullscreen?t.exitRotateFullscreen():t.getRotateFullscreen(),this.animate(t.fullscreen)):i.switchCallback&&"function"===typeof i.switchCallback?i.switchCallback(t.fullscreen):t.fullscreen?t.exitFullscreen():t.getFullscreen().catch((function(e){}))}},{key:"animate",value:function(e){e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.topBackIcon&&(e?(this.topBackIcon.show(),this.hide()):(this.topBackIcon.hide(),this.show()))}},{key:"show",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"show",this).call(this)}},{key:"hide",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"hide",this).call(this)}},{key:"render",value:function(){if(!this.config.disable){var e="FULLSCREEN_TIPS";return'<xg-icon class="xgplayer-fullscreen">\n    <div class="xgplayer-icon">\n    </div>\n    '.concat(S(this,e,this.playerConfig.isHideTips),"\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"fullscreen"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:0,useCssFullscreen:!1,rotateFullscreen:!1,switchCallback:null,target:null,disable:!1,needBackIcon:!1}}}]),i}(ue),pe=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),r.isActiving=!1,r}return Object(n["c"])(i,[{key:"duration",get:function(){return this.playerConfig.customDuration||this.player.duration}},{key:"currentTime",get:function(){return this.player.currentTime||0}},{key:"timeOffset",get:function(){return this.playerConfig.timeOffset||0}},{key:"afterCreate",value:function(){var e=this,t=this.player.controls.config.mode;this.mode="flex"===t?"flex":"normal",this.config.disable||("flex"===this.mode&&(this.createCenterTime(),this.root.style.display="none"),this.durationDom=this.find(".time-duration"),this.timeDom=this.find(".time-current"),this.on(s["DURATION_CHANGE"],(function(){e.onTimeUpdate()})),this.on(s["TIME_UPDATE"],(function(){e.onTimeUpdate()})),this.on(s["ENDED"],(function(){e.onTimeUpdate(!0)})),this.on(s["EMPTIED"],(function(){e.onReset()})))}},{key:"show",value:function(){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="block"),void(this.centerDurDom&&(this.centerDurDom.style.display="block"));this.root.style.display="block"}},{key:"hide",value:function(){if("flex"===this.mode)return this.centerCurDom&&(this.centerCurDom.style.display="none"),void(this.centerDurDom&&(this.centerDurDom.style.display="none"));this.root.style.display="none"}},{key:"onTimeUpdate",value:function(e){var t=this.player,i=this.config,n=this.duration;if(!i.disable&&!this.isActiving&&t.hasStart){var r=t.currentTime+this.timeOffset;r=a["b"].adjustTimeByDuration(r,n,e),"flex"===this.mode?(this.centerCurDom.innerHTML=a["b"].format(r),n!==1/0&&n>0&&(this.centerDurDom.innerHTML=a["b"].format(n))):(this.timeDom.innerHTML=a["b"].format(r),n!==1/0&&n>0&&(this.durationDom.innerHTML=a["b"].format(n)))}}},{key:"onReset",value:function(){"flex"===this.mode?(this.centerCurDom.innerHTML=a["b"].format(0),this.centerDurDom.innerHTML=a["b"].format(0)):(this.timeDom.innerHTML=a["b"].format(0),this.durationDom.innerHTML=a["b"].format(0))}},{key:"createCenterTime",value:function(){var e=this.player;if(e.controls&&e.controls.center){var t=e.controls.center;this.centerCurDom=a["b"].createDom("xg-icon","00:00",{},"xgplayer-time xg-time-left"),this.centerDurDom=a["b"].createDom("xg-icon","00:00",{},"xgplayer-time xg-time-right"),t.children.length>0?t.insertBefore(this.centerCurDom,t.children[0]):t.appendChild(this.centerCurDom),t.appendChild(this.centerDurDom)}}},{key:"afterPlayerInit",value:function(){var e=this.config;this.duration===1/0||this.playerConfig.isLive?(a["b"].hide(this.durationDom),a["b"].hide(this.timeDom),a["b"].hide(this.find(".time-separator")),a["b"].show(this.find(".time-live-tag"))):a["b"].hide(this.find(".time-live-tag")),e.hide?this.hide():this.show()}},{key:"changeLiveState",value:function(e){e?(a["b"].hide(this.durationDom),a["b"].hide(this.timeDom),a["b"].hide(this.find(".time-separator")),a["b"].show(this.find(".time-live-tag"))):(a["b"].hide(this.find(".time-live-tag")),a["b"].show(this.find(".time-separator")),a["b"].show(this.durationDom),a["b"].show(this.timeDom))}},{key:"updateTime",value:function(e){this.isActiving=!0,!e&&0!==e||e>this.duration||("flex"!==this.mode?this.timeDom.innerHTML=a["b"].format(e):this.centerCurDom.innerHTML=a["b"].format(e))}},{key:"resetActive",value:function(){var e=this,t=this.player,i=function(){e.isActiving=!1};this.off(s["SEEKED"],i),t.isSeeking?this.once(s["SEEKED"],i):this.isActiving=!1}},{key:"destroy",value:function(){var e=this.player.controls.center;this.centerCurDom&&e.removeChild(this.centerCurDom),this.centerCurDom=null,this.centerDurDom&&e.removeChild(this.centerDurDom),this.centerDurDom=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-time">\n    <span class="time-current">00:00</span>\n    <span class="time-separator">/</span>\n    <span class="time-duration">00:00</span>\n    <span class="time-live-tag">'.concat(this.i18n.LIVE_TIP,"</span>\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"time"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_LEFT,index:2,disable:!1}}}]),i}(l["b"]);function me(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M940.632 837.632l-72.192-72.192c65.114-64.745 105.412-154.386 105.412-253.44s-40.299-188.695-105.396-253.424l-0.016-0.016 72.192-72.192c83.639 83.197 135.401 198.37 135.401 325.632s-51.762 242.434-135.381 325.612l-0.020 0.020zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function ye(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021zM795.648 693.248l-72.704-72.704c27.756-27.789 44.921-66.162 44.921-108.544s-17.165-80.755-44.922-108.546l0.002 0.002 72.704-72.704c46.713 46.235 75.639 110.363 75.639 181.248s-28.926 135.013-75.617 181.227l-0.021 0.021z"></path>\n</svg>\n',"image/svg+xml").firstChild}function be(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="28" height="40" viewBox="0 -10 28 40">\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M358.4 358.4h-204.8v307.2h204.8l256 256v-819.2l-256 256z"></path>\n  <path fill="#fff" transform="scale(0.0220625 0.0220625)" d="M920.4 439.808l-108.544-109.056-72.704 72.704 109.568 108.544-109.056 108.544 72.704 72.704 108.032-109.568 108.544 109.056 72.704-72.704-109.568-108.032 109.056-108.544-72.704-72.704-108.032 109.568z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Ee=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,s=new Array(r),o=0;o<r;o++)s[o]=arguments[o];return e=t.call.apply(t,[this].concat(s)),Object(n["e"])(Object(n["a"])(e),"onBarMousedown",(function(t){var i=Object(n["a"])(e),r=i.player,s=e.find(".xgplayer-bar");a["b"].event(t);var o=s.getBoundingClientRect(),l=a["b"].getEventPos(t,r.zoom),u=o.height-(l.clientY-o.top);if(l.h=u,l.barH=o.height,e.pos=l,!(u<-2))return e.updateVolumePos(u,t),document.addEventListener("mouseup",e.onBarMouseUp),e._d.isStart=!0,!1})),Object(n["e"])(Object(n["a"])(e),"onBarMouseMove",(function(t){var i=Object(n["a"])(e),r=i._d;if(r.isStart){var s=Object(n["a"])(e),o=s.pos,l=s.player;t.preventDefault(),t.stopPropagation(),a["b"].event(t);var u=a["b"].getEventPos(t,l.zoom);r.isMoving=!0;var c=o.h-u.clientY+o.clientY;c>o.barH||e.updateVolumePos(c,t)}})),Object(n["e"])(Object(n["a"])(e),"onBarMouseUp",(function(t){a["b"].event(t),document.removeEventListener("mouseup",e.onBarMouseUp);var i=Object(n["a"])(e),r=i._d;r.isStart=!1,r.isMoving=!1})),Object(n["e"])(Object(n["a"])(e),"onMouseenter",(function(t){e._d.isActive=!0,e.focus(),e.emit("icon_mouseenter",{pluginName:e.pluginName})})),Object(n["e"])(Object(n["a"])(e),"onMouseleave",(function(t){e._d.isActive=!1,e.unFocus(100,!1,t),e.emit("icon_mouseleave",{pluginName:e.pluginName})})),Object(n["e"])(Object(n["a"])(e),"onVolumeChange",(function(t){if(e.player){var i=e.player,n=i.muted,r=i.volume;e._d.isMoving||(e.find(".xgplayer-drag").style.height=n||0===r?"4px":"".concat(100*r,"%"),e.config.showValueLabel&&e.updateVolumeValue()),e.animate(n,r)}})),e}return Object(n["c"])(i,[{key:"registerIcons",value:function(){return{volumeSmall:{icon:ye,class:"xg-volume-small"},volumeLarge:{icon:me,class:"xg-volume"},volumeMuted:{icon:be,class:"xg-volume-mute"}}}},{key:"afterCreate",value:function(){var e=this;if(this._timerId=null,this._d={isStart:!1,isMoving:!1,isActive:!1},!this.config.disable){this.initIcons();var t=this.playerConfig,i=t.commonStyle,n=t.volume;i.volumeColor&&(this.find(".xgplayer-drag").style.backgroundColor=i.volumeColor),this.changeMutedHandler=this.hook("mutedChange",(function(t){e.changeMuted(t)}),{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this._onMouseenterHandler=this.hook("mouseenter",this.onMouseenter),this._onMouseleaveHandler=this.hook("mouseleave",this.onMouseleave),"mobile"!==r["a"].device&&"mobile"!==this.playerConfig.isMobileSimulateMode&&(this.bind("mouseenter",this._onMouseenterHandler),this.bind(["blur","mouseleave"],this._onMouseleaveHandler),this.bind(".xgplayer-slider","mousedown",this.onBarMousedown),this.bind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.bind(".xgplayer-slider","mouseup",this.onBarMouseUp)),this.bind(".xgplayer-icon",["touchend","click"],this.changeMutedHandler),this.on(s["VOLUME_CHANGE"],this.onVolumeChange),this.once(s["LOADED_DATA"],this.onVolumeChange),"Number"!==a["b"].typeOf(n)&&(this.player.volume=this.config.default),this.onVolumeChange()}}},{key:"updateVolumePos",value:function(e,t){var i=this.player,n=this.find(".xgplayer-drag"),r=this.find(".xgplayer-bar");if(r&&n){var a=parseInt(e/r.getBoundingClientRect().height*1e3,10);n.style.height="".concat(e,"px");var s=Math.max(Math.min(a/1e3,1),0),o={volume:{from:i.volume,to:s}};i.muted&&(o.muted={from:!0,to:!1}),this.emitUserAction(t,"change_volume",{muted:i.muted,volume:i.volume,props:o}),i.volume=Math.max(Math.min(a/1e3,1),0),i.muted&&(i.muted=!1),this.config.showValueLabel&&this.updateVolumeValue()}}},{key:"updateVolumeValue",value:function(){var e=this.player,t=e.volume,i=e.muted,n=this.find(".xgplayer-value-label"),r=Math.max(Math.min(t,1),0);n.innerText=i?0:Math.ceil(100*r)}},{key:"focus",value:function(){var e=this.player;e.focus({autoHide:!1}),this._timerId&&(a["b"].clearTimeout(this,this._timerId),this._timerId=null),a["b"].addClass(this.root,"slide-show")}},{key:"unFocus",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,i=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0,r=this._d,s=this.player;r.isActive||(this._timerId&&(a["b"].clearTimeout(this,this._timerId),this._timerId=null),this._timerId=a["b"].setTimeout(this,(function(){r.isActive||(i?s.blur():s.focus(),a["b"].removeClass(e.root,"slide-show"),r.isStart&&e.onBarMouseUp(n)),e._timerId=null}),t))}},{key:"changeMuted",value:function(e){e&&e.stopPropagation();var t=this.player,i=this._d;i.isStart&&this.onBarMouseUp(e),this.emitUserAction(e,"change_muted",{muted:t.muted,volume:t.volume,props:{muted:{from:t.muted,to:!t.muted}}}),t.volume>0&&(t.muted=!t.muted),t.volume<.01&&(t.volume=this.config.miniVolume)}},{key:"animate",value:function(e,t){e||0===t?this.setAttr("data-state","mute"):t<.5&&this.icons.volumeSmall?this.setAttr("data-state","small"):this.setAttr("data-state","normal")}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.volumeSmall),this.appendChild(".xgplayer-icon",e.volumeLarge),this.appendChild(".xgplayer-icon",e.volumeMuted)}},{key:"destroy",value:function(){this._timerId&&(a["b"].clearTimeout(this,this._timerId),this._timerId=null),this.unbind("mouseenter",this.onMouseenter),this.unbind(["blur","mouseleave"],this.onMouseleave),this.unbind(".xgplayer-slider","mousedown",this.onBarMousedown),this.unbind(".xgplayer-slider","mousemove",this.onBarMouseMove),this.unbind(".xgplayer-slider","mouseup",this.onBarMouseUp),document.removeEventListener("mouseup",this.onBarMouseUp),this.unbind(".xgplayer-icon","mobile"===r["a"].device?"touchend":"click",this.changeMutedHandler)}},{key:"render",value:function(){if(!this.config.disable){var e=this.config.default||this.player.volume,t=this.config.showValueLabel;return'\n    <xg-icon class="xgplayer-volume" data-state="normal">\n      <div class="xgplayer-icon">\n      </div>\n      <xg-slider class="xgplayer-slider">\n        '.concat(t?'<div class="xgplayer-value-label">'.concat(100*e,"</div>"):"",'\n        <div class="xgplayer-bar">\n          <xg-drag class="xgplayer-drag" style="height: ').concat(100*e,'%"></xg-drag>\n        </div>\n      </xg-slider>\n    </xg-icon>')}}}],[{key:"pluginName",get:function(){return"volume"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:1,disable:!1,showValueLabel:!1,default:.6,miniVolume:.2}}}]),i}(l["b"]);function Te(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="-4 -6 40 40" fill="none">\n  <g clip-path="url(#clip0)">\n    <path transform="scale(1.5 1.5)" d="M11.6665 9.16663H4.1665C2.78579 9.16663 1.6665 10.2859 1.6665 11.6666V15.8333C1.6665 17.214 2.78579 18.3333 4.1665 18.3333H11.6665C13.0472 18.3333 14.1665 17.214 14.1665 15.8333V11.6666C14.1665 10.2859 13.0472 9.16663 11.6665 9.16663Z" fill="white"/>\n    <path transform="scale(1.5 1.5)" fill-rule="evenodd" clip-rule="evenodd" d="M3.88148 4.06298C3.75371 4.21005 3.67667 4.40231 3.67749 4.61242C3.67847 4.87253 3.79852 5.10435 3.98581 5.25646L6.99111 8.05895C7.32771 8.37283 7.85502 8.35443 8.16891 8.01782C8.48279 7.68122 8.46437 7.15391 8.12778 6.84003L6.62061 5.43457L9.8198 5.4224C9.82848 5.42239 9.8372 5.42221 9.84591 5.4219C10.9714 5.38233 12.0885 5.6285 13.0931 6.13744C14.0976 6.64635 14.957 7.40148 15.5908 8.33234C16.2246 9.2632 16.6122 10.3394 16.7177 11.4606C16.823 12.5819 16.6427 13.7115 16.1934 14.7442C16.0098 15.1661 16.203 15.6571 16.6251 15.8408C17.0471 16.0243 17.5381 15.8311 17.7216 15.4091C18.2833 14.1183 18.5087 12.7063 18.3771 11.3047C18.2453 9.90318 17.7607 8.55792 16.9684 7.39433C16.1761 6.23073 15.1021 5.28683 13.8463 4.65065C12.5946 4.01651 11.203 3.70872 9.80072 3.75583L6.43415 3.76862L7.96326 2.12885C8.27715 1.79225 8.25872 1.26494 7.92213 0.951061C7.58553 0.63718 7.05822 0.655585 6.74433 0.99219L3.90268 4.0395C3.89545 4.04724 3.88841 4.05509 3.88154 4.06303L3.88148 4.06298Z" fill="white"/>\n  </g>\n  <defs>\n    <clipPath id="clip0">\n      <rect width="40" height="40" fill="white"/>\n    </clipPath>\n  </defs>\n</svg>\n',"image/svg+xml").firstChild}var ke=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),r.rotateDeg=r.config.rotateDeg||0,r}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this.config.disable||(Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.rotate),this.onBtnClick=this.onBtnClick.bind(this),this.bind(".xgplayer-icon",["click","touchend"],this.onBtnClick),this.on(s["VIDEO_RESIZE"],(function(){e.rotateDeg&&a["b"].setTimeout(e,(function(){e.updateRotateDeg(e.rotateDeg,e.config.innerRotate)}),100)})),this.rotateDeg&&this.updateRotateDeg(this.rotateDeg,this.config.innerRotate))}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.unbind(".xgplayer-icon",["click","touchend"],this.onBtnClick)}},{key:"onBtnClick",value:function(e){e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"rotate"),this.rotate(this.config.clockwise,this.config.innerRotate,1)}},{key:"updateRotateDeg",value:function(e,t){var i=this.player;e||(e=0);var n=this.player,r=n.root,a=n.innerContainer,s=this.player.media,o=r.offsetWidth,l=a&&t?a.offsetHeight:r.offsetHeight,u="100%",c="100%",h=0,d=0;.75!==e&&.25!==e||(u="".concat(l,"px"),c="".concat(o,"px"),h=-(l-o)/2,d=-(o-l)/2);var f="translate(".concat(h,"px,").concat(d,"px) rotate(").concat(e,"turn)"),g={transformOrigin:"center center",transform:f,webKitTransform:f,height:c,width:u},v=t?s:r,p=t?i.getPlugin("poster"):null;Object.keys(g).map((function(e){v.style[e]=g[e],p&&p.root&&(p.root.style[e]=g[e])}))}},{key:"rotate",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0],t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=this.player;this.rotateDeg||(this.rotateDeg=0);var r=e?1:-1;this.rotateDeg=(this.rotateDeg+1+.25*r*i)%1,this.updateRotateDeg(this.rotateDeg,t),n.emit(s["ROTATE"],360*this.rotateDeg)}},{key:"registerIcons",value:function(){return{rotate:Te}}},{key:"render",value:function(){if(!this.config.disable)return'\n    <xg-icon class="xgplayer-rotate">\n      <div class="xgplayer-icon">\n      </div>\n      '.concat(S(this,"ROTATE_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"rotate"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:6,innerRotate:!0,clockwise:!1,rotateDeg:0,disable:!1}}}]),i}(ue);function Se(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}function _e(){return(new DOMParser).parseFromString('<svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M16.5 4.3H3.5C3.38954 4.3 3.3 4.38954 3.3 4.5V15.5C3.3 15.6105 3.38954 15.7 3.5 15.7H8.50005L8.50006 17.5H3.5C2.39543 17.5 1.5 16.6046 1.5 15.5V4.5C1.5 3.39543 2.39543 2.5 3.5 2.5H16.5C17.6046 2.5 18.5 3.39543 18.5 4.5V8.5H16.7V4.5C16.7 4.38954 16.6105 4.3 16.5 4.3ZM12 11.5C11.4477 11.5 11 11.9477 11 12.5L11 16.5C11 17.0523 11.4478 17.5 12 17.5H17.5C18.0523 17.5 18.5 17.0523 18.5 16.5L18.5 12.5C18.5 11.9477 18.0523 11.5 17.5 11.5H12Z"\n    fill="white" />\n  <path fill-rule="evenodd" clip-rule="evenodd"\n    d="M9.4998 7.7C9.77595 7.7 9.9998 7.47614 9.9998 7.2V6.5C9.9998 6.22386 9.77595 6 9.4998 6H5.5402L5.52754 6.00016H5.5C5.22386 6.00016 5 6.22401 5 6.50016V10.4598C5 10.7359 5.22386 10.9598 5.5 10.9598H6.2C6.47614 10.9598 6.7 10.7359 6.7 10.4598V8.83005L8.76983 10.9386C8.96327 11.1357 9.27984 11.1386 9.47691 10.9451L9.97645 10.4548C10.1735 10.2613 10.1764 9.94476 9.983 9.7477L7.97289 7.7H9.4998Z"\n    fill="white" />\n</svg>',"image/svg+xml").firstChild}var Le={PIP:"picture-in-picture",INLINE:"inline",FULLSCREEN:"fullscreen"},Ae=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"switchPIP",(function(t){if(!e.isPIPAvailable())return!1;t.stopPropagation&&t.stopPropagation(),e.isPip?(e.exitPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!0,to:!1}),e.setAttr("data-state","normal")):4===e.player.media.readyState&&(e.requestPIP(),e.emitUserAction(t,"change_pip",{props:"pip",from:!1,to:!0}),e.setAttr("data-state","pip"))})),e}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.pip&&(e.config.showIcon=e.player.config.pip)}},{key:"afterCreate",value:function(){var e=this;this.isPIPAvailable()&&(Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.pMode=Le.INLINE,this.initPipEvents(),this.config.showIcon&&this.initIcons(),this.once(s["COMPLETE"],(function(){e.config.showIcon&&(a["b"].removeClass(e.find(".xgplayer-icon"),"xg-icon-disable"),e.bind("click",e.switchPIP))})))}},{key:"registerIcons",value:function(){return{pipIcon:{icon:Se,class:"xg-get-pip"},pipIconExit:{icon:_e,class:"xg-exit-pip"}}}},{key:"initIcons",value:function(){var e=this.icons;this.appendChild(".xgplayer-icon",e.pipIcon),this.appendChild(".xgplayer-icon",e.pipIconExit)}},{key:"initPipEvents",value:function(){var e=this,t=this.player;this.leavePIPCallback=function(){var i=t.paused;a["b"].setTimeout(e,(function(){!i&&t.mediaPlay()}),0),!i&&t.mediaPlay(),e.setAttr("data-state","normal"),t.emit(s["PIP_CHANGE"],!1)},this.enterPIPCallback=function(i){t.emit(s["PIP_CHANGE"],!0),e.pipWindow=i.pictureInPictureWindow,e.setAttr("data-state","pip")},this.onWebkitpresentationmodechanged=function(i){var n=t.media.webkitPresentationMode;e.pMode===Le.FULLSCREEN&&n!==Le.FULLSCREEN&&t.onFullscreenChange(null,!1),e.pMode=n,n===Le.PIP?e.enterPIPCallback(i):n===Le.INLINE&&e.leavePIPCallback(i)},t.media&&(t.media.addEventListener("enterpictureinpicture",this.enterPIPCallback),t.media.addEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(t.media)&&t.media.addEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged))}},{key:"requestPIP",value:function(){var e=this.player,t=this.playerConfig;if(this.isPIPAvailable()&&!this.isPip)try{var n=t.poster;return n&&(e.media.poster="String"===a["b"].typeOf(n)?n:n.poster),i.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("picture-in-picture"):e.media.requestPictureInPicture(),!0}catch(r){return!1}}},{key:"exitPIP",value:function(){var e=this.player;try{return this.isPIPAvailable()&&this.isPip&&(i.checkWebkitSetPresentationMode(e.media)?e.media.webkitSetPresentationMode("inline"):document.exitPictureInPicture()),!0}catch(t){return!1}}},{key:"isPip",get:function(){var e=this.player;return document.pictureInPictureElement&&document.pictureInPictureElement===e.media||e.media.webkitPresentationMode===Le.PIP}},{key:"isPIPAvailable",value:function(){var e=this.player.media,t="Boolean"!==a["b"].typeOf(document.pictureInPictureEnabled)||document.pictureInPictureEnabled;return t&&("Boolean"===a["b"].typeOf(e.disablePictureInPicture)&&!e.disablePictureInPicture||e.webkitSupportsPresentationMode&&"Function"===a["b"].typeOf(e.webkitSetPresentationMode))}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this);var e=this.player;e.media.removeEventListener("enterpictureinpicture",this.enterPIPCallback),e.media.removeEventListener("leavepictureinpicture",this.leavePIPCallback),i.checkWebkitSetPresentationMode(e.media)&&e.media.removeEventListener("webkitpresentationmodechanged",this.onWebkitpresentationmodechanged),this.exitPIP(),this.unbind("click",this.btnClick)}},{key:"render",value:function(){if(this.config.showIcon&&this.isPIPAvailable())return'<xg-icon class="xgplayer-pip">\n      <div class="xgplayer-icon xg-icon-disable">\n      </div>\n      '.concat(S(this,"PIP",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"pip"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:6,showIcon:!1}}},{key:"checkWebkitSetPresentationMode",value:function(e){return"function"===typeof e.webkitSetPresentationMode}}]),i}(ue);function Ce(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24" height="40" viewBox="10 0 24 40">\n  <path transform="scale(0.038 0.028)" d="M800 380v768h-128v-352l-320 320v-704l320 320v-352z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Oe=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"playNext",(function(e){var t=Object(n["a"])(r),i=t.player;e.preventDefault(),e.stopPropagation(),r.idx+1<r.config.urlList.length?(r.idx++,r.nextHandler(r.config.urlList[r.idx],r.idx),i.emit(s["PLAYNEXT"],r.idx+1)):(r.nextHandler(),i.emit(s["PLAYNEXT"]))})),r.idx=-1,r}return Object(n["c"])(i,[{key:"afterCreate",value:function(){this.config.urlList&&0!==this.config.urlList.length&&(this.appendChild(".xgplayer-icon",this.icons.playNext),this.initEvents())}},{key:"registerIcons",value:function(){return{playNext:Ce}}},{key:"initEvents",value:function(){this.nextHandler=this.hook("nextClick",this.changeSrc);var e="mobile"===r["a"].device?"touchend":"click";this.bind(e,this.playNext),this.show()}},{key:"changeSrc",value:function(e){var t=this.player;e&&(t.pause(),t.currentTime=0,t.switchURL?t.switchURL(e):t.src=e,t.config.url=e,t.play())}},{key:"destroy",value:function(){this.unbind(["touchend","click"],this.playNext)}},{key:"render",value:function(){if(this.config.urlList&&0!==this.config.urlList.length)return'\n     <xg-icon class="xgplayer-playnext">\n      <div class="xgplayer-icon">\n      </div>\n      '.concat(S(this,"PLAYNEXT_TIPS",this.playerConfig.isHideTips),"\n     </xg-icon>\n    ")}}],[{key:"pluginName",get:function(){return"playNext"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_LEFT,index:1,url:null,urlList:[]}}}]),i}(l["b"]),Re=i("aeb1"),we=i.n(Re);function xe(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="24px" height="24px" viewBox="0 0 24 24">\n  <g id="Page-1" stroke="none" stroke-width="1" fill="none" fill-rule="evenodd">\n    <g transform="translate(-488.000000, -340.000000)" fill="#FFFFFF">\n      <g id="Group-2">\n        <g id="volme_big-copy" transform="translate(488.000000, 340.000000)">\n          <rect id="Rectangle-18" x="11" y="4" width="2" height="12" rx="1"></rect>\n          <rect id="Rectangle-2" x="3" y="18" width="18" height="2" rx="1"></rect>\n          <rect id="Rectangle-2" transform="translate(4.000000, 17.500000) rotate(90.000000) translate(-4.000000, -17.500000) " x="1.5" y="16.5" width="5" height="2" rx="1"></rect><rect id="Rectangle-2-Copy-3" transform="translate(20.000000, 17.500000) rotate(90.000000) translate(-20.000000, -17.500000) " x="17.5" y="16.5" width="5" height="2" rx="1"></rect>\n          <path d="M9.48791171,8.26502656 L9.48791171,14.2650266 C9.48791171,14.8173113 9.04019646,15.2650266 8.48791171,15.2650266 C7.93562696,15.2650266 7.48791171,14.8173113 7.48791171,14.2650266 L7.48791171,7.26502656 C7.48791171,6.71274181 7.93562696,6.26502656 8.48791171,6.26502656 L15.4879117,6.26502656 C16.0401965,6.26502656 16.4879117,6.71274181 16.4879117,7.26502656 C16.4879117,7.81731131 16.0401965,8.26502656 15.4879117,8.26502656 L9.48791171,8.26502656 Z" id="Combined-Shape" transform="translate(11.987912, 10.765027) scale(1, -1) rotate(45.000000) translate(-11.987912, -10.765027) "></path>\n        </g>\n      </g>\n    </g>\n  </g>\n</svg>\n',"image/svg+xml").firstChild}var Ie=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"download",(function(e){if(!r.isLock){r.emitUserAction(e,"download");var t=r.getAbsoluteURL(r.player.src);we()(t),r.isLock=!0,r.timer=window.setTimeout((function(){r.isLock=!1,window.clearTimeout(r.timer),r.timer=null}),300)}})),r.timer=null,r.isLock=!1,r}return Object(n["c"])(i,[{key:"afterCreate",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.config.disable||(this.appendChild(".xgplayer-icon",this.icons.download),this.bind(["click","touchend"],this.download))}},{key:"registerIcons",value:function(){return{download:xe}}},{key:"getAbsoluteURL",value:function(e){if(!e.match(/^https?:\/\//)){var t=document.createElement("div");t.innerHTML='<a href="'.concat(e,'">x</a>'),e=t.firstChild.href}return e}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.download),window.clearTimeout(this.timer),this.timer=null}},{key:"render",value:function(){if(!this.config.disable)return'<xg-icon class="xgplayer-download">\n   <div class="xgplayer-icon">\n   </div>\n   '.concat(S(this,"DOWNLOAD_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"download"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:3,disable:!0}}}]),i}(ue),De=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.screenShot&&(e.config.disable=!e.player.config.screenShot)}},{key:"afterCreate",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.appendChild(".xgplayer-icon",this.icons.screenshotIcon);var e=this.config;this.initSize=function(t){e.fitVideo&&(e.width=t.vWidth,e.height=t.vHeight)},this.once(s["VIDEO_RESIZE"],this.initSize)}},{key:"onPluginsReady",value:function(){this.show(),this.onClickBtn=this.onClickBtn.bind(this),this.bind(["click","touchend"],this.onClickBtn)}},{key:"saveScreenShot",value:function(e,t){var i=document.createElement("a");i.href=e,i.download=t;var n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!1,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(n)}},{key:"createCanvas",value:function(e,t){var i=document.createElement("canvas"),n=i.getContext("2d");this.canvasCtx=n,this.canvas=i,i.width=e||this.config.width,i.height=t||this.config.height,n.imageSmoothingEnabled=!0,n.imageSmoothingEnabled&&(n.imageSmoothingQuality="high")}},{key:"onClickBtn",value:function(e){var t=this;e.preventDefault(),e.stopPropagation(),this.emitUserAction(e,"shot"),this.shot().then((function(e){t.emit(s["SCREEN_SHOT"],e),t.saveScreenShot(e,t.config.name+t.config.format)}))}},{key:"shot",value:function(e,t){var i=this,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{quality:.92,type:"image/png"},r=this.config,a=this.player,s=n.quality||r.quality,o=n.type||r.type;return new Promise((function(n,l){var u,c=null;if(a.media.canvas)c=a.media.canvas;else{i.canvas?(i.canvas.width=e||r.width,i.canvas.height=t||r.height):i.createCanvas(e,t),c=i.canvas,u=i.canvasCtx;var h,d,f,g,v=a.media.videoWidth/a.media.videoHeight,p=c.width/c.height,m=0,y=0,b=a.media.videoWidth,E=a.media.videoHeight;v>p?(f=c.width,g=c.width/v,h=0,d=Math.round((c.height-g)/2)):v===p?(f=c.width,g=c.height,h=0,d=0):v<p&&(f=c.height*v,g=c.height,h=Math.round((c.width-f)/2),d=0),u.drawImage(a.media,m,y,b,E,h,d,f,g)}var T=c.toDataURL(o,s).replace(o,"image/octet-stream");T=T.replace(/^data:image\/[^;]+/,"data:application/octet-stream"),n(T)}))}},{key:"registerIcons",value:function(){return{screenshotIcon:null}}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.onClickBtn),this.off(s["VIDEO_RESIZE"],this.initSize)}},{key:"render",value:function(){if(!this.config.disable){var e=this.icons.screenshotIcon?"xgplayer-icon":"xgplayer-icon btn-text",t="SCREENSHOT";return'\n      <xg-icon class="xgplayer-shot">\n      <div class="'.concat(e,'">\n      ').concat(this.icons.screenshotIcon?"":'<span lang-key="'.concat(this.i18nKeys[t],'">').concat(this.i18n[t],"</span>"),"\n      </div>\n    </xg-icon>")}}}],[{key:"pluginName",get:function(){return"screenShot"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:5,quality:.92,type:"image/png",format:".png",width:600,height:337,fitVideo:!0,disable:!1,name:"screenshot"}}}]),i}(ue),Pe=function(){function e(t){Object(n["b"])(this,e),this.config=t.config,this.parent=t.root,this.root=a["b"].createDom("ul","",{},"xg-options-list ".concat(this.config.className)),t.root.appendChild(this.root),this.onItemClick=this.onItemClick.bind(this),this.renderItemList();var i="mobile"===r["a"].device?"touchend":"click";this._delegates=l["b"].delegate.call(this,this.root,"li",i,this.onItemClick)}return Object(n["c"])(e,[{key:"renderItemList",value:function(e){var t=this,i=this.config,n=this.root;e?i.data=e:e=i.data,i.style&&Object.keys(i.style).map((function(e){n.style[e]=i[e]})),e.length>0&&(this.attrKeys=Object.keys(e[0])),this.root.innerHTML="",e.map((function(e,i){var n=e.selected?"option-item selected":"option-item";e["data-index"]=i,t.root.appendChild(a["b"].createDom("li","<span>".concat(e.showText,"</span>"),e,n))}))}},{key:"onItemClick",value:function(e){e.delegateTarget||(e.delegateTarget=e.target);var t=e.delegateTarget;if(t&&a["b"].hasClass(t,"selected"))return!1;var i="function"===typeof this.config.onItemClick?this.config.onItemClick:null,n=this.root.querySelector(".selected");a["b"].addClass(t,"selected"),n&&a["b"].removeClass(n,"selected"),i(e,{from:n?this.getAttrObj(n,this.attrKeys):null,to:this.getAttrObj(t,this.attrKeys)})}},{key:"getAttrObj",value:function(e,t){if(!e||!t)return{};var i={};t.map((function(t){i[t]=e.getAttribute(t)}));var n=e.getAttribute("data-index");return n&&(i.index=Number(n)),i}},{key:"show",value:function(){a["b"].removeClass(this.root,"hide"),a["b"].addClass(this.root,"active")}},{key:"hide",value:function(){a["b"].removeClass(this.root,"active"),a["b"].addClass(this.root,"hide")}},{key:"setStyle",value:function(e){var t=this;Object.keys(e).forEach((function(i){t.root.style[i]=e[i]}))}},{key:"destroy",value:function(){this._delegates&&(this._delegates.map((function(e){e.destroy&&e.destroy()})),this._delegates=null),this.root.innerHTML=null,this.parent.removeChild(this.root),this.root=null}}]),e}(),Ne={SIDE:"side",MIDDLE:"middle"},Me={CLICK:"click",HOVER:"hover"};function Fe(e,t){return e===Ne.SIDE?t===l["a"].CONTROLS_LEFT?"xg-side-list xg-left-side":"xg-side-list xg-right-side":""}var je="mobile"===r["a"].device,Ue=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"onEnter",(function(e){e.preventDefault(),e.stopPropagation(),r.emit("icon_mouseenter",{pluginName:r.pluginName}),r.switchActiveState(e)})),Object(n["e"])(Object(n["a"])(r),"switchActiveState",(function(e){e.preventDefault(),e.stopPropagation();var t=r.config.toggleMode;t===Me.CLICK?r.toggle(!r.isActive):r.toggle(!0)})),Object(n["e"])(Object(n["a"])(r),"onLeave",(function(e){e.preventDefault(),e.stopPropagation(),r.emit("icon_mouseleave",{pluginName:r.pluginName}),r.config.listType!==Ne.SIDE&&r.isActive&&r.toggle(!1)})),Object(n["e"])(Object(n["a"])(r),"onListEnter",(function(e){r.enterType=2})),Object(n["e"])(Object(n["a"])(r),"onListLeave",(function(e){r.enterType=0,r.isActive&&r.toggle(!1)})),r.isIcons=!1,r.isActive=!1,r.curValue=null,r.curIndex=0,r}return Object(n["c"])(i,[{key:"updateLang",value:function(e){this.renderItemList(this.config.list,this.curIndex)}},{key:"afterCreate",value:function(){var e=this,t=this.config;this.initIcons(),je&&t.listType!==Ne.MIDDLE&&(t.listType=Ne.SIDE),t.hidePortrait&&a["b"].addClass(this.root,"portrait"),this.once(s["CANPLAY"],(function(){t.list&&t.list.length>0&&(e.renderItemList(t.list),e.show())})),je&&this.on(s["PLAYER_FOCUS"],(function(){e.isActive&&(e.optionsList&&e.optionsList.hide(),e.isActive=!1)})),je?(t.toggleMode=Me.CLICK,this.activeEvent="touchend"):this.activeEvent=t.toggleMode===Me.CLICK?"click":"mouseenter",t.toggleMode===Me.CLICK?this.bind(this.activeEvent,this.switchActiveState):(this.bind(this.activeEvent,this.onEnter),this.bind("mouseleave",this.onLeave)),this.isIcons&&this.bind("click",this.onIconClick)}},{key:"initIcons",value:function(){var e=this,t=this.icons,i=Object.keys(t),n=!1;i.length>0&&(i.forEach((function(i){e.appendChild(".xgplayer-icon",t[i]),!n&&(n=t[i])})),this.isIcons=n),n||(this.appendChild(".xgplayer-icon",a["b"].createDom("span","",{},"icon-text")),a["b"].addClass(this.find(".xgplayer-icon"),"btn-text"))}},{key:"show",value:function(){!this.config.list||this.config.list.length<2||a["b"].addClass(this.root,"show")}},{key:"hide",value:function(){a["b"].removeClass(this.root,"show")}},{key:"getTextByLang",value:function(e,t,i){if(void 0===e)return"";var r=this.config.list;!i&&(i=this.player.lang),t=!t||a["b"].isUndefined(e[t])?"text":t,"number"===typeof e&&(e=r[e]);try{return"object"===Object(n["l"])(e[t])?e[t][i]||e[t].en:e[t]}catch(s){return""}}},{key:"toggle",value:function(e){if(e!==this.isActive){var t=this.player.controls,i=this.config.listType;e?(i===Ne.SIDE?t.blur():t.focus(),this.optionsList&&this.optionsList.show()):(i===Ne.SIDE?t.focus():t.focusAwhile(),this.optionsList&&this.optionsList.hide()),this.isActive=e}}},{key:"onItemClick",value:function(e,t){e.preventDefault(),e.stopPropagation();var i=this.config,n=i.listType,r=i.list;this.curIndex=t.to.index,this.curItem=r[this.curIndex],this.changeCurrentText();var a=this.config.isItemClickHide;(a||je||n===Ne.SIDE)&&this.toggle(!1)}},{key:"onIconClick",value:function(e){}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,t=this.curIndex<e.length?this.curIndex:0,i=e[t];i&&(this.find(".icon-text").innerHTML=this.getTextByLang(i,"iconText"))}}},{key:"renderItemList",value:function(e,t){var i=this,n=this.config,r=this.optionsList,a=this.player;if("number"===typeof t&&(this.curIndex=t,this.curItem=n.list[t]),r)return r.renderItemList(e),void this.changeCurrentText();var s={config:{data:e||[],className:Fe(n.listType,n.position),onItemClick:function(e,t){i.onItemClick(e,t)}},root:n.listType===Ne.SIDE?a.innerContainer||a.root:this.root};this.config.isShowIcon&&(this.optionsList=new Pe(s),this.changeCurrentText(),this.show());var o=this.player.root.getBoundingClientRect(),l=o.height,u=n.listType===Ne.MIDDLE?l-50:l;this.optionsList&&this.optionsList.setStyle({maxHeight:"".concat(u,"px")})}},{key:"destroy",value:function(){var e=this.config;e.toggleMode===Me.CLICK?this.unbind(this.activeEvent,this.switchActiveState):(this.unbind(this.activeEvent,this.onEnter),this.unbind("mouseleave",this.onLeave)),this.isIcons&&this.unbind("click",this.onIconClick),this.optionsList&&(this.optionsList.destroy(),this.optionsList=null)}},{key:"render",value:function(){if(this.config.isShowIcon)return'<xg-icon class="xg-options-icon '.concat(this.config.className||"",'">\n    <div class="xgplayer-icon">\n    </div>\n   </xg-icon>')}}],[{key:"pluginName",get:function(){return"optionsIcon"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:100,list:[],listType:"middle",listStyle:{},hidePortrait:!0,isShowIcon:!1,isItemClickHide:!0,toggleMode:Me.HOVER}}}]),i}(l["b"]),Be=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),r.curTime=0,r.isPaused=!0,r}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){var t=e.config.list;Array.isArray(t)&&t.length>0&&(e.config.list=t.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})))}},{key:"afterCreate",value:function(){var e=this;Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.on("resourceReady",(function(t){e.changeDefinitionList(t)})),this.on(s["DEFINITION_CHANGE"],(function(t){e.renderItemList(e.config.list,t.to)})),this.player.definitionList.length<2&&this.hide()}},{key:"show",value:function(){!this.config.list||this.config.list.length<2||a["b"].addClass(this.root,"show")}},{key:"initDefinition",value:function(){var e=this.config,t=e.list,i=e.defaultDefinition;if(t.length>0){var n=null;t.map((function(e){e.definition===i&&(n=e)})),n||(n=t[0]),this.changeDefinition(n)}}},{key:"renderItemList",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.config.list||[],r=arguments.length>1?arguments[1]:void 0,a=r&&r.definition?r.definition:this.config.defaultDefinition;r&&t.forEach((function(e){e.selected=!1}));var s=0,o=t.map((function(t,i){var r=Object(n["i"])(Object(n["i"])({},t),{},{showText:e.getTextByLang(t)||t.definition,selected:!1});return(t.selected||t.definition&&t.definition==a)&&(r.selected=!0,s=i),r}));Object(n["f"])(Object(n["g"])(i.prototype),"renderItemList",this).call(this,o,s)}},{key:"changeDefinitionList",value:function(e){Array.isArray(e)&&(this.config.list=e.map((function(e){return!e.text&&e.name&&(e.text=e.name),e.text||(e.text=e.definition),e})),this.renderItemList(),this.config.list.length<2?this.hide():this.show())}},{key:"changeDefinition",value:function(e,t){this.player.changeDefinition(e,t)}},{key:"onItemClick",value:function(e,t){var r=this.player.definitionList;Object(n["f"])(Object(n["g"])(i.prototype),"onItemClick",this).apply(this,arguments),this.emitUserAction(e,"change_definition",{from:t.from,to:t.to});for(var a=0;a<r.length;a++)t.to&&r[a].definition===t.to.definition&&(t.to.url=r[a].url),t.from&&r[a].definition===t.from.definition&&(t.from.url=r[a].url);this.player.changeDefinition(t.to,t.from)}}],[{key:"pluginName",get:function(){return"definition"}},{key:"defaultConfig",get:function(){return Object(n["i"])(Object(n["i"])({},Ue.defaultConfig),{},{position:l["a"].CONTROLS_RIGHT,index:3,list:[],defaultDefinition:"",disable:!1,hidePortrait:!1,className:"xgplayer-definition",isShowIcon:!0})}}]),i}(Ue),Ge=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),r.curRate=1,r}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){var t=e.player.config.playbackRate,i=t?Array.isArray(t)?t:e.config.list:[];Array.isArray(i)&&(e.config.list=i.map((function(e){return"number"===typeof e?e={rate:e,text:"".concat(e,"x")}:!e.text&&e.rate&&(e.text="".concat(e.rate,"x")),e})))}},{key:"afterCreate",value:function(){var e=this;Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.on(s["RATE_CHANGE"],(function(){e.curValue!==e.player.playbackRate&&e.renderItemList()})),this.renderItemList()}},{key:"show",value:function(){this.config.list&&0!==this.config.list.length&&Object(n["f"])(Object(n["g"])(i.prototype),"show",this).call(this)}},{key:"onItemClick",value:function(e,t){Object(n["f"])(Object(n["g"])(i.prototype),"onItemClick",this).apply(this,arguments);var r=e.delegateTarget,a=Number(r.getAttribute("rate"));if(!a||a===this.curValue)return!1;var s={playbackRate:{from:this.player.playbackRate,to:a}};this.emitUserAction(e,"change_rate",{props:s}),this.curValue=a,this.player.playbackRate=a}},{key:"renderItemList",value:function(){var e=this,t=this.player.playbackRate||1;this.curValue=t;var r=-1,a=this.config.list.map((function(i,n){var a={rate:i.rate};return a.rate===t&&(a.selected=!0,r=n),a.showText=e.getTextByLang(i),a}));Object(n["f"])(Object(n["g"])(i.prototype),"renderItemList",this).call(this,a,r)}},{key:"changeCurrentText",value:function(){if(!this.isIcons){var e=this.config.list,t=this.curIndex<e.length?this.curIndex:0,i=e[t],n="";n=!i||this.curIndex<0?"".concat(this.player.playbackRate,"x"):this.getTextByLang(i,"iconText"),this.find(".icon-text").innerHTML=n}}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this)}}],[{key:"pluginName",get:function(){return"playbackRate"}},{key:"defaultConfig",get:function(){return Object(n["i"])(Object(n["i"])({},Ue.defaultConfig),{},{position:l["a"].CONTROLS_RIGHT,index:4,list:[2,1.5,1,.75,.5],className:"xgplayer-playbackrate",isShowIcon:!0,hidePortrait:!1})}}]),i}(Ue);function He(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" class=\'path_full\' d="M9,10v1a.9.9,0,0,1-1,1,.9.9,0,0,1-1-1V9A.9.9,0,0,1,8,8h2a.9.9,0,0,1,1,1,.9.9,0,0,1-1,1Zm6,4V13a1,1,0,0,1,2,0v2a.9.9,0,0,1-1,1H14a1,1,0,0,1,0-2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}function Ve(){return(new DOMParser).parseFromString('<svg xmlns="http://www.w3.org/2000/svg" width="31" height="40" viewBox="0 -5 31 40">\n  <path fill="#fff" transform="scale(1.3, 1.3)" d="M9,10V9a.9.9,0,0,1,1-1,.9.9,0,0,1,1,1v2a.9.9,0,0,1-1,1H8a.9.9,0,0,1-1-1,.9.9,0,0,1,1-1Zm6,4v1a1,1,0,0,1-2,0V13a.9.9,0,0,1,1-1h2a1,1,0,0,1,0,2Zm3-7H6V17H18Zm2,0V17a2,2,0,0,1-2,2H6a2,2,0,0,1-2-2V7A2,2,0,0,1,6,5H18A2,2,0,0,1,20,7Z"></path>\n</svg>\n',"image/svg+xml").firstChild}var Ke=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){"boolean"===typeof e.player.config.cssFullscreen&&(e.config.disable=!e.player.config.cssFullscreen)}},{key:"afterCreate",value:function(){var e=this;Object(n["f"])(Object(n["g"])(i.prototype),"afterCreate",this).call(this),this.config.disable||(this.config.target&&(this.playerConfig.fullscreenTarget=this.config.target),this.initIcons(),this.on(s["CSS_FULLSCREEN_CHANGE"],(function(t){e.animate(t)})),this.btnClick=this.btnClick.bind(this),this.handleCssFullscreen=this.hook("cssFullscreen_change",this.btnClick,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.bind(["click","touchend"],this.handleCssFullscreen))}},{key:"initIcons",value:function(){var e=this.icons,t=this.find(".xgplayer-icon");t.appendChild(e.cssFullscreen),t.appendChild(e.exitCssFullscreen)}},{key:"btnClick",value:function(e){e.preventDefault(),e.stopPropagation();var t=this.player.isCssfullScreen;this.emitUserAction(e,"switch_cssfullscreen",{cssfullscreen:t}),t?this.player.exitCssFullscreen():this.player.getCssFullscreen()}},{key:"animate",value:function(e){this.root&&(e?this.setAttr("data-state","full"):this.setAttr("data-state","normal"),this.switchTips(e))}},{key:"switchTips",value:function(e){var t=this.i18nKeys,i=this.find(".xg-tips");i&&this.changeLangTextKey(i,e?t.EXITCSSFULLSCREEN_TIPS:t.CSSFULLSCREEN_TIPS)}},{key:"registerIcons",value:function(){return{cssFullscreen:{icon:He,class:"xg-get-cssfull"},exitCssFullscreen:{icon:Ve,class:"xg-exit-cssfull"}}}},{key:"destroy",value:function(){Object(n["f"])(Object(n["g"])(i.prototype),"destroy",this).call(this),this.unbind(["click","touchend"],this.btnClick)}},{key:"render",value:function(){if(!this.config.disable)return"<xg-icon class='xgplayer-cssfullscreen'>\n    <div class=\"xgplayer-icon\">\n    </div>\n    ".concat(S(this,"CSSFULLSCREEN_TIPS",this.playerConfig.isHideTips),"\n    </xg-icon>")}}],[{key:"pluginName",get:function(){return"cssFullscreen"}},{key:"defaultConfig",get:function(){return{position:l["a"].CONTROLS_RIGHT,index:1,disable:!1,target:null}}}]),i}(ue),We=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this.clickHandler=this.hook("errorRetry",this.errorRetry,{pre:function(e){e.preventDefault(),e.stopPropagation()}}),this.onError=this.hook("showError",this.handleError),this.bind(".xgplayer-error-refresh","click",this.clickHandler),this.on(s["ERROR"],(function(t){e.onError(t)}))}},{key:"errorRetry",value:function(e){this.emitUserAction(e,"error_retry",{}),this.player.retry()}},{key:"handleError",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=this.player,i=e.errorType,n=t.errorNote?this.i18n[t.errorNote]:"";if(!n)switch(i){case"decoder":n=this.i18n.MEDIA_ERR_DECODE;break;case"network":n=this.i18n.MEDIA_ERR_NETWORK;break;default:n=this.i18n.MEDIA_ERR_SRC_NOT_SUPPORTED}this.find(".xgplayer-error-text").innerHTML=n,this.find(".xgplayer-error-tips").innerHTML="".concat(this.i18n.REFRESH_TIPS,'<span class="xgplayer-error-refresh">').concat(this.i18n.REFRESH,"</span>")}},{key:"destroy",value:function(){this.unbind(".xgplayer-error-refresh","click",this.clickHandler)}},{key:"render",value:function(){return'<xg-error class="xgplayer-error">\n      <div class="xgplayer-errornote">\n       <span class="xgplayer-error-text"></span>\n       <span class="xgplayer-error-tips"><em class="xgplayer-error-refresh"></em></span>\n      </div>\n    </xg-error>'}}],[{key:"pluginName",get:function(){return"error"}}]),i}(l["b"]),Ye=i("b39b"),ze=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this.intervalId=0,this.customConfig=null,this.bind(".highlight",["click","touchend"],(function(t){(e.config.onClick||e.customOnClick)&&(t.preventDefault(),t.stopPropagation(),e.customOnClick?e.customOnClick(t):e.config.onClick(t))})),this.player.showPrompt=function(){e.show.apply(e,arguments)},this.player.hidePrompt=function(){e.hide()}}},{key:"setStyle",value:function(e){var t=this;Object.keys(e).map((function(i){t.root.style[i]=e[i]}))}},{key:"show",value:function(e){var t=this,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(){};if(e){this.customOnClick=n;var r=this.config.interval;this.intervalId&&(clearTimeout(this.intervalId),this.intervalId=null),a["b"].addClass(this.root,"show"),"arrow"===i.mode&&a["b"].addClass(this.root,"arrow"),this.find(".xgplayer-prompt-detail").innerHTML="string"===typeof e?e:"".concat(e.text||"")+"".concat(e.highlight?'<i class="highlight">'.concat(e.highlight,"</i>"):""),i.style&&this.setStyle(i.style);var s="boolean"===typeof i.autoHide?i.autoHide:this.config.autoHide;if(s){var o=i.interval||r;this.intervalId=setTimeout((function(){t.hide()}),o)}}}},{key:"hide",value:function(){a["b"].removeClass(this.root,"show"),a["b"].removeClass(this.root,"arrow"),this.root.removeAttribute("style"),this.customOnClick=null}},{key:"render",value:function(){return'<xg-prompt class="xgplayer-prompt '.concat(Ye["a"].CONTROLS_FOLLOW,'">\n    <span class="xgplayer-prompt-detail"></span>\n    </xg-prompt>')}}],[{key:"pluginName",get:function(){return"prompt"}},{key:"defaultConfig",get:function(){return{interval:3e3,style:{},mode:"arrow",autoHide:!0,detail:{text:"",highlight:""},onClick:function(){}}}}]),i}(l["b"]),Xe={time:0,text:"",id:1,duration:1,color:"#fff",style:{},width:6,height:6};function qe(e){Object.keys(Xe).map((function(t){void 0===e[t]&&(e[t]=Xe[t])}))}var Ze={_updateDotDom:function(e,t){if(t){var i=this.calcuPosition(e.time,e.duration),n=e.style||{};n.left="".concat(i.left,"%"),n.width="".concat(i.width,"%"),t.setAttribute("data-text",e.text),t.setAttribute("data-time",e.time),i.isMini?a["b"].addClass(t,"mini"):a["b"].removeClass(t,"mini"),Object.keys(n).map((function(e){t.style[e]=n[e]}))}},initDots:function(){var e=this;this._ispots.map((function(t){e.createDot(t,!1)})),this.ispotsInit=!0},createDot:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],i=this.player.plugins.progress;if(i&&(t&&(qe(e),this._ispots.push(e)),this.ispotsInit||!t)){var n=this.calcuPosition(e.time,e.duration),r=e.style||{};r.left="".concat(n.left,"%"),r.width="".concat(n.width,"%");var s="xgspot_".concat(e.id," xgplayer-spot");n.isMini&&(s+=" mini");var o=a["b"].createDom("xg-spot",e.template||"",{"data-text":e.text,"data-time":e.time,"data-id":e.id},s);Object.keys(r).map((function(e){o.style[e]=r[e]})),i.outer&&i.outer.appendChild(o)}},findDot:function(e){if(this.player.plugins.progress){var t=this._ispots.filter((function(t,i){return t.id===e}));return t.length>0?t[0]:null}},updateDot:function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],i=this.player.plugins.progress;if(i){var n=this.findDot(e.id);if(n&&Object.keys(e).map((function(t){n[t]=e[t]})),this.ispotsInit){var r=i.find('xg-spot[data-id="'.concat(e.id,'"]'));r&&(this._updateDotDom(e,r),t&&this.showDot(e.id))}}},deleteDot:function(e){var t=this._ispots,i=this.player.plugins.progress;if(i){for(var n=[],r=0;r<t.length;r++)t[r].id===e&&n.push(r);for(var a=n.length,s=a-1;s>=0;s--)if(t.splice(n[s],1),this.ispotsInit){var o=i.find('xg-spot[data-id="'.concat(e,'"]'));o&&o.parentElement.removeChild(o)}}},deleteAllDots:function(){var e=this.player.plugins.progress;if(e)if(this.ispotsInit){for(var t=e.root.getElementsByTagName("xg-spot"),i=t.length-1;i>=0;i--)e.outer.removeChild(t[i]);this._ispots=[]}else this._ispots=[]},updateAllDots:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=this.player.plugins.progress;if(i)if(this.ispotsInit){this._ispots=[];var n=i.root.getElementsByTagName("xg-spot"),r=n.length;if(r>t.length)for(var a=r-1;a>t.length-1;a--)i.outer.removeChild(n[a]);t.forEach((function(t,i){i<r?(n[i].setAttribute("data-id","".concat(t.id)),e._ispots.push(t),e.updateDot(t)):e.createDot(t)}))}else this._ispots=t},updateDuration:function(){var e=this,t=this.player.plugins.progress;if(t){var i=this._ispots;i.forEach((function(i){var n=t.find('xg-spot[data-id="'.concat(i.id,'"]'));e._updateDotDom(i,n)}))}},getAllDotsDom:function(){var e=this.player.plugins.progress;if(!e)return[];var t=e.root.getElementsByTagName("xg-spot");return t},getDotDom:function(e){var t=this.player.plugins.progress;if(t)return t.find('xg-spot[data-id="'.concat(e,'"]'))}};function Qe(e){var t=e.config,i=e.player;Object.keys(Ze).map((function(t){e[t]=Ze[t].bind(e)}));var n=i.config.progressDot||t.ispots||[];e._ispots=n.map((function(e){return qe(e),e})),e.ispotsInit=!1,e.on(s["DURATION_CHANGE"],(function(){e.ispotsInit?e.updateDuration():e.initDots()}))}var Je={dragmove:"onProgressMove",dragstart:"onProgressDragStart",dragend:"onProgressDragEnd",click:"onProgressClick",mouseover:"onProgressMouseOver",mouseenter:"onProgressMove"},$e=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),Object(n["e"])(Object(n["a"])(r),"onMousemove",(function(e){r.config.disable||(a["b"].hasClass(e.target,"xg-spot-content")&&r.config.isHideThumbnailHover?r.player.plugins.progress.onMouseLeave(e):(r._state.f||a["b"].hasClass(e.target,"xg-spot-content"))&&(a["b"].event(e),e.stopPropagation()))})),Object(n["e"])(Object(n["a"])(r),"onMousedown",(function(e){r.config.disable||(r._state.f||a["b"].hasClass(e.target,"xg-spot-content"))&&(a["b"].event(e),e.stopPropagation())})),Object(n["e"])(Object(n["a"])(r),"onMouseup",(function(e){if(r.isDrag){var t=r.player.plugins.progress;t&&t.pos&&(t.onMouseUp(e),!t.pos.isEnter&&t.onMouseLeave(e))}})),Object(n["e"])(Object(n["a"])(r),"onDotMouseLeave",(function(e){if(!r.config.disable){r._curDot.removeEventListener("mouseleave",r.onDotMouseLeave),r.blurDot(e.target),r._curDot=null;var t=r.player.plugins.progress;t&&t.enableBlur(),r.show()}})),Object(n["e"])(Object(n["a"])(r),"onProgressMouseOver",(function(e,t){if(!r.config.disable&&a["b"].hasClass(t.target,"xgplayer-spot")&&!r._curDot){r._curDot=t.target,r.focusDot(t.target),r._curDot.children.length>0&&r.hide();var i=r.player.plugins.progress;i&&i.disableBlur(),r._curDot.addEventListener("mouseleave",r.onDotMouseLeave)}})),r._ispots=[],r.videoPreview=null,r.videothumbnail=null,r.thumbnail=null,r.timeStr="",r._state={now:0,f:!1},r}return Object(n["c"])(i,[{key:"beforeCreate",value:function(e){var t=e.player.plugins.progress;t&&(e.root=t.root)}},{key:"afterCreate",value:function(){var e=this;this._curDot=null,this.handlerSpotClick=this.hook("spotClick",(function(t,i){i.currentTime&&e.player.seek(i.currentTime)})),this.transformTimeHook=this.hook("transformTime",(function(t){e.setTimeContent(a["b"].format(t))})),Qe(this),this.on(s["DURATION_CHANGE"],(function(){e.show()})),this.config.disable&&this.disable(),this.extTextRoot=this.find(".xg-spot-ext-text")}},{key:"setConfig",value:function(e){var t=this;e&&Object.keys(e).map((function(i){t.config[i]=e[i]}))}},{key:"onPluginsReady",value:function(){var e=this.player;e.plugins.progress&&(this.previewLine=this.find(".xg-spot-line"),this.timePoint=this.find(".xgplayer-progress-point"),this.timeText=this.find(".xg-spot-time"),this.tipText=this.find(".spot-inner-text"),this._hasThumnail=!1,this.registerThumbnail(),this.bindEvents())}},{key:"bindEvents",value:function(){var e=this,t=this.player.plugins.progress;if(t&&(Object.keys(Je).map((function(i){e[Je[i]]=e[Je[i]].bind(e),t.addCallBack(i,e[Je[i]])})),"mobile"!==r["a"].device)){this.bind(".xg-spot-info","mousemove",this.onMousemove),this.bind(".xg-spot-info","mousedown",this.onMousedown),this.bind(".xg-spot-info","mouseup",this.onMouseup);var i=this.hook("previewClick",(function(){}));this.handlerPreviewClick=function(t){t.stopPropagation(),i(parseInt(1e3*e._state.now,10)/1e3,t)},this.bind(".xg-spot-content","mouseup",this.handlerPreviewClick)}}},{key:"onProgressMove",value:function(e,t){!this.config.disable&&this.player.duration&&this.updatePosition(e.offset,e.width,e.currentTime,e.e)}},{key:"onProgressDragStart",value:function(e){!this.config.disable&&this.player.duration&&(this.isDrag=!0,this.videoPreview&&a["b"].addClass(this.videoPreview,"show"))}},{key:"onProgressDragEnd",value:function(e){!this.config.disable&&this.player.duration&&(this.isDrag=!1,this.videoPreview&&a["b"].removeClass(this.videoPreview,"show"))}},{key:"onProgressClick",value:function(e,t){this.config.disable||a["b"].hasClass(t.target,"xgplayer-spot")&&(t.stopPropagation(),t.preventDefault(),["time","id","text"].map((function(i){e[i]=t.target.getAttribute("data-".concat(i))})),e.time&&(e.time=Number(e.time)),this.handlerSpotClick(t,e))}},{key:"updateLinePos",value:function(e,t){var i=this.root,n=this.previewLine,r=this.player,a=this.config,s=r.controls.mode,o="flex"===s,l=i.getBoundingClientRect().width;if(l){l=this._hasThumnail&&l<a.width?a.width:l;var u,c=e-l/2;c<0&&!o?(c=0,u=e-l/2):c>t-l&&!o?(u=c-(t-l),c=t-l):u=0,void 0!==u&&(n.style.transform="translateX(".concat(u.toFixed(2),"px)")),i.style.transform="translateX(".concat(c.toFixed(2),"px) translateZ(0)")}}},{key:"updateTimeText",value:function(e){var t=this.timeText,i=this.timePoint;t.innerHTML=e,!this.thumbnail&&(i.innerHTML=e)}},{key:"updatePosition",value:function(e,t,i,n){var r=this.root,s=this.config,o=this._state;if(r){o.now=i,this.transformTimeHook(i);var l=this.timeStr;n&&n.target&&a["b"].hasClass(n.target,"xgplayer-spot")?(this.showTips(n.target.getAttribute("data-text"),!1,l),this.focusDot(n.target),o.f=!0,s.isFocusDots&&o.f&&(o.now=parseInt(n.target.getAttribute("data-time"),10))):s.defaultText?(o.f=!1,this.showTips(s.defaultText,!0,l)):(o.f=!1,this.hideTips("")),this.updateTimeText(l),this.updateThumbnails(o.now),this.updateLinePos(e,t)}}},{key:"setTimeContent",value:function(e){this.timeStr=e}},{key:"updateThumbnails",value:function(e){var t=this.player,i=this.videoPreview,n=this.config,r=t.plugins.thumbnail;if(r&&r.usable){this.thumbnail&&r.update(this.thumbnail,e,n.width,n.height);var a=i&&i.getBoundingClientRect();this.videothumbnail&&r.update(this.videothumbnail,e,a.width,a.height)}}},{key:"registerThumbnail",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("mobile"!==r["a"].device){var t=this.player,i=this.config,n=t.getPlugin("thumbnail");if(n&&n.setConfig(e),n&&n.usable&&i.isShowThumbnail){a["b"].removeClass(this.root,"short-line no-thumbnail"),"short"===i.mode&&a["b"].addClass(this.root,"short-line"),this._hasThumnail=!0;var s=this.find(".xg-spot-thumbnail");this.thumbnail=n.createThumbnail(s,"progress-thumbnail"),i.isShowCoverPreview&&(this.videoPreview=a["b"].createDom("xg-video-preview","",{},"xgvideo-preview"),t.root.appendChild(this.videoPreview),this.videothumbnail=n.createThumbnail(this.videoPreview,"xgvideo-thumbnail")),this.updateThumbnails(0)}else a["b"].addClass(this.root,"short-line no-thumbnail")}}},{key:"calcuPosition",value:function(e,t){var i=this.player.plugins.progress,n=this.player,r=i.root.getBoundingClientRect().width,a=n.duration/r*6;return e+t>n.duration&&(t=n.duration-e),n.duration,n.duration,{left:e/n.duration*100,width:t/n.duration*100,isMini:t<a}}},{key:"showDot",value:function(e){var t=this.findDot(e);if(t){var i=this.root.getBoundingClientRect(),n=i.width,r=t.time/this.player.duration*n;this.updatePosition(r,n,t.time)}}},{key:"focusDot",value:function(e,t){e&&(t||(t=e.getAttribute("data-id")),a["b"].addClass(e,"active"),this._activeDotId=t)}},{key:"blurDot",value:function(e){if(!e){var t=this._activeDotId;e=this.getDotDom(t)}e&&(a["b"].removeClass(e,"active"),this._activeDotId=null)}},{key:"showTips",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"";a["b"].addClass(this.root,"no-timepoint"),e&&(a["b"].addClass(this.find(".xg-spot-content"),"show-text"),t&&"production"===this.config.mode?(a["b"].addClass(this.root,"product"),this.tipText.textContent=e):(a["b"].removeClass(this.root,"product"),this.tipText.textContent=this._hasThumnail?e:"".concat(i," ").concat(e)))}},{key:"hideTips",value:function(){a["b"].removeClass(this.root,"no-timepoint"),this.tipText.textContent="",a["b"].removeClass(this.find(".xg-spot-content"),"show-text"),a["b"].removeClass(this.root,"product")}},{key:"hide",value:function(){a["b"].addClass(this.root,"hide")}},{key:"show",value:function(){a["b"].removeClass(this.root,"hide")}},{key:"enable",value:function(){var e=this.config,t=this.playerConfig;this.config.disable=!1,this.show(),!this.thumbnail&&e.isShowThumbnail&&this.registerThumbnail(t.thumbnail||{})}},{key:"disable",value:function(){this.config.disable=!0,this.hide()}},{key:"destroy",value:function(){var e=this,t=this.player.plugins.progress;t&&Object.keys(Je).map((function(i){t.removeCallBack(i,e[Je[i]])})),this.videothumbnail=null,this.thumbnail=null,this.videoPreview&&this.player.root.removeChild(this.videoPreview),this.unbind(".xg-spot-info","mousemove",this.onMousemove),this.unbind(".xg-spot-info","mousedown",this.onMousedown),this.unbind(".xg-spot-info","mouseup",this.onMouseup),this.unbind(".xg-spot-content","mouseup",this.handlerPreviewClick)}},{key:"render",value:function(){return"mobile"===r["a"].device||"mobile"===this.playerConfig.isMobileSimulateMode?"":'<div class="xg-spot-info hide '.concat("short"===this.config.mode?"short-line":"",'">\n      <div class="xg-spot-content">\n        <div class="xg-spot-thumbnail">\n          <span class="xg-spot-time"></span>\n        </div>\n        <div class="xg-spot-text"><span class="spot-inner-text"></span></div>\n      </div>\n      <div class="xgplayer-progress-point">00:00</div>\n      <div class="xg-spot-ext-text"></div>\n      <div class="xg-spot-line"></div>\n    </div>')}}],[{key:"pluginName",get:function(){return"progresspreview"}},{key:"defaultConfig",get:function(){return{index:1,miniWidth:6,ispots:[],defaultText:"",isFocusDots:!0,isHideThumbnailHover:!0,isShowThumbnail:!0,isShowCoverPreview:!1,mode:"",disable:!1,width:160,height:90}}}]),i}(l["b"]),et=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(e){var r;return Object(n["b"])(this,i),r=t.call(this,e),r.ratio=1,r.interval=null,r._preloadMark={},r}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this.usable&&this.initThumbnail(),this.on([s["DURATION_CHANGE"]],(function(){var t=e.config,i=t.pic_num,n=t.interval;e.usable&&(e.interval=n>0?n:Math.round(1e3*e.player.duration/i)/1e3)}))}},{key:"setConfig",value:function(e){var t=this;if(e){var i=Object.keys(e);i.length<1||(i.forEach((function(i){t.config[i]=e[i]})),this.usable&&this.initThumbnail())}}},{key:"usable",get:function(){var e=this.config,t=e.urls,i=e.pic_num;return t&&t.length>0&&i>0}},{key:"initThumbnail",value:function(){var e=this.config,t=e.width,i=e.height,n=e.pic_num,r=e.interval;this.ratio=t/i*100,this.interval=r||Math.round(this.player.duration/n),this._preloadMark={}}},{key:"getUrlByIndex",value:function(e){return e>=0&&e<this.config.urls.length?this.config.urls[e]:""}},{key:"preload",value:function(e){var t=this;if(!this._preloadMark[e]){var i=this.config.urls,n=i.length,r=[];e>0&&r.push(e-1),r.push(e),e>0&&e<n-1&&r.push(e+1),r.map((function(e){!t._preloadMark[e]&&e>=0&&e<n&&(t._preloadMark[e]=1,a["b"].preloadImg(i[e],(function(){t._preloadMark[e]=2})))}))}}},{key:"getPosition",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=this.config,r=n.pic_num,a=n.row,s=n.col,o=n.width,l=n.height;this.interval=Math.round(this.player.duration/r);var u=Math.ceil(e/this.interval);u=u>r?r:u;var c=u<a*s?0:Math.ceil(u/(a*s))-1,h=u-c*(s*a),d=h>0?Math.ceil(h/s)-1:0,f=h>0?h-d*s-1:0,g=0,v=0;if(t&&i){var p=t/i;p<o/l?(v=i,g=v*(o/l)):(g=t,v=g/(o/l))}else i?t||(v=i||l,g=v*(o/l)):(g=t||o,v=g/(o/l));var m=this.getUrlByIndex(c);return{urlIndex:c,rowIndex:d,colIndex:f,url:m,height:v,width:g,style:{backgroundImage:"url(".concat(m,")"),backgroundSize:"".concat(g*s,"px auto"),backgroundPosition:"-".concat(f*g,"px -").concat(d*v,"px"),width:"".concat(g,"px"),height:"".concat(v,"px")}}}},{key:"update",value:function(e,t){var i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,r=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"",a=this.config,s=a.pic_num,o=a.urls;if(!(s<=0)&&o&&0!==o.length){var l=this.getPosition(t,i,n);this.preload(l.urlIndex),Object.keys(l.style).map((function(t){e.style[t]=l.style[t]})),Object.keys(r).map((function(t){e.style[t]=r[t]}))}}},{key:"changeConfig",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.setConfig(e)}},{key:"createThumbnail",value:function(e,t){var i=a["b"].createDom("xg-thumbnail","",{},"thumbnail ".concat(t));return e&&e.appendChild(i),i}}],[{key:"pluginName",get:function(){return"thumbnail"}},{key:"defaultConfig",get:function(){return{isShow:!1,urls:[],pic_num:0,col:0,row:0,height:90,width:160,scale:1,className:"",hidePortrait:!1}}}]),i}(l["b"]),tt=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){}},{key:"update",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{cached:0,played:0},t=arguments.length>1?arguments[1]:void 0;t&&this.root&&(e.cached&&(this.find("xg-mini-progress-cache").style.width="".concat(e.cached/t*100,"%")),e.played&&(this.find("xg-mini-progress-played").style.width="".concat(e.played/t*100,"%")))}},{key:"render",value:function(){if(this.playerConfig.progress&&this.playerConfig.miniprogress)return'<xg-mini-progress class="xg-mini-progress">\n    <xg-mini-progress-cache class="xg-mini-progress-cache"></xg-mini-progress-cache>\n    <xg-mini-progress-played class="xg-mini-progress-played"></xg-mini-progress-played>\n    </xg-mini-progress>'}}],[{key:"pluginName",get:function(){return"MiniProgress"}},{key:"defaultConfig",get:function(){return{}}}]),i}(l["b"]),it={REAL_TIME:"realtime",FIRST_FRAME:"firstframe",FRAME_RATE:"framerate",POSTER:"poster"};function nt(){try{return parseInt(window.performance.now(),10)}catch(e){return(new Date).getTime()}}function rt(){try{var e=document.createElement("canvas").getContext;return!!e}catch(t){return!1}}var at=null,st=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,o=new Array(r),l=0;l<r;l++)o[l]=arguments[l];return e=t.call.apply(t,[this].concat(o)),Object(n["e"])(Object(n["a"])(e),"onLoadedData",(function(t){e.player&&(e._frameCount=e.config.startFrameCount,e.renderOnTimeupdate(t),e.off(s["TIME_UPDATE"],e.renderOnTimeupdate),e.on(s["TIME_UPDATE"],e.renderOnTimeupdate))})),Object(n["e"])(Object(n["a"])(e),"renderOnTimeupdate",(function(t){e._frameCount>0?(e.renderOnce(),e._frameCount--):(e._isLoaded=!0,e.off(s["TIME_UPDATE"],e.renderOnTimeupdate),!e.player.paused&&e._checkIfCanStart()&&e.start())})),Object(n["e"])(Object(n["a"])(e),"start",(function(){var t=e.player.media,i=nt(),n=e.checkVideoIsSupport(t);n&&e.canvasCtx&&(e.stop(),t.videoWidth&&t.videoHeight&&(e.videoPI=t.videoHeight>0?parseInt(t.videoWidth/t.videoHeight*100,10):0,(e.config.mode===it.REAL_TIME||i-e.preTime>=e.interval)&&(t&&t.videoWidth&&e.update(n,e.videoPI),e.preTime=i)),e.frameId=a["b"].requestAnimationFrame(e.start))})),Object(n["e"])(Object(n["a"])(e),"stop",(function(){e.frameId&&(a["b"].cancelAnimationFrame(e.frameId),e.frameId=null)})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;!0===this.playerConfig.dynamicBg&&(this.config.disable=!1),i.isSupport||(this.config.disable=!0);var t=this.config,n=t.disable,r=t.mode,a=t.frameRate;n||(this._pos={width:0,height:0,rwidth:0,rheight:0,x:0,y:0,pi:0},this.isStart=!1,this._isLoaded=!1,this.videoPI=0,this.preTime=0,this.interval=parseInt(1e3/a,10),this.canvas=null,this.canvasCtx=null,this._frameCount=0,this.once(s["COMPLETE"],(function(){e.player&&(e.init(),e.player.paused||e.start())})),r!==it.POSTER&&(r!==it.FIRST_FRAME&&(this.on(s["EMPTIED"],(function(){e.stop()})),this.on(s["PLAY"],(function(){e._checkIfCanStart()&&e.start()})),this.on(s["PAUSE"],(function(){e.stop()}))),this.on(s["LOADED_DATA"],this.onLoadedData),this.on(s["LOAD_START"],(function(){e._isLoaded=!1,e.stop()}))))}},{key:"init",value:function(){var e=this.player,t=this.config;this.canvasFilter=i.supportCanvasFilter();try{var n=this.config.isInnerRender&&e.innerContainer||e.root;n.insertAdjacentHTML("afterbegin",'<div class="xgplayer-dynamic-bg"><canvas>\n        </canvas><xgmask></xgmask></div>'),this.root=n.children[0],this.canvas=this.find("canvas"),this.canvasFilter||(this.canvas.style.filter=t.filter,this.canvas.style.webkitFilter=t.filter),this.mask=this.find("xgmask"),t.addMask&&(this.mask.style.background=t.maskBg),this.canvasCtx=this.canvas.getContext("2d"),this.renderByPoster()}catch(r){o["b"].logError("plugin:DynamicBg",r)}}},{key:"checkVideoIsSupport",value:function(e){if(!e)return null;var t=e&&e instanceof window.HTMLVideoElement?e:e.canvas?e.canvas:e.flyVideo?e.flyVideo:null;if(t&&("safari"!==r["a"].browser||!/^blob/.test(t.currentSrc)&&!/^blob/.test(t.src)))return t;var i=t?t.tagName.toLowerCase():"";return"canvas"===i||"img"===i?t:null}},{key:"renderByPoster",value:function(){var e=this.playerConfig.poster;if(e){var t="String"===a["b"].typeOf(e)?e:"String"===a["b"].typeOf(e.poster)?e.poster:null;this.updateImg(t)}}},{key:"_checkIfCanStart",value:function(){var e=this.config.mode;return this._isLoaded&&e!==it.FIRST_FRAME&&e!==it.POSTER}},{key:"renderOnce",value:function(){var e=this.player.media;if(e.videoWidth&&e.videoHeight){this.videoPI=parseInt(e.videoWidth/e.videoHeight*100,10);var t=this.checkVideoIsSupport(e);t&&e.videoWidth&&this.update(t,this.videoPI)}}},{key:"updateImg",value:function(e){var t=this;if(e){var i=this.canvas.getBoundingClientRect(),n=i.width,r=i.height,a=new window.Image;a.onload=function(){if(t.canvas&&!t.frameId&&!t.isStart){t.canvas.height=r,t.canvas.width=n;var e=parseInt(n/r*100,10);t.update(a,e),a=null}},a.src=e}}},{key:"update",value:function(e,t){if(this.canvas&&this.canvasCtx&&t)try{var i=this._pos,n=this.config,r=this.canvas.getBoundingClientRect(),a=r.width,s=r.height;if(a!==i.width||s!==i.height||i.pi!==t){var l=parseInt(a/s*100,10);i.pi=t,i.width=this.canvas.width=a,i.height=this.canvas.height=s;var u=s,c=a;l<t?c=parseInt(s*t/100,10):l>t&&(u=parseInt(100*a/t,10)),i.rwidth=c*n.multiple,i.rheight=u*n.multiple,i.x=(a-i.rwidth)/2,i.y=(s-i.rheight)/2}this.canvasFilter&&(this.canvasCtx.filter=n.filter),this.canvasCtx.drawImage(e,i.x,i.y,i.rwidth,i.rheight)}catch(h){o["b"].logError("plugin:DynamicBg",h)}}},{key:"destroy",value:function(){this.stop(),this.canvasCtx=null,this.canvas=null}},{key:"render",value:function(){return""}}],[{key:"pluginName",get:function(){return"dynamicBg"}},{key:"defaultConfig",get:function(){return{isInnerRender:!1,disable:!0,mode:"framerate",frameRate:10,filter:"blur(50px)",startFrameCount:2,addMask:!0,multiple:1.2,maskBg:"rgba(0,0,0,0.7)"}}},{key:"isSupport",get:function(){return"boolean"===typeof at||(at=rt()),at}},{key:"supportCanvasFilter",value:function(){return!("safari"===r["a"].browser||"firefox"===r["a"].browser)}}]),i}(l["b"]),ot=i("674d"),lt="info",ut=s["STATS_EVENTS"],ct=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"_recordUserActions",(function(t){var i=e._getTime(),r=Object.assign({},t,{msg:t.msg||t.action});e._stats[lt].push(Object(n["i"])(Object(n["i"])({type:"userAction"},i),{},{payload:r}))})),Object(n["e"])(Object(n["a"])(e),"_onReset",(function(){e.reset()})),Object(n["e"])(Object(n["a"])(e),"_recordInfo",(function(t){e.info(t)})),Object(n["e"])(Object(n["a"])(e),"_downloadStats",(function(){var t=e.getStats(),i=new Blob([JSON.stringify(t)],{type:"application/json"}),n=window.URL.createObjectURL(i),r=document.createElement("a");r.style.display="none",r.href=n,r.download="player.txt",r.disabled=!1,r.click()})),e}return Object(n["c"])(i,[{key:"_getTime",value:function(){return{timestamp:Date.now(),timeFormat:(new Date).toISOString()}}},{key:"afterCreate",value:function(){this.reset(),this.on(s["USER_ACTION"],this._recordUserActions),this.on(ut.STATS_INFO,this._recordInfo),this.on(ut.STATS_DOWNLOAD,this._downloadStats),this.on(ut.STATS_RESET,this._onReset)}},{key:"destroy",value:function(){this.offAll()}},{key:"downloadStats",value:function(){this._downloadStats()}},{key:"info",value:function(e){e.profile?this._infoProfile(e):this._info(e)}},{key:"_info",value:function(e){var t=this._getTime();this._stats[lt].push(Object(n["i"])(Object(n["i"])({},t),{},{payload:e}))}},{key:"_infoProfile",value:function(e){if(e&&e.startMs){var t=Date.now(),i=t-e.startMs,r=Object(n["i"])({cat:"function",dur:i,name:e.name||e.msg,ph:"X",pid:0,tid:0,ts:e.startMs,profile:!0},e);this._info(r)}}},{key:"reset",value:function(){var e;this._stats=(e={},Object(n["e"])(e,lt,[]),Object(n["e"])(e,"media",{}),e)}},{key:"getStats",value:function(){for(var e=this.player,t=e.media,i=[],n=0;n<t.buffered.length;n++)i.push({start:t.buffered.start(n),end:t.buffered.end(n)});var r={currentTime:t.currentTime,readyState:t.readyState,buffered:i,paused:t.paused,ended:t.ended};return this._stats.media=r,{raw:this._stats,timestat:this._getTimeStats(),profile:this._getProfile()}}},{key:"_getTimeStats",value:function(){var e=this._stats[lt],t=e.map((function(e){var t=e.payload.data,i="";try{t instanceof Error?i=t.msg:void 0!==t&&(i=JSON.stringify(t))}catch(n){}return"[".concat(e.timeFormat,"] : ").concat(e.payload.msg," ").concat(i," ")}));return t}},{key:"_getProfile",value:function(){var e={traceEvents:[]},t=this._stats[lt];return t.forEach((function(t){t.payload.profile&&e.traceEvents.push(t.payload)})),e}}],[{key:"pluginName",get:function(){return"stats"}},{key:"defaultConfig",get:function(){return{}}}]),i}(j["a"]),ht=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"onGapJump",(function(){var t=Object(n["a"])(e),r=t.player,a=t.config;if(r.media.readyState!==HTMLMediaElement.HAVE_NOTHING){if(r.media.seeking){if(!e.seekingEventReceived)return}else e.seekingEventReceived=!1;if(!r.media.paused||0===r.media.currentTime||!e.hasPlayed){var s=r.media.buffered,o=a.smallGapLimit||.5,l=a.gapDetectionThreshold||.3,u=r.media.currentTime,c=e._getIndex(s,u,l);if(null!==c&&0!==c){var h=s.start(c)+.1,d=r.media.duration;if(!(h>d)){var f=h-u,g=f<=o;f<i.BROWSER_GAP_TOLERANCE||g&&(!1!==a.useGapJump&&(r.media.currentTime=e.isSafari?h+.1:h),e.player&&e.player.emit("detectGap"),.08!==h&&r&&r.emit("log",{type:"oneevent",end_type:"gap",vid:r.config.vid,ext:{video_postion:Math.floor(1e3*h)}}))}}}}})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this,t=this.config.useGapJump;!1!==t&&(this.hasPlayed=!1,this.seekingEventReceived=!1,this.isSafari=/(Safari|iPhone|iPad|iPod)/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)&&!/BlackBerry/.test(navigator.platform),this.on(s["WAITING"],this.onGapJump),this.on(s["PLAY"],(function(){e.hasPlayed=!0})),this.on(s["SEEKING"],(function(){e.seekingEventReceived=!0})))}},{key:"_getIndex",value:function(e,t,i){if(!e||!e.length)return null;if(1===e.length&&e.end(0)-e.start(0)<1e-6)return null;for(var n=this._getBuffered(e),r=null,a=0;a<n.length;a++){var s=n[a];if(s.start>t&&(0===a||n[a-1].end-t<=i)){r=a;break}}return r}},{key:"_getBuffered",value:function(e){if(!e)return[];for(var t=[],i=0;i<e.length;i++)t.push({start:e.start(i),end:e.end(i)});return t}}],[{key:"pluginName",get:function(){return"gapJump"}},{key:"defaultConfig",get:function(){return{useGapJump:!1,smallGapLimit:.5,gapDetectionThreshold:.3}}}]),i}(l["b"]);ht.BROWSER_GAP_TOLERANCE=.001;var dt=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),s=0;s<r;s++)a[s]=arguments[s];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"onWaiting",(function(){var t=Object(n["a"])(e),i=t.config;e.jumpCnt>i.jumpCntMax||e.timer||!1===i.useWaitingTimeoutJump||(e.timer=setTimeout(e.onJump,1e3*i.waitingTime))})),Object(n["e"])(Object(n["a"])(e),"onJump",(function(){var t=Object(n["a"])(e),i=t.player,r=t.config;if(clearTimeout(e.timer),e.timer=null,!(e.jumpCnt>r.jumpCntMax||!1===r.useWaitingTimeoutJump)&&(!i.media.paused||0===i.media.currentTime||!e.hasPlayed)){e.jumpSize=r.jumpSize*(e.jumpCnt+1),e.jumpCnt===r.jumpSize&&e.jumpSize<6&&(e.jumpSize=6);var a=i.currentTime+e.jumpSize,s=i.media.duration;a>s||(e.jumpCnt++,i.currentTime=a)}})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this,t=this.config,i=t.useWaitingTimeoutJump,n=t.jumpSize;!1!==i&&(this.hasPlayed=!1,this.jumpCnt=0,this.timer=null,this.jumpSize=n,this.on(s["WAITING"],this.onWaiting),this.on([s["PLAYING"],s["CANPLAY"]],(function(){clearTimeout(e.timer),e.timer=null,e.jumpSize=e.config.jumpSize})),this.on(s["PLAY"],(function(){e.hasPlayed=!0})))}}],[{key:"pluginName",get:function(){return"waitingTimeoutJump"}},{key:"defaultConfig",get:function(){return{useWaitingTimeoutJump:!1,waitingTime:15,jumpSize:2,jumpCntMax:4}}}]),i}(l["b"]),ft=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){var e;Object(n["b"])(this,i);for(var r=arguments.length,a=new Array(r),o=0;o<r;o++)a[o]=arguments[o];return e=t.call.apply(t,[this].concat(a)),Object(n["e"])(Object(n["a"])(e),"getSpeed",(function(t){if(e.speedListCache.length<=0)return 0;var i=0;return e.speedListCache.map((function(e){i+=e})),Math.floor(i/e.speedListCache.length)})),Object(n["e"])(Object(n["a"])(e),"_onRealSpeedChange",(function(t){t.speed&&e.appendList(t.speed)})),Object(n["e"])(Object(n["a"])(e),"testSpeed",(function(){if(clearTimeout(e.timer),e.timer=null,e.player&&e.config.openSpeed){var t=e.config,i=t.url,n=t.loadSize,r=t.testCnt,a=t.testTimeStep,s=i+(i.indexOf("?")<0?"?testst=":"&testst=")+Date.now();if(!(e.cnt>=r)){e.cnt++;try{var o=(new Date).getTime(),l=null,u=new XMLHttpRequest;e.xhr=u,u.open("GET",s);var c={},h=Math.floor(10*Math.random());c.Range="bytes="+h+"-"+(n+h),c&&Object.keys(c).forEach((function(e){u.setRequestHeader(e,c[e])})),u.onreadystatechange=function(){if(4===u.readyState){e.xhr=null,l=(new Date).getTime();var t=u.getResponseHeader("Content-Length")/1024*8,i=Math.round(1e3*t/(l-o));e.appendList(i),e.timer=setTimeout(e.testSpeed,a)}},u.send()}catch(d){}}}})),Object(n["e"])(Object(n["a"])(e),"appendList",(function(t){var i=e.config.saveSpeedMax;e.speedListCache.length>=i&&e.speedListCache.shift(),e.speedListCache.push(t),e.player&&(e.player.realTimeSpeed=t),e.updateSpeed()})),Object(n["e"])(Object(n["a"])(e),"updateSpeed",(function(){var t=e.getSpeed(),i=Object(n["a"])(e),r=i.player;!r||r.avgSpeed&&t===r.avgSpeed||(r.avgSpeed=t,r.emit(s["DOWNLOAD_SPEED_CHANGE"],{speed:t,realTimeSpeed:r.realTimeSpeed}))})),e}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this;this.speedListCache=[];var t=this.config,i=t.openSpeed,n=t.testTimeStep;this.timer=null,this.cnt=0,this.xhr=null,i&&(this.on("real_time_speed",this._onRealSpeedChange),this.on([s["LOADED_DATA"],s["REPLAY"]],(function(){a["b"].isMSE(e.player.video)||(e.speedListCache=[],e.cnt=0,e.timer=setTimeout(e.testSpeed,n))})))}},{key:"openSpeed",get:function(){return this.config.openSpeed},set:function(e){if(this.config.openSpeed=e,!e&&this.timer)return clearTimeout(this.timer),void(this.timer=null);if(this.config.openSpeed){if(this.timer)return;this.timer=setTimeout(this.testSpeed,this.config.testTimeStep)}}},{key:"destroy",value:function(){clearTimeout(this.timer),this.timer=null,this.xhr&&4!==this.xhr.readyState&&(this.xhr.cancel(),this.xhr=null)}}],[{key:"pluginName",get:function(){return"testspeed"}},{key:"defaultConfig",get:function(){return{openSpeed:!1,testCnt:3,loadSize:204800,testTimeStep:3e3,url:"",saveSpeedMax:5}}}]),i}(l["b"]),gt=i("5e99"),vt=function(e){Object(n["h"])(i,e);var t=Object(n["d"])(i);function i(){return Object(n["b"])(this,i),t.apply(this,arguments)}return Object(n["c"])(i,[{key:"afterCreate",value:function(){var e=this,t=this.player,i=this.config;if(this.timer=null,this._lastDecodedFrames=0,this._currentStuckCount=0,this._lastCheckPoint=null,this._payload=[],!i.disabled){var n=t.media.getVideoPlaybackQuality;n&&(this.on(s["PLAY"],(function(){e._startTick()})),this.on(s["PAUSE"],(function(){e._stopTick()})),this.on(s["ENDED"],(function(){e._stopTick()})),this.on(s["EMPTIED"],(function(){e._stopTick()})))}}},{key:"_startTick",value:function(){var e=this;this._stopTick(),this._timer=setTimeout((function(){e._checkDecodeFPS(),e._startTick()}),this.config.tick)}},{key:"_stopTick",value:function(){clearTimeout(this._timer),this._timer=null}},{key:"_checkStuck",value:function(e,t,i,n){var r=this.player.media,a=document.hidden,o=r.paused;if("boolean"===typeof a&&!a&&!o){for(var l=r.currentTime,u=r.buffered,c=!1,h=[],d=0;d<u.length;d++){var f=u.start(d),g=u.end(d);if(h.push({start:f,end:g}),f<=l&&l<=g-1){c=!0;break}}4===r.readyState&&c&&(this._currentStuckCount>this.config.stuckCount?(this.emit(s["FPS_STUCK"],this._payload),this._reset()):e<=this.config.reportFrame?(this._currentStuckCount++,this._payload.push({bufs:h,currentTime:r.currentTime,curDecodedFrames:e,totalVideoFrames:t,droppedVideoFrames:i,checkInterval:n})):this._reset())}}},{key:"_reset",value:function(){this._payload=[],this._currentStuckCount=0}},{key:"_checkDecodeFPS",value:function(){if(this.player.media){var e=this.player.media.getVideoPlaybackQuality(),t=e.totalVideoFrames,i=e.droppedVideoFrames,n=performance.now();if(t&&this._lastCheckPoint){var r=t-this._lastDecodedFrames,a=n-this._lastCheckPoint;this._checkStuck(r,t,i,a)}this._lastDecodedFrames=t,this._lastCheckPoint=n}}},{key:"destroy",value:function(){this._stopTick()}}],[{key:"pluginName",get:function(){return"FpsDetect"}},{key:"defaultConfig",get:function(){return{disabled:!1,tick:1e3,stuckCount:3,reportFrame:0}}}]),i}(l["b"]);gt["a"].use(ot["a"]);var pt=Object(n["c"])((function e(t,i){var a,s,o;Object(n["b"])(this,e);var l=i&&"mobile"===i.isMobileSimulateMode,u=i.isLive,c=u?[]:[le,tt,$e,pe],d=[].concat(c,[ce,ve,ke,Oe,Be,Ge,Ie,De,Ee,Ae]),v=[f,g,T,re,k,We,ze,et,F];this.plugins=[ct,h].concat(Object(n["k"])(d),v,[ht,dt]);var p=l?"mobile":r["a"].device;switch(p){case"pc":(a=this.plugins).push.apply(a,[ie,H,Ke,ft,vt]);break;case"mobile":(s=this.plugins).push.apply(s,[$]);break;default:(o=this.plugins).push.apply(o,[ie,H,Ke])}(r["a"].os.isIpad||"pc"===p)&&this.plugins.push(st),r["a"].os.isIpad&&this.plugins.push(H),this.ignores=[],this.i18n=[]}))}}]);